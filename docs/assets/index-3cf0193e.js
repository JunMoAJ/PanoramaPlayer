import{d as tg,r as _T,a as hf,o as vT,b as ig,c as ng,e as yT,_ as TT,f as xT}from"./index-7ba4e608.js";/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const yh="152",ST=0,df=1,bT=2,sg=1,ET=2,Hn=3,cs=0,Si=1,Vn=2,us=0,wr=1,ff=2,pf=3,mf=4,AT=5,Sr=100,CT=101,MT=102,gf=103,_f=104,wT=200,DT=201,RT=202,PT=203,rg=204,ag=205,LT=206,IT=207,OT=208,UT=209,NT=210,kT=0,FT=1,BT=2,Lc=3,HT=4,VT=5,zT=6,GT=7,og=0,WT=1,qT=2,qn=0,$T=1,jT=2,XT=3,KT=4,YT=5,lg=300,Fr=301,Br=302,Ic=303,Oc=304,$l=306,Uc=1e3,en=1001,Nc=1002,ui=1003,vf=1004,Uu=1005,vi=1006,QT=1007,Qa=1008,zs=1009,ZT=1010,JT=1011,ug=1012,ex=1013,Ls=1014,Is=1015,Za=1016,tx=1017,ix=1018,Dr=1020,nx=1021,tn=1023,sx=1024,rx=1025,Ns=1026,Hr=1027,ax=1028,ox=1029,lx=1030,ux=1031,cx=1033,Nu=33776,ku=33777,Fu=33778,Bu=33779,yf=35840,Tf=35841,xf=35842,Sf=35843,hx=36196,bf=37492,Ef=37496,Af=37808,Cf=37809,Mf=37810,wf=37811,Df=37812,Rf=37813,Pf=37814,Lf=37815,If=37816,Of=37817,Uf=37818,Nf=37819,kf=37820,Ff=37821,Hu=36492,dx=36283,Bf=36284,Hf=36285,Vf=36286,cg=3e3,ks=3001,fx=3200,px=3201,mx=0,gx=1,Fs="",Ze="srgb",En="srgb-linear",hg="display-p3",Vu=7680,_x=519,zf=35044,Gf="300 es",kc=1035;class ea{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const s=n.slice(0);for(let r=0,a=s.length;r<a;r++)s[r].call(this,e);e.target=null}}}const ti=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Wf=1234567;const Va=Math.PI/180,Ja=180/Math.PI;function ta(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(ti[i&255]+ti[i>>8&255]+ti[i>>16&255]+ti[i>>24&255]+"-"+ti[e&255]+ti[e>>8&255]+"-"+ti[e>>16&15|64]+ti[e>>24&255]+"-"+ti[t&63|128]+ti[t>>8&255]+"-"+ti[t>>16&255]+ti[t>>24&255]+ti[n&255]+ti[n>>8&255]+ti[n>>16&255]+ti[n>>24&255]).toLowerCase()}function ci(i,e,t){return Math.max(e,Math.min(t,i))}function Th(i,e){return(i%e+e)%e}function vx(i,e,t,n,s){return n+(i-e)*(s-n)/(t-e)}function yx(i,e,t){return i!==e?(t-i)/(e-i):0}function za(i,e,t){return(1-t)*i+t*e}function Tx(i,e,t,n){return za(i,e,1-Math.exp(-t*n))}function xx(i,e=1){return e-Math.abs(Th(i,e*2)-e)}function Sx(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*(3-2*i))}function bx(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*i*(i*(i*6-15)+10))}function Ex(i,e){return i+Math.floor(Math.random()*(e-i+1))}function Ax(i,e){return i+Math.random()*(e-i)}function Cx(i){return i*(.5-Math.random())}function Mx(i){i!==void 0&&(Wf=i);let e=Wf+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function wx(i){return i*Va}function Dx(i){return i*Ja}function Fc(i){return(i&i-1)===0&&i!==0}function Rx(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function dg(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function Px(i,e,t,n,s){const r=Math.cos,a=Math.sin,o=r(t/2),l=a(t/2),u=r((e+n)/2),h=a((e+n)/2),d=r((e-n)/2),m=a((e-n)/2),y=r((n-e)/2),v=a((n-e)/2);switch(s){case"XYX":i.set(o*h,l*d,l*m,o*u);break;case"YZY":i.set(l*m,o*h,l*d,o*u);break;case"ZXZ":i.set(l*d,l*m,o*h,o*u);break;case"XZX":i.set(o*h,l*v,l*y,o*u);break;case"YXY":i.set(l*y,o*h,l*v,o*u);break;case"ZYZ":i.set(l*v,l*y,o*h,o*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Ia(i,e){switch(e.constructor){case Float32Array:return i;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function gi(i,e){switch(e.constructor){case Float32Array:return i;case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}const qf={DEG2RAD:Va,RAD2DEG:Ja,generateUUID:ta,clamp:ci,euclideanModulo:Th,mapLinear:vx,inverseLerp:yx,lerp:za,damp:Tx,pingpong:xx,smoothstep:Sx,smootherstep:bx,randInt:Ex,randFloat:Ax,randFloatSpread:Cx,seededRandom:Mx,degToRad:wx,radToDeg:Dx,isPowerOfTwo:Fc,ceilPowerOfTwo:Rx,floorPowerOfTwo:dg,setQuaternionFromProperEuler:Px,normalize:gi,denormalize:Ia};class Tt{constructor(e=0,t=0){Tt.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6],this.y=s[1]*t+s[4]*n+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(ci(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),s=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*n-a*s+e.x,this.y=r*s+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class at{constructor(){at.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,s,r,a,o,l,u){const h=this.elements;return h[0]=e,h[1]=s,h[2]=o,h[3]=t,h[4]=r,h[5]=l,h[6]=n,h[7]=a,h[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,r=this.elements,a=n[0],o=n[3],l=n[6],u=n[1],h=n[4],d=n[7],m=n[2],y=n[5],v=n[8],b=s[0],x=s[3],_=s[6],E=s[1],A=s[4],w=s[7],C=s[2],I=s[5],B=s[8];return r[0]=a*b+o*E+l*C,r[3]=a*x+o*A+l*I,r[6]=a*_+o*w+l*B,r[1]=u*b+h*E+d*C,r[4]=u*x+h*A+d*I,r[7]=u*_+h*w+d*B,r[2]=m*b+y*E+v*C,r[5]=m*x+y*A+v*I,r[8]=m*_+y*w+v*B,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],a=e[4],o=e[5],l=e[6],u=e[7],h=e[8];return t*a*h-t*o*u-n*r*h+n*o*l+s*r*u-s*a*l}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],a=e[4],o=e[5],l=e[6],u=e[7],h=e[8],d=h*a-o*u,m=o*l-h*r,y=u*r-a*l,v=t*d+n*m+s*y;if(v===0)return this.set(0,0,0,0,0,0,0,0,0);const b=1/v;return e[0]=d*b,e[1]=(s*u-h*n)*b,e[2]=(o*n-s*a)*b,e[3]=m*b,e[4]=(h*t-s*l)*b,e[5]=(s*r-o*t)*b,e[6]=y*b,e[7]=(n*l-u*t)*b,e[8]=(a*t-n*r)*b,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,s,r,a,o){const l=Math.cos(r),u=Math.sin(r);return this.set(n*l,n*u,-n*(l*a+u*o)+a+e,-s*u,s*l,-s*(-u*a+l*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(zu.makeScale(e,t)),this}rotate(e){return this.premultiply(zu.makeRotation(-e)),this}translate(e,t){return this.premultiply(zu.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<9;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const zu=new at;function fg(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}function Tl(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}const $f={};function Ga(i){i in $f||($f[i]=!0,console.warn(i))}function Rr(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function Gu(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}const Lx=new at().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),Ix=new at().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);function Ox(i){return i.convertSRGBToLinear().applyMatrix3(Ix)}function Ux(i){return i.applyMatrix3(Lx).convertLinearToSRGB()}const Nx={[En]:i=>i,[Ze]:i=>i.convertSRGBToLinear(),[hg]:Ox},kx={[En]:i=>i,[Ze]:i=>i.convertLinearToSRGB(),[hg]:Ux},Ki={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(i){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!i},get workingColorSpace(){return En},set workingColorSpace(i){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(i,e,t){if(this.enabled===!1||e===t||!e||!t)return i;const n=Nx[e],s=kx[t];if(n===void 0||s===void 0)throw new Error(`Unsupported color space conversion, "${e}" to "${t}".`);return s(n(i))},fromWorkingColorSpace:function(i,e){return this.convert(i,this.workingColorSpace,e)},toWorkingColorSpace:function(i,e){return this.convert(i,e,this.workingColorSpace)}};let er;class pg{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{er===void 0&&(er=Tl("canvas")),er.width=e.width,er.height=e.height;const n=er.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=er}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Tl("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const s=n.getImageData(0,0,e.width,e.height),r=s.data;for(let a=0;a<r.length;a++)r[a]=Rr(r[a]/255)*255;return n.putImageData(s,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(Rr(t[n]/255)*255):t[n]=Rr(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class mg{constructor(e=null){this.isSource=!0,this.uuid=ta(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let a=0,o=s.length;a<o;a++)s[a].isDataTexture?r.push(Wu(s[a].image)):r.push(Wu(s[a]))}else r=Wu(s);n.url=r}return t||(e.images[this.uuid]=n),n}}function Wu(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?pg.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Fx=0;class bi extends ea{constructor(e=bi.DEFAULT_IMAGE,t=bi.DEFAULT_MAPPING,n=en,s=en,r=vi,a=Qa,o=tn,l=zs,u=bi.DEFAULT_ANISOTROPY,h=Fs){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Fx++}),this.uuid=ta(),this.name="",this.source=new mg(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=s,this.magFilter=r,this.minFilter=a,this.anisotropy=u,this.format=o,this.internalFormat=null,this.type=l,this.offset=new Tt(0,0),this.repeat=new Tt(1,1),this.center=new Tt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new at,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof h=="string"?this.colorSpace=h:(Ga("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=h===ks?Ze:Fs),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==lg)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Uc:e.x=e.x-Math.floor(e.x);break;case en:e.x=e.x<0?0:1;break;case Nc:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Uc:e.y=e.y-Math.floor(e.y);break;case en:e.y=e.y<0?0:1;break;case Nc:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return Ga("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Ze?ks:cg}set encoding(e){Ga("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===ks?Ze:Fs}}bi.DEFAULT_IMAGE=null;bi.DEFAULT_MAPPING=lg;bi.DEFAULT_ANISOTROPY=1;class Qt{constructor(e=0,t=0,n=0,s=1){Qt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,s){return this.x=e,this.y=t,this.z=n,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*s+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*s+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*s+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*s+a[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,s,r;const l=e.elements,u=l[0],h=l[4],d=l[8],m=l[1],y=l[5],v=l[9],b=l[2],x=l[6],_=l[10];if(Math.abs(h-m)<.01&&Math.abs(d-b)<.01&&Math.abs(v-x)<.01){if(Math.abs(h+m)<.1&&Math.abs(d+b)<.1&&Math.abs(v+x)<.1&&Math.abs(u+y+_-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const A=(u+1)/2,w=(y+1)/2,C=(_+1)/2,I=(h+m)/4,B=(d+b)/4,X=(v+x)/4;return A>w&&A>C?A<.01?(n=0,s=.707106781,r=.707106781):(n=Math.sqrt(A),s=I/n,r=B/n):w>C?w<.01?(n=.707106781,s=0,r=.707106781):(s=Math.sqrt(w),n=I/s,r=X/s):C<.01?(n=.707106781,s=.707106781,r=0):(r=Math.sqrt(C),n=B/r,s=X/r),this.set(n,s,r,t),this}let E=Math.sqrt((x-v)*(x-v)+(d-b)*(d-b)+(m-h)*(m-h));return Math.abs(E)<.001&&(E=1),this.x=(x-v)/E,this.y=(d-b)/E,this.z=(m-h)/E,this.w=Math.acos((u+y+_-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Gs extends ea{constructor(e=1,t=1,n={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Qt(0,0,e,t),this.scissorTest=!1,this.viewport=new Qt(0,0,e,t);const s={width:e,height:t,depth:1};n.encoding!==void 0&&(Ga("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===ks?Ze:Fs),this.texture=new bi(s,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.internalFormat=n.internalFormat!==void 0?n.internalFormat:null,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:vi,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null,this.samples=n.samples!==void 0?n.samples:0}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new mg(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class gg extends bi{constructor(e=null,t=1,n=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:s},this.magFilter=ui,this.minFilter=ui,this.wrapR=en,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Bx extends bi{constructor(e=null,t=1,n=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:s},this.magFilter=ui,this.minFilter=ui,this.wrapR=en,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class uo{constructor(e=0,t=0,n=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=s}static slerpFlat(e,t,n,s,r,a,o){let l=n[s+0],u=n[s+1],h=n[s+2],d=n[s+3];const m=r[a+0],y=r[a+1],v=r[a+2],b=r[a+3];if(o===0){e[t+0]=l,e[t+1]=u,e[t+2]=h,e[t+3]=d;return}if(o===1){e[t+0]=m,e[t+1]=y,e[t+2]=v,e[t+3]=b;return}if(d!==b||l!==m||u!==y||h!==v){let x=1-o;const _=l*m+u*y+h*v+d*b,E=_>=0?1:-1,A=1-_*_;if(A>Number.EPSILON){const C=Math.sqrt(A),I=Math.atan2(C,_*E);x=Math.sin(x*I)/C,o=Math.sin(o*I)/C}const w=o*E;if(l=l*x+m*w,u=u*x+y*w,h=h*x+v*w,d=d*x+b*w,x===1-o){const C=1/Math.sqrt(l*l+u*u+h*h+d*d);l*=C,u*=C,h*=C,d*=C}}e[t]=l,e[t+1]=u,e[t+2]=h,e[t+3]=d}static multiplyQuaternionsFlat(e,t,n,s,r,a){const o=n[s],l=n[s+1],u=n[s+2],h=n[s+3],d=r[a],m=r[a+1],y=r[a+2],v=r[a+3];return e[t]=o*v+h*d+l*y-u*m,e[t+1]=l*v+h*m+u*d-o*y,e[t+2]=u*v+h*y+o*m-l*d,e[t+3]=h*v-o*d-l*m-u*y,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,s){return this._x=e,this._y=t,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,s=e._y,r=e._z,a=e._order,o=Math.cos,l=Math.sin,u=o(n/2),h=o(s/2),d=o(r/2),m=l(n/2),y=l(s/2),v=l(r/2);switch(a){case"XYZ":this._x=m*h*d+u*y*v,this._y=u*y*d-m*h*v,this._z=u*h*v+m*y*d,this._w=u*h*d-m*y*v;break;case"YXZ":this._x=m*h*d+u*y*v,this._y=u*y*d-m*h*v,this._z=u*h*v-m*y*d,this._w=u*h*d+m*y*v;break;case"ZXY":this._x=m*h*d-u*y*v,this._y=u*y*d+m*h*v,this._z=u*h*v+m*y*d,this._w=u*h*d-m*y*v;break;case"ZYX":this._x=m*h*d-u*y*v,this._y=u*y*d+m*h*v,this._z=u*h*v-m*y*d,this._w=u*h*d+m*y*v;break;case"YZX":this._x=m*h*d+u*y*v,this._y=u*y*d+m*h*v,this._z=u*h*v-m*y*d,this._w=u*h*d-m*y*v;break;case"XZY":this._x=m*h*d-u*y*v,this._y=u*y*d-m*h*v,this._z=u*h*v+m*y*d,this._w=u*h*d+m*y*v;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,s=Math.sin(n);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],s=t[4],r=t[8],a=t[1],o=t[5],l=t[9],u=t[2],h=t[6],d=t[10],m=n+o+d;if(m>0){const y=.5/Math.sqrt(m+1);this._w=.25/y,this._x=(h-l)*y,this._y=(r-u)*y,this._z=(a-s)*y}else if(n>o&&n>d){const y=2*Math.sqrt(1+n-o-d);this._w=(h-l)/y,this._x=.25*y,this._y=(s+a)/y,this._z=(r+u)/y}else if(o>d){const y=2*Math.sqrt(1+o-n-d);this._w=(r-u)/y,this._x=(s+a)/y,this._y=.25*y,this._z=(l+h)/y}else{const y=2*Math.sqrt(1+d-n-o);this._w=(a-s)/y,this._x=(r+u)/y,this._y=(l+h)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ci(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const s=Math.min(1,t/n);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,s=e._y,r=e._z,a=e._w,o=t._x,l=t._y,u=t._z,h=t._w;return this._x=n*h+a*o+s*u-r*l,this._y=s*h+a*l+r*o-n*u,this._z=r*h+a*u+n*l-s*o,this._w=a*h-n*o-s*l-r*u,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,s=this._y,r=this._z,a=this._w;let o=a*e._w+n*e._x+s*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=s,this._z=r,this;const l=1-o*o;if(l<=Number.EPSILON){const y=1-t;return this._w=y*a+t*this._w,this._x=y*n+t*this._x,this._y=y*s+t*this._y,this._z=y*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const u=Math.sqrt(l),h=Math.atan2(u,o),d=Math.sin((1-t)*h)/u,m=Math.sin(t*h)/u;return this._w=a*d+this._w*m,this._x=n*d+this._x*m,this._y=s*d+this._y*m,this._z=r*d+this._z*m,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),s=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(s),n*Math.sin(r),n*Math.cos(r),t*Math.sin(s))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Y{constructor(e=0,t=0,n=0){Y.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(jf.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(jf.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*s,this.y=r[1]*t+r[4]*n+r[7]*s,this.z=r[2]*t+r[5]*n+r[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*s+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*s+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*s+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*s+r[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,s=this.z,r=e.x,a=e.y,o=e.z,l=e.w,u=l*t+a*s-o*n,h=l*n+o*t-r*s,d=l*s+r*n-a*t,m=-r*t-a*n-o*s;return this.x=u*l+m*-r+h*-o-d*-a,this.y=h*l+m*-a+d*-r-u*-o,this.z=d*l+m*-o+u*-a-h*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*s,this.y=r[1]*t+r[5]*n+r[9]*s,this.z=r[2]*t+r[6]*n+r[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,s=e.y,r=e.z,a=t.x,o=t.y,l=t.z;return this.x=s*l-r*o,this.y=r*a-n*l,this.z=n*o-s*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return qu.copy(this).projectOnVector(e),this.sub(qu)}reflect(e){return this.sub(qu.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(ci(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return t*t+n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const s=Math.sin(t)*e;return this.x=s*Math.sin(n),this.y=Math.cos(t)*e,this.z=s*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const qu=new Y,jf=new uo;class co{constructor(e=new Y(1/0,1/0,1/0),t=new Y(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(On.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(On.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=On.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){if(e.updateWorldMatrix(!1,!1),e.boundingBox!==void 0)e.boundingBox===null&&e.computeBoundingBox(),tr.copy(e.boundingBox),tr.applyMatrix4(e.matrixWorld),this.union(tr);else{const s=e.geometry;if(s!==void 0)if(t&&s.attributes!==void 0&&s.attributes.position!==void 0){const r=s.attributes.position;for(let a=0,o=r.count;a<o;a++)On.fromBufferAttribute(r,a).applyMatrix4(e.matrixWorld),this.expandByPoint(On)}else s.boundingBox===null&&s.computeBoundingBox(),tr.copy(s.boundingBox),tr.applyMatrix4(e.matrixWorld),this.union(tr)}const n=e.children;for(let s=0,r=n.length;s<r;s++)this.expandByObject(n[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,On),On.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(xa),Ho.subVectors(this.max,xa),ir.subVectors(e.a,xa),nr.subVectors(e.b,xa),sr.subVectors(e.c,xa),ts.subVectors(nr,ir),is.subVectors(sr,nr),bs.subVectors(ir,sr);let t=[0,-ts.z,ts.y,0,-is.z,is.y,0,-bs.z,bs.y,ts.z,0,-ts.x,is.z,0,-is.x,bs.z,0,-bs.x,-ts.y,ts.x,0,-is.y,is.x,0,-bs.y,bs.x,0];return!$u(t,ir,nr,sr,Ho)||(t=[1,0,0,0,1,0,0,0,1],!$u(t,ir,nr,sr,Ho))?!1:(Vo.crossVectors(ts,is),t=[Vo.x,Vo.y,Vo.z],$u(t,ir,nr,sr,Ho))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,On).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(On).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(In[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),In[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),In[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),In[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),In[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),In[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),In[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),In[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(In),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const In=[new Y,new Y,new Y,new Y,new Y,new Y,new Y,new Y],On=new Y,tr=new co,ir=new Y,nr=new Y,sr=new Y,ts=new Y,is=new Y,bs=new Y,xa=new Y,Ho=new Y,Vo=new Y,Es=new Y;function $u(i,e,t,n,s){for(let r=0,a=i.length-3;r<=a;r+=3){Es.fromArray(i,r);const o=s.x*Math.abs(Es.x)+s.y*Math.abs(Es.y)+s.z*Math.abs(Es.z),l=e.dot(Es),u=t.dot(Es),h=n.dot(Es);if(Math.max(-Math.max(l,u,h),Math.min(l,u,h))>o)return!1}return!0}const Hx=new co,Sa=new Y,ju=new Y;class xh{constructor(e=new Y,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):Hx.setFromPoints(e).getCenter(n);let s=0;for(let r=0,a=e.length;r<a;r++)s=Math.max(s,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Sa.subVectors(e,this.center);const t=Sa.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),s=(n-this.radius)*.5;this.center.addScaledVector(Sa,s/n),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(ju.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Sa.copy(e.center).add(ju)),this.expandByPoint(Sa.copy(e.center).sub(ju))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Un=new Y,Xu=new Y,zo=new Y,ns=new Y,Ku=new Y,Go=new Y,Yu=new Y;class Vx{constructor(e=new Y,t=new Y(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Un)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Un.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Un.copy(this.origin).addScaledVector(this.direction,t),Un.distanceToSquared(e))}distanceSqToSegment(e,t,n,s){Xu.copy(e).add(t).multiplyScalar(.5),zo.copy(t).sub(e).normalize(),ns.copy(this.origin).sub(Xu);const r=e.distanceTo(t)*.5,a=-this.direction.dot(zo),o=ns.dot(this.direction),l=-ns.dot(zo),u=ns.lengthSq(),h=Math.abs(1-a*a);let d,m,y,v;if(h>0)if(d=a*l-o,m=a*o-l,v=r*h,d>=0)if(m>=-v)if(m<=v){const b=1/h;d*=b,m*=b,y=d*(d+a*m+2*o)+m*(a*d+m+2*l)+u}else m=r,d=Math.max(0,-(a*m+o)),y=-d*d+m*(m+2*l)+u;else m=-r,d=Math.max(0,-(a*m+o)),y=-d*d+m*(m+2*l)+u;else m<=-v?(d=Math.max(0,-(-a*r+o)),m=d>0?-r:Math.min(Math.max(-r,-l),r),y=-d*d+m*(m+2*l)+u):m<=v?(d=0,m=Math.min(Math.max(-r,-l),r),y=m*(m+2*l)+u):(d=Math.max(0,-(a*r+o)),m=d>0?r:Math.min(Math.max(-r,-l),r),y=-d*d+m*(m+2*l)+u);else m=a>0?-r:r,d=Math.max(0,-(a*m+o)),y=-d*d+m*(m+2*l)+u;return n&&n.copy(this.origin).addScaledVector(this.direction,d),s&&s.copy(Xu).addScaledVector(zo,m),y}intersectSphere(e,t){Un.subVectors(e.center,this.origin);const n=Un.dot(this.direction),s=Un.dot(Un)-n*n,r=e.radius*e.radius;if(s>r)return null;const a=Math.sqrt(r-s),o=n-a,l=n+a;return l<0?null:o<0?this.at(l,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,s,r,a,o,l;const u=1/this.direction.x,h=1/this.direction.y,d=1/this.direction.z,m=this.origin;return u>=0?(n=(e.min.x-m.x)*u,s=(e.max.x-m.x)*u):(n=(e.max.x-m.x)*u,s=(e.min.x-m.x)*u),h>=0?(r=(e.min.y-m.y)*h,a=(e.max.y-m.y)*h):(r=(e.max.y-m.y)*h,a=(e.min.y-m.y)*h),n>a||r>s||((r>n||isNaN(n))&&(n=r),(a<s||isNaN(s))&&(s=a),d>=0?(o=(e.min.z-m.z)*d,l=(e.max.z-m.z)*d):(o=(e.max.z-m.z)*d,l=(e.min.z-m.z)*d),n>l||o>s)||((o>n||n!==n)&&(n=o),(l<s||s!==s)&&(s=l),s<0)?null:this.at(n>=0?n:s,t)}intersectsBox(e){return this.intersectBox(e,Un)!==null}intersectTriangle(e,t,n,s,r){Ku.subVectors(t,e),Go.subVectors(n,e),Yu.crossVectors(Ku,Go);let a=this.direction.dot(Yu),o;if(a>0){if(s)return null;o=1}else if(a<0)o=-1,a=-a;else return null;ns.subVectors(this.origin,e);const l=o*this.direction.dot(Go.crossVectors(ns,Go));if(l<0)return null;const u=o*this.direction.dot(Ku.cross(ns));if(u<0||l+u>a)return null;const h=-o*ns.dot(Yu);return h<0?null:this.at(h/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Zt{constructor(){Zt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,n,s,r,a,o,l,u,h,d,m,y,v,b,x){const _=this.elements;return _[0]=e,_[4]=t,_[8]=n,_[12]=s,_[1]=r,_[5]=a,_[9]=o,_[13]=l,_[2]=u,_[6]=h,_[10]=d,_[14]=m,_[3]=y,_[7]=v,_[11]=b,_[15]=x,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Zt().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,s=1/rr.setFromMatrixColumn(e,0).length(),r=1/rr.setFromMatrixColumn(e,1).length(),a=1/rr.setFromMatrixColumn(e,2).length();return t[0]=n[0]*s,t[1]=n[1]*s,t[2]=n[2]*s,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,s=e.y,r=e.z,a=Math.cos(n),o=Math.sin(n),l=Math.cos(s),u=Math.sin(s),h=Math.cos(r),d=Math.sin(r);if(e.order==="XYZ"){const m=a*h,y=a*d,v=o*h,b=o*d;t[0]=l*h,t[4]=-l*d,t[8]=u,t[1]=y+v*u,t[5]=m-b*u,t[9]=-o*l,t[2]=b-m*u,t[6]=v+y*u,t[10]=a*l}else if(e.order==="YXZ"){const m=l*h,y=l*d,v=u*h,b=u*d;t[0]=m+b*o,t[4]=v*o-y,t[8]=a*u,t[1]=a*d,t[5]=a*h,t[9]=-o,t[2]=y*o-v,t[6]=b+m*o,t[10]=a*l}else if(e.order==="ZXY"){const m=l*h,y=l*d,v=u*h,b=u*d;t[0]=m-b*o,t[4]=-a*d,t[8]=v+y*o,t[1]=y+v*o,t[5]=a*h,t[9]=b-m*o,t[2]=-a*u,t[6]=o,t[10]=a*l}else if(e.order==="ZYX"){const m=a*h,y=a*d,v=o*h,b=o*d;t[0]=l*h,t[4]=v*u-y,t[8]=m*u+b,t[1]=l*d,t[5]=b*u+m,t[9]=y*u-v,t[2]=-u,t[6]=o*l,t[10]=a*l}else if(e.order==="YZX"){const m=a*l,y=a*u,v=o*l,b=o*u;t[0]=l*h,t[4]=b-m*d,t[8]=v*d+y,t[1]=d,t[5]=a*h,t[9]=-o*h,t[2]=-u*h,t[6]=y*d+v,t[10]=m-b*d}else if(e.order==="XZY"){const m=a*l,y=a*u,v=o*l,b=o*u;t[0]=l*h,t[4]=-d,t[8]=u*h,t[1]=m*d+b,t[5]=a*h,t[9]=y*d-v,t[2]=v*d-y,t[6]=o*h,t[10]=b*d+m}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(zx,e,Gx)}lookAt(e,t,n){const s=this.elements;return wi.subVectors(e,t),wi.lengthSq()===0&&(wi.z=1),wi.normalize(),ss.crossVectors(n,wi),ss.lengthSq()===0&&(Math.abs(n.z)===1?wi.x+=1e-4:wi.z+=1e-4,wi.normalize(),ss.crossVectors(n,wi)),ss.normalize(),Wo.crossVectors(wi,ss),s[0]=ss.x,s[4]=Wo.x,s[8]=wi.x,s[1]=ss.y,s[5]=Wo.y,s[9]=wi.y,s[2]=ss.z,s[6]=Wo.z,s[10]=wi.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,r=this.elements,a=n[0],o=n[4],l=n[8],u=n[12],h=n[1],d=n[5],m=n[9],y=n[13],v=n[2],b=n[6],x=n[10],_=n[14],E=n[3],A=n[7],w=n[11],C=n[15],I=s[0],B=s[4],X=s[8],M=s[12],F=s[1],Q=s[5],oe=s[9],H=s[13],$=s[2],Z=s[6],le=s[10],ie=s[14],ue=s[3],de=s[7],fe=s[11],Pe=s[15];return r[0]=a*I+o*F+l*$+u*ue,r[4]=a*B+o*Q+l*Z+u*de,r[8]=a*X+o*oe+l*le+u*fe,r[12]=a*M+o*H+l*ie+u*Pe,r[1]=h*I+d*F+m*$+y*ue,r[5]=h*B+d*Q+m*Z+y*de,r[9]=h*X+d*oe+m*le+y*fe,r[13]=h*M+d*H+m*ie+y*Pe,r[2]=v*I+b*F+x*$+_*ue,r[6]=v*B+b*Q+x*Z+_*de,r[10]=v*X+b*oe+x*le+_*fe,r[14]=v*M+b*H+x*ie+_*Pe,r[3]=E*I+A*F+w*$+C*ue,r[7]=E*B+A*Q+w*Z+C*de,r[11]=E*X+A*oe+w*le+C*fe,r[15]=E*M+A*H+w*ie+C*Pe,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],s=e[8],r=e[12],a=e[1],o=e[5],l=e[9],u=e[13],h=e[2],d=e[6],m=e[10],y=e[14],v=e[3],b=e[7],x=e[11],_=e[15];return v*(+r*l*d-s*u*d-r*o*m+n*u*m+s*o*y-n*l*y)+b*(+t*l*y-t*u*m+r*a*m-s*a*y+s*u*h-r*l*h)+x*(+t*u*d-t*o*y-r*a*d+n*a*y+r*o*h-n*u*h)+_*(-s*o*h-t*l*d+t*o*m+s*a*d-n*a*m+n*l*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],a=e[4],o=e[5],l=e[6],u=e[7],h=e[8],d=e[9],m=e[10],y=e[11],v=e[12],b=e[13],x=e[14],_=e[15],E=d*x*u-b*m*u+b*l*y-o*x*y-d*l*_+o*m*_,A=v*m*u-h*x*u-v*l*y+a*x*y+h*l*_-a*m*_,w=h*b*u-v*d*u+v*o*y-a*b*y-h*o*_+a*d*_,C=v*d*l-h*b*l-v*o*m+a*b*m+h*o*x-a*d*x,I=t*E+n*A+s*w+r*C;if(I===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const B=1/I;return e[0]=E*B,e[1]=(b*m*r-d*x*r-b*s*y+n*x*y+d*s*_-n*m*_)*B,e[2]=(o*x*r-b*l*r+b*s*u-n*x*u-o*s*_+n*l*_)*B,e[3]=(d*l*r-o*m*r-d*s*u+n*m*u+o*s*y-n*l*y)*B,e[4]=A*B,e[5]=(h*x*r-v*m*r+v*s*y-t*x*y-h*s*_+t*m*_)*B,e[6]=(v*l*r-a*x*r-v*s*u+t*x*u+a*s*_-t*l*_)*B,e[7]=(a*m*r-h*l*r+h*s*u-t*m*u-a*s*y+t*l*y)*B,e[8]=w*B,e[9]=(v*d*r-h*b*r-v*n*y+t*b*y+h*n*_-t*d*_)*B,e[10]=(a*b*r-v*o*r+v*n*u-t*b*u-a*n*_+t*o*_)*B,e[11]=(h*o*r-a*d*r-h*n*u+t*d*u+a*n*y-t*o*y)*B,e[12]=C*B,e[13]=(h*b*s-v*d*s+v*n*m-t*b*m-h*n*x+t*d*x)*B,e[14]=(v*o*s-a*b*s-v*n*l+t*b*l+a*n*x-t*o*x)*B,e[15]=(a*d*s-h*o*s+h*n*l-t*d*l-a*n*m+t*o*m)*B,this}scale(e){const t=this.elements,n=e.x,s=e.y,r=e.z;return t[0]*=n,t[4]*=s,t[8]*=r,t[1]*=n,t[5]*=s,t[9]*=r,t[2]*=n,t[6]*=s,t[10]*=r,t[3]*=n,t[7]*=s,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,s))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),s=Math.sin(t),r=1-n,a=e.x,o=e.y,l=e.z,u=r*a,h=r*o;return this.set(u*a+n,u*o-s*l,u*l+s*o,0,u*o+s*l,h*o+n,h*l-s*a,0,u*l-s*o,h*l+s*a,r*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,s,r,a){return this.set(1,n,r,0,e,1,a,0,t,s,1,0,0,0,0,1),this}compose(e,t,n){const s=this.elements,r=t._x,a=t._y,o=t._z,l=t._w,u=r+r,h=a+a,d=o+o,m=r*u,y=r*h,v=r*d,b=a*h,x=a*d,_=o*d,E=l*u,A=l*h,w=l*d,C=n.x,I=n.y,B=n.z;return s[0]=(1-(b+_))*C,s[1]=(y+w)*C,s[2]=(v-A)*C,s[3]=0,s[4]=(y-w)*I,s[5]=(1-(m+_))*I,s[6]=(x+E)*I,s[7]=0,s[8]=(v+A)*B,s[9]=(x-E)*B,s[10]=(1-(m+b))*B,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,n){const s=this.elements;let r=rr.set(s[0],s[1],s[2]).length();const a=rr.set(s[4],s[5],s[6]).length(),o=rr.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),e.x=s[12],e.y=s[13],e.z=s[14],Yi.copy(this);const u=1/r,h=1/a,d=1/o;return Yi.elements[0]*=u,Yi.elements[1]*=u,Yi.elements[2]*=u,Yi.elements[4]*=h,Yi.elements[5]*=h,Yi.elements[6]*=h,Yi.elements[8]*=d,Yi.elements[9]*=d,Yi.elements[10]*=d,t.setFromRotationMatrix(Yi),n.x=r,n.y=a,n.z=o,this}makePerspective(e,t,n,s,r,a){const o=this.elements,l=2*r/(t-e),u=2*r/(n-s),h=(t+e)/(t-e),d=(n+s)/(n-s),m=-(a+r)/(a-r),y=-2*a*r/(a-r);return o[0]=l,o[4]=0,o[8]=h,o[12]=0,o[1]=0,o[5]=u,o[9]=d,o[13]=0,o[2]=0,o[6]=0,o[10]=m,o[14]=y,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,n,s,r,a){const o=this.elements,l=1/(t-e),u=1/(n-s),h=1/(a-r),d=(t+e)*l,m=(n+s)*u,y=(a+r)*h;return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-d,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-m,o[2]=0,o[6]=0,o[10]=-2*h,o[14]=-y,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<16;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const rr=new Y,Yi=new Zt,zx=new Y(0,0,0),Gx=new Y(1,1,1),ss=new Y,Wo=new Y,wi=new Y,Xf=new Zt,Kf=new uo;class jl{constructor(e=0,t=0,n=0,s=jl.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,s=this._order){return this._x=e,this._y=t,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const s=e.elements,r=s[0],a=s[4],o=s[8],l=s[1],u=s[5],h=s[9],d=s[2],m=s[6],y=s[10];switch(t){case"XYZ":this._y=Math.asin(ci(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,y),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(m,u),this._z=0);break;case"YXZ":this._x=Math.asin(-ci(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(o,y),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-d,r),this._z=0);break;case"ZXY":this._x=Math.asin(ci(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-d,y),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-ci(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(m,y),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(ci(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,u),this._y=Math.atan2(-d,r)):(this._x=0,this._y=Math.atan2(o,y));break;case"XZY":this._z=Math.asin(-ci(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(m,u),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-h,y),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Xf.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Xf,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Kf.setFromEuler(this),this.setFromQuaternion(Kf,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}jl.DEFAULT_ORDER="XYZ";class _g{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let Wx=0;const Yf=new Y,ar=new uo,Nn=new Zt,qo=new Y,ba=new Y,qx=new Y,$x=new uo,Qf=new Y(1,0,0),Zf=new Y(0,1,0),Jf=new Y(0,0,1),jx={type:"added"},ep={type:"removed"};class Oi extends ea{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Wx++}),this.uuid=ta(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Oi.DEFAULT_UP.clone();const e=new Y,t=new jl,n=new uo,s=new Y(1,1,1);function r(){n.setFromEuler(t,!1)}function a(){t.setFromQuaternion(n,void 0,!1)}t._onChange(r),n._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Zt},normalMatrix:{value:new at}}),this.matrix=new Zt,this.matrixWorld=new Zt,this.matrixAutoUpdate=Oi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Oi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new _g,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ar.setFromAxisAngle(e,t),this.quaternion.multiply(ar),this}rotateOnWorldAxis(e,t){return ar.setFromAxisAngle(e,t),this.quaternion.premultiply(ar),this}rotateX(e){return this.rotateOnAxis(Qf,e)}rotateY(e){return this.rotateOnAxis(Zf,e)}rotateZ(e){return this.rotateOnAxis(Jf,e)}translateOnAxis(e,t){return Yf.copy(e).applyQuaternion(this.quaternion),this.position.add(Yf.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Qf,e)}translateY(e){return this.translateOnAxis(Zf,e)}translateZ(e){return this.translateOnAxis(Jf,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Nn.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?qo.copy(e):qo.set(e,t,n);const s=this.parent;this.updateWorldMatrix(!0,!1),ba.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Nn.lookAt(ba,qo,this.up):Nn.lookAt(qo,ba,this.up),this.quaternion.setFromRotationMatrix(Nn),s&&(Nn.extractRotation(s.matrixWorld),ar.setFromRotationMatrix(Nn),this.quaternion.premultiply(ar.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(jx)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(ep)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(ep)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Nn.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Nn.multiply(e.parent.matrixWorld)),e.applyMatrix4(Nn),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,s=this.children.length;n<s;n++){const a=this.children[n].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t){let n=[];this[e]===t&&n.push(this);for(let s=0,r=this.children.length;s<r;s++){const a=this.children[s].getObjectsByProperty(e,t);a.length>0&&(n=n.concat(a))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ba,e,qx),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ba,$x,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,s=t.length;n<s;n++){const r=t[n];(r.matrixWorldAutoUpdate===!0||e===!0)&&r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const s=this.children;for(let r=0,a=s.length;r<a;r++){const o=s[r];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON()));function r(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let u=0,h=l.length;u<h;u++){const d=l[u];r(e.shapes,d)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,u=this.material.length;l<u;l++)o.push(r(e.materials,this.material[l]));s.material=o}else s.material=r(e.materials,this.material);if(this.children.length>0){s.children=[];for(let o=0;o<this.children.length;o++)s.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];s.animations.push(r(e.animations,l))}}if(t){const o=a(e.geometries),l=a(e.materials),u=a(e.textures),h=a(e.images),d=a(e.shapes),m=a(e.skeletons),y=a(e.animations),v=a(e.nodes);o.length>0&&(n.geometries=o),l.length>0&&(n.materials=l),u.length>0&&(n.textures=u),h.length>0&&(n.images=h),d.length>0&&(n.shapes=d),m.length>0&&(n.skeletons=m),y.length>0&&(n.animations=y),v.length>0&&(n.nodes=v)}return n.object=s,n;function a(o){const l=[];for(const u in o){const h=o[u];delete h.metadata,l.push(h)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const s=e.children[n];this.add(s.clone())}return this}}Oi.DEFAULT_UP=new Y(0,1,0);Oi.DEFAULT_MATRIX_AUTO_UPDATE=!0;Oi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Qi=new Y,kn=new Y,Qu=new Y,Fn=new Y,or=new Y,lr=new Y,tp=new Y,Zu=new Y,Ju=new Y,ec=new Y;let $o=!1;class Ji{constructor(e=new Y,t=new Y,n=new Y){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,s){s.subVectors(n,t),Qi.subVectors(e,t),s.cross(Qi);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(e,t,n,s,r){Qi.subVectors(s,t),kn.subVectors(n,t),Qu.subVectors(e,t);const a=Qi.dot(Qi),o=Qi.dot(kn),l=Qi.dot(Qu),u=kn.dot(kn),h=kn.dot(Qu),d=a*u-o*o;if(d===0)return r.set(-2,-1,-1);const m=1/d,y=(u*l-o*h)*m,v=(a*h-o*l)*m;return r.set(1-y-v,v,y)}static containsPoint(e,t,n,s){return this.getBarycoord(e,t,n,s,Fn),Fn.x>=0&&Fn.y>=0&&Fn.x+Fn.y<=1}static getUV(e,t,n,s,r,a,o,l){return $o===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),$o=!0),this.getInterpolation(e,t,n,s,r,a,o,l)}static getInterpolation(e,t,n,s,r,a,o,l){return this.getBarycoord(e,t,n,s,Fn),l.setScalar(0),l.addScaledVector(r,Fn.x),l.addScaledVector(a,Fn.y),l.addScaledVector(o,Fn.z),l}static isFrontFacing(e,t,n,s){return Qi.subVectors(n,t),kn.subVectors(e,t),Qi.cross(kn).dot(s)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,s){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,n,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Qi.subVectors(this.c,this.b),kn.subVectors(this.a,this.b),Qi.cross(kn).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ji.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ji.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,s,r){return $o===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),$o=!0),Ji.getInterpolation(e,this.a,this.b,this.c,t,n,s,r)}getInterpolation(e,t,n,s,r){return Ji.getInterpolation(e,this.a,this.b,this.c,t,n,s,r)}containsPoint(e){return Ji.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ji.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,s=this.b,r=this.c;let a,o;or.subVectors(s,n),lr.subVectors(r,n),Zu.subVectors(e,n);const l=or.dot(Zu),u=lr.dot(Zu);if(l<=0&&u<=0)return t.copy(n);Ju.subVectors(e,s);const h=or.dot(Ju),d=lr.dot(Ju);if(h>=0&&d<=h)return t.copy(s);const m=l*d-h*u;if(m<=0&&l>=0&&h<=0)return a=l/(l-h),t.copy(n).addScaledVector(or,a);ec.subVectors(e,r);const y=or.dot(ec),v=lr.dot(ec);if(v>=0&&y<=v)return t.copy(r);const b=y*u-l*v;if(b<=0&&u>=0&&v<=0)return o=u/(u-v),t.copy(n).addScaledVector(lr,o);const x=h*v-y*d;if(x<=0&&d-h>=0&&y-v>=0)return tp.subVectors(r,s),o=(d-h)/(d-h+(y-v)),t.copy(s).addScaledVector(tp,o);const _=1/(x+b+m);return a=b*_,o=m*_,t.copy(n).addScaledVector(or,a).addScaledVector(lr,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Xx=0;class Xl extends ea{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Xx++}),this.uuid=ta(),this.name="",this.type="Material",this.blending=wr,this.side=cs,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=rg,this.blendDst=ag,this.blendEquation=Sr,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Lc,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=_x,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Vu,this.stencilZFail=Vu,this.stencilZPass=Vu,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const s=this[t];if(s===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(n):s&&s.isVector3&&n&&n.isVector3?s.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==wr&&(n.blending=this.blending),this.side!==cs&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(n.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(n.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=this.flatShading),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function s(r){const a=[];for(const o in r){const l=r[o];delete l.metadata,a.push(l)}return a}if(t){const r=s(e.textures),a=s(e.images);r.length>0&&(n.textures=r),a.length>0&&(n.images=a)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const s=t.length;n=new Array(s);for(let r=0;r!==s;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}const vg={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Zi={h:0,s:0,l:0},jo={h:0,s:0,l:0};function tc(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}class bt{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Ze){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Ki.toWorkingColorSpace(this,t),this}setRGB(e,t,n,s=Ki.workingColorSpace){return this.r=e,this.g=t,this.b=n,Ki.toWorkingColorSpace(this,s),this}setHSL(e,t,n,s=Ki.workingColorSpace){if(e=Th(e,1),t=ci(t,0,1),n=ci(n,0,1),t===0)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,a=2*n-r;this.r=tc(a,r,e+1/3),this.g=tc(a,r,e),this.b=tc(a,r,e-1/3)}return Ki.toWorkingColorSpace(this,s),this}setStyle(e,t=Ze){function n(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const a=s[1],o=s[2];switch(a){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=s[1],a=r.length;if(a===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(a===6)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Ze){const n=vg[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Rr(e.r),this.g=Rr(e.g),this.b=Rr(e.b),this}copyLinearToSRGB(e){return this.r=Gu(e.r),this.g=Gu(e.g),this.b=Gu(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Ze){return Ki.fromWorkingColorSpace(ii.copy(this),e),Math.round(ci(ii.r*255,0,255))*65536+Math.round(ci(ii.g*255,0,255))*256+Math.round(ci(ii.b*255,0,255))}getHexString(e=Ze){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Ki.workingColorSpace){Ki.fromWorkingColorSpace(ii.copy(this),t);const n=ii.r,s=ii.g,r=ii.b,a=Math.max(n,s,r),o=Math.min(n,s,r);let l,u;const h=(o+a)/2;if(o===a)l=0,u=0;else{const d=a-o;switch(u=h<=.5?d/(a+o):d/(2-a-o),a){case n:l=(s-r)/d+(s<r?6:0);break;case s:l=(r-n)/d+2;break;case r:l=(n-s)/d+4;break}l/=6}return e.h=l,e.s=u,e.l=h,e}getRGB(e,t=Ki.workingColorSpace){return Ki.fromWorkingColorSpace(ii.copy(this),t),e.r=ii.r,e.g=ii.g,e.b=ii.b,e}getStyle(e=Ze){Ki.fromWorkingColorSpace(ii.copy(this),e);const t=ii.r,n=ii.g,s=ii.b;return e!==Ze?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(s*255)})`}offsetHSL(e,t,n){return this.getHSL(Zi),Zi.h+=e,Zi.s+=t,Zi.l+=n,this.setHSL(Zi.h,Zi.s,Zi.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Zi),e.getHSL(jo);const n=za(Zi.h,jo.h,t),s=za(Zi.s,jo.s,t),r=za(Zi.l,jo.l,t);return this.setHSL(n,s,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,s=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*s,this.g=r[1]*t+r[4]*n+r[7]*s,this.b=r[2]*t+r[5]*n+r[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ii=new bt;bt.NAMES=vg;class Sh extends Xl{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new bt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=og,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Ft=new Y,Xo=new Tt;class yn{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=zf,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[e+s]=t.array[n+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)Xo.fromBufferAttribute(this,t),Xo.applyMatrix3(e),this.setXY(t,Xo.x,Xo.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Ft.fromBufferAttribute(this,t),Ft.applyMatrix3(e),this.setXYZ(t,Ft.x,Ft.y,Ft.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Ft.fromBufferAttribute(this,t),Ft.applyMatrix4(e),this.setXYZ(t,Ft.x,Ft.y,Ft.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Ft.fromBufferAttribute(this,t),Ft.applyNormalMatrix(e),this.setXYZ(t,Ft.x,Ft.y,Ft.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Ft.fromBufferAttribute(this,t),Ft.transformDirection(e),this.setXYZ(t,Ft.x,Ft.y,Ft.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Ia(t,this.array)),t}setX(e,t){return this.normalized&&(t=gi(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Ia(t,this.array)),t}setY(e,t){return this.normalized&&(t=gi(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Ia(t,this.array)),t}setZ(e,t){return this.normalized&&(t=gi(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Ia(t,this.array)),t}setW(e,t){return this.normalized&&(t=gi(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=gi(t,this.array),n=gi(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,s){return e*=this.itemSize,this.normalized&&(t=gi(t,this.array),n=gi(n,this.array),s=gi(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=s,this}setXYZW(e,t,n,s,r){return e*=this.itemSize,this.normalized&&(t=gi(t,this.array),n=gi(n,this.array),s=gi(s,this.array),r=gi(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=s,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==zf&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class yg extends yn{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Tg extends yn{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Tn extends yn{constructor(e,t,n){super(new Float32Array(e),t,n)}}let Kx=0;const Bi=new Zt,ic=new Oi,ur=new Y,Di=new co,Ea=new co,$t=new Y;class fs extends ea{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Kx++}),this.uuid=ta(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(fg(e)?Tg:yg)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const r=new at().getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Bi.makeRotationFromQuaternion(e),this.applyMatrix4(Bi),this}rotateX(e){return Bi.makeRotationX(e),this.applyMatrix4(Bi),this}rotateY(e){return Bi.makeRotationY(e),this.applyMatrix4(Bi),this}rotateZ(e){return Bi.makeRotationZ(e),this.applyMatrix4(Bi),this}translate(e,t,n){return Bi.makeTranslation(e,t,n),this.applyMatrix4(Bi),this}scale(e,t,n){return Bi.makeScale(e,t,n),this.applyMatrix4(Bi),this}lookAt(e){return ic.lookAt(e),ic.updateMatrix(),this.applyMatrix4(ic.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ur).negate(),this.translate(ur.x,ur.y,ur.z),this}setFromPoints(e){const t=[];for(let n=0,s=e.length;n<s;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Tn(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new co);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Y(-1/0,-1/0,-1/0),new Y(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,s=t.length;n<s;n++){const r=t[n];Di.setFromBufferAttribute(r),this.morphTargetsRelative?($t.addVectors(this.boundingBox.min,Di.min),this.boundingBox.expandByPoint($t),$t.addVectors(this.boundingBox.max,Di.max),this.boundingBox.expandByPoint($t)):(this.boundingBox.expandByPoint(Di.min),this.boundingBox.expandByPoint(Di.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new xh);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Y,1/0);return}if(e){const n=this.boundingSphere.center;if(Di.setFromBufferAttribute(e),t)for(let r=0,a=t.length;r<a;r++){const o=t[r];Ea.setFromBufferAttribute(o),this.morphTargetsRelative?($t.addVectors(Di.min,Ea.min),Di.expandByPoint($t),$t.addVectors(Di.max,Ea.max),Di.expandByPoint($t)):(Di.expandByPoint(Ea.min),Di.expandByPoint(Ea.max))}Di.getCenter(n);let s=0;for(let r=0,a=e.count;r<a;r++)$t.fromBufferAttribute(e,r),s=Math.max(s,n.distanceToSquared($t));if(t)for(let r=0,a=t.length;r<a;r++){const o=t[r],l=this.morphTargetsRelative;for(let u=0,h=o.count;u<h;u++)$t.fromBufferAttribute(o,u),l&&(ur.fromBufferAttribute(e,u),$t.add(ur)),s=Math.max(s,n.distanceToSquared($t))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.array,s=t.position.array,r=t.normal.array,a=t.uv.array,o=s.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new yn(new Float32Array(4*o),4));const l=this.getAttribute("tangent").array,u=[],h=[];for(let F=0;F<o;F++)u[F]=new Y,h[F]=new Y;const d=new Y,m=new Y,y=new Y,v=new Tt,b=new Tt,x=new Tt,_=new Y,E=new Y;function A(F,Q,oe){d.fromArray(s,F*3),m.fromArray(s,Q*3),y.fromArray(s,oe*3),v.fromArray(a,F*2),b.fromArray(a,Q*2),x.fromArray(a,oe*2),m.sub(d),y.sub(d),b.sub(v),x.sub(v);const H=1/(b.x*x.y-x.x*b.y);isFinite(H)&&(_.copy(m).multiplyScalar(x.y).addScaledVector(y,-b.y).multiplyScalar(H),E.copy(y).multiplyScalar(b.x).addScaledVector(m,-x.x).multiplyScalar(H),u[F].add(_),u[Q].add(_),u[oe].add(_),h[F].add(E),h[Q].add(E),h[oe].add(E))}let w=this.groups;w.length===0&&(w=[{start:0,count:n.length}]);for(let F=0,Q=w.length;F<Q;++F){const oe=w[F],H=oe.start,$=oe.count;for(let Z=H,le=H+$;Z<le;Z+=3)A(n[Z+0],n[Z+1],n[Z+2])}const C=new Y,I=new Y,B=new Y,X=new Y;function M(F){B.fromArray(r,F*3),X.copy(B);const Q=u[F];C.copy(Q),C.sub(B.multiplyScalar(B.dot(Q))).normalize(),I.crossVectors(X,Q);const H=I.dot(h[F])<0?-1:1;l[F*4]=C.x,l[F*4+1]=C.y,l[F*4+2]=C.z,l[F*4+3]=H}for(let F=0,Q=w.length;F<Q;++F){const oe=w[F],H=oe.start,$=oe.count;for(let Z=H,le=H+$;Z<le;Z+=3)M(n[Z+0]),M(n[Z+1]),M(n[Z+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new yn(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let m=0,y=n.count;m<y;m++)n.setXYZ(m,0,0,0);const s=new Y,r=new Y,a=new Y,o=new Y,l=new Y,u=new Y,h=new Y,d=new Y;if(e)for(let m=0,y=e.count;m<y;m+=3){const v=e.getX(m+0),b=e.getX(m+1),x=e.getX(m+2);s.fromBufferAttribute(t,v),r.fromBufferAttribute(t,b),a.fromBufferAttribute(t,x),h.subVectors(a,r),d.subVectors(s,r),h.cross(d),o.fromBufferAttribute(n,v),l.fromBufferAttribute(n,b),u.fromBufferAttribute(n,x),o.add(h),l.add(h),u.add(h),n.setXYZ(v,o.x,o.y,o.z),n.setXYZ(b,l.x,l.y,l.z),n.setXYZ(x,u.x,u.y,u.z)}else for(let m=0,y=t.count;m<y;m+=3)s.fromBufferAttribute(t,m+0),r.fromBufferAttribute(t,m+1),a.fromBufferAttribute(t,m+2),h.subVectors(a,r),d.subVectors(s,r),h.cross(d),n.setXYZ(m+0,h.x,h.y,h.z),n.setXYZ(m+1,h.x,h.y,h.z),n.setXYZ(m+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)$t.fromBufferAttribute(e,t),$t.normalize(),e.setXYZ(t,$t.x,$t.y,$t.z)}toNonIndexed(){function e(o,l){const u=o.array,h=o.itemSize,d=o.normalized,m=new u.constructor(l.length*h);let y=0,v=0;for(let b=0,x=l.length;b<x;b++){o.isInterleavedBufferAttribute?y=l[b]*o.data.stride+o.offset:y=l[b]*h;for(let _=0;_<h;_++)m[v++]=u[y++]}return new yn(m,h,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new fs,n=this.index.array,s=this.attributes;for(const o in s){const l=s[o],u=e(l,n);t.setAttribute(o,u)}const r=this.morphAttributes;for(const o in r){const l=[],u=r[o];for(let h=0,d=u.length;h<d;h++){const m=u[h],y=e(m,n);l.push(y)}t.morphAttributes[o]=l}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const u=a[o];t.addGroup(u.start,u.count,u.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const u in l)l[u]!==void 0&&(e[u]=l[u]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const l in n){const u=n[l];e.data.attributes[l]=u.toJSON(e.data)}const s={};let r=!1;for(const l in this.morphAttributes){const u=this.morphAttributes[l],h=[];for(let d=0,m=u.length;d<m;d++){const y=u[d];h.push(y.toJSON(e.data))}h.length>0&&(s[l]=h,r=!0)}r&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const s=e.attributes;for(const u in s){const h=s[u];this.setAttribute(u,h.clone(t))}const r=e.morphAttributes;for(const u in r){const h=[],d=r[u];for(let m=0,y=d.length;m<y;m++)h.push(d[m].clone(t));this.morphAttributes[u]=h}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let u=0,h=a.length;u<h;u++){const d=a[u];this.addGroup(d.start,d.count,d.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const ip=new Zt,hn=new Vx,Ko=new xh,np=new Y,cr=new Y,hr=new Y,dr=new Y,nc=new Y,Yo=new Y,Qo=new Tt,Zo=new Tt,Jo=new Tt,sp=new Y,rp=new Y,ap=new Y,el=new Y,tl=new Y;class Wn extends Oi{constructor(e=new fs,t=new Sh){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=s.length;r<a;r++){const o=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}getVertexPosition(e,t){const n=this.geometry,s=n.attributes.position,r=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(s,e);const o=this.morphTargetInfluences;if(r&&o){Yo.set(0,0,0);for(let l=0,u=r.length;l<u;l++){const h=o[l],d=r[l];h!==0&&(nc.fromBufferAttribute(d,e),a?Yo.addScaledVector(nc,h):Yo.addScaledVector(nc.sub(t),h))}t.add(Yo)}return t}raycast(e,t){const n=this.geometry,s=this.material,r=this.matrixWorld;s!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),Ko.copy(n.boundingSphere),Ko.applyMatrix4(r),hn.copy(e.ray).recast(e.near),!(Ko.containsPoint(hn.origin)===!1&&(hn.intersectSphere(Ko,np)===null||hn.origin.distanceToSquared(np)>(e.far-e.near)**2))&&(ip.copy(r).invert(),hn.copy(e.ray).applyMatrix4(ip),!(n.boundingBox!==null&&hn.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t)))}_computeIntersections(e,t){let n;const s=this.geometry,r=this.material,a=s.index,o=s.attributes.position,l=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,d=s.groups,m=s.drawRange;if(a!==null)if(Array.isArray(r))for(let y=0,v=d.length;y<v;y++){const b=d[y],x=r[b.materialIndex],_=Math.max(b.start,m.start),E=Math.min(a.count,Math.min(b.start+b.count,m.start+m.count));for(let A=_,w=E;A<w;A+=3){const C=a.getX(A),I=a.getX(A+1),B=a.getX(A+2);n=il(this,x,e,hn,l,u,h,C,I,B),n&&(n.faceIndex=Math.floor(A/3),n.face.materialIndex=b.materialIndex,t.push(n))}}else{const y=Math.max(0,m.start),v=Math.min(a.count,m.start+m.count);for(let b=y,x=v;b<x;b+=3){const _=a.getX(b),E=a.getX(b+1),A=a.getX(b+2);n=il(this,r,e,hn,l,u,h,_,E,A),n&&(n.faceIndex=Math.floor(b/3),t.push(n))}}else if(o!==void 0)if(Array.isArray(r))for(let y=0,v=d.length;y<v;y++){const b=d[y],x=r[b.materialIndex],_=Math.max(b.start,m.start),E=Math.min(o.count,Math.min(b.start+b.count,m.start+m.count));for(let A=_,w=E;A<w;A+=3){const C=A,I=A+1,B=A+2;n=il(this,x,e,hn,l,u,h,C,I,B),n&&(n.faceIndex=Math.floor(A/3),n.face.materialIndex=b.materialIndex,t.push(n))}}else{const y=Math.max(0,m.start),v=Math.min(o.count,m.start+m.count);for(let b=y,x=v;b<x;b+=3){const _=b,E=b+1,A=b+2;n=il(this,r,e,hn,l,u,h,_,E,A),n&&(n.faceIndex=Math.floor(b/3),t.push(n))}}}}function Yx(i,e,t,n,s,r,a,o){let l;if(e.side===Si?l=n.intersectTriangle(a,r,s,!0,o):l=n.intersectTriangle(s,r,a,e.side===cs,o),l===null)return null;tl.copy(o),tl.applyMatrix4(i.matrixWorld);const u=t.ray.origin.distanceTo(tl);return u<t.near||u>t.far?null:{distance:u,point:tl.clone(),object:i}}function il(i,e,t,n,s,r,a,o,l,u){i.getVertexPosition(o,cr),i.getVertexPosition(l,hr),i.getVertexPosition(u,dr);const h=Yx(i,e,t,n,cr,hr,dr,el);if(h){s&&(Qo.fromBufferAttribute(s,o),Zo.fromBufferAttribute(s,l),Jo.fromBufferAttribute(s,u),h.uv=Ji.getInterpolation(el,cr,hr,dr,Qo,Zo,Jo,new Tt)),r&&(Qo.fromBufferAttribute(r,o),Zo.fromBufferAttribute(r,l),Jo.fromBufferAttribute(r,u),h.uv1=Ji.getInterpolation(el,cr,hr,dr,Qo,Zo,Jo,new Tt),h.uv2=h.uv1),a&&(sp.fromBufferAttribute(a,o),rp.fromBufferAttribute(a,l),ap.fromBufferAttribute(a,u),h.normal=Ji.getInterpolation(el,cr,hr,dr,sp,rp,ap,new Y),h.normal.dot(n.direction)>0&&h.normal.multiplyScalar(-1));const d={a:o,b:l,c:u,normal:new Y,materialIndex:0};Ji.getNormal(cr,hr,dr,d.normal),h.face=d}return h}class ho extends fs{constructor(e=1,t=1,n=1,s=1,r=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:s,heightSegments:r,depthSegments:a};const o=this;s=Math.floor(s),r=Math.floor(r),a=Math.floor(a);const l=[],u=[],h=[],d=[];let m=0,y=0;v("z","y","x",-1,-1,n,t,e,a,r,0),v("z","y","x",1,-1,n,t,-e,a,r,1),v("x","z","y",1,1,e,n,t,s,a,2),v("x","z","y",1,-1,e,n,-t,s,a,3),v("x","y","z",1,-1,e,t,n,s,r,4),v("x","y","z",-1,-1,e,t,-n,s,r,5),this.setIndex(l),this.setAttribute("position",new Tn(u,3)),this.setAttribute("normal",new Tn(h,3)),this.setAttribute("uv",new Tn(d,2));function v(b,x,_,E,A,w,C,I,B,X,M){const F=w/B,Q=C/X,oe=w/2,H=C/2,$=I/2,Z=B+1,le=X+1;let ie=0,ue=0;const de=new Y;for(let fe=0;fe<le;fe++){const Pe=fe*Q-H;for(let Ae=0;Ae<Z;Ae++){const ee=Ae*F-oe;de[b]=ee*E,de[x]=Pe*A,de[_]=$,u.push(de.x,de.y,de.z),de[b]=0,de[x]=0,de[_]=I>0?1:-1,h.push(de.x,de.y,de.z),d.push(Ae/B),d.push(1-fe/X),ie+=1}}for(let fe=0;fe<X;fe++)for(let Pe=0;Pe<B;Pe++){const Ae=m+Pe+Z*fe,ee=m+Pe+Z*(fe+1),he=m+(Pe+1)+Z*(fe+1),Te=m+(Pe+1)+Z*fe;l.push(Ae,ee,Te),l.push(ee,he,Te),ue+=6}o.addGroup(y,ue,M),y+=ue,m+=ie}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ho(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Vr(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const s=i[t][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=s.clone():Array.isArray(s)?e[t][n]=s.slice():e[t][n]=s}}return e}function li(i){const e={};for(let t=0;t<i.length;t++){const n=Vr(i[t]);for(const s in n)e[s]=n[s]}return e}function Qx(i){const e=[];for(let t=0;t<i.length;t++)e.push(i[t].clone());return e}function xg(i){return i.getRenderTarget()===null?i.outputColorSpace:En}const Zx={clone:Vr,merge:li};var Jx=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,eS=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Ws extends Xl{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Jx,this.fragmentShader=eS,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Vr(e.uniforms),this.uniformsGroups=Qx(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const a=this.uniforms[s].value;a&&a.isTexture?t.uniforms[s]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[s]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[s]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[s]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[s]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[s]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[s]={type:"m4",value:a.toArray()}:t.uniforms[s]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const s in this.extensions)this.extensions[s]===!0&&(n[s]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Sg extends Oi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Zt,this.projectionMatrix=new Zt,this.projectionMatrixInverse=new Zt}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class Vi extends Sg{constructor(e=50,t=1,n=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Ja*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Va*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Ja*2*Math.atan(Math.tan(Va*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,s,r,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Va*.5*this.fov)/this.zoom,n=2*t,s=this.aspect*n,r=-.5*s;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,u=a.fullHeight;r+=a.offsetX*s/l,t-=a.offsetY*n/u,s*=a.width/l,n*=a.height/u}const o=this.filmOffset;o!==0&&(r+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const fr=-90,pr=1;class tS extends Oi{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n;const s=new Vi(fr,pr,e,t);s.layers=this.layers,s.up.set(0,1,0),s.lookAt(1,0,0),this.add(s);const r=new Vi(fr,pr,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(-1,0,0),this.add(r);const a=new Vi(fr,pr,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(0,1,0),this.add(a);const o=new Vi(fr,pr,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(0,-1,0),this.add(o);const l=new Vi(fr,pr,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,1),this.add(l);const u=new Vi(fr,pr,e,t);u.layers=this.layers,u.up.set(0,1,0),u.lookAt(0,0,-1),this.add(u)}update(e,t){this.parent===null&&this.updateMatrixWorld();const n=this.renderTarget,[s,r,a,o,l,u]=this.children,h=e.getRenderTarget(),d=e.toneMapping,m=e.xr.enabled;e.toneMapping=qn,e.xr.enabled=!1;const y=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,s),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,a),e.setRenderTarget(n,3),e.render(t,o),e.setRenderTarget(n,4),e.render(t,l),n.texture.generateMipmaps=y,e.setRenderTarget(n,5),e.render(t,u),e.setRenderTarget(h),e.toneMapping=d,e.xr.enabled=m,n.texture.needsPMREMUpdate=!0}}class bg extends bi{constructor(e,t,n,s,r,a,o,l,u,h){e=e!==void 0?e:[],t=t!==void 0?t:Fr,super(e,t,n,s,r,a,o,l,u,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class iS extends Gs{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},s=[n,n,n,n,n,n];t.encoding!==void 0&&(Ga("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===ks?Ze:Fs),this.texture=new bg(s,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:vi}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new ho(5,5,5),r=new Ws({name:"CubemapFromEquirect",uniforms:Vr(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Si,blending:us});r.uniforms.tEquirect.value=t;const a=new Wn(s,r),o=t.minFilter;return t.minFilter===Qa&&(t.minFilter=vi),new tS(1,10,this).update(e,a),t.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,n,s){const r=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,s);e.setRenderTarget(r)}}const sc=new Y,nS=new Y,sS=new at;class Ms{constructor(e=new Y(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,s){return this.normal.set(e,t,n),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const s=sc.subVectors(n,t).cross(nS.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(sc),s=this.normal.dot(n);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||sS.getNormalMatrix(e),s=this.coplanarPoint(sc).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-s.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const As=new xh,nl=new Y;class Eg{constructor(e=new Ms,t=new Ms,n=new Ms,s=new Ms,r=new Ms,a=new Ms){this.planes=[e,t,n,s,r,a]}set(e,t,n,s,r,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(s),o[4].copy(r),o[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,s=n[0],r=n[1],a=n[2],o=n[3],l=n[4],u=n[5],h=n[6],d=n[7],m=n[8],y=n[9],v=n[10],b=n[11],x=n[12],_=n[13],E=n[14],A=n[15];return t[0].setComponents(o-s,d-l,b-m,A-x).normalize(),t[1].setComponents(o+s,d+l,b+m,A+x).normalize(),t[2].setComponents(o+r,d+u,b+y,A+_).normalize(),t[3].setComponents(o-r,d-u,b-y,A-_).normalize(),t[4].setComponents(o-a,d-h,b-v,A-E).normalize(),t[5].setComponents(o+a,d+h,b+v,A+E).normalize(),this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),As.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),As.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(As)}intersectsSprite(e){return As.center.set(0,0,0),As.radius=.7071067811865476,As.applyMatrix4(e.matrixWorld),this.intersectsSphere(As)}intersectsSphere(e){const t=this.planes,n=e.center,s=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const s=t[n];if(nl.x=s.normal.x>0?e.max.x:e.min.x,nl.y=s.normal.y>0?e.max.y:e.min.y,nl.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(nl)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Ag(){let i=null,e=!1,t=null,n=null;function s(r,a){t(r,a),n=i.requestAnimationFrame(s)}return{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(s),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){i=r}}}function rS(i,e){const t=e.isWebGL2,n=new WeakMap;function s(u,h){const d=u.array,m=u.usage,y=i.createBuffer();i.bindBuffer(h,y),i.bufferData(h,d,m),u.onUploadCallback();let v;if(d instanceof Float32Array)v=i.FLOAT;else if(d instanceof Uint16Array)if(u.isFloat16BufferAttribute)if(t)v=i.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else v=i.UNSIGNED_SHORT;else if(d instanceof Int16Array)v=i.SHORT;else if(d instanceof Uint32Array)v=i.UNSIGNED_INT;else if(d instanceof Int32Array)v=i.INT;else if(d instanceof Int8Array)v=i.BYTE;else if(d instanceof Uint8Array)v=i.UNSIGNED_BYTE;else if(d instanceof Uint8ClampedArray)v=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);return{buffer:y,type:v,bytesPerElement:d.BYTES_PER_ELEMENT,version:u.version}}function r(u,h,d){const m=h.array,y=h.updateRange;i.bindBuffer(d,u),y.count===-1?i.bufferSubData(d,0,m):(t?i.bufferSubData(d,y.offset*m.BYTES_PER_ELEMENT,m,y.offset,y.count):i.bufferSubData(d,y.offset*m.BYTES_PER_ELEMENT,m.subarray(y.offset,y.offset+y.count)),y.count=-1),h.onUploadCallback()}function a(u){return u.isInterleavedBufferAttribute&&(u=u.data),n.get(u)}function o(u){u.isInterleavedBufferAttribute&&(u=u.data);const h=n.get(u);h&&(i.deleteBuffer(h.buffer),n.delete(u))}function l(u,h){if(u.isGLBufferAttribute){const m=n.get(u);(!m||m.version<u.version)&&n.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version});return}u.isInterleavedBufferAttribute&&(u=u.data);const d=n.get(u);d===void 0?n.set(u,s(u,h)):d.version<u.version&&(r(d.buffer,u,h),d.version=u.version)}return{get:a,remove:o,update:l}}class bh extends fs{constructor(e=1,t=1,n=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:s};const r=e/2,a=t/2,o=Math.floor(n),l=Math.floor(s),u=o+1,h=l+1,d=e/o,m=t/l,y=[],v=[],b=[],x=[];for(let _=0;_<h;_++){const E=_*m-a;for(let A=0;A<u;A++){const w=A*d-r;v.push(w,-E,0),b.push(0,0,1),x.push(A/o),x.push(1-_/l)}}for(let _=0;_<l;_++)for(let E=0;E<o;E++){const A=E+u*_,w=E+u*(_+1),C=E+1+u*(_+1),I=E+1+u*_;y.push(A,w,I),y.push(w,C,I)}this.setIndex(y),this.setAttribute("position",new Tn(v,3)),this.setAttribute("normal",new Tn(b,3)),this.setAttribute("uv",new Tn(x,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new bh(e.width,e.height,e.widthSegments,e.heightSegments)}}var aS=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,oS=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,lS=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,uS=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,cS=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,hS=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,dS="vec3 transformed = vec3( position );",fS=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,pS=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,mS=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,gS=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,_S=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,vS=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,yS=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,TS=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,xS=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,SS=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,bS=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,ES=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,AS=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,CS=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,MS=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,wS=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,DS=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,RS=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,PS=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,LS="gl_FragColor = linearToOutputTexel( gl_FragColor );",IS=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,OS=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,US=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,NS=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,kS=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,FS=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,BS=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,HS=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,VS=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,zS=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,GS=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,WS=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,qS=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,$S=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,jS=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,XS=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,KS=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,YS=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,QS=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,ZS=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,JS=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,eb=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif`,tb=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,ib=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,nb=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,sb=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,rb=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,ab=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,ob=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,lb=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,ub=`#ifdef USE_MAP
	diffuseColor *= texture2D( map, vMapUv );
#endif`,cb=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,hb=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,db=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,fb=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,pb=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,mb=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,gb=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,_b=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,vb=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,yb=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#ifdef USE_NORMALMAP_TANGENTSPACE
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,Tb=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,xb=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Sb=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,bb=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Eb=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Ab=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,Cb=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Mb=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,wb=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Db=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Rb=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Pb=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Lb=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Ib=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Ob=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Ub=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Nb=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,kb=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,Fb=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Bb=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Hb=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Vb=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,zb=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,Gb=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Wb=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,qb=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,$b=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,jb=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Xb=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Kb=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,Yb=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,Qb=`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Zb=`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Jb=`#ifdef USE_UV
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,eE=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const tE=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,iE=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,nE=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,sE=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,rE=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,aE=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,oE=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,lE=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,uE=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,cE=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,hE=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,dE=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,fE=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,pE=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,mE=`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,gE=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_E=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,vE=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yE=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,TE=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,xE=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,SE=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,bE=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,EE=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,AE=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,CE=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ME=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,wE=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,DE=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,RE=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,PE=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,LE=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,IE=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,OE=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,tt={alphamap_fragment:aS,alphamap_pars_fragment:oS,alphatest_fragment:lS,alphatest_pars_fragment:uS,aomap_fragment:cS,aomap_pars_fragment:hS,begin_vertex:dS,beginnormal_vertex:fS,bsdfs:pS,iridescence_fragment:mS,bumpmap_pars_fragment:gS,clipping_planes_fragment:_S,clipping_planes_pars_fragment:vS,clipping_planes_pars_vertex:yS,clipping_planes_vertex:TS,color_fragment:xS,color_pars_fragment:SS,color_pars_vertex:bS,color_vertex:ES,common:AS,cube_uv_reflection_fragment:CS,defaultnormal_vertex:MS,displacementmap_pars_vertex:wS,displacementmap_vertex:DS,emissivemap_fragment:RS,emissivemap_pars_fragment:PS,encodings_fragment:LS,encodings_pars_fragment:IS,envmap_fragment:OS,envmap_common_pars_fragment:US,envmap_pars_fragment:NS,envmap_pars_vertex:kS,envmap_physical_pars_fragment:KS,envmap_vertex:FS,fog_vertex:BS,fog_pars_vertex:HS,fog_fragment:VS,fog_pars_fragment:zS,gradientmap_pars_fragment:GS,lightmap_fragment:WS,lightmap_pars_fragment:qS,lights_lambert_fragment:$S,lights_lambert_pars_fragment:jS,lights_pars_begin:XS,lights_toon_fragment:YS,lights_toon_pars_fragment:QS,lights_phong_fragment:ZS,lights_phong_pars_fragment:JS,lights_physical_fragment:eb,lights_physical_pars_fragment:tb,lights_fragment_begin:ib,lights_fragment_maps:nb,lights_fragment_end:sb,logdepthbuf_fragment:rb,logdepthbuf_pars_fragment:ab,logdepthbuf_pars_vertex:ob,logdepthbuf_vertex:lb,map_fragment:ub,map_pars_fragment:cb,map_particle_fragment:hb,map_particle_pars_fragment:db,metalnessmap_fragment:fb,metalnessmap_pars_fragment:pb,morphcolor_vertex:mb,morphnormal_vertex:gb,morphtarget_pars_vertex:_b,morphtarget_vertex:vb,normal_fragment_begin:yb,normal_fragment_maps:Tb,normal_pars_fragment:xb,normal_pars_vertex:Sb,normal_vertex:bb,normalmap_pars_fragment:Eb,clearcoat_normal_fragment_begin:Ab,clearcoat_normal_fragment_maps:Cb,clearcoat_pars_fragment:Mb,iridescence_pars_fragment:wb,output_fragment:Db,packing:Rb,premultiplied_alpha_fragment:Pb,project_vertex:Lb,dithering_fragment:Ib,dithering_pars_fragment:Ob,roughnessmap_fragment:Ub,roughnessmap_pars_fragment:Nb,shadowmap_pars_fragment:kb,shadowmap_pars_vertex:Fb,shadowmap_vertex:Bb,shadowmask_pars_fragment:Hb,skinbase_vertex:Vb,skinning_pars_vertex:zb,skinning_vertex:Gb,skinnormal_vertex:Wb,specularmap_fragment:qb,specularmap_pars_fragment:$b,tonemapping_fragment:jb,tonemapping_pars_fragment:Xb,transmission_fragment:Kb,transmission_pars_fragment:Yb,uv_pars_fragment:Qb,uv_pars_vertex:Zb,uv_vertex:Jb,worldpos_vertex:eE,background_vert:tE,background_frag:iE,backgroundCube_vert:nE,backgroundCube_frag:sE,cube_vert:rE,cube_frag:aE,depth_vert:oE,depth_frag:lE,distanceRGBA_vert:uE,distanceRGBA_frag:cE,equirect_vert:hE,equirect_frag:dE,linedashed_vert:fE,linedashed_frag:pE,meshbasic_vert:mE,meshbasic_frag:gE,meshlambert_vert:_E,meshlambert_frag:vE,meshmatcap_vert:yE,meshmatcap_frag:TE,meshnormal_vert:xE,meshnormal_frag:SE,meshphong_vert:bE,meshphong_frag:EE,meshphysical_vert:AE,meshphysical_frag:CE,meshtoon_vert:ME,meshtoon_frag:wE,points_vert:DE,points_frag:RE,shadow_vert:PE,shadow_frag:LE,sprite_vert:IE,sprite_frag:OE},Se={common:{diffuse:{value:new bt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new at},alphaMap:{value:null},alphaMapTransform:{value:new at},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new at}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new at}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new at}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new at},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new at},normalScale:{value:new Tt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new at},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new at}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new at}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new at}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new bt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new bt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new at}},sprite:{diffuse:{value:new bt(16777215)},opacity:{value:1},center:{value:new Tt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new at},alphaMap:{value:null},alphaTest:{value:0}}},fn={basic:{uniforms:li([Se.common,Se.specularmap,Se.envmap,Se.aomap,Se.lightmap,Se.fog]),vertexShader:tt.meshbasic_vert,fragmentShader:tt.meshbasic_frag},lambert:{uniforms:li([Se.common,Se.specularmap,Se.envmap,Se.aomap,Se.lightmap,Se.emissivemap,Se.bumpmap,Se.normalmap,Se.displacementmap,Se.fog,Se.lights,{emissive:{value:new bt(0)}}]),vertexShader:tt.meshlambert_vert,fragmentShader:tt.meshlambert_frag},phong:{uniforms:li([Se.common,Se.specularmap,Se.envmap,Se.aomap,Se.lightmap,Se.emissivemap,Se.bumpmap,Se.normalmap,Se.displacementmap,Se.fog,Se.lights,{emissive:{value:new bt(0)},specular:{value:new bt(1118481)},shininess:{value:30}}]),vertexShader:tt.meshphong_vert,fragmentShader:tt.meshphong_frag},standard:{uniforms:li([Se.common,Se.envmap,Se.aomap,Se.lightmap,Se.emissivemap,Se.bumpmap,Se.normalmap,Se.displacementmap,Se.roughnessmap,Se.metalnessmap,Se.fog,Se.lights,{emissive:{value:new bt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:tt.meshphysical_vert,fragmentShader:tt.meshphysical_frag},toon:{uniforms:li([Se.common,Se.aomap,Se.lightmap,Se.emissivemap,Se.bumpmap,Se.normalmap,Se.displacementmap,Se.gradientmap,Se.fog,Se.lights,{emissive:{value:new bt(0)}}]),vertexShader:tt.meshtoon_vert,fragmentShader:tt.meshtoon_frag},matcap:{uniforms:li([Se.common,Se.bumpmap,Se.normalmap,Se.displacementmap,Se.fog,{matcap:{value:null}}]),vertexShader:tt.meshmatcap_vert,fragmentShader:tt.meshmatcap_frag},points:{uniforms:li([Se.points,Se.fog]),vertexShader:tt.points_vert,fragmentShader:tt.points_frag},dashed:{uniforms:li([Se.common,Se.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:tt.linedashed_vert,fragmentShader:tt.linedashed_frag},depth:{uniforms:li([Se.common,Se.displacementmap]),vertexShader:tt.depth_vert,fragmentShader:tt.depth_frag},normal:{uniforms:li([Se.common,Se.bumpmap,Se.normalmap,Se.displacementmap,{opacity:{value:1}}]),vertexShader:tt.meshnormal_vert,fragmentShader:tt.meshnormal_frag},sprite:{uniforms:li([Se.sprite,Se.fog]),vertexShader:tt.sprite_vert,fragmentShader:tt.sprite_frag},background:{uniforms:{uvTransform:{value:new at},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:tt.background_vert,fragmentShader:tt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:tt.backgroundCube_vert,fragmentShader:tt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:tt.cube_vert,fragmentShader:tt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:tt.equirect_vert,fragmentShader:tt.equirect_frag},distanceRGBA:{uniforms:li([Se.common,Se.displacementmap,{referencePosition:{value:new Y},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:tt.distanceRGBA_vert,fragmentShader:tt.distanceRGBA_frag},shadow:{uniforms:li([Se.lights,Se.fog,{color:{value:new bt(0)},opacity:{value:1}}]),vertexShader:tt.shadow_vert,fragmentShader:tt.shadow_frag}};fn.physical={uniforms:li([fn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new at},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new at},clearcoatNormalScale:{value:new Tt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new at},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new at},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new at},sheen:{value:0},sheenColor:{value:new bt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new at},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new at},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new at},transmissionSamplerSize:{value:new Tt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new at},attenuationDistance:{value:0},attenuationColor:{value:new bt(0)},specularColor:{value:new bt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new at},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new at}}]),vertexShader:tt.meshphysical_vert,fragmentShader:tt.meshphysical_frag};const sl={r:0,b:0,g:0};function UE(i,e,t,n,s,r,a){const o=new bt(0);let l=r===!0?0:1,u,h,d=null,m=0,y=null;function v(x,_){let E=!1,A=_.isScene===!0?_.background:null;switch(A&&A.isTexture&&(A=(_.backgroundBlurriness>0?t:e).get(A)),A===null?b(o,l):A&&A.isColor&&(b(A,1),E=!0),i.xr.getEnvironmentBlendMode()){case"opaque":E=!0;break;case"additive":n.buffers.color.setClear(0,0,0,1,a),E=!0;break;case"alpha-blend":n.buffers.color.setClear(0,0,0,0,a),E=!0;break}(i.autoClear||E)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),A&&(A.isCubeTexture||A.mapping===$l)?(h===void 0&&(h=new Wn(new ho(1,1,1),new Ws({name:"BackgroundCubeMaterial",uniforms:Vr(fn.backgroundCube.uniforms),vertexShader:fn.backgroundCube.vertexShader,fragmentShader:fn.backgroundCube.fragmentShader,side:Si,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(I,B,X){this.matrixWorld.copyPosition(X.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(h)),h.material.uniforms.envMap.value=A,h.material.uniforms.flipEnvMap.value=A.isCubeTexture&&A.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=_.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,h.material.toneMapped=A.colorSpace!==Ze,(d!==A||m!==A.version||y!==i.toneMapping)&&(h.material.needsUpdate=!0,d=A,m=A.version,y=i.toneMapping),h.layers.enableAll(),x.unshift(h,h.geometry,h.material,0,0,null)):A&&A.isTexture&&(u===void 0&&(u=new Wn(new bh(2,2),new Ws({name:"BackgroundMaterial",uniforms:Vr(fn.background.uniforms),vertexShader:fn.background.vertexShader,fragmentShader:fn.background.fragmentShader,side:cs,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(u)),u.material.uniforms.t2D.value=A,u.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,u.material.toneMapped=A.colorSpace!==Ze,A.matrixAutoUpdate===!0&&A.updateMatrix(),u.material.uniforms.uvTransform.value.copy(A.matrix),(d!==A||m!==A.version||y!==i.toneMapping)&&(u.material.needsUpdate=!0,d=A,m=A.version,y=i.toneMapping),u.layers.enableAll(),x.unshift(u,u.geometry,u.material,0,0,null))}function b(x,_){x.getRGB(sl,xg(i)),n.buffers.color.setClear(sl.r,sl.g,sl.b,_,a)}return{getClearColor:function(){return o},setClearColor:function(x,_=1){o.set(x),l=_,b(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(x){l=x,b(o,l)},render:v}}function NE(i,e,t,n){const s=i.getParameter(i.MAX_VERTEX_ATTRIBS),r=n.isWebGL2?null:e.get("OES_vertex_array_object"),a=n.isWebGL2||r!==null,o={},l=x(null);let u=l,h=!1;function d($,Z,le,ie,ue){let de=!1;if(a){const fe=b(ie,le,Z);u!==fe&&(u=fe,y(u.object)),de=_($,ie,le,ue),de&&E($,ie,le,ue)}else{const fe=Z.wireframe===!0;(u.geometry!==ie.id||u.program!==le.id||u.wireframe!==fe)&&(u.geometry=ie.id,u.program=le.id,u.wireframe=fe,de=!0)}ue!==null&&t.update(ue,i.ELEMENT_ARRAY_BUFFER),(de||h)&&(h=!1,X($,Z,le,ie),ue!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.get(ue).buffer))}function m(){return n.isWebGL2?i.createVertexArray():r.createVertexArrayOES()}function y($){return n.isWebGL2?i.bindVertexArray($):r.bindVertexArrayOES($)}function v($){return n.isWebGL2?i.deleteVertexArray($):r.deleteVertexArrayOES($)}function b($,Z,le){const ie=le.wireframe===!0;let ue=o[$.id];ue===void 0&&(ue={},o[$.id]=ue);let de=ue[Z.id];de===void 0&&(de={},ue[Z.id]=de);let fe=de[ie];return fe===void 0&&(fe=x(m()),de[ie]=fe),fe}function x($){const Z=[],le=[],ie=[];for(let ue=0;ue<s;ue++)Z[ue]=0,le[ue]=0,ie[ue]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Z,enabledAttributes:le,attributeDivisors:ie,object:$,attributes:{},index:null}}function _($,Z,le,ie){const ue=u.attributes,de=Z.attributes;let fe=0;const Pe=le.getAttributes();for(const Ae in Pe)if(Pe[Ae].location>=0){const he=ue[Ae];let Te=de[Ae];if(Te===void 0&&(Ae==="instanceMatrix"&&$.instanceMatrix&&(Te=$.instanceMatrix),Ae==="instanceColor"&&$.instanceColor&&(Te=$.instanceColor)),he===void 0||he.attribute!==Te||Te&&he.data!==Te.data)return!0;fe++}return u.attributesNum!==fe||u.index!==ie}function E($,Z,le,ie){const ue={},de=Z.attributes;let fe=0;const Pe=le.getAttributes();for(const Ae in Pe)if(Pe[Ae].location>=0){let he=de[Ae];he===void 0&&(Ae==="instanceMatrix"&&$.instanceMatrix&&(he=$.instanceMatrix),Ae==="instanceColor"&&$.instanceColor&&(he=$.instanceColor));const Te={};Te.attribute=he,he&&he.data&&(Te.data=he.data),ue[Ae]=Te,fe++}u.attributes=ue,u.attributesNum=fe,u.index=ie}function A(){const $=u.newAttributes;for(let Z=0,le=$.length;Z<le;Z++)$[Z]=0}function w($){C($,0)}function C($,Z){const le=u.newAttributes,ie=u.enabledAttributes,ue=u.attributeDivisors;le[$]=1,ie[$]===0&&(i.enableVertexAttribArray($),ie[$]=1),ue[$]!==Z&&((n.isWebGL2?i:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"]($,Z),ue[$]=Z)}function I(){const $=u.newAttributes,Z=u.enabledAttributes;for(let le=0,ie=Z.length;le<ie;le++)Z[le]!==$[le]&&(i.disableVertexAttribArray(le),Z[le]=0)}function B($,Z,le,ie,ue,de){n.isWebGL2===!0&&(le===i.INT||le===i.UNSIGNED_INT)?i.vertexAttribIPointer($,Z,le,ue,de):i.vertexAttribPointer($,Z,le,ie,ue,de)}function X($,Z,le,ie){if(n.isWebGL2===!1&&($.isInstancedMesh||ie.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;A();const ue=ie.attributes,de=le.getAttributes(),fe=Z.defaultAttributeValues;for(const Pe in de){const Ae=de[Pe];if(Ae.location>=0){let ee=ue[Pe];if(ee===void 0&&(Pe==="instanceMatrix"&&$.instanceMatrix&&(ee=$.instanceMatrix),Pe==="instanceColor"&&$.instanceColor&&(ee=$.instanceColor)),ee!==void 0){const he=ee.normalized,Te=ee.itemSize,Ce=t.get(ee);if(Ce===void 0)continue;const G=Ce.buffer,Ke=Ce.type,$e=Ce.bytesPerElement;if(ee.isInterleavedBufferAttribute){const xe=ee.data,Ge=xe.stride,lt=ee.offset;if(xe.isInstancedInterleavedBuffer){for(let Ne=0;Ne<Ae.locationSize;Ne++)C(Ae.location+Ne,xe.meshPerAttribute);$.isInstancedMesh!==!0&&ie._maxInstanceCount===void 0&&(ie._maxInstanceCount=xe.meshPerAttribute*xe.count)}else for(let Ne=0;Ne<Ae.locationSize;Ne++)w(Ae.location+Ne);i.bindBuffer(i.ARRAY_BUFFER,G);for(let Ne=0;Ne<Ae.locationSize;Ne++)B(Ae.location+Ne,Te/Ae.locationSize,Ke,he,Ge*$e,(lt+Te/Ae.locationSize*Ne)*$e)}else{if(ee.isInstancedBufferAttribute){for(let xe=0;xe<Ae.locationSize;xe++)C(Ae.location+xe,ee.meshPerAttribute);$.isInstancedMesh!==!0&&ie._maxInstanceCount===void 0&&(ie._maxInstanceCount=ee.meshPerAttribute*ee.count)}else for(let xe=0;xe<Ae.locationSize;xe++)w(Ae.location+xe);i.bindBuffer(i.ARRAY_BUFFER,G);for(let xe=0;xe<Ae.locationSize;xe++)B(Ae.location+xe,Te/Ae.locationSize,Ke,he,Te*$e,Te/Ae.locationSize*xe*$e)}}else if(fe!==void 0){const he=fe[Pe];if(he!==void 0)switch(he.length){case 2:i.vertexAttrib2fv(Ae.location,he);break;case 3:i.vertexAttrib3fv(Ae.location,he);break;case 4:i.vertexAttrib4fv(Ae.location,he);break;default:i.vertexAttrib1fv(Ae.location,he)}}}}I()}function M(){oe();for(const $ in o){const Z=o[$];for(const le in Z){const ie=Z[le];for(const ue in ie)v(ie[ue].object),delete ie[ue];delete Z[le]}delete o[$]}}function F($){if(o[$.id]===void 0)return;const Z=o[$.id];for(const le in Z){const ie=Z[le];for(const ue in ie)v(ie[ue].object),delete ie[ue];delete Z[le]}delete o[$.id]}function Q($){for(const Z in o){const le=o[Z];if(le[$.id]===void 0)continue;const ie=le[$.id];for(const ue in ie)v(ie[ue].object),delete ie[ue];delete le[$.id]}}function oe(){H(),h=!0,u!==l&&(u=l,y(u.object))}function H(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:d,reset:oe,resetDefaultState:H,dispose:M,releaseStatesOfGeometry:F,releaseStatesOfProgram:Q,initAttributes:A,enableAttribute:w,disableUnusedAttributes:I}}function kE(i,e,t,n){const s=n.isWebGL2;let r;function a(u){r=u}function o(u,h){i.drawArrays(r,u,h),t.update(h,r,1)}function l(u,h,d){if(d===0)return;let m,y;if(s)m=i,y="drawArraysInstanced";else if(m=e.get("ANGLE_instanced_arrays"),y="drawArraysInstancedANGLE",m===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[y](r,u,h,d),t.update(h,r,d)}this.setMode=a,this.render=o,this.renderInstances=l}function FE(i,e,t){let n;function s(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const B=e.get("EXT_texture_filter_anisotropic");n=i.getParameter(B.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function r(B){if(B==="highp"){if(i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision>0)return"highp";B="mediump"}return B==="mediump"&&i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const a=typeof WebGL2RenderingContext<"u"&&i.constructor.name==="WebGL2RenderingContext";let o=t.precision!==void 0?t.precision:"highp";const l=r(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);const u=a||e.has("WEBGL_draw_buffers"),h=t.logarithmicDepthBuffer===!0,d=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),m=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),y=i.getParameter(i.MAX_TEXTURE_SIZE),v=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),b=i.getParameter(i.MAX_VERTEX_ATTRIBS),x=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),_=i.getParameter(i.MAX_VARYING_VECTORS),E=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),A=m>0,w=a||e.has("OES_texture_float"),C=A&&w,I=a?i.getParameter(i.MAX_SAMPLES):0;return{isWebGL2:a,drawBuffers:u,getMaxAnisotropy:s,getMaxPrecision:r,precision:o,logarithmicDepthBuffer:h,maxTextures:d,maxVertexTextures:m,maxTextureSize:y,maxCubemapSize:v,maxAttributes:b,maxVertexUniforms:x,maxVaryings:_,maxFragmentUniforms:E,vertexTextures:A,floatFragmentTextures:w,floatVertexTextures:C,maxSamples:I}}function BE(i){const e=this;let t=null,n=0,s=!1,r=!1;const a=new Ms,o=new at,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,m){const y=d.length!==0||m||n!==0||s;return s=m,n=d.length,y},this.beginShadows=function(){r=!0,h(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(d,m){t=h(d,m,0)},this.setState=function(d,m,y){const v=d.clippingPlanes,b=d.clipIntersection,x=d.clipShadows,_=i.get(d);if(!s||v===null||v.length===0||r&&!x)r?h(null):u();else{const E=r?0:n,A=E*4;let w=_.clippingState||null;l.value=w,w=h(v,m,A,y);for(let C=0;C!==A;++C)w[C]=t[C];_.clippingState=w,this.numIntersection=b?this.numPlanes:0,this.numPlanes+=E}};function u(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function h(d,m,y,v){const b=d!==null?d.length:0;let x=null;if(b!==0){if(x=l.value,v!==!0||x===null){const _=y+b*4,E=m.matrixWorldInverse;o.getNormalMatrix(E),(x===null||x.length<_)&&(x=new Float32Array(_));for(let A=0,w=y;A!==b;++A,w+=4)a.copy(d[A]).applyMatrix4(E,o),a.normal.toArray(x,w),x[w+3]=a.constant}l.value=x,l.needsUpdate=!0}return e.numPlanes=b,e.numIntersection=0,x}}function HE(i){let e=new WeakMap;function t(a,o){return o===Ic?a.mapping=Fr:o===Oc&&(a.mapping=Br),a}function n(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){const o=a.mapping;if(o===Ic||o===Oc)if(e.has(a)){const l=e.get(a).texture;return t(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const u=new iS(l.height/2);return u.fromEquirectangularTexture(i,a),e.set(a,u),a.addEventListener("dispose",s),t(u.texture,a.mapping)}else return null}}return a}function s(a){const o=a.target;o.removeEventListener("dispose",s);const l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function r(){e=new WeakMap}return{get:n,dispose:r}}class VE extends Sg{constructor(e=-1,t=1,n=1,s=-1,r=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=s,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,s,r,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=n-e,a=n+e,o=s+t,l=s-t;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=u*this.view.offsetX,a=r+u*this.view.width,o-=h*this.view.offsetY,l=o-h*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const br=4,op=[.125,.215,.35,.446,.526,.582],Rs=20,rc=new VE,lp=new bt;let ac=null;const ws=(1+Math.sqrt(5))/2,mr=1/ws,up=[new Y(1,1,1),new Y(-1,1,1),new Y(1,1,-1),new Y(-1,1,-1),new Y(0,ws,mr),new Y(0,ws,-mr),new Y(mr,0,ws),new Y(-mr,0,ws),new Y(ws,mr,0),new Y(-ws,mr,0)];class cp{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,s=100){ac=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,s,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=fp(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=dp(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(ac),e.scissorTest=!1,rl(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Fr||e.mapping===Br?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),ac=this._renderer.getRenderTarget();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:vi,minFilter:vi,generateMipmaps:!1,type:Za,format:tn,colorSpace:En,depthBuffer:!1},s=hp(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=hp(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=zE(r)),this._blurMaterial=GE(r,e,t)}return s}_compileMaterial(e){const t=new Wn(this._lodPlanes[0],e);this._renderer.compile(t,rc)}_sceneToCubeUV(e,t,n,s){const o=new Vi(90,1,t,n),l=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],h=this._renderer,d=h.autoClear,m=h.toneMapping;h.getClearColor(lp),h.toneMapping=qn,h.autoClear=!1;const y=new Sh({name:"PMREM.Background",side:Si,depthWrite:!1,depthTest:!1}),v=new Wn(new ho,y);let b=!1;const x=e.background;x?x.isColor&&(y.color.copy(x),e.background=null,b=!0):(y.color.copy(lp),b=!0);for(let _=0;_<6;_++){const E=_%3;E===0?(o.up.set(0,l[_],0),o.lookAt(u[_],0,0)):E===1?(o.up.set(0,0,l[_]),o.lookAt(0,u[_],0)):(o.up.set(0,l[_],0),o.lookAt(0,0,u[_]));const A=this._cubeSize;rl(s,E*A,_>2?A:0,A,A),h.setRenderTarget(s),b&&h.render(v,o),h.render(e,o)}v.geometry.dispose(),v.material.dispose(),h.toneMapping=m,h.autoClear=d,e.background=x}_textureToCubeUV(e,t){const n=this._renderer,s=e.mapping===Fr||e.mapping===Br;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=fp()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=dp());const r=s?this._cubemapMaterial:this._equirectMaterial,a=new Wn(this._lodPlanes[0],r),o=r.uniforms;o.envMap.value=e;const l=this._cubeSize;rl(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(a,rc)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let s=1;s<this._lodPlanes.length;s++){const r=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=up[(s-1)%up.length];this._blur(e,s-1,s,r,a)}t.autoClear=n}_blur(e,t,n,s,r){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,s,"latitudinal",r),this._halfBlur(a,e,n,n,s,"longitudinal",r)}_halfBlur(e,t,n,s,r,a,o){const l=this._renderer,u=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,d=new Wn(this._lodPlanes[s],u),m=u.uniforms,y=this._sizeLods[n]-1,v=isFinite(r)?Math.PI/(2*y):2*Math.PI/(2*Rs-1),b=r/v,x=isFinite(r)?1+Math.floor(h*b):Rs;x>Rs&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${x} samples when the maximum is set to ${Rs}`);const _=[];let E=0;for(let B=0;B<Rs;++B){const X=B/b,M=Math.exp(-X*X/2);_.push(M),B===0?E+=M:B<x&&(E+=2*M)}for(let B=0;B<_.length;B++)_[B]=_[B]/E;m.envMap.value=e.texture,m.samples.value=x,m.weights.value=_,m.latitudinal.value=a==="latitudinal",o&&(m.poleAxis.value=o);const{_lodMax:A}=this;m.dTheta.value=v,m.mipInt.value=A-n;const w=this._sizeLods[s],C=3*w*(s>A-br?s-A+br:0),I=4*(this._cubeSize-w);rl(t,C,I,3*w,2*w),l.setRenderTarget(t),l.render(d,rc)}}function zE(i){const e=[],t=[],n=[];let s=i;const r=i-br+1+op.length;for(let a=0;a<r;a++){const o=Math.pow(2,s);t.push(o);let l=1/o;a>i-br?l=op[a-i+br-1]:a===0&&(l=0),n.push(l);const u=1/(o-2),h=-u,d=1+u,m=[h,h,d,h,d,d,h,h,d,d,h,d],y=6,v=6,b=3,x=2,_=1,E=new Float32Array(b*v*y),A=new Float32Array(x*v*y),w=new Float32Array(_*v*y);for(let I=0;I<y;I++){const B=I%3*2/3-1,X=I>2?0:-1,M=[B,X,0,B+2/3,X,0,B+2/3,X+1,0,B,X,0,B+2/3,X+1,0,B,X+1,0];E.set(M,b*v*I),A.set(m,x*v*I);const F=[I,I,I,I,I,I];w.set(F,_*v*I)}const C=new fs;C.setAttribute("position",new yn(E,b)),C.setAttribute("uv",new yn(A,x)),C.setAttribute("faceIndex",new yn(w,_)),e.push(C),s>br&&s--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function hp(i,e,t){const n=new Gs(i,e,t);return n.texture.mapping=$l,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function rl(i,e,t,n,s){i.viewport.set(e,t,n,s),i.scissor.set(e,t,n,s)}function GE(i,e,t){const n=new Float32Array(Rs),s=new Y(0,1,0);return new Ws({name:"SphericalGaussianBlur",defines:{n:Rs,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:Eh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:us,depthTest:!1,depthWrite:!1})}function dp(){return new Ws({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Eh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:us,depthTest:!1,depthWrite:!1})}function fp(){return new Ws({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Eh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:us,depthTest:!1,depthWrite:!1})}function Eh(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function WE(i){let e=new WeakMap,t=null;function n(o){if(o&&o.isTexture){const l=o.mapping,u=l===Ic||l===Oc,h=l===Fr||l===Br;if(u||h)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let d=e.get(o);return t===null&&(t=new cp(i)),d=u?t.fromEquirectangular(o,d):t.fromCubemap(o,d),e.set(o,d),d.texture}else{if(e.has(o))return e.get(o).texture;{const d=o.image;if(u&&d&&d.height>0||h&&d&&s(d)){t===null&&(t=new cp(i));const m=u?t.fromEquirectangular(o):t.fromCubemap(o);return e.set(o,m),o.addEventListener("dispose",r),m.texture}else return null}}}return o}function s(o){let l=0;const u=6;for(let h=0;h<u;h++)o[h]!==void 0&&l++;return l===u}function r(o){const l=o.target;l.removeEventListener("dispose",r);const u=e.get(l);u!==void 0&&(e.delete(l),u.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:a}}function qE(i){const e={};function t(n){if(e[n]!==void 0)return e[n];let s;switch(n){case"WEBGL_depth_texture":s=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=i.getExtension(n)}return e[n]=s,s}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const s=t(n);return s===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),s}}}function $E(i,e,t,n){const s={},r=new WeakMap;function a(d){const m=d.target;m.index!==null&&e.remove(m.index);for(const v in m.attributes)e.remove(m.attributes[v]);m.removeEventListener("dispose",a),delete s[m.id];const y=r.get(m);y&&(e.remove(y),r.delete(m)),n.releaseStatesOfGeometry(m),m.isInstancedBufferGeometry===!0&&delete m._maxInstanceCount,t.memory.geometries--}function o(d,m){return s[m.id]===!0||(m.addEventListener("dispose",a),s[m.id]=!0,t.memory.geometries++),m}function l(d){const m=d.attributes;for(const v in m)e.update(m[v],i.ARRAY_BUFFER);const y=d.morphAttributes;for(const v in y){const b=y[v];for(let x=0,_=b.length;x<_;x++)e.update(b[x],i.ARRAY_BUFFER)}}function u(d){const m=[],y=d.index,v=d.attributes.position;let b=0;if(y!==null){const E=y.array;b=y.version;for(let A=0,w=E.length;A<w;A+=3){const C=E[A+0],I=E[A+1],B=E[A+2];m.push(C,I,I,B,B,C)}}else{const E=v.array;b=v.version;for(let A=0,w=E.length/3-1;A<w;A+=3){const C=A+0,I=A+1,B=A+2;m.push(C,I,I,B,B,C)}}const x=new(fg(m)?Tg:yg)(m,1);x.version=b;const _=r.get(d);_&&e.remove(_),r.set(d,x)}function h(d){const m=r.get(d);if(m){const y=d.index;y!==null&&m.version<y.version&&u(d)}else u(d);return r.get(d)}return{get:o,update:l,getWireframeAttribute:h}}function jE(i,e,t,n){const s=n.isWebGL2;let r;function a(m){r=m}let o,l;function u(m){o=m.type,l=m.bytesPerElement}function h(m,y){i.drawElements(r,y,o,m*l),t.update(y,r,1)}function d(m,y,v){if(v===0)return;let b,x;if(s)b=i,x="drawElementsInstanced";else if(b=e.get("ANGLE_instanced_arrays"),x="drawElementsInstancedANGLE",b===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}b[x](r,y,o,m*l,v),t.update(y,r,v)}this.setMode=a,this.setIndex=u,this.render=h,this.renderInstances=d}function XE(i){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(r,a,o){switch(t.calls++,a){case i.TRIANGLES:t.triangles+=o*(r/3);break;case i.LINES:t.lines+=o*(r/2);break;case i.LINE_STRIP:t.lines+=o*(r-1);break;case i.LINE_LOOP:t.lines+=o*r;break;case i.POINTS:t.points+=o*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function s(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:s,update:n}}function KE(i,e){return i[0]-e[0]}function YE(i,e){return Math.abs(e[1])-Math.abs(i[1])}function QE(i,e,t){const n={},s=new Float32Array(8),r=new WeakMap,a=new Qt,o=[];for(let u=0;u<8;u++)o[u]=[u,0];function l(u,h,d){const m=u.morphTargetInfluences;if(e.isWebGL2===!0){const y=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,v=y!==void 0?y.length:0;let b=r.get(h);if(b===void 0||b.count!==v){let $=function(){oe.dispose(),r.delete(h),h.removeEventListener("dispose",$)};b!==void 0&&b.texture.dispose();const E=h.morphAttributes.position!==void 0,A=h.morphAttributes.normal!==void 0,w=h.morphAttributes.color!==void 0,C=h.morphAttributes.position||[],I=h.morphAttributes.normal||[],B=h.morphAttributes.color||[];let X=0;E===!0&&(X=1),A===!0&&(X=2),w===!0&&(X=3);let M=h.attributes.position.count*X,F=1;M>e.maxTextureSize&&(F=Math.ceil(M/e.maxTextureSize),M=e.maxTextureSize);const Q=new Float32Array(M*F*4*v),oe=new gg(Q,M,F,v);oe.type=Is,oe.needsUpdate=!0;const H=X*4;for(let Z=0;Z<v;Z++){const le=C[Z],ie=I[Z],ue=B[Z],de=M*F*4*Z;for(let fe=0;fe<le.count;fe++){const Pe=fe*H;E===!0&&(a.fromBufferAttribute(le,fe),Q[de+Pe+0]=a.x,Q[de+Pe+1]=a.y,Q[de+Pe+2]=a.z,Q[de+Pe+3]=0),A===!0&&(a.fromBufferAttribute(ie,fe),Q[de+Pe+4]=a.x,Q[de+Pe+5]=a.y,Q[de+Pe+6]=a.z,Q[de+Pe+7]=0),w===!0&&(a.fromBufferAttribute(ue,fe),Q[de+Pe+8]=a.x,Q[de+Pe+9]=a.y,Q[de+Pe+10]=a.z,Q[de+Pe+11]=ue.itemSize===4?a.w:1)}}b={count:v,texture:oe,size:new Tt(M,F)},r.set(h,b),h.addEventListener("dispose",$)}let x=0;for(let E=0;E<m.length;E++)x+=m[E];const _=h.morphTargetsRelative?1:1-x;d.getUniforms().setValue(i,"morphTargetBaseInfluence",_),d.getUniforms().setValue(i,"morphTargetInfluences",m),d.getUniforms().setValue(i,"morphTargetsTexture",b.texture,t),d.getUniforms().setValue(i,"morphTargetsTextureSize",b.size)}else{const y=m===void 0?0:m.length;let v=n[h.id];if(v===void 0||v.length!==y){v=[];for(let A=0;A<y;A++)v[A]=[A,0];n[h.id]=v}for(let A=0;A<y;A++){const w=v[A];w[0]=A,w[1]=m[A]}v.sort(YE);for(let A=0;A<8;A++)A<y&&v[A][1]?(o[A][0]=v[A][0],o[A][1]=v[A][1]):(o[A][0]=Number.MAX_SAFE_INTEGER,o[A][1]=0);o.sort(KE);const b=h.morphAttributes.position,x=h.morphAttributes.normal;let _=0;for(let A=0;A<8;A++){const w=o[A],C=w[0],I=w[1];C!==Number.MAX_SAFE_INTEGER&&I?(b&&h.getAttribute("morphTarget"+A)!==b[C]&&h.setAttribute("morphTarget"+A,b[C]),x&&h.getAttribute("morphNormal"+A)!==x[C]&&h.setAttribute("morphNormal"+A,x[C]),s[A]=I,_+=I):(b&&h.hasAttribute("morphTarget"+A)===!0&&h.deleteAttribute("morphTarget"+A),x&&h.hasAttribute("morphNormal"+A)===!0&&h.deleteAttribute("morphNormal"+A),s[A]=0)}const E=h.morphTargetsRelative?1:1-_;d.getUniforms().setValue(i,"morphTargetBaseInfluence",E),d.getUniforms().setValue(i,"morphTargetInfluences",s)}}return{update:l}}function ZE(i,e,t,n){let s=new WeakMap;function r(l){const u=n.render.frame,h=l.geometry,d=e.get(l,h);return s.get(d)!==u&&(e.update(d),s.set(d,u)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),t.update(l.instanceMatrix,i.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,i.ARRAY_BUFFER)),d}function a(){s=new WeakMap}function o(l){const u=l.target;u.removeEventListener("dispose",o),t.remove(u.instanceMatrix),u.instanceColor!==null&&t.remove(u.instanceColor)}return{update:r,dispose:a}}const Cg=new bi,Mg=new gg,wg=new Bx,Dg=new bg,pp=[],mp=[],gp=new Float32Array(16),_p=new Float32Array(9),vp=new Float32Array(4);function ia(i,e,t){const n=i[0];if(n<=0||n>0)return i;const s=e*t;let r=pp[s];if(r===void 0&&(r=new Float32Array(s),pp[s]=r),e!==0){n.toArray(r,0);for(let a=1,o=0;a!==e;++a)o+=t,i[a].toArray(r,o)}return r}function Wt(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}function qt(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}function Kl(i,e){let t=mp[e];t===void 0&&(t=new Int32Array(e),mp[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}function JE(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function e2(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Wt(t,e))return;i.uniform2fv(this.addr,e),qt(t,e)}}function t2(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Wt(t,e))return;i.uniform3fv(this.addr,e),qt(t,e)}}function i2(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Wt(t,e))return;i.uniform4fv(this.addr,e),qt(t,e)}}function n2(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Wt(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),qt(t,e)}else{if(Wt(t,n))return;vp.set(n),i.uniformMatrix2fv(this.addr,!1,vp),qt(t,n)}}function s2(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Wt(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),qt(t,e)}else{if(Wt(t,n))return;_p.set(n),i.uniformMatrix3fv(this.addr,!1,_p),qt(t,n)}}function r2(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Wt(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),qt(t,e)}else{if(Wt(t,n))return;gp.set(n),i.uniformMatrix4fv(this.addr,!1,gp),qt(t,n)}}function a2(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function o2(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Wt(t,e))return;i.uniform2iv(this.addr,e),qt(t,e)}}function l2(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Wt(t,e))return;i.uniform3iv(this.addr,e),qt(t,e)}}function u2(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Wt(t,e))return;i.uniform4iv(this.addr,e),qt(t,e)}}function c2(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function h2(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Wt(t,e))return;i.uniform2uiv(this.addr,e),qt(t,e)}}function d2(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Wt(t,e))return;i.uniform3uiv(this.addr,e),qt(t,e)}}function f2(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Wt(t,e))return;i.uniform4uiv(this.addr,e),qt(t,e)}}function p2(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture2D(e||Cg,s)}function m2(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture3D(e||wg,s)}function g2(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTextureCube(e||Dg,s)}function _2(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture2DArray(e||Mg,s)}function v2(i){switch(i){case 5126:return JE;case 35664:return e2;case 35665:return t2;case 35666:return i2;case 35674:return n2;case 35675:return s2;case 35676:return r2;case 5124:case 35670:return a2;case 35667:case 35671:return o2;case 35668:case 35672:return l2;case 35669:case 35673:return u2;case 5125:return c2;case 36294:return h2;case 36295:return d2;case 36296:return f2;case 35678:case 36198:case 36298:case 36306:case 35682:return p2;case 35679:case 36299:case 36307:return m2;case 35680:case 36300:case 36308:case 36293:return g2;case 36289:case 36303:case 36311:case 36292:return _2}}function y2(i,e){i.uniform1fv(this.addr,e)}function T2(i,e){const t=ia(e,this.size,2);i.uniform2fv(this.addr,t)}function x2(i,e){const t=ia(e,this.size,3);i.uniform3fv(this.addr,t)}function S2(i,e){const t=ia(e,this.size,4);i.uniform4fv(this.addr,t)}function b2(i,e){const t=ia(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function E2(i,e){const t=ia(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function A2(i,e){const t=ia(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function C2(i,e){i.uniform1iv(this.addr,e)}function M2(i,e){i.uniform2iv(this.addr,e)}function w2(i,e){i.uniform3iv(this.addr,e)}function D2(i,e){i.uniform4iv(this.addr,e)}function R2(i,e){i.uniform1uiv(this.addr,e)}function P2(i,e){i.uniform2uiv(this.addr,e)}function L2(i,e){i.uniform3uiv(this.addr,e)}function I2(i,e){i.uniform4uiv(this.addr,e)}function O2(i,e,t){const n=this.cache,s=e.length,r=Kl(t,s);Wt(n,r)||(i.uniform1iv(this.addr,r),qt(n,r));for(let a=0;a!==s;++a)t.setTexture2D(e[a]||Cg,r[a])}function U2(i,e,t){const n=this.cache,s=e.length,r=Kl(t,s);Wt(n,r)||(i.uniform1iv(this.addr,r),qt(n,r));for(let a=0;a!==s;++a)t.setTexture3D(e[a]||wg,r[a])}function N2(i,e,t){const n=this.cache,s=e.length,r=Kl(t,s);Wt(n,r)||(i.uniform1iv(this.addr,r),qt(n,r));for(let a=0;a!==s;++a)t.setTextureCube(e[a]||Dg,r[a])}function k2(i,e,t){const n=this.cache,s=e.length,r=Kl(t,s);Wt(n,r)||(i.uniform1iv(this.addr,r),qt(n,r));for(let a=0;a!==s;++a)t.setTexture2DArray(e[a]||Mg,r[a])}function F2(i){switch(i){case 5126:return y2;case 35664:return T2;case 35665:return x2;case 35666:return S2;case 35674:return b2;case 35675:return E2;case 35676:return A2;case 5124:case 35670:return C2;case 35667:case 35671:return M2;case 35668:case 35672:return w2;case 35669:case 35673:return D2;case 5125:return R2;case 36294:return P2;case 36295:return L2;case 36296:return I2;case 35678:case 36198:case 36298:case 36306:case 35682:return O2;case 35679:case 36299:case 36307:return U2;case 35680:case 36300:case 36308:case 36293:return N2;case 36289:case 36303:case 36311:case 36292:return k2}}class B2{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=v2(t.type)}}class H2{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=F2(t.type)}}class V2{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const s=this.seq;for(let r=0,a=s.length;r!==a;++r){const o=s[r];o.setValue(e,t[o.id],n)}}}const oc=/(\w+)(\])?(\[|\.)?/g;function yp(i,e){i.seq.push(e),i.map[e.id]=e}function z2(i,e,t){const n=i.name,s=n.length;for(oc.lastIndex=0;;){const r=oc.exec(n),a=oc.lastIndex;let o=r[1];const l=r[2]==="]",u=r[3];if(l&&(o=o|0),u===void 0||u==="["&&a+2===s){yp(t,u===void 0?new B2(o,i,e):new H2(o,i,e));break}else{let d=t.map[o];d===void 0&&(d=new V2(o),yp(t,d)),t=d}}}class ml{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<n;++s){const r=e.getActiveUniform(t,s),a=e.getUniformLocation(t,r.name);z2(r,a,this)}}setValue(e,t,n,s){const r=this.map[t];r!==void 0&&r.setValue(e,n,s)}setOptional(e,t,n){const s=t[n];s!==void 0&&this.setValue(e,n,s)}static upload(e,t,n,s){for(let r=0,a=t.length;r!==a;++r){const o=t[r],l=n[o.id];l.needsUpdate!==!1&&o.setValue(e,l.value,s)}}static seqWithValue(e,t){const n=[];for(let s=0,r=e.length;s!==r;++s){const a=e[s];a.id in t&&n.push(a)}return n}}function Tp(i,e,t){const n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}let G2=0;function W2(i,e){const t=i.split(`
`),n=[],s=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let a=s;a<r;a++){const o=a+1;n.push(`${o===e?">":" "} ${o}: ${t[a]}`)}return n.join(`
`)}function q2(i){switch(i){case En:return["Linear","( value )"];case Ze:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",i),["Linear","( value )"]}}function xp(i,e,t){const n=i.getShaderParameter(e,i.COMPILE_STATUS),s=i.getShaderInfoLog(e).trim();if(n&&s==="")return"";const r=/ERROR: 0:(\d+)/.exec(s);if(r){const a=parseInt(r[1]);return t.toUpperCase()+`

`+s+`

`+W2(i.getShaderSource(e),a)}else return s}function $2(i,e){const t=q2(e);return"vec4 "+i+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function j2(i,e){let t;switch(e){case $T:t="Linear";break;case jT:t="Reinhard";break;case XT:t="OptimizedCineon";break;case KT:t="ACESFilmic";break;case YT:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function X2(i){return[i.extensionDerivatives||i.envMapCubeUVHeight||i.bumpMap||i.normalMapTangentSpace||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap||i.transmission)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Oa).join(`
`)}function K2(i){const e=[];for(const t in i){const n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function Y2(i,e){const t={},n=i.getProgramParameter(e,i.ACTIVE_ATTRIBUTES);for(let s=0;s<n;s++){const r=i.getActiveAttrib(e,s),a=r.name;let o=1;r.type===i.FLOAT_MAT2&&(o=2),r.type===i.FLOAT_MAT3&&(o=3),r.type===i.FLOAT_MAT4&&(o=4),t[a]={type:r.type,location:i.getAttribLocation(e,a),locationSize:o}}return t}function Oa(i){return i!==""}function Sp(i,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function bp(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Q2=/^[ \t]*#include +<([\w\d./]+)>/gm;function Bc(i){return i.replace(Q2,Z2)}function Z2(i,e){const t=tt[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return Bc(t)}const J2=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Ep(i){return i.replace(J2,e1)}function e1(i,e,t,n){let s="";for(let r=parseInt(e);r<parseInt(t);r++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return s}function Ap(i){let e="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function t1(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===sg?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===ET?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===Hn&&(e="SHADOWMAP_TYPE_VSM"),e}function i1(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case Fr:case Br:e="ENVMAP_TYPE_CUBE";break;case $l:e="ENVMAP_TYPE_CUBE_UV";break}return e}function n1(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case Br:e="ENVMAP_MODE_REFRACTION";break}return e}function s1(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case og:e="ENVMAP_BLENDING_MULTIPLY";break;case WT:e="ENVMAP_BLENDING_MIX";break;case qT:e="ENVMAP_BLENDING_ADD";break}return e}function r1(i){const e=i.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function a1(i,e,t,n){const s=i.getContext(),r=t.defines;let a=t.vertexShader,o=t.fragmentShader;const l=t1(t),u=i1(t),h=n1(t),d=s1(t),m=r1(t),y=t.isWebGL2?"":X2(t),v=K2(r),b=s.createProgram();let x,_,E=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(x=[v].filter(Oa).join(`
`),x.length>0&&(x+=`
`),_=[y,v].filter(Oa).join(`
`),_.length>0&&(_+=`
`)):(x=[Ap(t),"#define SHADER_NAME "+t.shaderName,v,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Oa).join(`
`),_=[y,Ap(t),"#define SHADER_NAME "+t.shaderName,v,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",t.envMap?"#define "+d:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==qn?"#define TONE_MAPPING":"",t.toneMapping!==qn?tt.tonemapping_pars_fragment:"",t.toneMapping!==qn?j2("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",tt.encodings_pars_fragment,$2("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Oa).join(`
`)),a=Bc(a),a=Sp(a,t),a=bp(a,t),o=Bc(o),o=Sp(o,t),o=bp(o,t),a=Ep(a),o=Ep(o),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(E=`#version 300 es
`,x=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+x,_=["#define varying in",t.glslVersion===Gf?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===Gf?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+_);const A=E+x+a,w=E+_+o,C=Tp(s,s.VERTEX_SHADER,A),I=Tp(s,s.FRAGMENT_SHADER,w);if(s.attachShader(b,C),s.attachShader(b,I),t.index0AttributeName!==void 0?s.bindAttribLocation(b,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(b,0,"position"),s.linkProgram(b),i.debug.checkShaderErrors){const M=s.getProgramInfoLog(b).trim(),F=s.getShaderInfoLog(C).trim(),Q=s.getShaderInfoLog(I).trim();let oe=!0,H=!0;if(s.getProgramParameter(b,s.LINK_STATUS)===!1)if(oe=!1,typeof i.debug.onShaderError=="function")i.debug.onShaderError(s,b,C,I);else{const $=xp(s,C,"vertex"),Z=xp(s,I,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(b,s.VALIDATE_STATUS)+`

Program Info Log: `+M+`
`+$+`
`+Z)}else M!==""?console.warn("THREE.WebGLProgram: Program Info Log:",M):(F===""||Q==="")&&(H=!1);H&&(this.diagnostics={runnable:oe,programLog:M,vertexShader:{log:F,prefix:x},fragmentShader:{log:Q,prefix:_}})}s.deleteShader(C),s.deleteShader(I);let B;this.getUniforms=function(){return B===void 0&&(B=new ml(s,b)),B};let X;return this.getAttributes=function(){return X===void 0&&(X=Y2(s,b)),X},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(b),this.program=void 0},this.name=t.shaderName,this.id=G2++,this.cacheKey=e,this.usedTimes=1,this.program=b,this.vertexShader=C,this.fragmentShader=I,this}let o1=0;class l1{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,s=this._getShaderStage(t),r=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return a.has(s)===!1&&(a.add(s),s.usedTimes++),a.has(r)===!1&&(a.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new u1(e),t.set(e,n)),n}}class u1{constructor(e){this.id=o1++,this.code=e,this.usedTimes=0}}function c1(i,e,t,n,s,r,a){const o=new _g,l=new l1,u=[],h=s.isWebGL2,d=s.logarithmicDepthBuffer,m=s.vertexTextures;let y=s.precision;const v={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function b(M){return M===1?"uv1":M===2?"uv2":M===3?"uv3":"uv"}function x(M,F,Q,oe,H){const $=oe.fog,Z=H.geometry,le=M.isMeshStandardMaterial?oe.environment:null,ie=(M.isMeshStandardMaterial?t:e).get(M.envMap||le),ue=ie&&ie.mapping===$l?ie.image.height:null,de=v[M.type];M.precision!==null&&(y=s.getMaxPrecision(M.precision),y!==M.precision&&console.warn("THREE.WebGLProgram.getParameters:",M.precision,"not supported, using",y,"instead."));const fe=Z.morphAttributes.position||Z.morphAttributes.normal||Z.morphAttributes.color,Pe=fe!==void 0?fe.length:0;let Ae=0;Z.morphAttributes.position!==void 0&&(Ae=1),Z.morphAttributes.normal!==void 0&&(Ae=2),Z.morphAttributes.color!==void 0&&(Ae=3);let ee,he,Te,Ce;if(de){const dt=fn[de];ee=dt.vertexShader,he=dt.fragmentShader}else ee=M.vertexShader,he=M.fragmentShader,l.update(M),Te=l.getVertexShaderID(M),Ce=l.getFragmentShaderID(M);const G=i.getRenderTarget(),Ke=H.isInstancedMesh===!0,$e=!!M.map,xe=!!M.matcap,Ge=!!ie,lt=!!M.aoMap,Ne=!!M.lightMap,it=!!M.bumpMap,Ot=!!M.normalMap,Ht=!!M.displacementMap,Ut=!!M.emissiveMap,gt=!!M.metalnessMap,ot=!!M.roughnessMap,Fe=M.clearcoat>0,Jt=M.iridescence>0,U=M.sheen>0,R=M.transmission>0,J=Fe&&!!M.clearcoatMap,pe=Fe&&!!M.clearcoatNormalMap,ge=Fe&&!!M.clearcoatRoughnessMap,be=Jt&&!!M.iridescenceMap,ze=Jt&&!!M.iridescenceThicknessMap,Re=U&&!!M.sheenColorMap,ae=U&&!!M.sheenRoughnessMap,Ie=!!M.specularMap,ye=!!M.specularColorMap,He=!!M.specularIntensityMap,De=R&&!!M.transmissionMap,Ue=R&&!!M.thicknessMap,st=!!M.gradientMap,ct=!!M.alphaMap,Et=M.alphaTest>0,V=!!M.extensions,ne=!!Z.attributes.uv1,me=!!Z.attributes.uv2,we=!!Z.attributes.uv3;return{isWebGL2:h,shaderID:de,shaderName:M.type,vertexShader:ee,fragmentShader:he,defines:M.defines,customVertexShaderID:Te,customFragmentShaderID:Ce,isRawShaderMaterial:M.isRawShaderMaterial===!0,glslVersion:M.glslVersion,precision:y,instancing:Ke,instancingColor:Ke&&H.instanceColor!==null,supportsVertexTextures:m,outputColorSpace:G===null?i.outputColorSpace:G.isXRRenderTarget===!0?G.texture.colorSpace:En,map:$e,matcap:xe,envMap:Ge,envMapMode:Ge&&ie.mapping,envMapCubeUVHeight:ue,aoMap:lt,lightMap:Ne,bumpMap:it,normalMap:Ot,displacementMap:m&&Ht,emissiveMap:Ut,normalMapObjectSpace:Ot&&M.normalMapType===gx,normalMapTangentSpace:Ot&&M.normalMapType===mx,metalnessMap:gt,roughnessMap:ot,clearcoat:Fe,clearcoatMap:J,clearcoatNormalMap:pe,clearcoatRoughnessMap:ge,iridescence:Jt,iridescenceMap:be,iridescenceThicknessMap:ze,sheen:U,sheenColorMap:Re,sheenRoughnessMap:ae,specularMap:Ie,specularColorMap:ye,specularIntensityMap:He,transmission:R,transmissionMap:De,thicknessMap:Ue,gradientMap:st,opaque:M.transparent===!1&&M.blending===wr,alphaMap:ct,alphaTest:Et,combine:M.combine,mapUv:$e&&b(M.map.channel),aoMapUv:lt&&b(M.aoMap.channel),lightMapUv:Ne&&b(M.lightMap.channel),bumpMapUv:it&&b(M.bumpMap.channel),normalMapUv:Ot&&b(M.normalMap.channel),displacementMapUv:Ht&&b(M.displacementMap.channel),emissiveMapUv:Ut&&b(M.emissiveMap.channel),metalnessMapUv:gt&&b(M.metalnessMap.channel),roughnessMapUv:ot&&b(M.roughnessMap.channel),clearcoatMapUv:J&&b(M.clearcoatMap.channel),clearcoatNormalMapUv:pe&&b(M.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ge&&b(M.clearcoatRoughnessMap.channel),iridescenceMapUv:be&&b(M.iridescenceMap.channel),iridescenceThicknessMapUv:ze&&b(M.iridescenceThicknessMap.channel),sheenColorMapUv:Re&&b(M.sheenColorMap.channel),sheenRoughnessMapUv:ae&&b(M.sheenRoughnessMap.channel),specularMapUv:Ie&&b(M.specularMap.channel),specularColorMapUv:ye&&b(M.specularColorMap.channel),specularIntensityMapUv:He&&b(M.specularIntensityMap.channel),transmissionMapUv:De&&b(M.transmissionMap.channel),thicknessMapUv:Ue&&b(M.thicknessMap.channel),alphaMapUv:ct&&b(M.alphaMap.channel),vertexTangents:Ot&&!!Z.attributes.tangent,vertexColors:M.vertexColors,vertexAlphas:M.vertexColors===!0&&!!Z.attributes.color&&Z.attributes.color.itemSize===4,vertexUv1s:ne,vertexUv2s:me,vertexUv3s:we,pointsUvs:H.isPoints===!0&&!!Z.attributes.uv&&($e||ct),fog:!!$,useFog:M.fog===!0,fogExp2:$&&$.isFogExp2,flatShading:M.flatShading===!0,sizeAttenuation:M.sizeAttenuation===!0,logarithmicDepthBuffer:d,skinning:H.isSkinnedMesh===!0,morphTargets:Z.morphAttributes.position!==void 0,morphNormals:Z.morphAttributes.normal!==void 0,morphColors:Z.morphAttributes.color!==void 0,morphTargetsCount:Pe,morphTextureStride:Ae,numDirLights:F.directional.length,numPointLights:F.point.length,numSpotLights:F.spot.length,numSpotLightMaps:F.spotLightMap.length,numRectAreaLights:F.rectArea.length,numHemiLights:F.hemi.length,numDirLightShadows:F.directionalShadowMap.length,numPointLightShadows:F.pointShadowMap.length,numSpotLightShadows:F.spotShadowMap.length,numSpotLightShadowsWithMaps:F.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:M.dithering,shadowMapEnabled:i.shadowMap.enabled&&Q.length>0,shadowMapType:i.shadowMap.type,toneMapping:M.toneMapped?i.toneMapping:qn,useLegacyLights:i.useLegacyLights,premultipliedAlpha:M.premultipliedAlpha,doubleSided:M.side===Vn,flipSided:M.side===Si,useDepthPacking:M.depthPacking>=0,depthPacking:M.depthPacking||0,index0AttributeName:M.index0AttributeName,extensionDerivatives:V&&M.extensions.derivatives===!0,extensionFragDepth:V&&M.extensions.fragDepth===!0,extensionDrawBuffers:V&&M.extensions.drawBuffers===!0,extensionShaderTextureLOD:V&&M.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:h||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||n.has("EXT_shader_texture_lod"),customProgramCacheKey:M.customProgramCacheKey()}}function _(M){const F=[];if(M.shaderID?F.push(M.shaderID):(F.push(M.customVertexShaderID),F.push(M.customFragmentShaderID)),M.defines!==void 0)for(const Q in M.defines)F.push(Q),F.push(M.defines[Q]);return M.isRawShaderMaterial===!1&&(E(F,M),A(F,M),F.push(i.outputColorSpace)),F.push(M.customProgramCacheKey),F.join()}function E(M,F){M.push(F.precision),M.push(F.outputColorSpace),M.push(F.envMapMode),M.push(F.envMapCubeUVHeight),M.push(F.mapUv),M.push(F.alphaMapUv),M.push(F.lightMapUv),M.push(F.aoMapUv),M.push(F.bumpMapUv),M.push(F.normalMapUv),M.push(F.displacementMapUv),M.push(F.emissiveMapUv),M.push(F.metalnessMapUv),M.push(F.roughnessMapUv),M.push(F.clearcoatMapUv),M.push(F.clearcoatNormalMapUv),M.push(F.clearcoatRoughnessMapUv),M.push(F.iridescenceMapUv),M.push(F.iridescenceThicknessMapUv),M.push(F.sheenColorMapUv),M.push(F.sheenRoughnessMapUv),M.push(F.specularMapUv),M.push(F.specularColorMapUv),M.push(F.specularIntensityMapUv),M.push(F.transmissionMapUv),M.push(F.thicknessMapUv),M.push(F.combine),M.push(F.fogExp2),M.push(F.sizeAttenuation),M.push(F.morphTargetsCount),M.push(F.morphAttributeCount),M.push(F.numDirLights),M.push(F.numPointLights),M.push(F.numSpotLights),M.push(F.numSpotLightMaps),M.push(F.numHemiLights),M.push(F.numRectAreaLights),M.push(F.numDirLightShadows),M.push(F.numPointLightShadows),M.push(F.numSpotLightShadows),M.push(F.numSpotLightShadowsWithMaps),M.push(F.shadowMapType),M.push(F.toneMapping),M.push(F.numClippingPlanes),M.push(F.numClipIntersection),M.push(F.depthPacking)}function A(M,F){o.disableAll(),F.isWebGL2&&o.enable(0),F.supportsVertexTextures&&o.enable(1),F.instancing&&o.enable(2),F.instancingColor&&o.enable(3),F.matcap&&o.enable(4),F.envMap&&o.enable(5),F.normalMapObjectSpace&&o.enable(6),F.normalMapTangentSpace&&o.enable(7),F.clearcoat&&o.enable(8),F.iridescence&&o.enable(9),F.alphaTest&&o.enable(10),F.vertexColors&&o.enable(11),F.vertexAlphas&&o.enable(12),F.vertexUv1s&&o.enable(13),F.vertexUv2s&&o.enable(14),F.vertexUv3s&&o.enable(15),F.vertexTangents&&o.enable(16),M.push(o.mask),o.disableAll(),F.fog&&o.enable(0),F.useFog&&o.enable(1),F.flatShading&&o.enable(2),F.logarithmicDepthBuffer&&o.enable(3),F.skinning&&o.enable(4),F.morphTargets&&o.enable(5),F.morphNormals&&o.enable(6),F.morphColors&&o.enable(7),F.premultipliedAlpha&&o.enable(8),F.shadowMapEnabled&&o.enable(9),F.useLegacyLights&&o.enable(10),F.doubleSided&&o.enable(11),F.flipSided&&o.enable(12),F.useDepthPacking&&o.enable(13),F.dithering&&o.enable(14),F.transmission&&o.enable(15),F.sheen&&o.enable(16),F.opaque&&o.enable(17),F.pointsUvs&&o.enable(18),M.push(o.mask)}function w(M){const F=v[M.type];let Q;if(F){const oe=fn[F];Q=Zx.clone(oe.uniforms)}else Q=M.uniforms;return Q}function C(M,F){let Q;for(let oe=0,H=u.length;oe<H;oe++){const $=u[oe];if($.cacheKey===F){Q=$,++Q.usedTimes;break}}return Q===void 0&&(Q=new a1(i,F,M,r),u.push(Q)),Q}function I(M){if(--M.usedTimes===0){const F=u.indexOf(M);u[F]=u[u.length-1],u.pop(),M.destroy()}}function B(M){l.remove(M)}function X(){l.dispose()}return{getParameters:x,getProgramCacheKey:_,getUniforms:w,acquireProgram:C,releaseProgram:I,releaseShaderCache:B,programs:u,dispose:X}}function h1(){let i=new WeakMap;function e(r){let a=i.get(r);return a===void 0&&(a={},i.set(r,a)),a}function t(r){i.delete(r)}function n(r,a,o){i.get(r)[a]=o}function s(){i=new WeakMap}return{get:e,remove:t,update:n,dispose:s}}function d1(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function Cp(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function Mp(){const i=[];let e=0;const t=[],n=[],s=[];function r(){e=0,t.length=0,n.length=0,s.length=0}function a(d,m,y,v,b,x){let _=i[e];return _===void 0?(_={id:d.id,object:d,geometry:m,material:y,groupOrder:v,renderOrder:d.renderOrder,z:b,group:x},i[e]=_):(_.id=d.id,_.object=d,_.geometry=m,_.material=y,_.groupOrder=v,_.renderOrder=d.renderOrder,_.z=b,_.group=x),e++,_}function o(d,m,y,v,b,x){const _=a(d,m,y,v,b,x);y.transmission>0?n.push(_):y.transparent===!0?s.push(_):t.push(_)}function l(d,m,y,v,b,x){const _=a(d,m,y,v,b,x);y.transmission>0?n.unshift(_):y.transparent===!0?s.unshift(_):t.unshift(_)}function u(d,m){t.length>1&&t.sort(d||d1),n.length>1&&n.sort(m||Cp),s.length>1&&s.sort(m||Cp)}function h(){for(let d=e,m=i.length;d<m;d++){const y=i[d];if(y.id===null)break;y.id=null,y.object=null,y.geometry=null,y.material=null,y.group=null}}return{opaque:t,transmissive:n,transparent:s,init:r,push:o,unshift:l,finish:h,sort:u}}function f1(){let i=new WeakMap;function e(n,s){const r=i.get(n);let a;return r===void 0?(a=new Mp,i.set(n,[a])):s>=r.length?(a=new Mp,r.push(a)):a=r[s],a}function t(){i=new WeakMap}return{get:e,dispose:t}}function p1(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Y,color:new bt};break;case"SpotLight":t={position:new Y,direction:new Y,color:new bt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Y,color:new bt,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Y,skyColor:new bt,groundColor:new bt};break;case"RectAreaLight":t={color:new bt,position:new Y,halfWidth:new Y,halfHeight:new Y};break}return i[e.id]=t,t}}}function m1(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Tt};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Tt};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Tt,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}let g1=0;function _1(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}function v1(i,e){const t=new p1,n=m1(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let h=0;h<9;h++)s.probe.push(new Y);const r=new Y,a=new Zt,o=new Zt;function l(h,d){let m=0,y=0,v=0;for(let Q=0;Q<9;Q++)s.probe[Q].set(0,0,0);let b=0,x=0,_=0,E=0,A=0,w=0,C=0,I=0,B=0,X=0;h.sort(_1);const M=d===!0?Math.PI:1;for(let Q=0,oe=h.length;Q<oe;Q++){const H=h[Q],$=H.color,Z=H.intensity,le=H.distance,ie=H.shadow&&H.shadow.map?H.shadow.map.texture:null;if(H.isAmbientLight)m+=$.r*Z*M,y+=$.g*Z*M,v+=$.b*Z*M;else if(H.isLightProbe)for(let ue=0;ue<9;ue++)s.probe[ue].addScaledVector(H.sh.coefficients[ue],Z);else if(H.isDirectionalLight){const ue=t.get(H);if(ue.color.copy(H.color).multiplyScalar(H.intensity*M),H.castShadow){const de=H.shadow,fe=n.get(H);fe.shadowBias=de.bias,fe.shadowNormalBias=de.normalBias,fe.shadowRadius=de.radius,fe.shadowMapSize=de.mapSize,s.directionalShadow[b]=fe,s.directionalShadowMap[b]=ie,s.directionalShadowMatrix[b]=H.shadow.matrix,w++}s.directional[b]=ue,b++}else if(H.isSpotLight){const ue=t.get(H);ue.position.setFromMatrixPosition(H.matrixWorld),ue.color.copy($).multiplyScalar(Z*M),ue.distance=le,ue.coneCos=Math.cos(H.angle),ue.penumbraCos=Math.cos(H.angle*(1-H.penumbra)),ue.decay=H.decay,s.spot[_]=ue;const de=H.shadow;if(H.map&&(s.spotLightMap[B]=H.map,B++,de.updateMatrices(H),H.castShadow&&X++),s.spotLightMatrix[_]=de.matrix,H.castShadow){const fe=n.get(H);fe.shadowBias=de.bias,fe.shadowNormalBias=de.normalBias,fe.shadowRadius=de.radius,fe.shadowMapSize=de.mapSize,s.spotShadow[_]=fe,s.spotShadowMap[_]=ie,I++}_++}else if(H.isRectAreaLight){const ue=t.get(H);ue.color.copy($).multiplyScalar(Z),ue.halfWidth.set(H.width*.5,0,0),ue.halfHeight.set(0,H.height*.5,0),s.rectArea[E]=ue,E++}else if(H.isPointLight){const ue=t.get(H);if(ue.color.copy(H.color).multiplyScalar(H.intensity*M),ue.distance=H.distance,ue.decay=H.decay,H.castShadow){const de=H.shadow,fe=n.get(H);fe.shadowBias=de.bias,fe.shadowNormalBias=de.normalBias,fe.shadowRadius=de.radius,fe.shadowMapSize=de.mapSize,fe.shadowCameraNear=de.camera.near,fe.shadowCameraFar=de.camera.far,s.pointShadow[x]=fe,s.pointShadowMap[x]=ie,s.pointShadowMatrix[x]=H.shadow.matrix,C++}s.point[x]=ue,x++}else if(H.isHemisphereLight){const ue=t.get(H);ue.skyColor.copy(H.color).multiplyScalar(Z*M),ue.groundColor.copy(H.groundColor).multiplyScalar(Z*M),s.hemi[A]=ue,A++}}E>0&&(e.isWebGL2||i.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=Se.LTC_FLOAT_1,s.rectAreaLTC2=Se.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(s.rectAreaLTC1=Se.LTC_HALF_1,s.rectAreaLTC2=Se.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=m,s.ambient[1]=y,s.ambient[2]=v;const F=s.hash;(F.directionalLength!==b||F.pointLength!==x||F.spotLength!==_||F.rectAreaLength!==E||F.hemiLength!==A||F.numDirectionalShadows!==w||F.numPointShadows!==C||F.numSpotShadows!==I||F.numSpotMaps!==B)&&(s.directional.length=b,s.spot.length=_,s.rectArea.length=E,s.point.length=x,s.hemi.length=A,s.directionalShadow.length=w,s.directionalShadowMap.length=w,s.pointShadow.length=C,s.pointShadowMap.length=C,s.spotShadow.length=I,s.spotShadowMap.length=I,s.directionalShadowMatrix.length=w,s.pointShadowMatrix.length=C,s.spotLightMatrix.length=I+B-X,s.spotLightMap.length=B,s.numSpotLightShadowsWithMaps=X,F.directionalLength=b,F.pointLength=x,F.spotLength=_,F.rectAreaLength=E,F.hemiLength=A,F.numDirectionalShadows=w,F.numPointShadows=C,F.numSpotShadows=I,F.numSpotMaps=B,s.version=g1++)}function u(h,d){let m=0,y=0,v=0,b=0,x=0;const _=d.matrixWorldInverse;for(let E=0,A=h.length;E<A;E++){const w=h[E];if(w.isDirectionalLight){const C=s.directional[m];C.direction.setFromMatrixPosition(w.matrixWorld),r.setFromMatrixPosition(w.target.matrixWorld),C.direction.sub(r),C.direction.transformDirection(_),m++}else if(w.isSpotLight){const C=s.spot[v];C.position.setFromMatrixPosition(w.matrixWorld),C.position.applyMatrix4(_),C.direction.setFromMatrixPosition(w.matrixWorld),r.setFromMatrixPosition(w.target.matrixWorld),C.direction.sub(r),C.direction.transformDirection(_),v++}else if(w.isRectAreaLight){const C=s.rectArea[b];C.position.setFromMatrixPosition(w.matrixWorld),C.position.applyMatrix4(_),o.identity(),a.copy(w.matrixWorld),a.premultiply(_),o.extractRotation(a),C.halfWidth.set(w.width*.5,0,0),C.halfHeight.set(0,w.height*.5,0),C.halfWidth.applyMatrix4(o),C.halfHeight.applyMatrix4(o),b++}else if(w.isPointLight){const C=s.point[y];C.position.setFromMatrixPosition(w.matrixWorld),C.position.applyMatrix4(_),y++}else if(w.isHemisphereLight){const C=s.hemi[x];C.direction.setFromMatrixPosition(w.matrixWorld),C.direction.transformDirection(_),x++}}}return{setup:l,setupView:u,state:s}}function wp(i,e){const t=new v1(i,e),n=[],s=[];function r(){n.length=0,s.length=0}function a(d){n.push(d)}function o(d){s.push(d)}function l(d){t.setup(n,d)}function u(d){t.setupView(n,d)}return{init:r,state:{lightsArray:n,shadowsArray:s,lights:t},setupLights:l,setupLightsView:u,pushLight:a,pushShadow:o}}function y1(i,e){let t=new WeakMap;function n(r,a=0){const o=t.get(r);let l;return o===void 0?(l=new wp(i,e),t.set(r,[l])):a>=o.length?(l=new wp(i,e),o.push(l)):l=o[a],l}function s(){t=new WeakMap}return{get:n,dispose:s}}class T1 extends Xl{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=fx,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class x1 extends Xl{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const S1=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,b1=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function E1(i,e,t){let n=new Eg;const s=new Tt,r=new Tt,a=new Qt,o=new T1({depthPacking:px}),l=new x1,u={},h=t.maxTextureSize,d={[cs]:Si,[Si]:cs,[Vn]:Vn},m=new Ws({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Tt},radius:{value:4}},vertexShader:S1,fragmentShader:b1}),y=m.clone();y.defines.HORIZONTAL_PASS=1;const v=new fs;v.setAttribute("position",new yn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new Wn(v,m),x=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=sg;let _=this.type;this.render=function(C,I,B){if(x.enabled===!1||x.autoUpdate===!1&&x.needsUpdate===!1||C.length===0)return;const X=i.getRenderTarget(),M=i.getActiveCubeFace(),F=i.getActiveMipmapLevel(),Q=i.state;Q.setBlending(us),Q.buffers.color.setClear(1,1,1,1),Q.buffers.depth.setTest(!0),Q.setScissorTest(!1);const oe=_!==Hn&&this.type===Hn,H=_===Hn&&this.type!==Hn;for(let $=0,Z=C.length;$<Z;$++){const le=C[$],ie=le.shadow;if(ie===void 0){console.warn("THREE.WebGLShadowMap:",le,"has no shadow.");continue}if(ie.autoUpdate===!1&&ie.needsUpdate===!1)continue;s.copy(ie.mapSize);const ue=ie.getFrameExtents();if(s.multiply(ue),r.copy(ie.mapSize),(s.x>h||s.y>h)&&(s.x>h&&(r.x=Math.floor(h/ue.x),s.x=r.x*ue.x,ie.mapSize.x=r.x),s.y>h&&(r.y=Math.floor(h/ue.y),s.y=r.y*ue.y,ie.mapSize.y=r.y)),ie.map===null||oe===!0||H===!0){const fe=this.type!==Hn?{minFilter:ui,magFilter:ui}:{};ie.map!==null&&ie.map.dispose(),ie.map=new Gs(s.x,s.y,fe),ie.map.texture.name=le.name+".shadowMap",ie.camera.updateProjectionMatrix()}i.setRenderTarget(ie.map),i.clear();const de=ie.getViewportCount();for(let fe=0;fe<de;fe++){const Pe=ie.getViewport(fe);a.set(r.x*Pe.x,r.y*Pe.y,r.x*Pe.z,r.y*Pe.w),Q.viewport(a),ie.updateMatrices(le,fe),n=ie.getFrustum(),w(I,B,ie.camera,le,this.type)}ie.isPointLightShadow!==!0&&this.type===Hn&&E(ie,B),ie.needsUpdate=!1}_=this.type,x.needsUpdate=!1,i.setRenderTarget(X,M,F)};function E(C,I){const B=e.update(b);m.defines.VSM_SAMPLES!==C.blurSamples&&(m.defines.VSM_SAMPLES=C.blurSamples,y.defines.VSM_SAMPLES=C.blurSamples,m.needsUpdate=!0,y.needsUpdate=!0),C.mapPass===null&&(C.mapPass=new Gs(s.x,s.y)),m.uniforms.shadow_pass.value=C.map.texture,m.uniforms.resolution.value=C.mapSize,m.uniforms.radius.value=C.radius,i.setRenderTarget(C.mapPass),i.clear(),i.renderBufferDirect(I,null,B,m,b,null),y.uniforms.shadow_pass.value=C.mapPass.texture,y.uniforms.resolution.value=C.mapSize,y.uniforms.radius.value=C.radius,i.setRenderTarget(C.map),i.clear(),i.renderBufferDirect(I,null,B,y,b,null)}function A(C,I,B,X){let M=null;const F=B.isPointLight===!0?C.customDistanceMaterial:C.customDepthMaterial;if(F!==void 0)M=F;else if(M=B.isPointLight===!0?l:o,i.localClippingEnabled&&I.clipShadows===!0&&Array.isArray(I.clippingPlanes)&&I.clippingPlanes.length!==0||I.displacementMap&&I.displacementScale!==0||I.alphaMap&&I.alphaTest>0||I.map&&I.alphaTest>0){const Q=M.uuid,oe=I.uuid;let H=u[Q];H===void 0&&(H={},u[Q]=H);let $=H[oe];$===void 0&&($=M.clone(),H[oe]=$),M=$}if(M.visible=I.visible,M.wireframe=I.wireframe,X===Hn?M.side=I.shadowSide!==null?I.shadowSide:I.side:M.side=I.shadowSide!==null?I.shadowSide:d[I.side],M.alphaMap=I.alphaMap,M.alphaTest=I.alphaTest,M.map=I.map,M.clipShadows=I.clipShadows,M.clippingPlanes=I.clippingPlanes,M.clipIntersection=I.clipIntersection,M.displacementMap=I.displacementMap,M.displacementScale=I.displacementScale,M.displacementBias=I.displacementBias,M.wireframeLinewidth=I.wireframeLinewidth,M.linewidth=I.linewidth,B.isPointLight===!0&&M.isMeshDistanceMaterial===!0){const Q=i.properties.get(M);Q.light=B}return M}function w(C,I,B,X,M){if(C.visible===!1)return;if(C.layers.test(I.layers)&&(C.isMesh||C.isLine||C.isPoints)&&(C.castShadow||C.receiveShadow&&M===Hn)&&(!C.frustumCulled||n.intersectsObject(C))){C.modelViewMatrix.multiplyMatrices(B.matrixWorldInverse,C.matrixWorld);const oe=e.update(C),H=C.material;if(Array.isArray(H)){const $=oe.groups;for(let Z=0,le=$.length;Z<le;Z++){const ie=$[Z],ue=H[ie.materialIndex];if(ue&&ue.visible){const de=A(C,ue,X,M);i.renderBufferDirect(B,null,oe,de,C,ie)}}}else if(H.visible){const $=A(C,H,X,M);i.renderBufferDirect(B,null,oe,$,C,null)}}const Q=C.children;for(let oe=0,H=Q.length;oe<H;oe++)w(Q[oe],I,B,X,M)}}function A1(i,e,t){const n=t.isWebGL2;function s(){let V=!1;const ne=new Qt;let me=null;const we=new Qt(0,0,0,0);return{setMask:function(Oe){me!==Oe&&!V&&(i.colorMask(Oe,Oe,Oe,Oe),me=Oe)},setLocked:function(Oe){V=Oe},setClear:function(Oe,dt,ft,Vt,on){on===!0&&(Oe*=Vt,dt*=Vt,ft*=Vt),ne.set(Oe,dt,ft,Vt),we.equals(ne)===!1&&(i.clearColor(Oe,dt,ft,Vt),we.copy(ne))},reset:function(){V=!1,me=null,we.set(-1,0,0,0)}}}function r(){let V=!1,ne=null,me=null,we=null;return{setTest:function(Oe){Oe?G(i.DEPTH_TEST):Ke(i.DEPTH_TEST)},setMask:function(Oe){ne!==Oe&&!V&&(i.depthMask(Oe),ne=Oe)},setFunc:function(Oe){if(me!==Oe){switch(Oe){case kT:i.depthFunc(i.NEVER);break;case FT:i.depthFunc(i.ALWAYS);break;case BT:i.depthFunc(i.LESS);break;case Lc:i.depthFunc(i.LEQUAL);break;case HT:i.depthFunc(i.EQUAL);break;case VT:i.depthFunc(i.GEQUAL);break;case zT:i.depthFunc(i.GREATER);break;case GT:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}me=Oe}},setLocked:function(Oe){V=Oe},setClear:function(Oe){we!==Oe&&(i.clearDepth(Oe),we=Oe)},reset:function(){V=!1,ne=null,me=null,we=null}}}function a(){let V=!1,ne=null,me=null,we=null,Oe=null,dt=null,ft=null,Vt=null,on=null;return{setTest:function(At){V||(At?G(i.STENCIL_TEST):Ke(i.STENCIL_TEST))},setMask:function(At){ne!==At&&!V&&(i.stencilMask(At),ne=At)},setFunc:function(At,mi,ki){(me!==At||we!==mi||Oe!==ki)&&(i.stencilFunc(At,mi,ki),me=At,we=mi,Oe=ki)},setOp:function(At,mi,ki){(dt!==At||ft!==mi||Vt!==ki)&&(i.stencilOp(At,mi,ki),dt=At,ft=mi,Vt=ki)},setLocked:function(At){V=At},setClear:function(At){on!==At&&(i.clearStencil(At),on=At)},reset:function(){V=!1,ne=null,me=null,we=null,Oe=null,dt=null,ft=null,Vt=null,on=null}}}const o=new s,l=new r,u=new a,h=new WeakMap,d=new WeakMap;let m={},y={},v=new WeakMap,b=[],x=null,_=!1,E=null,A=null,w=null,C=null,I=null,B=null,X=null,M=!1,F=null,Q=null,oe=null,H=null,$=null;const Z=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let le=!1,ie=0;const ue=i.getParameter(i.VERSION);ue.indexOf("WebGL")!==-1?(ie=parseFloat(/^WebGL (\d)/.exec(ue)[1]),le=ie>=1):ue.indexOf("OpenGL ES")!==-1&&(ie=parseFloat(/^OpenGL ES (\d)/.exec(ue)[1]),le=ie>=2);let de=null,fe={};const Pe=i.getParameter(i.SCISSOR_BOX),Ae=i.getParameter(i.VIEWPORT),ee=new Qt().fromArray(Pe),he=new Qt().fromArray(Ae);function Te(V,ne,me,we){const Oe=new Uint8Array(4),dt=i.createTexture();i.bindTexture(V,dt),i.texParameteri(V,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(V,i.TEXTURE_MAG_FILTER,i.NEAREST);for(let ft=0;ft<me;ft++)n&&(V===i.TEXTURE_3D||V===i.TEXTURE_2D_ARRAY)?i.texImage3D(ne,0,i.RGBA,1,1,we,0,i.RGBA,i.UNSIGNED_BYTE,Oe):i.texImage2D(ne+ft,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,Oe);return dt}const Ce={};Ce[i.TEXTURE_2D]=Te(i.TEXTURE_2D,i.TEXTURE_2D,1),Ce[i.TEXTURE_CUBE_MAP]=Te(i.TEXTURE_CUBE_MAP,i.TEXTURE_CUBE_MAP_POSITIVE_X,6),n&&(Ce[i.TEXTURE_2D_ARRAY]=Te(i.TEXTURE_2D_ARRAY,i.TEXTURE_2D_ARRAY,1,1),Ce[i.TEXTURE_3D]=Te(i.TEXTURE_3D,i.TEXTURE_3D,1,1)),o.setClear(0,0,0,1),l.setClear(1),u.setClear(0),G(i.DEPTH_TEST),l.setFunc(Lc),Ht(!1),Ut(df),G(i.CULL_FACE),it(us);function G(V){m[V]!==!0&&(i.enable(V),m[V]=!0)}function Ke(V){m[V]!==!1&&(i.disable(V),m[V]=!1)}function $e(V,ne){return y[V]!==ne?(i.bindFramebuffer(V,ne),y[V]=ne,n&&(V===i.DRAW_FRAMEBUFFER&&(y[i.FRAMEBUFFER]=ne),V===i.FRAMEBUFFER&&(y[i.DRAW_FRAMEBUFFER]=ne)),!0):!1}function xe(V,ne){let me=b,we=!1;if(V)if(me=v.get(ne),me===void 0&&(me=[],v.set(ne,me)),V.isWebGLMultipleRenderTargets){const Oe=V.texture;if(me.length!==Oe.length||me[0]!==i.COLOR_ATTACHMENT0){for(let dt=0,ft=Oe.length;dt<ft;dt++)me[dt]=i.COLOR_ATTACHMENT0+dt;me.length=Oe.length,we=!0}}else me[0]!==i.COLOR_ATTACHMENT0&&(me[0]=i.COLOR_ATTACHMENT0,we=!0);else me[0]!==i.BACK&&(me[0]=i.BACK,we=!0);we&&(t.isWebGL2?i.drawBuffers(me):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(me))}function Ge(V){return x!==V?(i.useProgram(V),x=V,!0):!1}const lt={[Sr]:i.FUNC_ADD,[CT]:i.FUNC_SUBTRACT,[MT]:i.FUNC_REVERSE_SUBTRACT};if(n)lt[gf]=i.MIN,lt[_f]=i.MAX;else{const V=e.get("EXT_blend_minmax");V!==null&&(lt[gf]=V.MIN_EXT,lt[_f]=V.MAX_EXT)}const Ne={[wT]:i.ZERO,[DT]:i.ONE,[RT]:i.SRC_COLOR,[rg]:i.SRC_ALPHA,[NT]:i.SRC_ALPHA_SATURATE,[OT]:i.DST_COLOR,[LT]:i.DST_ALPHA,[PT]:i.ONE_MINUS_SRC_COLOR,[ag]:i.ONE_MINUS_SRC_ALPHA,[UT]:i.ONE_MINUS_DST_COLOR,[IT]:i.ONE_MINUS_DST_ALPHA};function it(V,ne,me,we,Oe,dt,ft,Vt){if(V===us){_===!0&&(Ke(i.BLEND),_=!1);return}if(_===!1&&(G(i.BLEND),_=!0),V!==AT){if(V!==E||Vt!==M){if((A!==Sr||I!==Sr)&&(i.blendEquation(i.FUNC_ADD),A=Sr,I=Sr),Vt)switch(V){case wr:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case ff:i.blendFunc(i.ONE,i.ONE);break;case pf:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case mf:i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",V);break}else switch(V){case wr:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case ff:i.blendFunc(i.SRC_ALPHA,i.ONE);break;case pf:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case mf:i.blendFunc(i.ZERO,i.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",V);break}w=null,C=null,B=null,X=null,E=V,M=Vt}return}Oe=Oe||ne,dt=dt||me,ft=ft||we,(ne!==A||Oe!==I)&&(i.blendEquationSeparate(lt[ne],lt[Oe]),A=ne,I=Oe),(me!==w||we!==C||dt!==B||ft!==X)&&(i.blendFuncSeparate(Ne[me],Ne[we],Ne[dt],Ne[ft]),w=me,C=we,B=dt,X=ft),E=V,M=!1}function Ot(V,ne){V.side===Vn?Ke(i.CULL_FACE):G(i.CULL_FACE);let me=V.side===Si;ne&&(me=!me),Ht(me),V.blending===wr&&V.transparent===!1?it(us):it(V.blending,V.blendEquation,V.blendSrc,V.blendDst,V.blendEquationAlpha,V.blendSrcAlpha,V.blendDstAlpha,V.premultipliedAlpha),l.setFunc(V.depthFunc),l.setTest(V.depthTest),l.setMask(V.depthWrite),o.setMask(V.colorWrite);const we=V.stencilWrite;u.setTest(we),we&&(u.setMask(V.stencilWriteMask),u.setFunc(V.stencilFunc,V.stencilRef,V.stencilFuncMask),u.setOp(V.stencilFail,V.stencilZFail,V.stencilZPass)),ot(V.polygonOffset,V.polygonOffsetFactor,V.polygonOffsetUnits),V.alphaToCoverage===!0?G(i.SAMPLE_ALPHA_TO_COVERAGE):Ke(i.SAMPLE_ALPHA_TO_COVERAGE)}function Ht(V){F!==V&&(V?i.frontFace(i.CW):i.frontFace(i.CCW),F=V)}function Ut(V){V!==ST?(G(i.CULL_FACE),V!==Q&&(V===df?i.cullFace(i.BACK):V===bT?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):Ke(i.CULL_FACE),Q=V}function gt(V){V!==oe&&(le&&i.lineWidth(V),oe=V)}function ot(V,ne,me){V?(G(i.POLYGON_OFFSET_FILL),(H!==ne||$!==me)&&(i.polygonOffset(ne,me),H=ne,$=me)):Ke(i.POLYGON_OFFSET_FILL)}function Fe(V){V?G(i.SCISSOR_TEST):Ke(i.SCISSOR_TEST)}function Jt(V){V===void 0&&(V=i.TEXTURE0+Z-1),de!==V&&(i.activeTexture(V),de=V)}function U(V,ne,me){me===void 0&&(de===null?me=i.TEXTURE0+Z-1:me=de);let we=fe[me];we===void 0&&(we={type:void 0,texture:void 0},fe[me]=we),(we.type!==V||we.texture!==ne)&&(de!==me&&(i.activeTexture(me),de=me),i.bindTexture(V,ne||Ce[V]),we.type=V,we.texture=ne)}function R(){const V=fe[de];V!==void 0&&V.type!==void 0&&(i.bindTexture(V.type,null),V.type=void 0,V.texture=void 0)}function J(){try{i.compressedTexImage2D.apply(i,arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function pe(){try{i.compressedTexImage3D.apply(i,arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function ge(){try{i.texSubImage2D.apply(i,arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function be(){try{i.texSubImage3D.apply(i,arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function ze(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function Re(){try{i.compressedTexSubImage3D.apply(i,arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function ae(){try{i.texStorage2D.apply(i,arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function Ie(){try{i.texStorage3D.apply(i,arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function ye(){try{i.texImage2D.apply(i,arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function He(){try{i.texImage3D.apply(i,arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function De(V){ee.equals(V)===!1&&(i.scissor(V.x,V.y,V.z,V.w),ee.copy(V))}function Ue(V){he.equals(V)===!1&&(i.viewport(V.x,V.y,V.z,V.w),he.copy(V))}function st(V,ne){let me=d.get(ne);me===void 0&&(me=new WeakMap,d.set(ne,me));let we=me.get(V);we===void 0&&(we=i.getUniformBlockIndex(ne,V.name),me.set(V,we))}function ct(V,ne){const we=d.get(ne).get(V);h.get(ne)!==we&&(i.uniformBlockBinding(ne,we,V.__bindingPointIndex),h.set(ne,we))}function Et(){i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.POLYGON_OFFSET_FILL),i.disable(i.SCISSOR_TEST),i.disable(i.STENCIL_TEST),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(i.LESS),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.clearStencil(0),i.cullFace(i.BACK),i.frontFace(i.CCW),i.polygonOffset(0,0),i.activeTexture(i.TEXTURE0),i.bindFramebuffer(i.FRAMEBUFFER,null),n===!0&&(i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null)),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),m={},de=null,fe={},y={},v=new WeakMap,b=[],x=null,_=!1,E=null,A=null,w=null,C=null,I=null,B=null,X=null,M=!1,F=null,Q=null,oe=null,H=null,$=null,ee.set(0,0,i.canvas.width,i.canvas.height),he.set(0,0,i.canvas.width,i.canvas.height),o.reset(),l.reset(),u.reset()}return{buffers:{color:o,depth:l,stencil:u},enable:G,disable:Ke,bindFramebuffer:$e,drawBuffers:xe,useProgram:Ge,setBlending:it,setMaterial:Ot,setFlipSided:Ht,setCullFace:Ut,setLineWidth:gt,setPolygonOffset:ot,setScissorTest:Fe,activeTexture:Jt,bindTexture:U,unbindTexture:R,compressedTexImage2D:J,compressedTexImage3D:pe,texImage2D:ye,texImage3D:He,updateUBOMapping:st,uniformBlockBinding:ct,texStorage2D:ae,texStorage3D:Ie,texSubImage2D:ge,texSubImage3D:be,compressedTexSubImage2D:ze,compressedTexSubImage3D:Re,scissor:De,viewport:Ue,reset:Et}}function C1(i,e,t,n,s,r,a){const o=s.isWebGL2,l=s.maxTextures,u=s.maxCubemapSize,h=s.maxTextureSize,d=s.maxSamples,m=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,y=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),v=new WeakMap;let b;const x=new WeakMap;let _=!1;try{_=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function E(U,R){return _?new OffscreenCanvas(U,R):Tl("canvas")}function A(U,R,J,pe){let ge=1;if((U.width>pe||U.height>pe)&&(ge=pe/Math.max(U.width,U.height)),ge<1||R===!0)if(typeof HTMLImageElement<"u"&&U instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&U instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&U instanceof ImageBitmap){const be=R?dg:Math.floor,ze=be(ge*U.width),Re=be(ge*U.height);b===void 0&&(b=E(ze,Re));const ae=J?E(ze,Re):b;return ae.width=ze,ae.height=Re,ae.getContext("2d").drawImage(U,0,0,ze,Re),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+U.width+"x"+U.height+") to ("+ze+"x"+Re+")."),ae}else return"data"in U&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+U.width+"x"+U.height+")."),U;return U}function w(U){return Fc(U.width)&&Fc(U.height)}function C(U){return o?!1:U.wrapS!==en||U.wrapT!==en||U.minFilter!==ui&&U.minFilter!==vi}function I(U,R){return U.generateMipmaps&&R&&U.minFilter!==ui&&U.minFilter!==vi}function B(U){i.generateMipmap(U)}function X(U,R,J,pe,ge=!1){if(o===!1)return R;if(U!==null){if(i[U]!==void 0)return i[U];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+U+"'")}let be=R;return R===i.RED&&(J===i.FLOAT&&(be=i.R32F),J===i.HALF_FLOAT&&(be=i.R16F),J===i.UNSIGNED_BYTE&&(be=i.R8)),R===i.RG&&(J===i.FLOAT&&(be=i.RG32F),J===i.HALF_FLOAT&&(be=i.RG16F),J===i.UNSIGNED_BYTE&&(be=i.RG8)),R===i.RGBA&&(J===i.FLOAT&&(be=i.RGBA32F),J===i.HALF_FLOAT&&(be=i.RGBA16F),J===i.UNSIGNED_BYTE&&(be=pe===Ze&&ge===!1?i.SRGB8_ALPHA8:i.RGBA8),J===i.UNSIGNED_SHORT_4_4_4_4&&(be=i.RGBA4),J===i.UNSIGNED_SHORT_5_5_5_1&&(be=i.RGB5_A1)),(be===i.R16F||be===i.R32F||be===i.RG16F||be===i.RG32F||be===i.RGBA16F||be===i.RGBA32F)&&e.get("EXT_color_buffer_float"),be}function M(U,R,J){return I(U,J)===!0||U.isFramebufferTexture&&U.minFilter!==ui&&U.minFilter!==vi?Math.log2(Math.max(R.width,R.height))+1:U.mipmaps!==void 0&&U.mipmaps.length>0?U.mipmaps.length:U.isCompressedTexture&&Array.isArray(U.image)?R.mipmaps.length:1}function F(U){return U===ui||U===vf||U===Uu?i.NEAREST:i.LINEAR}function Q(U){const R=U.target;R.removeEventListener("dispose",Q),H(R),R.isVideoTexture&&v.delete(R)}function oe(U){const R=U.target;R.removeEventListener("dispose",oe),Z(R)}function H(U){const R=n.get(U);if(R.__webglInit===void 0)return;const J=U.source,pe=x.get(J);if(pe){const ge=pe[R.__cacheKey];ge.usedTimes--,ge.usedTimes===0&&$(U),Object.keys(pe).length===0&&x.delete(J)}n.remove(U)}function $(U){const R=n.get(U);i.deleteTexture(R.__webglTexture);const J=U.source,pe=x.get(J);delete pe[R.__cacheKey],a.memory.textures--}function Z(U){const R=U.texture,J=n.get(U),pe=n.get(R);if(pe.__webglTexture!==void 0&&(i.deleteTexture(pe.__webglTexture),a.memory.textures--),U.depthTexture&&U.depthTexture.dispose(),U.isWebGLCubeRenderTarget)for(let ge=0;ge<6;ge++)i.deleteFramebuffer(J.__webglFramebuffer[ge]),J.__webglDepthbuffer&&i.deleteRenderbuffer(J.__webglDepthbuffer[ge]);else{if(i.deleteFramebuffer(J.__webglFramebuffer),J.__webglDepthbuffer&&i.deleteRenderbuffer(J.__webglDepthbuffer),J.__webglMultisampledFramebuffer&&i.deleteFramebuffer(J.__webglMultisampledFramebuffer),J.__webglColorRenderbuffer)for(let ge=0;ge<J.__webglColorRenderbuffer.length;ge++)J.__webglColorRenderbuffer[ge]&&i.deleteRenderbuffer(J.__webglColorRenderbuffer[ge]);J.__webglDepthRenderbuffer&&i.deleteRenderbuffer(J.__webglDepthRenderbuffer)}if(U.isWebGLMultipleRenderTargets)for(let ge=0,be=R.length;ge<be;ge++){const ze=n.get(R[ge]);ze.__webglTexture&&(i.deleteTexture(ze.__webglTexture),a.memory.textures--),n.remove(R[ge])}n.remove(R),n.remove(U)}let le=0;function ie(){le=0}function ue(){const U=le;return U>=l&&console.warn("THREE.WebGLTextures: Trying to use "+U+" texture units while this GPU supports only "+l),le+=1,U}function de(U){const R=[];return R.push(U.wrapS),R.push(U.wrapT),R.push(U.wrapR||0),R.push(U.magFilter),R.push(U.minFilter),R.push(U.anisotropy),R.push(U.internalFormat),R.push(U.format),R.push(U.type),R.push(U.generateMipmaps),R.push(U.premultiplyAlpha),R.push(U.flipY),R.push(U.unpackAlignment),R.push(U.colorSpace),R.join()}function fe(U,R){const J=n.get(U);if(U.isVideoTexture&&Fe(U),U.isRenderTargetTexture===!1&&U.version>0&&J.__version!==U.version){const pe=U.image;if(pe===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(pe.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Ke(J,U,R);return}}t.bindTexture(i.TEXTURE_2D,J.__webglTexture,i.TEXTURE0+R)}function Pe(U,R){const J=n.get(U);if(U.version>0&&J.__version!==U.version){Ke(J,U,R);return}t.bindTexture(i.TEXTURE_2D_ARRAY,J.__webglTexture,i.TEXTURE0+R)}function Ae(U,R){const J=n.get(U);if(U.version>0&&J.__version!==U.version){Ke(J,U,R);return}t.bindTexture(i.TEXTURE_3D,J.__webglTexture,i.TEXTURE0+R)}function ee(U,R){const J=n.get(U);if(U.version>0&&J.__version!==U.version){$e(J,U,R);return}t.bindTexture(i.TEXTURE_CUBE_MAP,J.__webglTexture,i.TEXTURE0+R)}const he={[Uc]:i.REPEAT,[en]:i.CLAMP_TO_EDGE,[Nc]:i.MIRRORED_REPEAT},Te={[ui]:i.NEAREST,[vf]:i.NEAREST_MIPMAP_NEAREST,[Uu]:i.NEAREST_MIPMAP_LINEAR,[vi]:i.LINEAR,[QT]:i.LINEAR_MIPMAP_NEAREST,[Qa]:i.LINEAR_MIPMAP_LINEAR};function Ce(U,R,J){if(J?(i.texParameteri(U,i.TEXTURE_WRAP_S,he[R.wrapS]),i.texParameteri(U,i.TEXTURE_WRAP_T,he[R.wrapT]),(U===i.TEXTURE_3D||U===i.TEXTURE_2D_ARRAY)&&i.texParameteri(U,i.TEXTURE_WRAP_R,he[R.wrapR]),i.texParameteri(U,i.TEXTURE_MAG_FILTER,Te[R.magFilter]),i.texParameteri(U,i.TEXTURE_MIN_FILTER,Te[R.minFilter])):(i.texParameteri(U,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(U,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),(U===i.TEXTURE_3D||U===i.TEXTURE_2D_ARRAY)&&i.texParameteri(U,i.TEXTURE_WRAP_R,i.CLAMP_TO_EDGE),(R.wrapS!==en||R.wrapT!==en)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(U,i.TEXTURE_MAG_FILTER,F(R.magFilter)),i.texParameteri(U,i.TEXTURE_MIN_FILTER,F(R.minFilter)),R.minFilter!==ui&&R.minFilter!==vi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const pe=e.get("EXT_texture_filter_anisotropic");if(R.magFilter===ui||R.minFilter!==Uu&&R.minFilter!==Qa||R.type===Is&&e.has("OES_texture_float_linear")===!1||o===!1&&R.type===Za&&e.has("OES_texture_half_float_linear")===!1)return;(R.anisotropy>1||n.get(R).__currentAnisotropy)&&(i.texParameterf(U,pe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(R.anisotropy,s.getMaxAnisotropy())),n.get(R).__currentAnisotropy=R.anisotropy)}}function G(U,R){let J=!1;U.__webglInit===void 0&&(U.__webglInit=!0,R.addEventListener("dispose",Q));const pe=R.source;let ge=x.get(pe);ge===void 0&&(ge={},x.set(pe,ge));const be=de(R);if(be!==U.__cacheKey){ge[be]===void 0&&(ge[be]={texture:i.createTexture(),usedTimes:0},a.memory.textures++,J=!0),ge[be].usedTimes++;const ze=ge[U.__cacheKey];ze!==void 0&&(ge[U.__cacheKey].usedTimes--,ze.usedTimes===0&&$(R)),U.__cacheKey=be,U.__webglTexture=ge[be].texture}return J}function Ke(U,R,J){let pe=i.TEXTURE_2D;(R.isDataArrayTexture||R.isCompressedArrayTexture)&&(pe=i.TEXTURE_2D_ARRAY),R.isData3DTexture&&(pe=i.TEXTURE_3D);const ge=G(U,R),be=R.source;t.bindTexture(pe,U.__webglTexture,i.TEXTURE0+J);const ze=n.get(be);if(be.version!==ze.__version||ge===!0){t.activeTexture(i.TEXTURE0+J),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,R.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,R.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,R.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE);const Re=C(R)&&w(R.image)===!1;let ae=A(R.image,Re,!1,h);ae=Jt(R,ae);const Ie=w(ae)||o,ye=r.convert(R.format,R.colorSpace);let He=r.convert(R.type),De=X(R.internalFormat,ye,He,R.colorSpace);Ce(pe,R,Ie);let Ue;const st=R.mipmaps,ct=o&&R.isVideoTexture!==!0,Et=ze.__version===void 0||ge===!0,V=M(R,ae,Ie);if(R.isDepthTexture)De=i.DEPTH_COMPONENT,o?R.type===Is?De=i.DEPTH_COMPONENT32F:R.type===Ls?De=i.DEPTH_COMPONENT24:R.type===Dr?De=i.DEPTH24_STENCIL8:De=i.DEPTH_COMPONENT16:R.type===Is&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),R.format===Ns&&De===i.DEPTH_COMPONENT&&R.type!==ug&&R.type!==Ls&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),R.type=Ls,He=r.convert(R.type)),R.format===Hr&&De===i.DEPTH_COMPONENT&&(De=i.DEPTH_STENCIL,R.type!==Dr&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),R.type=Dr,He=r.convert(R.type))),Et&&(ct?t.texStorage2D(i.TEXTURE_2D,1,De,ae.width,ae.height):t.texImage2D(i.TEXTURE_2D,0,De,ae.width,ae.height,0,ye,He,null));else if(R.isDataTexture)if(st.length>0&&Ie){ct&&Et&&t.texStorage2D(i.TEXTURE_2D,V,De,st[0].width,st[0].height);for(let ne=0,me=st.length;ne<me;ne++)Ue=st[ne],ct?t.texSubImage2D(i.TEXTURE_2D,ne,0,0,Ue.width,Ue.height,ye,He,Ue.data):t.texImage2D(i.TEXTURE_2D,ne,De,Ue.width,Ue.height,0,ye,He,Ue.data);R.generateMipmaps=!1}else ct?(Et&&t.texStorage2D(i.TEXTURE_2D,V,De,ae.width,ae.height),t.texSubImage2D(i.TEXTURE_2D,0,0,0,ae.width,ae.height,ye,He,ae.data)):t.texImage2D(i.TEXTURE_2D,0,De,ae.width,ae.height,0,ye,He,ae.data);else if(R.isCompressedTexture)if(R.isCompressedArrayTexture){ct&&Et&&t.texStorage3D(i.TEXTURE_2D_ARRAY,V,De,st[0].width,st[0].height,ae.depth);for(let ne=0,me=st.length;ne<me;ne++)Ue=st[ne],R.format!==tn?ye!==null?ct?t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,ne,0,0,0,Ue.width,Ue.height,ae.depth,ye,Ue.data,0,0):t.compressedTexImage3D(i.TEXTURE_2D_ARRAY,ne,De,Ue.width,Ue.height,ae.depth,0,Ue.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ct?t.texSubImage3D(i.TEXTURE_2D_ARRAY,ne,0,0,0,Ue.width,Ue.height,ae.depth,ye,He,Ue.data):t.texImage3D(i.TEXTURE_2D_ARRAY,ne,De,Ue.width,Ue.height,ae.depth,0,ye,He,Ue.data)}else{ct&&Et&&t.texStorage2D(i.TEXTURE_2D,V,De,st[0].width,st[0].height);for(let ne=0,me=st.length;ne<me;ne++)Ue=st[ne],R.format!==tn?ye!==null?ct?t.compressedTexSubImage2D(i.TEXTURE_2D,ne,0,0,Ue.width,Ue.height,ye,Ue.data):t.compressedTexImage2D(i.TEXTURE_2D,ne,De,Ue.width,Ue.height,0,Ue.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ct?t.texSubImage2D(i.TEXTURE_2D,ne,0,0,Ue.width,Ue.height,ye,He,Ue.data):t.texImage2D(i.TEXTURE_2D,ne,De,Ue.width,Ue.height,0,ye,He,Ue.data)}else if(R.isDataArrayTexture)ct?(Et&&t.texStorage3D(i.TEXTURE_2D_ARRAY,V,De,ae.width,ae.height,ae.depth),t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,ae.width,ae.height,ae.depth,ye,He,ae.data)):t.texImage3D(i.TEXTURE_2D_ARRAY,0,De,ae.width,ae.height,ae.depth,0,ye,He,ae.data);else if(R.isData3DTexture)ct?(Et&&t.texStorage3D(i.TEXTURE_3D,V,De,ae.width,ae.height,ae.depth),t.texSubImage3D(i.TEXTURE_3D,0,0,0,0,ae.width,ae.height,ae.depth,ye,He,ae.data)):t.texImage3D(i.TEXTURE_3D,0,De,ae.width,ae.height,ae.depth,0,ye,He,ae.data);else if(R.isFramebufferTexture){if(Et)if(ct)t.texStorage2D(i.TEXTURE_2D,V,De,ae.width,ae.height);else{let ne=ae.width,me=ae.height;for(let we=0;we<V;we++)t.texImage2D(i.TEXTURE_2D,we,De,ne,me,0,ye,He,null),ne>>=1,me>>=1}}else if(st.length>0&&Ie){ct&&Et&&t.texStorage2D(i.TEXTURE_2D,V,De,st[0].width,st[0].height);for(let ne=0,me=st.length;ne<me;ne++)Ue=st[ne],ct?t.texSubImage2D(i.TEXTURE_2D,ne,0,0,ye,He,Ue):t.texImage2D(i.TEXTURE_2D,ne,De,ye,He,Ue);R.generateMipmaps=!1}else ct?(Et&&t.texStorage2D(i.TEXTURE_2D,V,De,ae.width,ae.height),t.texSubImage2D(i.TEXTURE_2D,0,0,0,ye,He,ae)):t.texImage2D(i.TEXTURE_2D,0,De,ye,He,ae);I(R,Ie)&&B(pe),ze.__version=be.version,R.onUpdate&&R.onUpdate(R)}U.__version=R.version}function $e(U,R,J){if(R.image.length!==6)return;const pe=G(U,R),ge=R.source;t.bindTexture(i.TEXTURE_CUBE_MAP,U.__webglTexture,i.TEXTURE0+J);const be=n.get(ge);if(ge.version!==be.__version||pe===!0){t.activeTexture(i.TEXTURE0+J),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,R.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,R.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,R.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE);const ze=R.isCompressedTexture||R.image[0].isCompressedTexture,Re=R.image[0]&&R.image[0].isDataTexture,ae=[];for(let ne=0;ne<6;ne++)!ze&&!Re?ae[ne]=A(R.image[ne],!1,!0,u):ae[ne]=Re?R.image[ne].image:R.image[ne],ae[ne]=Jt(R,ae[ne]);const Ie=ae[0],ye=w(Ie)||o,He=r.convert(R.format,R.colorSpace),De=r.convert(R.type),Ue=X(R.internalFormat,He,De,R.colorSpace),st=o&&R.isVideoTexture!==!0,ct=be.__version===void 0||pe===!0;let Et=M(R,Ie,ye);Ce(i.TEXTURE_CUBE_MAP,R,ye);let V;if(ze){st&&ct&&t.texStorage2D(i.TEXTURE_CUBE_MAP,Et,Ue,Ie.width,Ie.height);for(let ne=0;ne<6;ne++){V=ae[ne].mipmaps;for(let me=0;me<V.length;me++){const we=V[me];R.format!==tn?He!==null?st?t.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ne,me,0,0,we.width,we.height,He,we.data):t.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ne,me,Ue,we.width,we.height,0,we.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):st?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ne,me,0,0,we.width,we.height,He,De,we.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ne,me,Ue,we.width,we.height,0,He,De,we.data)}}}else{V=R.mipmaps,st&&ct&&(V.length>0&&Et++,t.texStorage2D(i.TEXTURE_CUBE_MAP,Et,Ue,ae[0].width,ae[0].height));for(let ne=0;ne<6;ne++)if(Re){st?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ne,0,0,0,ae[ne].width,ae[ne].height,He,De,ae[ne].data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ne,0,Ue,ae[ne].width,ae[ne].height,0,He,De,ae[ne].data);for(let me=0;me<V.length;me++){const Oe=V[me].image[ne].image;st?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ne,me+1,0,0,Oe.width,Oe.height,He,De,Oe.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ne,me+1,Ue,Oe.width,Oe.height,0,He,De,Oe.data)}}else{st?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ne,0,0,0,He,De,ae[ne]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ne,0,Ue,He,De,ae[ne]);for(let me=0;me<V.length;me++){const we=V[me];st?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ne,me+1,0,0,He,De,we.image[ne]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ne,me+1,Ue,He,De,we.image[ne])}}}I(R,ye)&&B(i.TEXTURE_CUBE_MAP),be.__version=ge.version,R.onUpdate&&R.onUpdate(R)}U.__version=R.version}function xe(U,R,J,pe,ge){const be=r.convert(J.format,J.colorSpace),ze=r.convert(J.type),Re=X(J.internalFormat,be,ze,J.colorSpace);n.get(R).__hasExternalTextures||(ge===i.TEXTURE_3D||ge===i.TEXTURE_2D_ARRAY?t.texImage3D(ge,0,Re,R.width,R.height,R.depth,0,be,ze,null):t.texImage2D(ge,0,Re,R.width,R.height,0,be,ze,null)),t.bindFramebuffer(i.FRAMEBUFFER,U),ot(R)?m.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,pe,ge,n.get(J).__webglTexture,0,gt(R)):(ge===i.TEXTURE_2D||ge>=i.TEXTURE_CUBE_MAP_POSITIVE_X&&ge<=i.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&i.framebufferTexture2D(i.FRAMEBUFFER,pe,ge,n.get(J).__webglTexture,0),t.bindFramebuffer(i.FRAMEBUFFER,null)}function Ge(U,R,J){if(i.bindRenderbuffer(i.RENDERBUFFER,U),R.depthBuffer&&!R.stencilBuffer){let pe=i.DEPTH_COMPONENT16;if(J||ot(R)){const ge=R.depthTexture;ge&&ge.isDepthTexture&&(ge.type===Is?pe=i.DEPTH_COMPONENT32F:ge.type===Ls&&(pe=i.DEPTH_COMPONENT24));const be=gt(R);ot(R)?m.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,be,pe,R.width,R.height):i.renderbufferStorageMultisample(i.RENDERBUFFER,be,pe,R.width,R.height)}else i.renderbufferStorage(i.RENDERBUFFER,pe,R.width,R.height);i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,U)}else if(R.depthBuffer&&R.stencilBuffer){const pe=gt(R);J&&ot(R)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,pe,i.DEPTH24_STENCIL8,R.width,R.height):ot(R)?m.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,pe,i.DEPTH24_STENCIL8,R.width,R.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,R.width,R.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,U)}else{const pe=R.isWebGLMultipleRenderTargets===!0?R.texture:[R.texture];for(let ge=0;ge<pe.length;ge++){const be=pe[ge],ze=r.convert(be.format,be.colorSpace),Re=r.convert(be.type),ae=X(be.internalFormat,ze,Re,be.colorSpace),Ie=gt(R);J&&ot(R)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,Ie,ae,R.width,R.height):ot(R)?m.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,Ie,ae,R.width,R.height):i.renderbufferStorage(i.RENDERBUFFER,ae,R.width,R.height)}}i.bindRenderbuffer(i.RENDERBUFFER,null)}function lt(U,R){if(R&&R.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(i.FRAMEBUFFER,U),!(R.depthTexture&&R.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(R.depthTexture).__webglTexture||R.depthTexture.image.width!==R.width||R.depthTexture.image.height!==R.height)&&(R.depthTexture.image.width=R.width,R.depthTexture.image.height=R.height,R.depthTexture.needsUpdate=!0),fe(R.depthTexture,0);const pe=n.get(R.depthTexture).__webglTexture,ge=gt(R);if(R.depthTexture.format===Ns)ot(R)?m.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,pe,0,ge):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,pe,0);else if(R.depthTexture.format===Hr)ot(R)?m.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,pe,0,ge):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,pe,0);else throw new Error("Unknown depthTexture format")}function Ne(U){const R=n.get(U),J=U.isWebGLCubeRenderTarget===!0;if(U.depthTexture&&!R.__autoAllocateDepthBuffer){if(J)throw new Error("target.depthTexture not supported in Cube render targets");lt(R.__webglFramebuffer,U)}else if(J){R.__webglDepthbuffer=[];for(let pe=0;pe<6;pe++)t.bindFramebuffer(i.FRAMEBUFFER,R.__webglFramebuffer[pe]),R.__webglDepthbuffer[pe]=i.createRenderbuffer(),Ge(R.__webglDepthbuffer[pe],U,!1)}else t.bindFramebuffer(i.FRAMEBUFFER,R.__webglFramebuffer),R.__webglDepthbuffer=i.createRenderbuffer(),Ge(R.__webglDepthbuffer,U,!1);t.bindFramebuffer(i.FRAMEBUFFER,null)}function it(U,R,J){const pe=n.get(U);R!==void 0&&xe(pe.__webglFramebuffer,U,U.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_2D),J!==void 0&&Ne(U)}function Ot(U){const R=U.texture,J=n.get(U),pe=n.get(R);U.addEventListener("dispose",oe),U.isWebGLMultipleRenderTargets!==!0&&(pe.__webglTexture===void 0&&(pe.__webglTexture=i.createTexture()),pe.__version=R.version,a.memory.textures++);const ge=U.isWebGLCubeRenderTarget===!0,be=U.isWebGLMultipleRenderTargets===!0,ze=w(U)||o;if(ge){J.__webglFramebuffer=[];for(let Re=0;Re<6;Re++)J.__webglFramebuffer[Re]=i.createFramebuffer()}else{if(J.__webglFramebuffer=i.createFramebuffer(),be)if(s.drawBuffers){const Re=U.texture;for(let ae=0,Ie=Re.length;ae<Ie;ae++){const ye=n.get(Re[ae]);ye.__webglTexture===void 0&&(ye.__webglTexture=i.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&U.samples>0&&ot(U)===!1){const Re=be?R:[R];J.__webglMultisampledFramebuffer=i.createFramebuffer(),J.__webglColorRenderbuffer=[],t.bindFramebuffer(i.FRAMEBUFFER,J.__webglMultisampledFramebuffer);for(let ae=0;ae<Re.length;ae++){const Ie=Re[ae];J.__webglColorRenderbuffer[ae]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,J.__webglColorRenderbuffer[ae]);const ye=r.convert(Ie.format,Ie.colorSpace),He=r.convert(Ie.type),De=X(Ie.internalFormat,ye,He,Ie.colorSpace,U.isXRRenderTarget===!0),Ue=gt(U);i.renderbufferStorageMultisample(i.RENDERBUFFER,Ue,De,U.width,U.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+ae,i.RENDERBUFFER,J.__webglColorRenderbuffer[ae])}i.bindRenderbuffer(i.RENDERBUFFER,null),U.depthBuffer&&(J.__webglDepthRenderbuffer=i.createRenderbuffer(),Ge(J.__webglDepthRenderbuffer,U,!0)),t.bindFramebuffer(i.FRAMEBUFFER,null)}}if(ge){t.bindTexture(i.TEXTURE_CUBE_MAP,pe.__webglTexture),Ce(i.TEXTURE_CUBE_MAP,R,ze);for(let Re=0;Re<6;Re++)xe(J.__webglFramebuffer[Re],U,R,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+Re);I(R,ze)&&B(i.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(be){const Re=U.texture;for(let ae=0,Ie=Re.length;ae<Ie;ae++){const ye=Re[ae],He=n.get(ye);t.bindTexture(i.TEXTURE_2D,He.__webglTexture),Ce(i.TEXTURE_2D,ye,ze),xe(J.__webglFramebuffer,U,ye,i.COLOR_ATTACHMENT0+ae,i.TEXTURE_2D),I(ye,ze)&&B(i.TEXTURE_2D)}t.unbindTexture()}else{let Re=i.TEXTURE_2D;(U.isWebGL3DRenderTarget||U.isWebGLArrayRenderTarget)&&(o?Re=U.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(Re,pe.__webglTexture),Ce(Re,R,ze),xe(J.__webglFramebuffer,U,R,i.COLOR_ATTACHMENT0,Re),I(R,ze)&&B(Re),t.unbindTexture()}U.depthBuffer&&Ne(U)}function Ht(U){const R=w(U)||o,J=U.isWebGLMultipleRenderTargets===!0?U.texture:[U.texture];for(let pe=0,ge=J.length;pe<ge;pe++){const be=J[pe];if(I(be,R)){const ze=U.isWebGLCubeRenderTarget?i.TEXTURE_CUBE_MAP:i.TEXTURE_2D,Re=n.get(be).__webglTexture;t.bindTexture(ze,Re),B(ze),t.unbindTexture()}}}function Ut(U){if(o&&U.samples>0&&ot(U)===!1){const R=U.isWebGLMultipleRenderTargets?U.texture:[U.texture],J=U.width,pe=U.height;let ge=i.COLOR_BUFFER_BIT;const be=[],ze=U.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Re=n.get(U),ae=U.isWebGLMultipleRenderTargets===!0;if(ae)for(let Ie=0;Ie<R.length;Ie++)t.bindFramebuffer(i.FRAMEBUFFER,Re.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Ie,i.RENDERBUFFER,null),t.bindFramebuffer(i.FRAMEBUFFER,Re.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+Ie,i.TEXTURE_2D,null,0);t.bindFramebuffer(i.READ_FRAMEBUFFER,Re.__webglMultisampledFramebuffer),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Re.__webglFramebuffer);for(let Ie=0;Ie<R.length;Ie++){be.push(i.COLOR_ATTACHMENT0+Ie),U.depthBuffer&&be.push(ze);const ye=Re.__ignoreDepthValues!==void 0?Re.__ignoreDepthValues:!1;if(ye===!1&&(U.depthBuffer&&(ge|=i.DEPTH_BUFFER_BIT),U.stencilBuffer&&(ge|=i.STENCIL_BUFFER_BIT)),ae&&i.framebufferRenderbuffer(i.READ_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,Re.__webglColorRenderbuffer[Ie]),ye===!0&&(i.invalidateFramebuffer(i.READ_FRAMEBUFFER,[ze]),i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,[ze])),ae){const He=n.get(R[Ie]).__webglTexture;i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,He,0)}i.blitFramebuffer(0,0,J,pe,0,0,J,pe,ge,i.NEAREST),y&&i.invalidateFramebuffer(i.READ_FRAMEBUFFER,be)}if(t.bindFramebuffer(i.READ_FRAMEBUFFER,null),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),ae)for(let Ie=0;Ie<R.length;Ie++){t.bindFramebuffer(i.FRAMEBUFFER,Re.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Ie,i.RENDERBUFFER,Re.__webglColorRenderbuffer[Ie]);const ye=n.get(R[Ie]).__webglTexture;t.bindFramebuffer(i.FRAMEBUFFER,Re.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+Ie,i.TEXTURE_2D,ye,0)}t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Re.__webglMultisampledFramebuffer)}}function gt(U){return Math.min(d,U.samples)}function ot(U){const R=n.get(U);return o&&U.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&R.__useRenderToTexture!==!1}function Fe(U){const R=a.render.frame;v.get(U)!==R&&(v.set(U,R),U.update())}function Jt(U,R){const J=U.colorSpace,pe=U.format,ge=U.type;return U.isCompressedTexture===!0||U.format===kc||J!==En&&J!==Fs&&(J===Ze?o===!1?e.has("EXT_sRGB")===!0&&pe===tn?(U.format=kc,U.minFilter=vi,U.generateMipmaps=!1):R=pg.sRGBToLinear(R):(pe!==tn||ge!==zs)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",J)),R}this.allocateTextureUnit=ue,this.resetTextureUnits=ie,this.setTexture2D=fe,this.setTexture2DArray=Pe,this.setTexture3D=Ae,this.setTextureCube=ee,this.rebindTextures=it,this.setupRenderTarget=Ot,this.updateRenderTargetMipmap=Ht,this.updateMultisampleRenderTarget=Ut,this.setupDepthRenderbuffer=Ne,this.setupFrameBufferTexture=xe,this.useMultisampledRTT=ot}function M1(i,e,t){const n=t.isWebGL2;function s(r,a=Fs){let o;if(r===zs)return i.UNSIGNED_BYTE;if(r===tx)return i.UNSIGNED_SHORT_4_4_4_4;if(r===ix)return i.UNSIGNED_SHORT_5_5_5_1;if(r===ZT)return i.BYTE;if(r===JT)return i.SHORT;if(r===ug)return i.UNSIGNED_SHORT;if(r===ex)return i.INT;if(r===Ls)return i.UNSIGNED_INT;if(r===Is)return i.FLOAT;if(r===Za)return n?i.HALF_FLOAT:(o=e.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(r===nx)return i.ALPHA;if(r===tn)return i.RGBA;if(r===sx)return i.LUMINANCE;if(r===rx)return i.LUMINANCE_ALPHA;if(r===Ns)return i.DEPTH_COMPONENT;if(r===Hr)return i.DEPTH_STENCIL;if(r===kc)return o=e.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(r===ax)return i.RED;if(r===ox)return i.RED_INTEGER;if(r===lx)return i.RG;if(r===ux)return i.RG_INTEGER;if(r===cx)return i.RGBA_INTEGER;if(r===Nu||r===ku||r===Fu||r===Bu)if(a===Ze)if(o=e.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(r===Nu)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===ku)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===Fu)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===Bu)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(r===Nu)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===ku)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===Fu)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===Bu)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===yf||r===Tf||r===xf||r===Sf)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(r===yf)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===Tf)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===xf)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===Sf)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===hx)return o=e.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(r===bf||r===Ef)if(o=e.get("WEBGL_compressed_texture_etc"),o!==null){if(r===bf)return a===Ze?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(r===Ef)return a===Ze?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===Af||r===Cf||r===Mf||r===wf||r===Df||r===Rf||r===Pf||r===Lf||r===If||r===Of||r===Uf||r===Nf||r===kf||r===Ff)if(o=e.get("WEBGL_compressed_texture_astc"),o!==null){if(r===Af)return a===Ze?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===Cf)return a===Ze?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===Mf)return a===Ze?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===wf)return a===Ze?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===Df)return a===Ze?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===Rf)return a===Ze?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===Pf)return a===Ze?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===Lf)return a===Ze?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===If)return a===Ze?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===Of)return a===Ze?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===Uf)return a===Ze?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===Nf)return a===Ze?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===kf)return a===Ze?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===Ff)return a===Ze?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===Hu)if(o=e.get("EXT_texture_compression_bptc"),o!==null){if(r===Hu)return a===Ze?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(r===dx||r===Bf||r===Hf||r===Vf)if(o=e.get("EXT_texture_compression_rgtc"),o!==null){if(r===Hu)return o.COMPRESSED_RED_RGTC1_EXT;if(r===Bf)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===Hf)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===Vf)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===Dr?n?i.UNSIGNED_INT_24_8:(o=e.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):i[r]!==void 0?i[r]:null}return{convert:s}}class w1 extends Vi{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class al extends Oi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const D1={type:"move"};class lc{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new al,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new al,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Y,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Y),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new al,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Y,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Y),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let s=null,r=null,a=null;const o=this._targetRay,l=this._grip,u=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(u&&e.hand){a=!0;for(const b of e.hand.values()){const x=t.getJointPose(b,n),_=this._getHandJoint(u,b);x!==null&&(_.matrix.fromArray(x.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale),_.matrixWorldNeedsUpdate=!0,_.jointRadius=x.radius),_.visible=x!==null}const h=u.joints["index-finger-tip"],d=u.joints["thumb-tip"],m=h.position.distanceTo(d.position),y=.02,v=.005;u.inputState.pinching&&m>y+v?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&m<=y-v&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(s=t.getPose(e.targetRaySpace,n),s===null&&r!==null&&(s=r),s!==null&&(o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,s.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(s.linearVelocity)):o.hasLinearVelocity=!1,s.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(s.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(D1)))}return o!==null&&(o.visible=s!==null),l!==null&&(l.visible=r!==null),u!==null&&(u.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new al;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class R1 extends bi{constructor(e,t,n,s,r,a,o,l,u,h){if(h=h!==void 0?h:Ns,h!==Ns&&h!==Hr)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&h===Ns&&(n=Ls),n===void 0&&h===Hr&&(n=Dr),super(null,s,r,a,o,l,h,n,u),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=o!==void 0?o:ui,this.minFilter=l!==void 0?l:ui,this.flipY=!1,this.generateMipmaps=!1}}class P1 extends ea{constructor(e,t){super();const n=this;let s=null,r=1,a=null,o="local-floor",l=1,u=null,h=null,d=null,m=null,y=null,v=null;const b=t.getContextAttributes();let x=null,_=null;const E=[],A=[],w=new Set,C=new Map,I=new Vi;I.layers.enable(1),I.viewport=new Qt;const B=new Vi;B.layers.enable(2),B.viewport=new Qt;const X=[I,B],M=new w1;M.layers.enable(1),M.layers.enable(2);let F=null,Q=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(ee){let he=E[ee];return he===void 0&&(he=new lc,E[ee]=he),he.getTargetRaySpace()},this.getControllerGrip=function(ee){let he=E[ee];return he===void 0&&(he=new lc,E[ee]=he),he.getGripSpace()},this.getHand=function(ee){let he=E[ee];return he===void 0&&(he=new lc,E[ee]=he),he.getHandSpace()};function oe(ee){const he=A.indexOf(ee.inputSource);if(he===-1)return;const Te=E[he];Te!==void 0&&(Te.update(ee.inputSource,ee.frame,u||a),Te.dispatchEvent({type:ee.type,data:ee.inputSource}))}function H(){s.removeEventListener("select",oe),s.removeEventListener("selectstart",oe),s.removeEventListener("selectend",oe),s.removeEventListener("squeeze",oe),s.removeEventListener("squeezestart",oe),s.removeEventListener("squeezeend",oe),s.removeEventListener("end",H),s.removeEventListener("inputsourceschange",$);for(let ee=0;ee<E.length;ee++){const he=A[ee];he!==null&&(A[ee]=null,E[ee].disconnect(he))}F=null,Q=null,e.setRenderTarget(x),y=null,m=null,d=null,s=null,_=null,Ae.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(ee){r=ee,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ee){o=ee,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||a},this.setReferenceSpace=function(ee){u=ee},this.getBaseLayer=function(){return m!==null?m:y},this.getBinding=function(){return d},this.getFrame=function(){return v},this.getSession=function(){return s},this.setSession=async function(ee){if(s=ee,s!==null){if(x=e.getRenderTarget(),s.addEventListener("select",oe),s.addEventListener("selectstart",oe),s.addEventListener("selectend",oe),s.addEventListener("squeeze",oe),s.addEventListener("squeezestart",oe),s.addEventListener("squeezeend",oe),s.addEventListener("end",H),s.addEventListener("inputsourceschange",$),b.xrCompatible!==!0&&await t.makeXRCompatible(),s.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const he={antialias:s.renderState.layers===void 0?b.antialias:!0,alpha:!0,depth:b.depth,stencil:b.stencil,framebufferScaleFactor:r};y=new XRWebGLLayer(s,t,he),s.updateRenderState({baseLayer:y}),_=new Gs(y.framebufferWidth,y.framebufferHeight,{format:tn,type:zs,colorSpace:e.outputColorSpace,stencilBuffer:b.stencil})}else{let he=null,Te=null,Ce=null;b.depth&&(Ce=b.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,he=b.stencil?Hr:Ns,Te=b.stencil?Dr:Ls);const G={colorFormat:t.RGBA8,depthFormat:Ce,scaleFactor:r};d=new XRWebGLBinding(s,t),m=d.createProjectionLayer(G),s.updateRenderState({layers:[m]}),_=new Gs(m.textureWidth,m.textureHeight,{format:tn,type:zs,depthTexture:new R1(m.textureWidth,m.textureHeight,Te,void 0,void 0,void 0,void 0,void 0,void 0,he),stencilBuffer:b.stencil,colorSpace:e.outputColorSpace,samples:b.antialias?4:0});const Ke=e.properties.get(_);Ke.__ignoreDepthValues=m.ignoreDepthValues}_.isXRRenderTarget=!0,this.setFoveation(l),u=null,a=await s.requestReferenceSpace(o),Ae.setContext(s),Ae.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode};function $(ee){for(let he=0;he<ee.removed.length;he++){const Te=ee.removed[he],Ce=A.indexOf(Te);Ce>=0&&(A[Ce]=null,E[Ce].disconnect(Te))}for(let he=0;he<ee.added.length;he++){const Te=ee.added[he];let Ce=A.indexOf(Te);if(Ce===-1){for(let Ke=0;Ke<E.length;Ke++)if(Ke>=A.length){A.push(Te),Ce=Ke;break}else if(A[Ke]===null){A[Ke]=Te,Ce=Ke;break}if(Ce===-1)break}const G=E[Ce];G&&G.connect(Te)}}const Z=new Y,le=new Y;function ie(ee,he,Te){Z.setFromMatrixPosition(he.matrixWorld),le.setFromMatrixPosition(Te.matrixWorld);const Ce=Z.distanceTo(le),G=he.projectionMatrix.elements,Ke=Te.projectionMatrix.elements,$e=G[14]/(G[10]-1),xe=G[14]/(G[10]+1),Ge=(G[9]+1)/G[5],lt=(G[9]-1)/G[5],Ne=(G[8]-1)/G[0],it=(Ke[8]+1)/Ke[0],Ot=$e*Ne,Ht=$e*it,Ut=Ce/(-Ne+it),gt=Ut*-Ne;he.matrixWorld.decompose(ee.position,ee.quaternion,ee.scale),ee.translateX(gt),ee.translateZ(Ut),ee.matrixWorld.compose(ee.position,ee.quaternion,ee.scale),ee.matrixWorldInverse.copy(ee.matrixWorld).invert();const ot=$e+Ut,Fe=xe+Ut,Jt=Ot-gt,U=Ht+(Ce-gt),R=Ge*xe/Fe*ot,J=lt*xe/Fe*ot;ee.projectionMatrix.makePerspective(Jt,U,R,J,ot,Fe),ee.projectionMatrixInverse.copy(ee.projectionMatrix).invert()}function ue(ee,he){he===null?ee.matrixWorld.copy(ee.matrix):ee.matrixWorld.multiplyMatrices(he.matrixWorld,ee.matrix),ee.matrixWorldInverse.copy(ee.matrixWorld).invert()}this.updateCamera=function(ee){if(s===null)return;M.near=B.near=I.near=ee.near,M.far=B.far=I.far=ee.far,(F!==M.near||Q!==M.far)&&(s.updateRenderState({depthNear:M.near,depthFar:M.far}),F=M.near,Q=M.far);const he=ee.parent,Te=M.cameras;ue(M,he);for(let Ce=0;Ce<Te.length;Ce++)ue(Te[Ce],he);Te.length===2?ie(M,I,B):M.projectionMatrix.copy(I.projectionMatrix),de(ee,M,he)};function de(ee,he,Te){Te===null?ee.matrix.copy(he.matrixWorld):(ee.matrix.copy(Te.matrixWorld),ee.matrix.invert(),ee.matrix.multiply(he.matrixWorld)),ee.matrix.decompose(ee.position,ee.quaternion,ee.scale),ee.updateMatrixWorld(!0);const Ce=ee.children;for(let G=0,Ke=Ce.length;G<Ke;G++)Ce[G].updateMatrixWorld(!0);ee.projectionMatrix.copy(he.projectionMatrix),ee.projectionMatrixInverse.copy(he.projectionMatrixInverse),ee.isPerspectiveCamera&&(ee.fov=Ja*2*Math.atan(1/ee.projectionMatrix.elements[5]),ee.zoom=1)}this.getCamera=function(){return M},this.getFoveation=function(){if(!(m===null&&y===null))return l},this.setFoveation=function(ee){l=ee,m!==null&&(m.fixedFoveation=ee),y!==null&&y.fixedFoveation!==void 0&&(y.fixedFoveation=ee)},this.getPlanes=function(){return w};let fe=null;function Pe(ee,he){if(h=he.getViewerPose(u||a),v=he,h!==null){const Te=h.views;y!==null&&(e.setRenderTargetFramebuffer(_,y.framebuffer),e.setRenderTarget(_));let Ce=!1;Te.length!==M.cameras.length&&(M.cameras.length=0,Ce=!0);for(let G=0;G<Te.length;G++){const Ke=Te[G];let $e=null;if(y!==null)$e=y.getViewport(Ke);else{const Ge=d.getViewSubImage(m,Ke);$e=Ge.viewport,G===0&&(e.setRenderTargetTextures(_,Ge.colorTexture,m.ignoreDepthValues?void 0:Ge.depthStencilTexture),e.setRenderTarget(_))}let xe=X[G];xe===void 0&&(xe=new Vi,xe.layers.enable(G),xe.viewport=new Qt,X[G]=xe),xe.matrix.fromArray(Ke.transform.matrix),xe.matrix.decompose(xe.position,xe.quaternion,xe.scale),xe.projectionMatrix.fromArray(Ke.projectionMatrix),xe.projectionMatrixInverse.copy(xe.projectionMatrix).invert(),xe.viewport.set($e.x,$e.y,$e.width,$e.height),G===0&&(M.matrix.copy(xe.matrix),M.matrix.decompose(M.position,M.quaternion,M.scale)),Ce===!0&&M.cameras.push(xe)}}for(let Te=0;Te<E.length;Te++){const Ce=A[Te],G=E[Te];Ce!==null&&G!==void 0&&G.update(Ce,he,u||a)}if(fe&&fe(ee,he),he.detectedPlanes){n.dispatchEvent({type:"planesdetected",data:he.detectedPlanes});let Te=null;for(const Ce of w)he.detectedPlanes.has(Ce)||(Te===null&&(Te=[]),Te.push(Ce));if(Te!==null)for(const Ce of Te)w.delete(Ce),C.delete(Ce),n.dispatchEvent({type:"planeremoved",data:Ce});for(const Ce of he.detectedPlanes)if(!w.has(Ce))w.add(Ce),C.set(Ce,he.lastChangedTime),n.dispatchEvent({type:"planeadded",data:Ce});else{const G=C.get(Ce);Ce.lastChangedTime>G&&(C.set(Ce,Ce.lastChangedTime),n.dispatchEvent({type:"planechanged",data:Ce}))}}v=null}const Ae=new Ag;Ae.setAnimationLoop(Pe),this.setAnimationLoop=function(ee){fe=ee},this.dispose=function(){}}}function L1(i,e){function t(x,_){x.matrixAutoUpdate===!0&&x.updateMatrix(),_.value.copy(x.matrix)}function n(x,_){_.color.getRGB(x.fogColor.value,xg(i)),_.isFog?(x.fogNear.value=_.near,x.fogFar.value=_.far):_.isFogExp2&&(x.fogDensity.value=_.density)}function s(x,_,E,A,w){_.isMeshBasicMaterial||_.isMeshLambertMaterial?r(x,_):_.isMeshToonMaterial?(r(x,_),d(x,_)):_.isMeshPhongMaterial?(r(x,_),h(x,_)):_.isMeshStandardMaterial?(r(x,_),m(x,_),_.isMeshPhysicalMaterial&&y(x,_,w)):_.isMeshMatcapMaterial?(r(x,_),v(x,_)):_.isMeshDepthMaterial?r(x,_):_.isMeshDistanceMaterial?(r(x,_),b(x,_)):_.isMeshNormalMaterial?r(x,_):_.isLineBasicMaterial?(a(x,_),_.isLineDashedMaterial&&o(x,_)):_.isPointsMaterial?l(x,_,E,A):_.isSpriteMaterial?u(x,_):_.isShadowMaterial?(x.color.value.copy(_.color),x.opacity.value=_.opacity):_.isShaderMaterial&&(_.uniformsNeedUpdate=!1)}function r(x,_){x.opacity.value=_.opacity,_.color&&x.diffuse.value.copy(_.color),_.emissive&&x.emissive.value.copy(_.emissive).multiplyScalar(_.emissiveIntensity),_.map&&(x.map.value=_.map,t(_.map,x.mapTransform)),_.alphaMap&&(x.alphaMap.value=_.alphaMap,t(_.alphaMap,x.alphaMapTransform)),_.bumpMap&&(x.bumpMap.value=_.bumpMap,t(_.bumpMap,x.bumpMapTransform),x.bumpScale.value=_.bumpScale,_.side===Si&&(x.bumpScale.value*=-1)),_.normalMap&&(x.normalMap.value=_.normalMap,t(_.normalMap,x.normalMapTransform),x.normalScale.value.copy(_.normalScale),_.side===Si&&x.normalScale.value.negate()),_.displacementMap&&(x.displacementMap.value=_.displacementMap,t(_.displacementMap,x.displacementMapTransform),x.displacementScale.value=_.displacementScale,x.displacementBias.value=_.displacementBias),_.emissiveMap&&(x.emissiveMap.value=_.emissiveMap,t(_.emissiveMap,x.emissiveMapTransform)),_.specularMap&&(x.specularMap.value=_.specularMap,t(_.specularMap,x.specularMapTransform)),_.alphaTest>0&&(x.alphaTest.value=_.alphaTest);const E=e.get(_).envMap;if(E&&(x.envMap.value=E,x.flipEnvMap.value=E.isCubeTexture&&E.isRenderTargetTexture===!1?-1:1,x.reflectivity.value=_.reflectivity,x.ior.value=_.ior,x.refractionRatio.value=_.refractionRatio),_.lightMap){x.lightMap.value=_.lightMap;const A=i.useLegacyLights===!0?Math.PI:1;x.lightMapIntensity.value=_.lightMapIntensity*A,t(_.lightMap,x.lightMapTransform)}_.aoMap&&(x.aoMap.value=_.aoMap,x.aoMapIntensity.value=_.aoMapIntensity,t(_.aoMap,x.aoMapTransform))}function a(x,_){x.diffuse.value.copy(_.color),x.opacity.value=_.opacity,_.map&&(x.map.value=_.map,t(_.map,x.mapTransform))}function o(x,_){x.dashSize.value=_.dashSize,x.totalSize.value=_.dashSize+_.gapSize,x.scale.value=_.scale}function l(x,_,E,A){x.diffuse.value.copy(_.color),x.opacity.value=_.opacity,x.size.value=_.size*E,x.scale.value=A*.5,_.map&&(x.map.value=_.map,t(_.map,x.uvTransform)),_.alphaMap&&(x.alphaMap.value=_.alphaMap),_.alphaTest>0&&(x.alphaTest.value=_.alphaTest)}function u(x,_){x.diffuse.value.copy(_.color),x.opacity.value=_.opacity,x.rotation.value=_.rotation,_.map&&(x.map.value=_.map,t(_.map,x.mapTransform)),_.alphaMap&&(x.alphaMap.value=_.alphaMap),_.alphaTest>0&&(x.alphaTest.value=_.alphaTest)}function h(x,_){x.specular.value.copy(_.specular),x.shininess.value=Math.max(_.shininess,1e-4)}function d(x,_){_.gradientMap&&(x.gradientMap.value=_.gradientMap)}function m(x,_){x.metalness.value=_.metalness,_.metalnessMap&&(x.metalnessMap.value=_.metalnessMap,t(_.metalnessMap,x.metalnessMapTransform)),x.roughness.value=_.roughness,_.roughnessMap&&(x.roughnessMap.value=_.roughnessMap,t(_.roughnessMap,x.roughnessMapTransform)),e.get(_).envMap&&(x.envMapIntensity.value=_.envMapIntensity)}function y(x,_,E){x.ior.value=_.ior,_.sheen>0&&(x.sheenColor.value.copy(_.sheenColor).multiplyScalar(_.sheen),x.sheenRoughness.value=_.sheenRoughness,_.sheenColorMap&&(x.sheenColorMap.value=_.sheenColorMap,t(_.sheenColorMap,x.sheenColorMapTransform)),_.sheenRoughnessMap&&(x.sheenRoughnessMap.value=_.sheenRoughnessMap,t(_.sheenRoughnessMap,x.sheenRoughnessMapTransform))),_.clearcoat>0&&(x.clearcoat.value=_.clearcoat,x.clearcoatRoughness.value=_.clearcoatRoughness,_.clearcoatMap&&(x.clearcoatMap.value=_.clearcoatMap,t(_.clearcoatMap,x.clearcoatMapTransform)),_.clearcoatRoughnessMap&&(x.clearcoatRoughnessMap.value=_.clearcoatRoughnessMap,t(_.clearcoatRoughnessMap,x.clearcoatRoughnessMapTransform)),_.clearcoatNormalMap&&(x.clearcoatNormalMap.value=_.clearcoatNormalMap,t(_.clearcoatNormalMap,x.clearcoatNormalMapTransform),x.clearcoatNormalScale.value.copy(_.clearcoatNormalScale),_.side===Si&&x.clearcoatNormalScale.value.negate())),_.iridescence>0&&(x.iridescence.value=_.iridescence,x.iridescenceIOR.value=_.iridescenceIOR,x.iridescenceThicknessMinimum.value=_.iridescenceThicknessRange[0],x.iridescenceThicknessMaximum.value=_.iridescenceThicknessRange[1],_.iridescenceMap&&(x.iridescenceMap.value=_.iridescenceMap,t(_.iridescenceMap,x.iridescenceMapTransform)),_.iridescenceThicknessMap&&(x.iridescenceThicknessMap.value=_.iridescenceThicknessMap,t(_.iridescenceThicknessMap,x.iridescenceThicknessMapTransform))),_.transmission>0&&(x.transmission.value=_.transmission,x.transmissionSamplerMap.value=E.texture,x.transmissionSamplerSize.value.set(E.width,E.height),_.transmissionMap&&(x.transmissionMap.value=_.transmissionMap,t(_.transmissionMap,x.transmissionMapTransform)),x.thickness.value=_.thickness,_.thicknessMap&&(x.thicknessMap.value=_.thicknessMap,t(_.thicknessMap,x.thicknessMapTransform)),x.attenuationDistance.value=_.attenuationDistance,x.attenuationColor.value.copy(_.attenuationColor)),x.specularIntensity.value=_.specularIntensity,x.specularColor.value.copy(_.specularColor),_.specularColorMap&&(x.specularColorMap.value=_.specularColorMap,t(_.specularColorMap,x.specularColorMapTransform)),_.specularIntensityMap&&(x.specularIntensityMap.value=_.specularIntensityMap,t(_.specularIntensityMap,x.specularIntensityMapTransform))}function v(x,_){_.matcap&&(x.matcap.value=_.matcap)}function b(x,_){const E=e.get(_).light;x.referencePosition.value.setFromMatrixPosition(E.matrixWorld),x.nearDistance.value=E.shadow.camera.near,x.farDistance.value=E.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:s}}function I1(i,e,t,n){let s={},r={},a=[];const o=t.isWebGL2?i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(E,A){const w=A.program;n.uniformBlockBinding(E,w)}function u(E,A){let w=s[E.id];w===void 0&&(v(E),w=h(E),s[E.id]=w,E.addEventListener("dispose",x));const C=A.program;n.updateUBOMapping(E,C);const I=e.render.frame;r[E.id]!==I&&(m(E),r[E.id]=I)}function h(E){const A=d();E.__bindingPointIndex=A;const w=i.createBuffer(),C=E.__size,I=E.usage;return i.bindBuffer(i.UNIFORM_BUFFER,w),i.bufferData(i.UNIFORM_BUFFER,C,I),i.bindBuffer(i.UNIFORM_BUFFER,null),i.bindBufferBase(i.UNIFORM_BUFFER,A,w),w}function d(){for(let E=0;E<o;E++)if(a.indexOf(E)===-1)return a.push(E),E;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function m(E){const A=s[E.id],w=E.uniforms,C=E.__cache;i.bindBuffer(i.UNIFORM_BUFFER,A);for(let I=0,B=w.length;I<B;I++){const X=w[I];if(y(X,I,C)===!0){const M=X.__offset,F=Array.isArray(X.value)?X.value:[X.value];let Q=0;for(let oe=0;oe<F.length;oe++){const H=F[oe],$=b(H);typeof H=="number"?(X.__data[0]=H,i.bufferSubData(i.UNIFORM_BUFFER,M+Q,X.__data)):H.isMatrix3?(X.__data[0]=H.elements[0],X.__data[1]=H.elements[1],X.__data[2]=H.elements[2],X.__data[3]=H.elements[0],X.__data[4]=H.elements[3],X.__data[5]=H.elements[4],X.__data[6]=H.elements[5],X.__data[7]=H.elements[0],X.__data[8]=H.elements[6],X.__data[9]=H.elements[7],X.__data[10]=H.elements[8],X.__data[11]=H.elements[0]):(H.toArray(X.__data,Q),Q+=$.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(i.UNIFORM_BUFFER,M,X.__data)}}i.bindBuffer(i.UNIFORM_BUFFER,null)}function y(E,A,w){const C=E.value;if(w[A]===void 0){if(typeof C=="number")w[A]=C;else{const I=Array.isArray(C)?C:[C],B=[];for(let X=0;X<I.length;X++)B.push(I[X].clone());w[A]=B}return!0}else if(typeof C=="number"){if(w[A]!==C)return w[A]=C,!0}else{const I=Array.isArray(w[A])?w[A]:[w[A]],B=Array.isArray(C)?C:[C];for(let X=0;X<I.length;X++){const M=I[X];if(M.equals(B[X])===!1)return M.copy(B[X]),!0}}return!1}function v(E){const A=E.uniforms;let w=0;const C=16;let I=0;for(let B=0,X=A.length;B<X;B++){const M=A[B],F={boundary:0,storage:0},Q=Array.isArray(M.value)?M.value:[M.value];for(let oe=0,H=Q.length;oe<H;oe++){const $=Q[oe],Z=b($);F.boundary+=Z.boundary,F.storage+=Z.storage}if(M.__data=new Float32Array(F.storage/Float32Array.BYTES_PER_ELEMENT),M.__offset=w,B>0){I=w%C;const oe=C-I;I!==0&&oe-F.boundary<0&&(w+=C-I,M.__offset=w)}w+=F.storage}return I=w%C,I>0&&(w+=C-I),E.__size=w,E.__cache={},this}function b(E){const A={boundary:0,storage:0};return typeof E=="number"?(A.boundary=4,A.storage=4):E.isVector2?(A.boundary=8,A.storage=8):E.isVector3||E.isColor?(A.boundary=16,A.storage=12):E.isVector4?(A.boundary=16,A.storage=16):E.isMatrix3?(A.boundary=48,A.storage=48):E.isMatrix4?(A.boundary=64,A.storage=64):E.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",E),A}function x(E){const A=E.target;A.removeEventListener("dispose",x);const w=a.indexOf(A.__bindingPointIndex);a.splice(w,1),i.deleteBuffer(s[A.id]),delete s[A.id],delete r[A.id]}function _(){for(const E in s)i.deleteBuffer(s[E]);a=[],s={},r={}}return{bind:l,update:u,dispose:_}}function O1(){const i=Tl("canvas");return i.style.display="block",i}class Rg{constructor(e={}){const{canvas:t=O1(),context:n=null,depth:s=!0,stencil:r=!0,alpha:a=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:u=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:d=!1}=e;this.isWebGLRenderer=!0;let m;n!==null?m=n.getContextAttributes().alpha:m=a;let y=null,v=null;const b=[],x=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=Ze,this.useLegacyLights=!0,this.toneMapping=qn,this.toneMappingExposure=1;const _=this;let E=!1,A=0,w=0,C=null,I=-1,B=null;const X=new Qt,M=new Qt;let F=null,Q=t.width,oe=t.height,H=1,$=null,Z=null;const le=new Qt(0,0,Q,oe),ie=new Qt(0,0,Q,oe);let ue=!1;const de=new Eg;let fe=!1,Pe=!1,Ae=null;const ee=new Zt,he=new Y,Te={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Ce(){return C===null?H:1}let G=n;function Ke(L,j){for(let te=0;te<L.length;te++){const W=L[te],se=t.getContext(W,j);if(se!==null)return se}return null}try{const L={alpha:!0,depth:s,stencil:r,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:u,powerPreference:h,failIfMajorPerformanceCaveat:d};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${yh}`),t.addEventListener("webglcontextlost",Ue,!1),t.addEventListener("webglcontextrestored",st,!1),t.addEventListener("webglcontextcreationerror",ct,!1),G===null){const j=["webgl2","webgl","experimental-webgl"];if(_.isWebGL1Renderer===!0&&j.shift(),G=Ke(j,L),G===null)throw Ke(j)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}G.getShaderPrecisionFormat===void 0&&(G.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(L){throw console.error("THREE.WebGLRenderer: "+L.message),L}let $e,xe,Ge,lt,Ne,it,Ot,Ht,Ut,gt,ot,Fe,Jt,U,R,J,pe,ge,be,ze,Re,ae,Ie,ye;function He(){$e=new qE(G),xe=new FE(G,$e,e),$e.init(xe),ae=new M1(G,$e,xe),Ge=new A1(G,$e,xe),lt=new XE(G),Ne=new h1,it=new C1(G,$e,Ge,Ne,xe,ae,lt),Ot=new HE(_),Ht=new WE(_),Ut=new rS(G,xe),Ie=new NE(G,$e,Ut,xe),gt=new $E(G,Ut,lt,Ie),ot=new ZE(G,gt,Ut,lt),be=new QE(G,xe,it),J=new BE(Ne),Fe=new c1(_,Ot,Ht,$e,xe,Ie,J),Jt=new L1(_,Ne),U=new f1,R=new y1($e,xe),ge=new UE(_,Ot,Ht,Ge,ot,m,l),pe=new E1(_,ot,xe),ye=new I1(G,lt,xe,Ge),ze=new kE(G,$e,lt,xe),Re=new jE(G,$e,lt,xe),lt.programs=Fe.programs,_.capabilities=xe,_.extensions=$e,_.properties=Ne,_.renderLists=U,_.shadowMap=pe,_.state=Ge,_.info=lt}He();const De=new P1(_,G);this.xr=De,this.getContext=function(){return G},this.getContextAttributes=function(){return G.getContextAttributes()},this.forceContextLoss=function(){const L=$e.get("WEBGL_lose_context");L&&L.loseContext()},this.forceContextRestore=function(){const L=$e.get("WEBGL_lose_context");L&&L.restoreContext()},this.getPixelRatio=function(){return H},this.setPixelRatio=function(L){L!==void 0&&(H=L,this.setSize(Q,oe,!1))},this.getSize=function(L){return L.set(Q,oe)},this.setSize=function(L,j,te=!0){if(De.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Q=L,oe=j,t.width=Math.floor(L*H),t.height=Math.floor(j*H),te===!0&&(t.style.width=L+"px",t.style.height=j+"px"),this.setViewport(0,0,L,j)},this.getDrawingBufferSize=function(L){return L.set(Q*H,oe*H).floor()},this.setDrawingBufferSize=function(L,j,te){Q=L,oe=j,H=te,t.width=Math.floor(L*te),t.height=Math.floor(j*te),this.setViewport(0,0,L,j)},this.getCurrentViewport=function(L){return L.copy(X)},this.getViewport=function(L){return L.copy(le)},this.setViewport=function(L,j,te,W){L.isVector4?le.set(L.x,L.y,L.z,L.w):le.set(L,j,te,W),Ge.viewport(X.copy(le).multiplyScalar(H).floor())},this.getScissor=function(L){return L.copy(ie)},this.setScissor=function(L,j,te,W){L.isVector4?ie.set(L.x,L.y,L.z,L.w):ie.set(L,j,te,W),Ge.scissor(M.copy(ie).multiplyScalar(H).floor())},this.getScissorTest=function(){return ue},this.setScissorTest=function(L){Ge.setScissorTest(ue=L)},this.setOpaqueSort=function(L){$=L},this.setTransparentSort=function(L){Z=L},this.getClearColor=function(L){return L.copy(ge.getClearColor())},this.setClearColor=function(){ge.setClearColor.apply(ge,arguments)},this.getClearAlpha=function(){return ge.getClearAlpha()},this.setClearAlpha=function(){ge.setClearAlpha.apply(ge,arguments)},this.clear=function(L=!0,j=!0,te=!0){let W=0;L&&(W|=G.COLOR_BUFFER_BIT),j&&(W|=G.DEPTH_BUFFER_BIT),te&&(W|=G.STENCIL_BUFFER_BIT),G.clear(W)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ue,!1),t.removeEventListener("webglcontextrestored",st,!1),t.removeEventListener("webglcontextcreationerror",ct,!1),U.dispose(),R.dispose(),Ne.dispose(),Ot.dispose(),Ht.dispose(),ot.dispose(),Ie.dispose(),ye.dispose(),Fe.dispose(),De.dispose(),De.removeEventListener("sessionstart",Oe),De.removeEventListener("sessionend",dt),Ae&&(Ae.dispose(),Ae=null),ft.stop()};function Ue(L){L.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),E=!0}function st(){console.log("THREE.WebGLRenderer: Context Restored."),E=!1;const L=lt.autoReset,j=pe.enabled,te=pe.autoUpdate,W=pe.needsUpdate,se=pe.type;He(),lt.autoReset=L,pe.enabled=j,pe.autoUpdate=te,pe.needsUpdate=W,pe.type=se}function ct(L){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",L.statusMessage)}function Et(L){const j=L.target;j.removeEventListener("dispose",Et),V(j)}function V(L){ne(L),Ne.remove(L)}function ne(L){const j=Ne.get(L).programs;j!==void 0&&(j.forEach(function(te){Fe.releaseProgram(te)}),L.isShaderMaterial&&Fe.releaseShaderCache(L))}this.renderBufferDirect=function(L,j,te,W,se,ve){j===null&&(j=Te);const Ve=se.isMesh&&se.matrixWorld.determinant()<0,We=da(L,j,te,W,se);Ge.setMaterial(W,Ve);let Ye=te.index,et=1;W.wireframe===!0&&(Ye=gt.getWireframeAttribute(te),et=2);const Xe=te.drawRange,Le=te.attributes.position;let ut=Xe.start*et,Nt=(Xe.start+Xe.count)*et;ve!==null&&(ut=Math.max(ut,ve.start*et),Nt=Math.min(Nt,(ve.start+ve.count)*et)),Ye!==null?(ut=Math.max(ut,0),Nt=Math.min(Nt,Ye.count)):Le!=null&&(ut=Math.max(ut,0),Nt=Math.min(Nt,Le.count));const Mi=Nt-ut;if(Mi<0||Mi===1/0)return;Ie.setup(se,W,We,te,Ye);let Dn,wt=ze;if(Ye!==null&&(Dn=Ut.get(Ye),wt=Re,wt.setIndex(Dn)),se.isMesh)W.wireframe===!0?(Ge.setLineWidth(W.wireframeLinewidth*Ce()),wt.setMode(G.LINES)):wt.setMode(G.TRIANGLES);else if(se.isLine){let nt=W.linewidth;nt===void 0&&(nt=1),Ge.setLineWidth(nt*Ce()),se.isLineSegments?wt.setMode(G.LINES):se.isLineLoop?wt.setMode(G.LINE_LOOP):wt.setMode(G.LINE_STRIP)}else se.isPoints?wt.setMode(G.POINTS):se.isSprite&&wt.setMode(G.TRIANGLES);if(se.isInstancedMesh)wt.renderInstances(ut,Mi,se.count);else if(te.isInstancedBufferGeometry){const nt=te._maxInstanceCount!==void 0?te._maxInstanceCount:1/0,gs=Math.min(te.instanceCount,nt);wt.renderInstances(ut,Mi,gs)}else wt.render(ut,Mi)},this.compile=function(L,j){function te(W,se,ve){W.transparent===!0&&W.side===Vn&&W.forceSinglePass===!1?(W.side=Si,W.needsUpdate=!0,Xs(W,se,ve),W.side=cs,W.needsUpdate=!0,Xs(W,se,ve),W.side=Vn):Xs(W,se,ve)}v=R.get(L),v.init(),x.push(v),L.traverseVisible(function(W){W.isLight&&W.layers.test(j.layers)&&(v.pushLight(W),W.castShadow&&v.pushShadow(W))}),v.setupLights(_.useLegacyLights),L.traverse(function(W){const se=W.material;if(se)if(Array.isArray(se))for(let ve=0;ve<se.length;ve++){const Ve=se[ve];te(Ve,L,W)}else te(se,L,W)}),x.pop(),v=null};let me=null;function we(L){me&&me(L)}function Oe(){ft.stop()}function dt(){ft.start()}const ft=new Ag;ft.setAnimationLoop(we),typeof self<"u"&&ft.setContext(self),this.setAnimationLoop=function(L){me=L,De.setAnimationLoop(L),L===null?ft.stop():ft.start()},De.addEventListener("sessionstart",Oe),De.addEventListener("sessionend",dt),this.render=function(L,j){if(j!==void 0&&j.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(E===!0)return;L.matrixWorldAutoUpdate===!0&&L.updateMatrixWorld(),j.parent===null&&j.matrixWorldAutoUpdate===!0&&j.updateMatrixWorld(),De.enabled===!0&&De.isPresenting===!0&&(De.cameraAutoUpdate===!0&&De.updateCamera(j),j=De.getCamera()),L.isScene===!0&&L.onBeforeRender(_,L,j,C),v=R.get(L,x.length),v.init(),x.push(v),ee.multiplyMatrices(j.projectionMatrix,j.matrixWorldInverse),de.setFromProjectionMatrix(ee),Pe=this.localClippingEnabled,fe=J.init(this.clippingPlanes,Pe),y=U.get(L,b.length),y.init(),b.push(y),Vt(L,j,0,_.sortObjects),y.finish(),_.sortObjects===!0&&y.sort($,Z),fe===!0&&J.beginShadows();const te=v.state.shadowsArray;if(pe.render(te,L,j),fe===!0&&J.endShadows(),this.info.autoReset===!0&&this.info.reset(),ge.render(y,L),v.setupLights(_.useLegacyLights),j.isArrayCamera){const W=j.cameras;for(let se=0,ve=W.length;se<ve;se++){const Ve=W[se];on(y,L,Ve,Ve.viewport)}}else on(y,L,j);C!==null&&(it.updateMultisampleRenderTarget(C),it.updateRenderTargetMipmap(C)),L.isScene===!0&&L.onAfterRender(_,L,j),Ie.resetDefaultState(),I=-1,B=null,x.pop(),x.length>0?v=x[x.length-1]:v=null,b.pop(),b.length>0?y=b[b.length-1]:y=null};function Vt(L,j,te,W){if(L.visible===!1)return;if(L.layers.test(j.layers)){if(L.isGroup)te=L.renderOrder;else if(L.isLOD)L.autoUpdate===!0&&L.update(j);else if(L.isLight)v.pushLight(L),L.castShadow&&v.pushShadow(L);else if(L.isSprite){if(!L.frustumCulled||de.intersectsSprite(L)){W&&he.setFromMatrixPosition(L.matrixWorld).applyMatrix4(ee);const Ve=ot.update(L),We=L.material;We.visible&&y.push(L,Ve,We,te,he.z,null)}}else if((L.isMesh||L.isLine||L.isPoints)&&(!L.frustumCulled||de.intersectsObject(L))){L.isSkinnedMesh&&L.skeleton.frame!==lt.render.frame&&(L.skeleton.update(),L.skeleton.frame=lt.render.frame);const Ve=ot.update(L),We=L.material;if(W&&(Ve.boundingSphere===null&&Ve.computeBoundingSphere(),he.copy(Ve.boundingSphere.center).applyMatrix4(L.matrixWorld).applyMatrix4(ee)),Array.isArray(We)){const Ye=Ve.groups;for(let et=0,Xe=Ye.length;et<Xe;et++){const Le=Ye[et],ut=We[Le.materialIndex];ut&&ut.visible&&y.push(L,Ve,ut,te,he.z,Le)}}else We.visible&&y.push(L,Ve,We,te,he.z,null)}}const ve=L.children;for(let Ve=0,We=ve.length;Ve<We;Ve++)Vt(ve[Ve],j,te,W)}function on(L,j,te,W){const se=L.opaque,ve=L.transmissive,Ve=L.transparent;v.setupLightsView(te),fe===!0&&J.setGlobalState(_.clippingPlanes,te),ve.length>0&&At(se,ve,j,te),W&&Ge.viewport(X.copy(W)),se.length>0&&mi(se,j,te),ve.length>0&&mi(ve,j,te),Ve.length>0&&mi(Ve,j,te),Ge.buffers.depth.setTest(!0),Ge.buffers.depth.setMask(!0),Ge.buffers.color.setMask(!0),Ge.setPolygonOffset(!1)}function At(L,j,te,W){if(Ae===null){const We=xe.isWebGL2;Ae=new Gs(1024,1024,{generateMipmaps:!0,type:$e.has("EXT_color_buffer_half_float")?Za:zs,minFilter:Qa,samples:We&&o===!0?4:0})}const se=_.getRenderTarget();_.setRenderTarget(Ae),_.clear();const ve=_.toneMapping;_.toneMapping=qn,mi(L,te,W),it.updateMultisampleRenderTarget(Ae),it.updateRenderTargetMipmap(Ae);let Ve=!1;for(let We=0,Ye=j.length;We<Ye;We++){const et=j[We],Xe=et.object,Le=et.geometry,ut=et.material,Nt=et.group;if(ut.side===Vn&&Xe.layers.test(W.layers)){const Mi=ut.side;ut.side=Si,ut.needsUpdate=!0,ki(Xe,te,W,Le,ut,Nt),ut.side=Mi,ut.needsUpdate=!0,Ve=!0}}Ve===!0&&(it.updateMultisampleRenderTarget(Ae),it.updateRenderTargetMipmap(Ae)),_.setRenderTarget(se),_.toneMapping=ve}function mi(L,j,te){const W=j.isScene===!0?j.overrideMaterial:null;for(let se=0,ve=L.length;se<ve;se++){const Ve=L[se],We=Ve.object,Ye=Ve.geometry,et=W===null?Ve.material:W,Xe=Ve.group;We.layers.test(te.layers)&&ki(We,j,te,Ye,et,Xe)}}function ki(L,j,te,W,se,ve){L.onBeforeRender(_,j,te,W,se,ve),L.modelViewMatrix.multiplyMatrices(te.matrixWorldInverse,L.matrixWorld),L.normalMatrix.getNormalMatrix(L.modelViewMatrix),se.onBeforeRender(_,j,te,W,L,ve),se.transparent===!0&&se.side===Vn&&se.forceSinglePass===!1?(se.side=Si,se.needsUpdate=!0,_.renderBufferDirect(te,j,W,se,L,ve),se.side=cs,se.needsUpdate=!0,_.renderBufferDirect(te,j,W,se,L,ve),se.side=Vn):_.renderBufferDirect(te,j,W,se,L,ve),L.onAfterRender(_,j,te,W,se,ve)}function Xs(L,j,te){j.isScene!==!0&&(j=Te);const W=Ne.get(L),se=v.state.lights,ve=v.state.shadowsArray,Ve=se.state.version,We=Fe.getParameters(L,se.state,ve,j,te),Ye=Fe.getProgramCacheKey(We);let et=W.programs;W.environment=L.isMeshStandardMaterial?j.environment:null,W.fog=j.fog,W.envMap=(L.isMeshStandardMaterial?Ht:Ot).get(L.envMap||W.environment),et===void 0&&(L.addEventListener("dispose",Et),et=new Map,W.programs=et);let Xe=et.get(Ye);if(Xe!==void 0){if(W.currentProgram===Xe&&W.lightsStateVersion===Ve)return ha(L,We),Xe}else We.uniforms=Fe.getUniforms(L),L.onBuild(te,We,_),L.onBeforeCompile(We,_),Xe=Fe.acquireProgram(We,Ye),et.set(Ye,Xe),W.uniforms=We.uniforms;const Le=W.uniforms;(!L.isShaderMaterial&&!L.isRawShaderMaterial||L.clipping===!0)&&(Le.clippingPlanes=J.uniform),ha(L,We),W.needsLights=ei(L),W.lightsStateVersion=Ve,W.needsLights&&(Le.ambientLightColor.value=se.state.ambient,Le.lightProbe.value=se.state.probe,Le.directionalLights.value=se.state.directional,Le.directionalLightShadows.value=se.state.directionalShadow,Le.spotLights.value=se.state.spot,Le.spotLightShadows.value=se.state.spotShadow,Le.rectAreaLights.value=se.state.rectArea,Le.ltc_1.value=se.state.rectAreaLTC1,Le.ltc_2.value=se.state.rectAreaLTC2,Le.pointLights.value=se.state.point,Le.pointLightShadows.value=se.state.pointShadow,Le.hemisphereLights.value=se.state.hemi,Le.directionalShadowMap.value=se.state.directionalShadowMap,Le.directionalShadowMatrix.value=se.state.directionalShadowMatrix,Le.spotShadowMap.value=se.state.spotShadowMap,Le.spotLightMatrix.value=se.state.spotLightMatrix,Le.spotLightMap.value=se.state.spotLightMap,Le.pointShadowMap.value=se.state.pointShadowMap,Le.pointShadowMatrix.value=se.state.pointShadowMatrix);const ut=Xe.getUniforms(),Nt=ml.seqWithValue(ut.seq,Le);return W.currentProgram=Xe,W.uniformsList=Nt,Xe}function ha(L,j){const te=Ne.get(L);te.outputColorSpace=j.outputColorSpace,te.instancing=j.instancing,te.skinning=j.skinning,te.morphTargets=j.morphTargets,te.morphNormals=j.morphNormals,te.morphColors=j.morphColors,te.morphTargetsCount=j.morphTargetsCount,te.numClippingPlanes=j.numClippingPlanes,te.numIntersection=j.numClipIntersection,te.vertexAlphas=j.vertexAlphas,te.vertexTangents=j.vertexTangents,te.toneMapping=j.toneMapping}function da(L,j,te,W,se){j.isScene!==!0&&(j=Te),it.resetTextureUnits();const ve=j.fog,Ve=W.isMeshStandardMaterial?j.environment:null,We=C===null?_.outputColorSpace:C.isXRRenderTarget===!0?C.texture.colorSpace:En,Ye=(W.isMeshStandardMaterial?Ht:Ot).get(W.envMap||Ve),et=W.vertexColors===!0&&!!te.attributes.color&&te.attributes.color.itemSize===4,Xe=!!W.normalMap&&!!te.attributes.tangent,Le=!!te.morphAttributes.position,ut=!!te.morphAttributes.normal,Nt=!!te.morphAttributes.color,Mi=W.toneMapped?_.toneMapping:qn,Dn=te.morphAttributes.position||te.morphAttributes.normal||te.morphAttributes.color,wt=Dn!==void 0?Dn.length:0,nt=Ne.get(W),gs=v.state.lights;if(fe===!0&&(Pe===!0||L!==B)){const zt=L===B&&W.id===I;J.setState(W,L,zt)}let Dt=!1;W.version===nt.__version?(nt.needsLights&&nt.lightsStateVersion!==gs.state.version||nt.outputColorSpace!==We||se.isInstancedMesh&&nt.instancing===!1||!se.isInstancedMesh&&nt.instancing===!0||se.isSkinnedMesh&&nt.skinning===!1||!se.isSkinnedMesh&&nt.skinning===!0||nt.envMap!==Ye||W.fog===!0&&nt.fog!==ve||nt.numClippingPlanes!==void 0&&(nt.numClippingPlanes!==J.numPlanes||nt.numIntersection!==J.numIntersection)||nt.vertexAlphas!==et||nt.vertexTangents!==Xe||nt.morphTargets!==Le||nt.morphNormals!==ut||nt.morphColors!==Nt||nt.toneMapping!==Mi||xe.isWebGL2===!0&&nt.morphTargetsCount!==wt)&&(Dt=!0):(Dt=!0,nt.__version=W.version);let ln=nt.currentProgram;Dt===!0&&(ln=Xs(W,j,se));let bo=!1,_s=!1,Jn=!1;const kt=ln.getUniforms(),un=nt.uniforms;if(Ge.useProgram(ln.program)&&(bo=!0,_s=!0,Jn=!0),W.id!==I&&(I=W.id,_s=!0),bo||B!==L){if(kt.setValue(G,"projectionMatrix",L.projectionMatrix),xe.logarithmicDepthBuffer&&kt.setValue(G,"logDepthBufFC",2/(Math.log(L.far+1)/Math.LN2)),B!==L&&(B=L,_s=!0,Jn=!0),W.isShaderMaterial||W.isMeshPhongMaterial||W.isMeshToonMaterial||W.isMeshStandardMaterial||W.envMap){const zt=kt.map.cameraPosition;zt!==void 0&&zt.setValue(G,he.setFromMatrixPosition(L.matrixWorld))}(W.isMeshPhongMaterial||W.isMeshToonMaterial||W.isMeshLambertMaterial||W.isMeshBasicMaterial||W.isMeshStandardMaterial||W.isShaderMaterial)&&kt.setValue(G,"isOrthographic",L.isOrthographicCamera===!0),(W.isMeshPhongMaterial||W.isMeshToonMaterial||W.isMeshLambertMaterial||W.isMeshBasicMaterial||W.isMeshStandardMaterial||W.isShaderMaterial||W.isShadowMaterial||se.isSkinnedMesh)&&kt.setValue(G,"viewMatrix",L.matrixWorldInverse)}if(se.isSkinnedMesh){kt.setOptional(G,se,"bindMatrix"),kt.setOptional(G,se,"bindMatrixInverse");const zt=se.skeleton;zt&&(xe.floatVertexTextures?(zt.boneTexture===null&&zt.computeBoneTexture(),kt.setValue(G,"boneTexture",zt.boneTexture,it),kt.setValue(G,"boneTextureSize",zt.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Rn=te.morphAttributes;if((Rn.position!==void 0||Rn.normal!==void 0||Rn.color!==void 0&&xe.isWebGL2===!0)&&be.update(se,te,ln),(_s||nt.receiveShadow!==se.receiveShadow)&&(nt.receiveShadow=se.receiveShadow,kt.setValue(G,"receiveShadow",se.receiveShadow)),W.isMeshGouraudMaterial&&W.envMap!==null&&(un.envMap.value=Ye,un.flipEnvMap.value=Ye.isCubeTexture&&Ye.isRenderTargetTexture===!1?-1:1),_s&&(kt.setValue(G,"toneMappingExposure",_.toneMappingExposure),nt.needsLights&&Ks(un,Jn),ve&&W.fog===!0&&Jt.refreshFogUniforms(un,ve),Jt.refreshMaterialUniforms(un,W,H,oe,Ae),ml.upload(G,nt.uniformsList,un,it)),W.isShaderMaterial&&W.uniformsNeedUpdate===!0&&(ml.upload(G,nt.uniformsList,un,it),W.uniformsNeedUpdate=!1),W.isSpriteMaterial&&kt.setValue(G,"center",se.center),kt.setValue(G,"modelViewMatrix",se.modelViewMatrix),kt.setValue(G,"normalMatrix",se.normalMatrix),kt.setValue(G,"modelMatrix",se.matrixWorld),W.isShaderMaterial||W.isRawShaderMaterial){const zt=W.uniformsGroups;for(let Pn=0,vs=zt.length;Pn<vs;Pn++)if(xe.isWebGL2){const Eo=zt[Pn];ye.update(Eo,ln),ye.bind(Eo,ln)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return ln}function Ks(L,j){L.ambientLightColor.needsUpdate=j,L.lightProbe.needsUpdate=j,L.directionalLights.needsUpdate=j,L.directionalLightShadows.needsUpdate=j,L.pointLights.needsUpdate=j,L.pointLightShadows.needsUpdate=j,L.spotLights.needsUpdate=j,L.spotLightShadows.needsUpdate=j,L.rectAreaLights.needsUpdate=j,L.hemisphereLights.needsUpdate=j}function ei(L){return L.isMeshLambertMaterial||L.isMeshToonMaterial||L.isMeshPhongMaterial||L.isMeshStandardMaterial||L.isShadowMaterial||L.isShaderMaterial&&L.lights===!0}this.getActiveCubeFace=function(){return A},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return C},this.setRenderTargetTextures=function(L,j,te){Ne.get(L.texture).__webglTexture=j,Ne.get(L.depthTexture).__webglTexture=te;const W=Ne.get(L);W.__hasExternalTextures=!0,W.__hasExternalTextures&&(W.__autoAllocateDepthBuffer=te===void 0,W.__autoAllocateDepthBuffer||$e.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),W.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(L,j){const te=Ne.get(L);te.__webglFramebuffer=j,te.__useDefaultFramebuffer=j===void 0},this.setRenderTarget=function(L,j=0,te=0){C=L,A=j,w=te;let W=!0,se=null,ve=!1,Ve=!1;if(L){const Ye=Ne.get(L);Ye.__useDefaultFramebuffer!==void 0?(Ge.bindFramebuffer(G.FRAMEBUFFER,null),W=!1):Ye.__webglFramebuffer===void 0?it.setupRenderTarget(L):Ye.__hasExternalTextures&&it.rebindTextures(L,Ne.get(L.texture).__webglTexture,Ne.get(L.depthTexture).__webglTexture);const et=L.texture;(et.isData3DTexture||et.isDataArrayTexture||et.isCompressedArrayTexture)&&(Ve=!0);const Xe=Ne.get(L).__webglFramebuffer;L.isWebGLCubeRenderTarget?(se=Xe[j],ve=!0):xe.isWebGL2&&L.samples>0&&it.useMultisampledRTT(L)===!1?se=Ne.get(L).__webglMultisampledFramebuffer:se=Xe,X.copy(L.viewport),M.copy(L.scissor),F=L.scissorTest}else X.copy(le).multiplyScalar(H).floor(),M.copy(ie).multiplyScalar(H).floor(),F=ue;if(Ge.bindFramebuffer(G.FRAMEBUFFER,se)&&xe.drawBuffers&&W&&Ge.drawBuffers(L,se),Ge.viewport(X),Ge.scissor(M),Ge.setScissorTest(F),ve){const Ye=Ne.get(L.texture);G.framebufferTexture2D(G.FRAMEBUFFER,G.COLOR_ATTACHMENT0,G.TEXTURE_CUBE_MAP_POSITIVE_X+j,Ye.__webglTexture,te)}else if(Ve){const Ye=Ne.get(L.texture),et=j||0;G.framebufferTextureLayer(G.FRAMEBUFFER,G.COLOR_ATTACHMENT0,Ye.__webglTexture,te||0,et)}I=-1},this.readRenderTargetPixels=function(L,j,te,W,se,ve,Ve){if(!(L&&L.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let We=Ne.get(L).__webglFramebuffer;if(L.isWebGLCubeRenderTarget&&Ve!==void 0&&(We=We[Ve]),We){Ge.bindFramebuffer(G.FRAMEBUFFER,We);try{const Ye=L.texture,et=Ye.format,Xe=Ye.type;if(et!==tn&&ae.convert(et)!==G.getParameter(G.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Le=Xe===Za&&($e.has("EXT_color_buffer_half_float")||xe.isWebGL2&&$e.has("EXT_color_buffer_float"));if(Xe!==zs&&ae.convert(Xe)!==G.getParameter(G.IMPLEMENTATION_COLOR_READ_TYPE)&&!(Xe===Is&&(xe.isWebGL2||$e.has("OES_texture_float")||$e.has("WEBGL_color_buffer_float")))&&!Le){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}j>=0&&j<=L.width-W&&te>=0&&te<=L.height-se&&G.readPixels(j,te,W,se,ae.convert(et),ae.convert(Xe),ve)}finally{const Ye=C!==null?Ne.get(C).__webglFramebuffer:null;Ge.bindFramebuffer(G.FRAMEBUFFER,Ye)}}},this.copyFramebufferToTexture=function(L,j,te=0){const W=Math.pow(2,-te),se=Math.floor(j.image.width*W),ve=Math.floor(j.image.height*W);it.setTexture2D(j,0),G.copyTexSubImage2D(G.TEXTURE_2D,te,0,0,L.x,L.y,se,ve),Ge.unbindTexture()},this.copyTextureToTexture=function(L,j,te,W=0){const se=j.image.width,ve=j.image.height,Ve=ae.convert(te.format),We=ae.convert(te.type);it.setTexture2D(te,0),G.pixelStorei(G.UNPACK_FLIP_Y_WEBGL,te.flipY),G.pixelStorei(G.UNPACK_PREMULTIPLY_ALPHA_WEBGL,te.premultiplyAlpha),G.pixelStorei(G.UNPACK_ALIGNMENT,te.unpackAlignment),j.isDataTexture?G.texSubImage2D(G.TEXTURE_2D,W,L.x,L.y,se,ve,Ve,We,j.image.data):j.isCompressedTexture?G.compressedTexSubImage2D(G.TEXTURE_2D,W,L.x,L.y,j.mipmaps[0].width,j.mipmaps[0].height,Ve,j.mipmaps[0].data):G.texSubImage2D(G.TEXTURE_2D,W,L.x,L.y,Ve,We,j.image),W===0&&te.generateMipmaps&&G.generateMipmap(G.TEXTURE_2D),Ge.unbindTexture()},this.copyTextureToTexture3D=function(L,j,te,W,se=0){if(_.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const ve=L.max.x-L.min.x+1,Ve=L.max.y-L.min.y+1,We=L.max.z-L.min.z+1,Ye=ae.convert(W.format),et=ae.convert(W.type);let Xe;if(W.isData3DTexture)it.setTexture3D(W,0),Xe=G.TEXTURE_3D;else if(W.isDataArrayTexture)it.setTexture2DArray(W,0),Xe=G.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}G.pixelStorei(G.UNPACK_FLIP_Y_WEBGL,W.flipY),G.pixelStorei(G.UNPACK_PREMULTIPLY_ALPHA_WEBGL,W.premultiplyAlpha),G.pixelStorei(G.UNPACK_ALIGNMENT,W.unpackAlignment);const Le=G.getParameter(G.UNPACK_ROW_LENGTH),ut=G.getParameter(G.UNPACK_IMAGE_HEIGHT),Nt=G.getParameter(G.UNPACK_SKIP_PIXELS),Mi=G.getParameter(G.UNPACK_SKIP_ROWS),Dn=G.getParameter(G.UNPACK_SKIP_IMAGES),wt=te.isCompressedTexture?te.mipmaps[0]:te.image;G.pixelStorei(G.UNPACK_ROW_LENGTH,wt.width),G.pixelStorei(G.UNPACK_IMAGE_HEIGHT,wt.height),G.pixelStorei(G.UNPACK_SKIP_PIXELS,L.min.x),G.pixelStorei(G.UNPACK_SKIP_ROWS,L.min.y),G.pixelStorei(G.UNPACK_SKIP_IMAGES,L.min.z),te.isDataTexture||te.isData3DTexture?G.texSubImage3D(Xe,se,j.x,j.y,j.z,ve,Ve,We,Ye,et,wt.data):te.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),G.compressedTexSubImage3D(Xe,se,j.x,j.y,j.z,ve,Ve,We,Ye,wt.data)):G.texSubImage3D(Xe,se,j.x,j.y,j.z,ve,Ve,We,Ye,et,wt),G.pixelStorei(G.UNPACK_ROW_LENGTH,Le),G.pixelStorei(G.UNPACK_IMAGE_HEIGHT,ut),G.pixelStorei(G.UNPACK_SKIP_PIXELS,Nt),G.pixelStorei(G.UNPACK_SKIP_ROWS,Mi),G.pixelStorei(G.UNPACK_SKIP_IMAGES,Dn),se===0&&W.generateMipmaps&&G.generateMipmap(Xe),Ge.unbindTexture()},this.initTexture=function(L){L.isCubeTexture?it.setTextureCube(L,0):L.isData3DTexture?it.setTexture3D(L,0):L.isDataArrayTexture||L.isCompressedArrayTexture?it.setTexture2DArray(L,0):it.setTexture2D(L,0),Ge.unbindTexture()},this.resetState=function(){A=0,w=0,C=null,Ge.reset(),Ie.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Ze?ks:cg}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===ks?Ze:En}}class U1 extends Rg{}U1.prototype.isWebGL1Renderer=!0;class N1 extends Oi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class k1 extends bi{constructor(e,t,n,s,r,a,o,l,u){super(e,t,n,s,r,a,o,l,u),this.isVideoTexture=!0,this.minFilter=a!==void 0?a:vi,this.magFilter=r!==void 0?r:vi,this.generateMipmaps=!1;const h=this;function d(){h.needsUpdate=!0,e.requestVideoFrameCallback(d)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(d)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class Ah extends fs{constructor(e=1,t=32,n=16,s=0,r=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:s,phiLength:r,thetaStart:a,thetaLength:o},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const l=Math.min(a+o,Math.PI);let u=0;const h=[],d=new Y,m=new Y,y=[],v=[],b=[],x=[];for(let _=0;_<=n;_++){const E=[],A=_/n;let w=0;_===0&&a===0?w=.5/t:_===n&&l===Math.PI&&(w=-.5/t);for(let C=0;C<=t;C++){const I=C/t;d.x=-e*Math.cos(s+I*r)*Math.sin(a+A*o),d.y=e*Math.cos(a+A*o),d.z=e*Math.sin(s+I*r)*Math.sin(a+A*o),v.push(d.x,d.y,d.z),m.copy(d).normalize(),b.push(m.x,m.y,m.z),x.push(I+w,1-A),E.push(u++)}h.push(E)}for(let _=0;_<n;_++)for(let E=0;E<t;E++){const A=h[_][E+1],w=h[_][E],C=h[_+1][E],I=h[_+1][E+1];(_!==0||a>0)&&y.push(A,w,I),(_!==n-1||l<Math.PI)&&y.push(w,C,I)}this.setIndex(y),this.setAttribute("position",new Tn(v,3)),this.setAttribute("normal",new Tn(b,3)),this.setAttribute("uv",new Tn(x,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ah(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:yh}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=yh);var xl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Pg(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var t=function n(){if(this instanceof n){var s=[null];s.push.apply(s,arguments);var r=Function.bind.apply(e,s);return new r}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var s=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return i[n]}})}),t}var Ua;typeof window<"u"?Ua=window:typeof xl<"u"?Ua=xl:typeof self<"u"?Ua=self:Ua={};var N=Ua;const F1={},B1=Object.freeze(Object.defineProperty({__proto__:null,default:F1},Symbol.toStringTag,{value:"Module"})),H1=Pg(B1);var Dp=typeof xl<"u"?xl:typeof window<"u"?window:{},V1=H1,Na;typeof document<"u"?Na=document:(Na=Dp["__GLOBAL_DOCUMENT_CACHE@4"],Na||(Na=Dp["__GLOBAL_DOCUMENT_CACHE@4"]=V1));var _e=Na,qe={},z1={get exports(){return qe},set exports(i){qe=i}};(function(i,e){function t(l){if(l&&typeof l=="object"){var u=l.which||l.keyCode||l.charCode;u&&(l=u)}if(typeof l=="number")return a[l];var h=String(l),d=n[h.toLowerCase()];if(d)return d;var d=s[h.toLowerCase()];if(d)return d;if(h.length===1)return h.charCodeAt(0)}t.isEventKey=function(u,h){if(u&&typeof u=="object"){var d=u.which||u.keyCode||u.charCode;if(d==null)return!1;if(typeof h=="string"){var m=n[h.toLowerCase()];if(m)return m===d;var m=s[h.toLowerCase()];if(m)return m===d}else if(typeof h=="number")return h===d;return!1}},e=i.exports=t;var n=e.code=e.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},s=e.aliases={windows:91,"":16,"":18,"":17,"":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};/*!
 * Programatically add the following
 */for(r=97;r<123;r++)n[String.fromCharCode(r)]=r-32;for(var r=48;r<58;r++)n[r-48]=r;for(r=1;r<13;r++)n["f"+r]=r+111;for(r=0;r<10;r++)n["numpad "+r]=r+96;var a=e.names=e.title={};for(r in n)a[n[r]]=r;for(var o in s)n[o]=s[o]})(z1,qe);var G1=W1;function W1(i,e){var t,n=null;try{t=JSON.parse(i,e)}catch(s){n=s}return[n,t]}var eo={},q1={get exports(){return eo},set exports(i){eo=i}};function zi(){return zi=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},zi.apply(null,arguments)}const $1=Object.freeze(Object.defineProperty({__proto__:null,get default(){return zi}},Symbol.toStringTag,{value:"Module"})),j1=Pg($1);var X1=Y1,K1=Object.prototype.toString;function Y1(i){if(!i)return!1;var e=K1.call(i);return e==="[object Function]"||typeof i=="function"&&e!=="[object RegExp]"||typeof window<"u"&&(i===window.setTimeout||i===window.alert||i===window.confirm||i===window.prompt)}var Q1=N,Z1=function(e,t){return t===void 0&&(t=!1),function(n,s,r){if(n){e(n);return}if(s.statusCode>=400&&s.statusCode<=599){var a=r;if(t)if(Q1.TextDecoder){var o=J1(s.headers&&s.headers["content-type"]);try{a=new TextDecoder(o).decode(r)}catch{}}else a=String.fromCharCode.apply(null,new Uint8Array(r));e({cause:a});return}e(null,r)}};function J1(i){return i===void 0&&(i=""),i.toLowerCase().split(";").reduce(function(e,t){var n=t.split("="),s=n[0],r=n[1];return s.trim()==="charset"?r.trim():e},"utf-8")}var eA=Z1,Lg=N,tA=j1,iA=X1;xn.httpHandler=eA;/**
 * @license
 * slighly modified parse-headers 2.0.2 <https://github.com/kesla/parse-headers/>
 * Copyright (c) 2014 David Bjrklund
 * Available under the MIT license
 * <https://github.com/kesla/parse-headers/blob/master/LICENCE>
 */var nA=function(e){var t={};return e&&e.trim().split(`
`).forEach(function(n){var s=n.indexOf(":"),r=n.slice(0,s).trim().toLowerCase(),a=n.slice(s+1).trim();typeof t[r]>"u"?t[r]=a:Array.isArray(t[r])?t[r].push(a):t[r]=[t[r],a]}),t};q1.exports=xn;eo.default=xn;xn.XMLHttpRequest=Lg.XMLHttpRequest||oA;xn.XDomainRequest="withCredentials"in new xn.XMLHttpRequest?xn.XMLHttpRequest:Lg.XDomainRequest;sA(["get","put","post","patch","head","delete"],function(i){xn[i==="delete"?"del":i]=function(e,t,n){return t=Ig(e,t,n),t.method=i.toUpperCase(),Og(t)}});function sA(i,e){for(var t=0;t<i.length;t++)e(i[t])}function rA(i){for(var e in i)if(i.hasOwnProperty(e))return!1;return!0}function Ig(i,e,t){var n=i;return iA(e)?(t=e,typeof i=="string"&&(n={uri:i})):n=tA({},e,{uri:i}),n.callback=t,n}function xn(i,e,t){return e=Ig(i,e,t),Og(e)}function Og(i){if(typeof i.callback>"u")throw new Error("callback argument missing");var e=!1,t=function(A,w,C){e||(e=!0,i.callback(A,w,C))};function n(){o.readyState===4&&setTimeout(a,0)}function s(){var E=void 0;if(o.response?E=o.response:E=o.responseText||aA(o),b)try{E=JSON.parse(E)}catch{}return E}function r(E){return clearTimeout(x),E instanceof Error||(E=new Error(""+(E||"Unknown XMLHttpRequest Error"))),E.statusCode=0,t(E,_)}function a(){if(!u){var E;clearTimeout(x),i.useXDR&&o.status===void 0?E=200:E=o.status===1223?204:o.status;var A=_,w=null;return E!==0?(A={body:s(),statusCode:E,method:d,headers:{},url:h,rawRequest:o},o.getAllResponseHeaders&&(A.headers=nA(o.getAllResponseHeaders()))):w=new Error("Internal XMLHttpRequest Error"),t(w,A,A.body)}}var o=i.xhr||null;o||(i.cors||i.useXDR?o=new xn.XDomainRequest:o=new xn.XMLHttpRequest);var l,u,h=o.url=i.uri||i.url,d=o.method=i.method||"GET",m=i.body||i.data,y=o.headers=i.headers||{},v=!!i.sync,b=!1,x,_={body:void 0,headers:{},statusCode:0,method:d,url:h,rawRequest:o};if("json"in i&&i.json!==!1&&(b=!0,y.accept||y.Accept||(y.Accept="application/json"),d!=="GET"&&d!=="HEAD"&&(y["content-type"]||y["Content-Type"]||(y["Content-Type"]="application/json"),m=JSON.stringify(i.json===!0?m:i.json))),o.onreadystatechange=n,o.onload=a,o.onerror=r,o.onprogress=function(){},o.onabort=function(){u=!0},o.ontimeout=r,o.open(d,h,!v,i.username,i.password),v||(o.withCredentials=!!i.withCredentials),!v&&i.timeout>0&&(x=setTimeout(function(){if(!u){u=!0,o.abort("timeout");var E=new Error("XMLHttpRequest timeout");E.code="ETIMEDOUT",r(E)}},i.timeout)),o.setRequestHeader)for(l in y)y.hasOwnProperty(l)&&o.setRequestHeader(l,y[l]);else if(i.headers&&!rA(i.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in i&&(o.responseType=i.responseType),"beforeSend"in i&&typeof i.beforeSend=="function"&&i.beforeSend(o),o.send(m||null),o}function aA(i){try{if(i.responseType==="document")return i.responseXML;var e=i.responseXML&&i.responseXML.documentElement.nodeName==="parsererror";if(i.responseType===""&&!e)return i.responseXML}catch{}return null}function oA(){}var Sl={},lA={get exports(){return Sl},set exports(i){Sl=i}},Rp=_e,Ch=Object.create||function(){function i(){}return function(e){if(arguments.length!==1)throw new Error("Object.create shim only accepts one parameter.");return i.prototype=e,new i}}();function Ii(i,e){this.name="ParsingError",this.code=i.code,this.message=e||i.message}Ii.prototype=Ch(Error.prototype);Ii.prototype.constructor=Ii;Ii.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}};function Mh(i){function e(n,s,r,a){return(n|0)*3600+(s|0)*60+(r|0)+(a|0)/1e3}var t=i.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return t?t[3]?e(t[1],t[2],t[3].replace(":",""),t[4]):t[1]>59?e(t[1],t[2],0,t[4]):e(0,t[1],t[2],t[4]):null}function Wa(){this.values=Ch(null)}Wa.prototype={set:function(i,e){!this.get(i)&&e!==""&&(this.values[i]=e)},get:function(i,e,t){return t?this.has(i)?this.values[i]:e[t]:this.has(i)?this.values[i]:e},has:function(i){return i in this.values},alt:function(i,e,t){for(var n=0;n<t.length;++n)if(e===t[n]){this.set(i,e);break}},integer:function(i,e){/^-?\d+$/.test(e)&&this.set(i,parseInt(e,10))},percent:function(i,e){return e.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(e=parseFloat(e),e>=0&&e<=100)?(this.set(i,e),!0):!1}};function ka(i,e,t,n){var s=n?i.split(n):[i];for(var r in s)if(typeof s[r]=="string"){var a=s[r].split(t);if(a.length===2){var o=a[0].trim(),l=a[1].trim();e(o,l)}}}function uA(i,e,t){var n=i;function s(){var o=Mh(i);if(o===null)throw new Ii(Ii.Errors.BadTimeStamp,"Malformed timestamp: "+n);return i=i.replace(/^[^\sa-zA-Z-]+/,""),o}function r(o,l){var u=new Wa;ka(o,function(h,d){switch(h){case"region":for(var m=t.length-1;m>=0;m--)if(t[m].id===d){u.set(h,t[m].region);break}break;case"vertical":u.alt(h,d,["rl","lr"]);break;case"line":var y=d.split(","),v=y[0];u.integer(h,v),u.percent(h,v)&&u.set("snapToLines",!1),u.alt(h,v,["auto"]),y.length===2&&u.alt("lineAlign",y[1],["start","center","end"]);break;case"position":y=d.split(","),u.percent(h,y[0]),y.length===2&&u.alt("positionAlign",y[1],["start","center","end"]);break;case"size":u.percent(h,d);break;case"align":u.alt(h,d,["start","center","end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");try{l.line=u.get("line","auto")}catch{}l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100);try{l.align=u.get("align","center")}catch{l.align=u.get("align","middle")}try{l.position=u.get("position","auto")}catch{l.position=u.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},l.align)}l.positionAlign=u.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},l.align)}function a(){i=i.replace(/^\s+/,"")}if(a(),e.startTime=s(),a(),i.substr(0,3)!=="-->")throw new Ii(Ii.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '-->'): "+n);i=i.substr(3),a(),e.endTime=s(),a(),r(i,e)}var uc=Rp.createElement&&Rp.createElement("textarea"),cA={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},Pp={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},hA={v:"title",lang:"lang"},Lp={rt:"ruby"};function Ug(i,e){function t(){if(!e)return null;function v(x){return e=e.substr(x.length),x}var b=e.match(/^([^<]*)(<[^>]*>?)?/);return v(b[1]?b[1]:b[2])}function n(v){return uc.innerHTML=v,v=uc.textContent,uc.textContent="",v}function s(v,b){return!Lp[b.localName]||Lp[b.localName]===v.localName}function r(v,b){var x=cA[v];if(!x)return null;var _=i.document.createElement(x),E=hA[v];return E&&b&&(_[E]=b.trim()),_}for(var a=i.document.createElement("div"),o=a,l,u=[];(l=t())!==null;){if(l[0]==="<"){if(l[1]==="/"){u.length&&u[u.length-1]===l.substr(2).replace(">","")&&(u.pop(),o=o.parentNode);continue}var h=Mh(l.substr(1,l.length-2)),d;if(h){d=i.document.createProcessingInstruction("timestamp",h),o.appendChild(d);continue}var m=l.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!m||(d=r(m[1],m[3]),!d)||!s(o,d))continue;if(m[2]){var y=m[2].split(".");y.forEach(function(v){var b=/^bg_/.test(v),x=b?v.slice(3):v;if(Pp.hasOwnProperty(x)){var _=b?"background-color":"color",E=Pp[x];d.style[_]=E}}),d.className=y.join(" ")}u.push(m[1]),o.appendChild(d),o=d;continue}o.appendChild(i.document.createTextNode(n(l)))}return a}var Ip=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function dA(i){for(var e=0;e<Ip.length;e++){var t=Ip[e];if(i>=t[0]&&i<=t[1])return!0}return!1}function fA(i){var e=[],t="",n;if(!i||!i.childNodes)return"ltr";function s(o,l){for(var u=l.childNodes.length-1;u>=0;u--)o.push(l.childNodes[u])}function r(o){if(!o||!o.length)return null;var l=o.pop(),u=l.textContent||l.innerText;if(u){var h=u.match(/^.*(\n|\r)/);return h?(o.length=0,h[0]):u}if(l.tagName==="ruby")return r(o);if(l.childNodes)return s(o,l),r(o)}for(s(e,i);t=r(e);)for(var a=0;a<t.length;a++)if(n=t.charCodeAt(a),dA(n))return"rtl";return"ltr"}function pA(i){if(typeof i.line=="number"&&(i.snapToLines||i.line>=0&&i.line<=100))return i.line;if(!i.track||!i.track.textTrackList||!i.track.textTrackList.mediaElement)return-1;for(var e=i.track,t=e.textTrackList,n=0,s=0;s<t.length&&t[s]!==e;s++)t[s].mode==="showing"&&n++;return++n*-1}function Yl(){}Yl.prototype.applyStyles=function(i,e){e=e||this.div;for(var t in i)i.hasOwnProperty(t)&&(e.style[t]=i[t])};Yl.prototype.formatStyle=function(i,e){return i===0?0:i+e};function bl(i,e,t){Yl.call(this),this.cue=e,this.cueDiv=Ug(i,e.text);var n={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:e.vertical===""?"horizontal-tb":e.vertical==="lr"?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(n,this.cueDiv),this.div=i.document.createElement("div"),n={direction:fA(this.cueDiv),writingMode:e.vertical===""?"horizontal-tb":e.vertical==="lr"?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:e.align==="middle"?"center":e.align,font:t.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(n),this.div.appendChild(this.cueDiv);var s=0;switch(e.positionAlign){case"start":case"line-left":s=e.position;break;case"center":s=e.position-e.size/2;break;case"end":case"line-right":s=e.position-e.size;break}e.vertical===""?this.applyStyles({left:this.formatStyle(s,"%"),width:this.formatStyle(e.size,"%")}):this.applyStyles({top:this.formatStyle(s,"%"),height:this.formatStyle(e.size,"%")}),this.move=function(r){this.applyStyles({top:this.formatStyle(r.top,"px"),bottom:this.formatStyle(r.bottom,"px"),left:this.formatStyle(r.left,"px"),right:this.formatStyle(r.right,"px"),height:this.formatStyle(r.height,"px"),width:this.formatStyle(r.width,"px")})}}bl.prototype=Ch(Yl.prototype);bl.prototype.constructor=bl;function di(i){var e,t,n,s;if(i.div){t=i.div.offsetHeight,n=i.div.offsetWidth,s=i.div.offsetTop;var r=(r=i.div.childNodes)&&(r=r[0])&&r.getClientRects&&r.getClientRects();i=i.div.getBoundingClientRect(),e=r?Math.max(r[0]&&r[0].height||0,i.height/r.length):0}this.left=i.left,this.right=i.right,this.top=i.top||s,this.height=i.height||t,this.bottom=i.bottom||s+(i.height||t),this.width=i.width||n,this.lineHeight=e!==void 0?e:i.lineHeight}di.prototype.move=function(i,e){switch(e=e!==void 0?e:this.lineHeight,i){case"+x":this.left+=e,this.right+=e;break;case"-x":this.left-=e,this.right-=e;break;case"+y":this.top+=e,this.bottom+=e;break;case"-y":this.top-=e,this.bottom-=e;break}};di.prototype.overlaps=function(i){return this.left<i.right&&this.right>i.left&&this.top<i.bottom&&this.bottom>i.top};di.prototype.overlapsAny=function(i){for(var e=0;e<i.length;e++)if(this.overlaps(i[e]))return!0;return!1};di.prototype.within=function(i){return this.top>=i.top&&this.bottom<=i.bottom&&this.left>=i.left&&this.right<=i.right};di.prototype.overlapsOppositeAxis=function(i,e){switch(e){case"+x":return this.left<i.left;case"-x":return this.right>i.right;case"+y":return this.top<i.top;case"-y":return this.bottom>i.bottom}};di.prototype.intersectPercentage=function(i){var e=Math.max(0,Math.min(this.right,i.right)-Math.max(this.left,i.left)),t=Math.max(0,Math.min(this.bottom,i.bottom)-Math.max(this.top,i.top)),n=e*t;return n/(this.height*this.width)};di.prototype.toCSSCompatValues=function(i){return{top:this.top-i.top,bottom:i.bottom-this.bottom,left:this.left-i.left,right:i.right-this.right,height:this.height,width:this.width}};di.getSimpleBoxPosition=function(i){var e=i.div?i.div.offsetHeight:i.tagName?i.offsetHeight:0,t=i.div?i.div.offsetWidth:i.tagName?i.offsetWidth:0,n=i.div?i.div.offsetTop:i.tagName?i.offsetTop:0;i=i.div?i.div.getBoundingClientRect():i.tagName?i.getBoundingClientRect():i;var s={left:i.left,right:i.right,top:i.top||n,height:i.height||e,bottom:i.bottom||n+(i.height||e),width:i.width||t};return s};function mA(i,e,t,n){function s(x,_){for(var E,A=new di(x),w=1,C=0;C<_.length;C++){for(;x.overlapsOppositeAxis(t,_[C])||x.within(t)&&x.overlapsAny(n);)x.move(_[C]);if(x.within(t))return x;var I=x.intersectPercentage(t);w>I&&(E=new di(x),w=I),x=new di(A)}return E||A}var r=new di(e),a=e.cue,o=pA(a),l=[];if(a.snapToLines){var u;switch(a.vertical){case"":l=["+y","-y"],u="height";break;case"rl":l=["+x","-x"],u="width";break;case"lr":l=["-x","+x"],u="width";break}var h=r.lineHeight,d=h*Math.round(o),m=t[u]+h,y=l[0];Math.abs(d)>m&&(d=d<0?-1:1,d*=Math.ceil(m/h)*h),o<0&&(d+=a.vertical===""?t.height:t.width,l=l.reverse()),r.move(y,d)}else{var v=r.lineHeight/t.height*100;switch(a.lineAlign){case"center":o-=v/2;break;case"end":o-=v;break}switch(a.vertical){case"":e.applyStyles({top:e.formatStyle(o,"%")});break;case"rl":e.applyStyles({left:e.formatStyle(o,"%")});break;case"lr":e.applyStyles({right:e.formatStyle(o,"%")});break}l=["+y","-x","+x","-y"],r=new di(e)}var b=s(r,l);e.move(b.toCSSCompatValues(t))}function na(){}na.StringDecoder=function(){return{decode:function(i){if(!i)return"";if(typeof i!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(i))}}};na.convertCueToDOMTree=function(i,e){return!i||!e?null:Ug(i,e)};var gA=.05,_A="sans-serif",vA="1.5%";na.processCues=function(i,e,t){if(!i||!e||!t)return null;for(;t.firstChild;)t.removeChild(t.firstChild);var n=i.document.createElement("div");n.style.position="absolute",n.style.left="0",n.style.right="0",n.style.top="0",n.style.bottom="0",n.style.margin=vA,t.appendChild(n);function s(h){for(var d=0;d<h.length;d++)if(h[d].hasBeenReset||!h[d].displayState)return!0;return!1}if(!s(e)){for(var r=0;r<e.length;r++)n.appendChild(e[r].displayState);return}var a=[],o=di.getSimpleBoxPosition(n),l=Math.round(o.height*gA*100)/100,u={font:l+"px "+_A};(function(){for(var h,d,m=0;m<e.length;m++)d=e[m],h=new bl(i,d,u),n.appendChild(h.div),mA(i,h,o,a),d.displayState=h.div,a.push(di.getSimpleBoxPosition(h))})()};na.Parser=function(i,e,t){t||(t=e,e={}),e||(e={}),this.window=i,this.vttjs=e,this.state="INITIAL",this.buffer="",this.decoder=t||new TextDecoder("utf8"),this.regionList=[]};na.Parser.prototype={reportOrThrowError:function(i){if(i instanceof Ii)this.onparsingerror&&this.onparsingerror(i);else throw i},parse:function(i){var e=this;i&&(e.buffer+=e.decoder.decode(i,{stream:!0}));function t(){for(var h=e.buffer,d=0;d<h.length&&h[d]!=="\r"&&h[d]!==`
`;)++d;var m=h.substr(0,d);return h[d]==="\r"&&++d,h[d]===`
`&&++d,e.buffer=h.substr(d),m}function n(h){var d=new Wa;if(ka(h,function(y,v){switch(y){case"id":d.set(y,v);break;case"width":d.percent(y,v);break;case"lines":d.integer(y,v);break;case"regionanchor":case"viewportanchor":var b=v.split(",");if(b.length!==2)break;var x=new Wa;if(x.percent("x",b[0]),x.percent("y",b[1]),!x.has("x")||!x.has("y"))break;d.set(y+"X",x.get("x")),d.set(y+"Y",x.get("y"));break;case"scroll":d.alt(y,v,["up"]);break}},/=/,/\s/),d.has("id")){var m=new(e.vttjs.VTTRegion||e.window.VTTRegion);m.width=d.get("width",100),m.lines=d.get("lines",3),m.regionAnchorX=d.get("regionanchorX",0),m.regionAnchorY=d.get("regionanchorY",100),m.viewportAnchorX=d.get("viewportanchorX",0),m.viewportAnchorY=d.get("viewportanchorY",100),m.scroll=d.get("scroll",""),e.onregion&&e.onregion(m),e.regionList.push({id:d.get("id"),region:m})}}function s(h){var d=new Wa;ka(h,function(m,y){switch(m){case"MPEGT":d.integer(m+"S",y);break;case"LOCA":d.set(m+"L",Mh(y));break}},/[^\d]:/,/,/),e.ontimestampmap&&e.ontimestampmap({MPEGTS:d.get("MPEGTS"),LOCAL:d.get("LOCAL")})}function r(h){h.match(/X-TIMESTAMP-MAP/)?ka(h,function(d,m){switch(d){case"X-TIMESTAMP-MAP":s(m);break}},/=/):ka(h,function(d,m){switch(d){case"Region":n(m);break}},/:/)}try{var a;if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;a=t();var o=a.match(/^WEBVTT([ \t].*)?$/);if(!o||!o[0])throw new Ii(Ii.Errors.BadSignature);e.state="HEADER"}for(var l=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(l?l=!1:a=t(),e.state){case"HEADER":/:/.test(a)?r(a):a||(e.state="ID");continue;case"NOTE":a||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(a)){e.state="NOTE";break}if(!a)continue;e.cue=new(e.vttjs.VTTCue||e.window.VTTCue)(0,0,"");try{e.cue.align="center"}catch{e.cue.align="middle"}if(e.state="CUE",a.indexOf("-->")===-1){e.cue.id=a;continue}case"CUE":try{uA(a,e.cue,e.regionList)}catch(h){e.reportOrThrowError(h),e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var u=a.indexOf("-->")!==-1;if(!a||u&&(l=!0)){e.oncue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}e.cue.text&&(e.cue.text+=`
`),e.cue.text+=a.replace(/\u2028/g,`
`).replace(/u2029/g,`
`);continue;case"BADCUE":a||(e.state="ID");continue}}}catch(h){e.reportOrThrowError(h),e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function(){var i=this;try{if(i.buffer+=i.decoder.decode(),(i.cue||i.state==="HEADER")&&(i.buffer+=`

`,i.parse()),i.state==="INITIAL")throw new Ii(Ii.Errors.BadSignature)}catch(e){i.reportOrThrowError(e)}return i.onflush&&i.onflush(),this}};var yA=na,TA="auto",xA={"":1,lr:1,rl:1},SA={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function bA(i){if(typeof i!="string")return!1;var e=xA[i.toLowerCase()];return e?i.toLowerCase():!1}function cc(i){if(typeof i!="string")return!1;var e=SA[i.toLowerCase()];return e?i.toLowerCase():!1}function Ng(i,e,t){this.hasBeenReset=!1;var n="",s=!1,r=i,a=e,o=t,l=null,u="",h=!0,d="auto",m="start",y="auto",v="auto",b=100,x="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return n},set:function(_){n=""+_}},pauseOnExit:{enumerable:!0,get:function(){return s},set:function(_){s=!!_}},startTime:{enumerable:!0,get:function(){return r},set:function(_){if(typeof _!="number")throw new TypeError("Start time must be set to a number.");r=_,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return a},set:function(_){if(typeof _!="number")throw new TypeError("End time must be set to a number.");a=_,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return o},set:function(_){o=""+_,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return l},set:function(_){l=_,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return u},set:function(_){var E=bA(_);if(E===!1)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");u=E,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return h},set:function(_){h=!!_,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return d},set:function(_){if(typeof _!="number"&&_!==TA)throw new SyntaxError("Line: an invalid number or illegal string was specified.");d=_,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return m},set:function(_){var E=cc(_);E?(m=E,this.hasBeenReset=!0):console.warn("lineAlign: an invalid or illegal string was specified.")}},position:{enumerable:!0,get:function(){return y},set:function(_){if(_<0||_>100)throw new Error("Position must be between 0 and 100.");y=_,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return v},set:function(_){var E=cc(_);E?(v=E,this.hasBeenReset=!0):console.warn("positionAlign: an invalid or illegal string was specified.")}},size:{enumerable:!0,get:function(){return b},set:function(_){if(_<0||_>100)throw new Error("Size must be between 0 and 100.");b=_,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return x},set:function(_){var E=cc(_);if(!E)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");x=E,this.hasBeenReset=!0}}}),this.displayState=void 0}Ng.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)};var EA=Ng,AA={"":!0,up:!0};function CA(i){if(typeof i!="string")return!1;var e=AA[i.toLowerCase()];return e?i.toLowerCase():!1}function Aa(i){return typeof i=="number"&&i>=0&&i<=100}function MA(){var i=100,e=3,t=0,n=100,s=0,r=100,a="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return i},set:function(o){if(!Aa(o))throw new Error("Width must be between 0 and 100.");i=o}},lines:{enumerable:!0,get:function(){return e},set:function(o){if(typeof o!="number")throw new TypeError("Lines must be set to a number.");e=o}},regionAnchorY:{enumerable:!0,get:function(){return n},set:function(o){if(!Aa(o))throw new Error("RegionAnchorX must be between 0 and 100.");n=o}},regionAnchorX:{enumerable:!0,get:function(){return t},set:function(o){if(!Aa(o))throw new Error("RegionAnchorY must be between 0 and 100.");t=o}},viewportAnchorY:{enumerable:!0,get:function(){return r},set:function(o){if(!Aa(o))throw new Error("ViewportAnchorY must be between 0 and 100.");r=o}},viewportAnchorX:{enumerable:!0,get:function(){return s},set:function(o){if(!Aa(o))throw new Error("ViewportAnchorX must be between 0 and 100.");s=o}},scroll:{enumerable:!0,get:function(){return a},set:function(o){var l=CA(o);l===!1?console.warn("Scroll: an invalid or illegal string was specified."):a=l}}})}var wA=MA,Xn=N,js=lA.exports={WebVTT:yA,VTTCue:EA,VTTRegion:wA};Xn.vttjs=js;Xn.WebVTT=js.WebVTT;var DA=js.VTTCue,RA=js.VTTRegion,PA=Xn.VTTCue,LA=Xn.VTTRegion;js.shim=function(){Xn.VTTCue=DA,Xn.VTTRegion=RA};js.restore=function(){Xn.VTTCue=PA,Xn.VTTRegion=LA};Xn.VTTCue||js.shim();var Hc={},IA={get exports(){return Hc},set exports(i){Hc=i}};(function(i,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(l,u,h){if(h=h||{},l=l.trim(),u=u.trim(),!u){if(!h.alwaysNormalize)return l;var d=o.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=o.normalizePath(d.path),o.buildURLFromParts(d)}var m=o.parseURL(u);if(!m)throw new Error("Error trying to parse relative URL.");if(m.scheme)return h.alwaysNormalize?(m.path=o.normalizePath(m.path),o.buildURLFromParts(m)):u;var y=o.parseURL(l);if(!y)throw new Error("Error trying to parse base URL.");if(!y.netLoc&&y.path&&y.path[0]!=="/"){var v=s.exec(y.path);y.netLoc=v[1],y.path=v[2]}y.netLoc&&!y.path&&(y.path="/");var b={scheme:y.scheme,netLoc:m.netLoc,path:null,params:m.params,query:m.query,fragment:m.fragment};if(!m.netLoc&&(b.netLoc=y.netLoc,m.path[0]!=="/"))if(!m.path)b.path=y.path,m.params||(b.params=y.params,m.query||(b.query=y.query));else{var x=y.path,_=x.substring(0,x.lastIndexOf("/")+1)+m.path;b.path=o.normalizePath(_)}return b.path===null&&(b.path=h.alwaysNormalize?o.normalizePath(m.path):m.path),o.buildURLFromParts(b)},parseURL:function(l){var u=n.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(r,"");l.length!==(l=l.replace(a,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};i.exports=o})()})(IA);const Op=Hc;var Up="http://example.com",Ql=function(e,t){if(/^[a-z]+:/i.test(t))return t;/^data:/.test(e)&&(e=N.location&&N.location.href||"");var n=typeof N.URL=="function",s=/^\/\//.test(e),r=!N.location&&!/\/\//i.test(e);if(n?e=new N.URL(e,N.location||Up):/\/\//i.test(e)||(e=Op.buildAbsoluteURL(N.location&&N.location.href||"",e)),n){var a=new URL(t,e);return r?a.href.slice(Up.length):s?a.href.slice(a.protocol.length):a.href}return Op.buildAbsoluteURL(e,t)},wh=function(){function i(){this.listeners={}}var e=i.prototype;return e.on=function(n,s){this.listeners[n]||(this.listeners[n]=[]),this.listeners[n].push(s)},e.off=function(n,s){if(!this.listeners[n])return!1;var r=this.listeners[n].indexOf(s);return this.listeners[n]=this.listeners[n].slice(0),this.listeners[n].splice(r,1),r>-1},e.trigger=function(n){var s=this.listeners[n];if(s)if(arguments.length===2)for(var r=s.length,a=0;a<r;++a)s[a].call(this,arguments[1]);else for(var o=Array.prototype.slice.call(arguments,1),l=s.length,u=0;u<l;++u)s[u].apply(this,o)},e.dispose=function(){this.listeners={}},e.pipe=function(n){this.on("data",function(s){n.push(s)})},i}(),OA=function(e){return N.atob?N.atob(e):Buffer.from(e,"base64").toString("binary")};function UA(i){for(var e=OA(i),t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}/*! @name m3u8-parser @version 7.1.0 @license Apache-2.0 */class NA extends wh{constructor(){super(),this.buffer=""}push(e){let t;for(this.buffer+=e,t=this.buffer.indexOf(`
`);t>-1;t=this.buffer.indexOf(`
`))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)}}const kA=String.fromCharCode(9),hc=function(i){const e=/([0-9.]*)?@?([0-9.]*)?/.exec(i||""),t={};return e[1]&&(t.length=parseInt(e[1],10)),e[2]&&(t.offset=parseInt(e[2],10)),t},FA=function(){const i="[^=]*",e='"[^"]*"|[^,]*',t="(?:"+i+")=(?:"+e+")";return new RegExp("(?:^|,)("+t+")")},Ri=function(i){const e={};if(!i)return e;const t=i.split(FA());let n=t.length,s;for(;n--;)t[n]!==""&&(s=/([^=]*)=(.*)/.exec(t[n]).slice(1),s[0]=s[0].replace(/^\s+|\s+$/g,""),s[1]=s[1].replace(/^\s+|\s+$/g,""),s[1]=s[1].replace(/^['"](.*)['"]$/g,"$1"),e[s[0]]=s[1]);return e};class BA extends wh{constructor(){super(),this.customParsers=[],this.tagMappers=[]}push(e){let t,n;if(e=e.trim(),e.length===0)return;if(e[0]!=="#"){this.trigger("data",{type:"uri",uri:e});return}this.tagMappers.reduce((r,a)=>{const o=a(e);return o===e?r:r.concat([o])},[e]).forEach(r=>{for(let a=0;a<this.customParsers.length;a++)if(this.customParsers[a].call(this,r))return;if(r.indexOf("#EXT")!==0){this.trigger("data",{type:"comment",text:r.slice(1)});return}if(r=r.replace("\r",""),t=/^#EXTM3U/.exec(r),t){this.trigger("data",{type:"tag",tagType:"m3u"});return}if(t=/^#EXTINF:([0-9\.]*)?,?(.*)?$/.exec(r),t){n={type:"tag",tagType:"inf"},t[1]&&(n.duration=parseFloat(t[1])),t[2]&&(n.title=t[2]),this.trigger("data",n);return}if(t=/^#EXT-X-TARGETDURATION:([0-9.]*)?/.exec(r),t){n={type:"tag",tagType:"targetduration"},t[1]&&(n.duration=parseInt(t[1],10)),this.trigger("data",n);return}if(t=/^#EXT-X-VERSION:([0-9.]*)?/.exec(r),t){n={type:"tag",tagType:"version"},t[1]&&(n.version=parseInt(t[1],10)),this.trigger("data",n);return}if(t=/^#EXT-X-MEDIA-SEQUENCE:(\-?[0-9.]*)?/.exec(r),t){n={type:"tag",tagType:"media-sequence"},t[1]&&(n.number=parseInt(t[1],10)),this.trigger("data",n);return}if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:(\-?[0-9.]*)?/.exec(r),t){n={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(n.number=parseInt(t[1],10)),this.trigger("data",n);return}if(t=/^#EXT-X-PLAYLIST-TYPE:(.*)?$/.exec(r),t){n={type:"tag",tagType:"playlist-type"},t[1]&&(n.playlistType=t[1]),this.trigger("data",n);return}if(t=/^#EXT-X-BYTERANGE:(.*)?$/.exec(r),t){n=zi(hc(t[1]),{type:"tag",tagType:"byterange"}),this.trigger("data",n);return}if(t=/^#EXT-X-ALLOW-CACHE:(YES|NO)?/.exec(r),t){n={type:"tag",tagType:"allow-cache"},t[1]&&(n.allowed=!/NO/.test(t[1])),this.trigger("data",n);return}if(t=/^#EXT-X-MAP:(.*)$/.exec(r),t){if(n={type:"tag",tagType:"map"},t[1]){const a=Ri(t[1]);a.URI&&(n.uri=a.URI),a.BYTERANGE&&(n.byterange=hc(a.BYTERANGE))}this.trigger("data",n);return}if(t=/^#EXT-X-STREAM-INF:(.*)$/.exec(r),t){if(n={type:"tag",tagType:"stream-inf"},t[1]){if(n.attributes=Ri(t[1]),n.attributes.RESOLUTION){const a=n.attributes.RESOLUTION.split("x"),o={};a[0]&&(o.width=parseInt(a[0],10)),a[1]&&(o.height=parseInt(a[1],10)),n.attributes.RESOLUTION=o}n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes["FRAME-RATE"]&&(n.attributes["FRAME-RATE"]=parseFloat(n.attributes["FRAME-RATE"])),n.attributes["PROGRAM-ID"]&&(n.attributes["PROGRAM-ID"]=parseInt(n.attributes["PROGRAM-ID"],10))}this.trigger("data",n);return}if(t=/^#EXT-X-MEDIA:(.*)$/.exec(r),t){n={type:"tag",tagType:"media"},t[1]&&(n.attributes=Ri(t[1])),this.trigger("data",n);return}if(t=/^#EXT-X-ENDLIST/.exec(r),t){this.trigger("data",{type:"tag",tagType:"endlist"});return}if(t=/^#EXT-X-DISCONTINUITY/.exec(r),t){this.trigger("data",{type:"tag",tagType:"discontinuity"});return}if(t=/^#EXT-X-PROGRAM-DATE-TIME:(.*)$/.exec(r),t){n={type:"tag",tagType:"program-date-time"},t[1]&&(n.dateTimeString=t[1],n.dateTimeObject=new Date(t[1])),this.trigger("data",n);return}if(t=/^#EXT-X-KEY:(.*)$/.exec(r),t){n={type:"tag",tagType:"key"},t[1]&&(n.attributes=Ri(t[1]),n.attributes.IV&&(n.attributes.IV.substring(0,2).toLowerCase()==="0x"&&(n.attributes.IV=n.attributes.IV.substring(2)),n.attributes.IV=n.attributes.IV.match(/.{8}/g),n.attributes.IV[0]=parseInt(n.attributes.IV[0],16),n.attributes.IV[1]=parseInt(n.attributes.IV[1],16),n.attributes.IV[2]=parseInt(n.attributes.IV[2],16),n.attributes.IV[3]=parseInt(n.attributes.IV[3],16),n.attributes.IV=new Uint32Array(n.attributes.IV))),this.trigger("data",n);return}if(t=/^#EXT-X-START:(.*)$/.exec(r),t){n={type:"tag",tagType:"start"},t[1]&&(n.attributes=Ri(t[1]),n.attributes["TIME-OFFSET"]=parseFloat(n.attributes["TIME-OFFSET"]),n.attributes.PRECISE=/YES/.test(n.attributes.PRECISE)),this.trigger("data",n);return}if(t=/^#EXT-X-CUE-OUT-CONT:(.*)?$/.exec(r),t){n={type:"tag",tagType:"cue-out-cont"},t[1]?n.data=t[1]:n.data="",this.trigger("data",n);return}if(t=/^#EXT-X-CUE-OUT:(.*)?$/.exec(r),t){n={type:"tag",tagType:"cue-out"},t[1]?n.data=t[1]:n.data="",this.trigger("data",n);return}if(t=/^#EXT-X-CUE-IN:(.*)?$/.exec(r),t){n={type:"tag",tagType:"cue-in"},t[1]?n.data=t[1]:n.data="",this.trigger("data",n);return}if(t=/^#EXT-X-SKIP:(.*)$/.exec(r),t&&t[1]){n={type:"tag",tagType:"skip"},n.attributes=Ri(t[1]),n.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(n.attributes["SKIPPED-SEGMENTS"]=parseInt(n.attributes["SKIPPED-SEGMENTS"],10)),n.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(n.attributes["RECENTLY-REMOVED-DATERANGES"]=n.attributes["RECENTLY-REMOVED-DATERANGES"].split(kA)),this.trigger("data",n);return}if(t=/^#EXT-X-PART:(.*)$/.exec(r),t&&t[1]){n={type:"tag",tagType:"part"},n.attributes=Ri(t[1]),["DURATION"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=parseFloat(n.attributes[a]))}),["INDEPENDENT","GAP"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=/YES/.test(n.attributes[a]))}),n.attributes.hasOwnProperty("BYTERANGE")&&(n.attributes.byterange=hc(n.attributes.BYTERANGE)),this.trigger("data",n);return}if(t=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(r),t&&t[1]){n={type:"tag",tagType:"server-control"},n.attributes=Ri(t[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=parseFloat(n.attributes[a]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=/YES/.test(n.attributes[a]))}),this.trigger("data",n);return}if(t=/^#EXT-X-PART-INF:(.*)$/.exec(r),t&&t[1]){n={type:"tag",tagType:"part-inf"},n.attributes=Ri(t[1]),["PART-TARGET"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=parseFloat(n.attributes[a]))}),this.trigger("data",n);return}if(t=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(r),t&&t[1]){n={type:"tag",tagType:"preload-hint"},n.attributes=Ri(t[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(a){if(n.attributes.hasOwnProperty(a)){n.attributes[a]=parseInt(n.attributes[a],10);const o=a==="BYTERANGE-LENGTH"?"length":"offset";n.attributes.byterange=n.attributes.byterange||{},n.attributes.byterange[o]=n.attributes[a],delete n.attributes[a]}}),this.trigger("data",n);return}if(t=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(r),t&&t[1]){n={type:"tag",tagType:"rendition-report"},n.attributes=Ri(t[1]),["LAST-MSN","LAST-PART"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=parseInt(n.attributes[a],10))}),this.trigger("data",n);return}if(t=/^#EXT-X-DATERANGE:(.*)$/.exec(r),t&&t[1]){n={type:"tag",tagType:"daterange"},n.attributes=Ri(t[1]),["ID","CLASS"].forEach(function(o){n.attributes.hasOwnProperty(o)&&(n.attributes[o]=String(n.attributes[o]))}),["START-DATE","END-DATE"].forEach(function(o){n.attributes.hasOwnProperty(o)&&(n.attributes[o]=new Date(n.attributes[o]))}),["DURATION","PLANNED-DURATION"].forEach(function(o){n.attributes.hasOwnProperty(o)&&(n.attributes[o]=parseFloat(n.attributes[o]))}),["END-ON-NEXT"].forEach(function(o){n.attributes.hasOwnProperty(o)&&(n.attributes[o]=/YES/i.test(n.attributes[o]))}),["SCTE35-CMD"," SCTE35-OUT","SCTE35-IN"].forEach(function(o){n.attributes.hasOwnProperty(o)&&(n.attributes[o]=n.attributes[o].toString(16))});const a=/^X-([A-Z]+-)+[A-Z]+$/;for(const o in n.attributes){if(!a.test(o))continue;const l=/[0-9A-Fa-f]{6}/g.test(n.attributes[o]),u=/^\d+(\.\d+)?$/.test(n.attributes[o]);n.attributes[o]=l?n.attributes[o].toString(16):u?parseFloat(n.attributes[o]):String(n.attributes[o])}this.trigger("data",n);return}if(t=/^#EXT-X-INDEPENDENT-SEGMENTS/.exec(r),t){this.trigger("data",{type:"tag",tagType:"independent-segments"});return}if(t=/^#EXT-X-CONTENT-STEERING:(.*)$/.exec(r),t){n={type:"tag",tagType:"content-steering"},n.attributes=Ri(t[1]),this.trigger("data",n);return}this.trigger("data",{type:"tag",data:r.slice(4)})})}addParser({expression:e,customType:t,dataParser:n,segment:s}){typeof n!="function"&&(n=r=>r),this.customParsers.push(r=>{if(e.exec(r))return this.trigger("data",{type:"custom",data:n(r),customType:t,segment:s}),!0})}addTagMapper({expression:e,map:t}){const n=s=>e.test(s)?t(s):s;this.tagMappers.push(n)}}const HA=i=>i.toLowerCase().replace(/-(\w)/g,e=>e[1].toUpperCase()),rs=function(i){const e={};return Object.keys(i).forEach(function(t){e[HA(t)]=i[t]}),e},dc=function(i){const{serverControl:e,targetDuration:t,partTargetDuration:n}=i;if(!e)return;const s="#EXT-X-SERVER-CONTROL",r="holdBack",a="partHoldBack",o=t&&t*3,l=n&&n*2;t&&!e.hasOwnProperty(r)&&(e[r]=o,this.trigger("info",{message:`${s} defaulting HOLD-BACK to targetDuration * 3 (${o}).`})),o&&e[r]<o&&(this.trigger("warn",{message:`${s} clamping HOLD-BACK (${e[r]}) to targetDuration * 3 (${o})`}),e[r]=o),n&&!e.hasOwnProperty(a)&&(e[a]=n*3,this.trigger("info",{message:`${s} defaulting PART-HOLD-BACK to partTargetDuration * 3 (${e[a]}).`})),n&&e[a]<l&&(this.trigger("warn",{message:`${s} clamping PART-HOLD-BACK (${e[a]}) to partTargetDuration * 2 (${l}).`}),e[a]=l)};class VA extends wh{constructor(){super(),this.lineStream=new NA,this.parseStream=new BA,this.lineStream.pipe(this.parseStream),this.lastProgramDateTime=null;const e=this,t=[];let n={},s,r,a=!1;const o=function(){},l={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},u="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";let h=0;this.manifest={allowCache:!0,discontinuityStarts:[],dateRanges:[],segments:[]};let d=0,m=0;const y={};this.on("end",()=>{n.uri||!n.parts&&!n.preloadHints||(!n.map&&s&&(n.map=s),!n.key&&r&&(n.key=r),!n.timeline&&typeof h=="number"&&(n.timeline=h),this.manifest.preloadSegment=n)}),this.parseStream.on("data",function(v){let b,x;({tag(){({version(){v.version&&(this.manifest.version=v.version)},"allow-cache"(){this.manifest.allowCache=v.allowed,"allowed"in v||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange(){const _={};"length"in v&&(n.byterange=_,_.length=v.length,"offset"in v||(v.offset=d)),"offset"in v&&(n.byterange=_,_.offset=v.offset),d=_.offset+_.length},endlist(){this.manifest.endList=!0},inf(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),v.title&&(n.title=v.title),v.duration>0&&(n.duration=v.duration),v.duration===0&&(n.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=t},key(){if(!v.attributes){this.trigger("warn",{message:"ignoring key declaration without attribute list"});return}if(v.attributes.METHOD==="NONE"){r=null;return}if(!v.attributes.URI){this.trigger("warn",{message:"ignoring key declaration without URI"});return}if(v.attributes.KEYFORMAT==="com.apple.streamingkeydelivery"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:v.attributes};return}if(v.attributes.KEYFORMAT==="com.microsoft.playready"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.microsoft.playready"]={uri:v.attributes.URI};return}if(v.attributes.KEYFORMAT===u){if(["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(v.attributes.METHOD)===-1){this.trigger("warn",{message:"invalid key method provided for Widevine"});return}if(v.attributes.METHOD==="SAMPLE-AES-CENC"&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),v.attributes.URI.substring(0,23)!=="data:text/plain;base64,"){this.trigger("warn",{message:"invalid key URI provided for Widevine"});return}if(!(v.attributes.KEYID&&v.attributes.KEYID.substring(0,2)==="0x")){this.trigger("warn",{message:"invalid key ID provided for Widevine"});return}this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:v.attributes.KEYFORMAT,keyId:v.attributes.KEYID.substring(2)},pssh:UA(v.attributes.URI.split(",")[1])};return}v.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),r={method:v.attributes.METHOD||"AES-128",uri:v.attributes.URI},typeof v.attributes.IV<"u"&&(r.iv=v.attributes.IV)},"media-sequence"(){if(!isFinite(v.number)){this.trigger("warn",{message:"ignoring invalid media sequence: "+v.number});return}this.manifest.mediaSequence=v.number},"discontinuity-sequence"(){if(!isFinite(v.number)){this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+v.number});return}this.manifest.discontinuitySequence=v.number,h=v.number},"playlist-type"(){if(!/VOD|EVENT/.test(v.playlistType)){this.trigger("warn",{message:"ignoring unknown playlist type: "+v.playlist});return}this.manifest.playlistType=v.playlistType},map(){s={},v.uri&&(s.uri=v.uri),v.byterange&&(s.byterange=v.byterange),r&&(s.key=r)},"stream-inf"(){if(this.manifest.playlists=t,this.manifest.mediaGroups=this.manifest.mediaGroups||l,!v.attributes){this.trigger("warn",{message:"ignoring empty stream-inf attributes"});return}n.attributes||(n.attributes={}),zi(n.attributes,v.attributes)},media(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||l,!(v.attributes&&v.attributes.TYPE&&v.attributes["GROUP-ID"]&&v.attributes.NAME)){this.trigger("warn",{message:"ignoring incomplete or missing media group"});return}const _=this.manifest.mediaGroups[v.attributes.TYPE];_[v.attributes["GROUP-ID"]]=_[v.attributes["GROUP-ID"]]||{},b=_[v.attributes["GROUP-ID"]],x={default:/yes/i.test(v.attributes.DEFAULT)},x.default?x.autoselect=!0:x.autoselect=/yes/i.test(v.attributes.AUTOSELECT),v.attributes.LANGUAGE&&(x.language=v.attributes.LANGUAGE),v.attributes.URI&&(x.uri=v.attributes.URI),v.attributes["INSTREAM-ID"]&&(x.instreamId=v.attributes["INSTREAM-ID"]),v.attributes.CHARACTERISTICS&&(x.characteristics=v.attributes.CHARACTERISTICS),v.attributes.FORCED&&(x.forced=/yes/i.test(v.attributes.FORCED)),b[v.attributes.NAME]=x},discontinuity(){h+=1,n.discontinuity=!0,this.manifest.discontinuityStarts.push(t.length)},"program-date-time"(){typeof this.manifest.dateTimeString>"u"&&(this.manifest.dateTimeString=v.dateTimeString,this.manifest.dateTimeObject=v.dateTimeObject),n.dateTimeString=v.dateTimeString,n.dateTimeObject=v.dateTimeObject;const{lastProgramDateTime:_}=this;this.lastProgramDateTime=new Date(v.dateTimeString).getTime(),_===null&&this.manifest.segments.reduceRight((E,A)=>(A.programDateTime=E-A.duration*1e3,A.programDateTime),this.lastProgramDateTime)},targetduration(){if(!isFinite(v.duration)||v.duration<0){this.trigger("warn",{message:"ignoring invalid target duration: "+v.duration});return}this.manifest.targetDuration=v.duration,dc.call(this,this.manifest)},start(){if(!v.attributes||isNaN(v.attributes["TIME-OFFSET"])){this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"});return}this.manifest.start={timeOffset:v.attributes["TIME-OFFSET"],precise:v.attributes.PRECISE}},"cue-out"(){n.cueOut=v.data},"cue-out-cont"(){n.cueOutCont=v.data},"cue-in"(){n.cueIn=v.data},skip(){this.manifest.skip=rs(v.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",v.attributes,["SKIPPED-SEGMENTS"])},part(){a=!0;const _=this.manifest.segments.length,E=rs(v.attributes);n.parts=n.parts||[],n.parts.push(E),E.byterange&&(E.byterange.hasOwnProperty("offset")||(E.byterange.offset=m),m=E.byterange.offset+E.byterange.length);const A=n.parts.length-1;this.warnOnMissingAttributes_(`#EXT-X-PART #${A} for segment #${_}`,v.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach((w,C)=>{w.hasOwnProperty("lastPart")||this.trigger("warn",{message:`#EXT-X-RENDITION-REPORT #${C} lacks required attribute(s): LAST-PART`})})},"server-control"(){const _=this.manifest.serverControl=rs(v.attributes);_.hasOwnProperty("canBlockReload")||(_.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),dc.call(this,this.manifest),_.canSkipDateranges&&!_.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint"(){const _=this.manifest.segments.length,E=rs(v.attributes),A=E.type&&E.type==="PART";n.preloadHints=n.preloadHints||[],n.preloadHints.push(E),E.byterange&&(E.byterange.hasOwnProperty("offset")||(E.byterange.offset=A?m:0,A&&(m=E.byterange.offset+E.byterange.length)));const w=n.preloadHints.length-1;if(this.warnOnMissingAttributes_(`#EXT-X-PRELOAD-HINT #${w} for segment #${_}`,v.attributes,["TYPE","URI"]),!!E.type)for(let C=0;C<n.preloadHints.length-1;C++){const I=n.preloadHints[C];I.type&&I.type===E.type&&this.trigger("warn",{message:`#EXT-X-PRELOAD-HINT #${w} for segment #${_} has the same TYPE ${E.type} as preload hint #${C}`})}},"rendition-report"(){const _=rs(v.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(_);const E=this.manifest.renditionReports.length-1,A=["LAST-MSN","URI"];a&&A.push("LAST-PART"),this.warnOnMissingAttributes_(`#EXT-X-RENDITION-REPORT #${E}`,v.attributes,A)},"part-inf"(){this.manifest.partInf=rs(v.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",v.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),dc.call(this,this.manifest)},daterange(){this.manifest.dateRanges.push(rs(v.attributes));const _=this.manifest.dateRanges.length-1;this.warnOnMissingAttributes_(`#EXT-X-DATERANGE #${_}`,v.attributes,["ID","START-DATE"]);const E=this.manifest.dateRanges[_];E.endDate&&E.startDate&&new Date(E.endDate)<new Date(E.startDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE END-DATE must be equal to or later than the value of the START-DATE"}),E.duration&&E.duration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE DURATION must not be negative"}),E.plannedDuration&&E.plannedDuration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE PLANNED-DURATION must not be negative"});const A=!!E.endOnNext;if(A&&!E.class&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must have a CLASS attribute"}),A&&(E.duration||E.endDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must not contain DURATION or END-DATE attributes"}),E.duration&&E.endDate){const C=E.startDate.getTime()+E.duration*1e3;this.manifest.dateRanges[_].endDate=new Date(C)}if(!y[E.id])y[E.id]=E;else{for(const C in y[E.id])if(E[C]&&JSON.stringify(y[E.id][C])!==JSON.stringify(E[C])){this.trigger("warn",{message:"EXT-X-DATERANGE tags with the same ID in a playlist must have the same attributes values"});break}const w=this.manifest.dateRanges.findIndex(C=>C.id===E.id);this.manifest.dateRanges[w]=zi(this.manifest.dateRanges[w],E),y[E.id]=zi(y[E.id],E),this.manifest.dateRanges.pop()}},"independent-segments"(){this.manifest.independentSegments=!0},"content-steering"(){this.manifest.contentSteering=rs(v.attributes),this.warnOnMissingAttributes_("#EXT-X-CONTENT-STEERING",v.attributes,["SERVER-URI"])}}[v.tagType]||o).call(e)},uri(){n.uri=v.uri,t.push(n),this.manifest.targetDuration&&!("duration"in n)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),n.duration=this.manifest.targetDuration),r&&(n.key=r),n.timeline=h,s&&(n.map=s),m=0,this.lastProgramDateTime!==null&&(n.programDateTime=this.lastProgramDateTime,this.lastProgramDateTime+=n.duration*1e3),n={}},comment(){},custom(){v.segment?(n.custom=n.custom||{},n.custom[v.customType]=v.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[v.customType]=v.data)}})[v.type].call(e)})}warnOnMissingAttributes_(e,t,n){const s=[];n.forEach(function(r){t.hasOwnProperty(r)||s.push(r)}),s.length&&this.trigger("warn",{message:`${e} lacks required attribute(s): ${s.join(", ")}`})}push(e){this.lineStream.push(e)}end(){this.lineStream.push(`
`),this.manifest.dateRanges.length&&this.lastProgramDateTime===null&&this.trigger("warn",{message:"A playlist with EXT-X-DATERANGE tag must contain atleast one EXT-X-PROGRAM-DATE-TIME tag"}),this.lastProgramDateTime=null,this.trigger("end")}addParser(e){this.parseStream.addParser(e)}addTagMapper(e){this.parseStream.addTagMapper(e)}}var Bs={mp4:/^(av0?1|avc0?[1234]|vp0?9|flac|opus|mp3|mp4a|mp4v|stpp.ttml.im1t)/,webm:/^(vp0?[89]|av0?1|opus|vorbis)/,ogg:/^(vp0?[89]|theora|flac|opus|vorbis)/,video:/^(av0?1|avc0?[1234]|vp0?[89]|hvc1|hev1|theora|mp4v)/,audio:/^(mp4a|flac|vorbis|opus|ac-[34]|ec-3|alac|mp3|speex|aac)/,text:/^(stpp.ttml.im1t)/,muxerVideo:/^(avc0?1)/,muxerAudio:/^(mp4a)/,muxerText:/a^/},zA=["video","audio","text"],Np=["Video","Audio","Text"],kg=function(e){return e&&e.replace(/avc1\.(\d+)\.(\d+)/i,function(t,n,s){var r=("00"+Number(n).toString(16)).slice(-2),a=("00"+Number(s).toString(16)).slice(-2);return"avc1."+r+"00"+a})},dn=function(e){e===void 0&&(e="");var t=e.split(","),n=[];return t.forEach(function(s){s=s.trim();var r;zA.forEach(function(a){var o=Bs[a].exec(s.toLowerCase());if(!(!o||o.length<=1)){r=a;var l=s.substring(0,o[1].length),u=s.replace(l,"");n.push({type:l,details:u,mediaType:a})}}),r||n.push({type:s,details:"",mediaType:"unknown"})}),n},GA=function(e,t){if(!e.mediaGroups.AUDIO||!t)return null;var n=e.mediaGroups.AUDIO[t];if(!n)return null;for(var s in n){var r=n[s];if(r.default&&r.playlists)return dn(r.playlists[0].attributes.CODECS)}return null},Fg=function(e){return e===void 0&&(e=""),Bs.audio.test(e.trim().toLowerCase())},WA=function(e){return e===void 0&&(e=""),Bs.text.test(e.trim().toLowerCase())},to=function(e){if(!(!e||typeof e!="string")){var t=e.toLowerCase().split(",").map(function(r){return kg(r.trim())}),n="video";t.length===1&&Fg(t[0])?n="audio":t.length===1&&WA(t[0])&&(n="application");var s="mp4";return t.every(function(r){return Bs.mp4.test(r)})?s="mp4":t.every(function(r){return Bs.webm.test(r)})?s="webm":t.every(function(r){return Bs.ogg.test(r)})&&(s="ogg"),n+"/"+s+';codecs="'+e+'"'}},gl=function(e){return e===void 0&&(e=""),N.MediaSource&&N.MediaSource.isTypeSupported&&N.MediaSource.isTypeSupported(to(e))||!1},fc=function(e){return e===void 0&&(e=""),e.toLowerCase().split(",").every(function(t){t=t.trim();for(var n=0;n<Np.length;n++){var s=Np[n];if(Bs["muxer"+s].test(t))return!0}return!1})},kp="mp4a.40.2",qA="avc1.4d400d",$A=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i,jA=/^application\/dash\+xml/i,Bg=function(e){return $A.test(e)?"hls":jA.test(e)?"dash":e==="application/vnd.videojs.vhs+json"?"vhs-json":null},XA=function(e){return e.toString(2).length},KA=function(e){return Math.ceil(XA(e)/8)},Hg=function(e){return ArrayBuffer.isView==="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},YA=function(e){return Hg(e)},ke=function(e){return e instanceof Uint8Array?e:(!Array.isArray(e)&&!YA(e)&&!(e instanceof ArrayBuffer)&&(typeof e!="number"||typeof e=="number"&&e!==e?e=0:e=[e]),new Uint8Array(e&&e.buffer||e,e&&e.byteOffset||0,e&&e.byteLength||0))},Yt=N.BigInt||Number,Vc=[Yt("0x1"),Yt("0x100"),Yt("0x10000"),Yt("0x1000000"),Yt("0x100000000"),Yt("0x10000000000"),Yt("0x1000000000000"),Yt("0x100000000000000"),Yt("0x10000000000000000")];(function(){var i=new Uint16Array([65484]),e=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);return e[0]===255?"big":e[0]===204?"little":"unknown"})();var QA=function(e,t){var n=t===void 0?{}:t,s=n.signed,r=s===void 0?!1:s,a=n.le,o=a===void 0?!1:a;e=ke(e);var l=o?"reduce":"reduceRight",u=e[l]?e[l]:Array.prototype[l],h=u.call(e,function(m,y,v){var b=o?v:Math.abs(v+1-e.length);return m+Yt(y)*Vc[b]},Yt(0));if(r){var d=Vc[e.length]/Yt(2)-Yt(1);h=Yt(h),h>d&&(h-=d,h-=d,h-=Yt(2))}return Number(h)},ZA=function(e,t){var n=t===void 0?{}:t,s=n.le,r=s===void 0?!1:s;(typeof e!="bigint"&&typeof e!="number"||typeof e=="number"&&e!==e)&&(e=0),e=Yt(e);for(var a=KA(e),o=new Uint8Array(new ArrayBuffer(a)),l=0;l<a;l++){var u=r?l:Math.abs(l+1-o.length);o[u]=Number(e/Vc[l]&Yt(255)),e<0&&(o[u]=Math.abs(~o[u]),o[u]-=l===0?1:2)}return o},Vg=function(e,t){if(typeof e!="string"&&e&&typeof e.toString=="function"&&(e=e.toString()),typeof e!="string")return new Uint8Array;t||(e=unescape(encodeURIComponent(e)));for(var n=new Uint8Array(e.length),s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n},JA=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t=t.filter(function(o){return o&&(o.byteLength||o.length)&&typeof o!="string"}),t.length<=1)return ke(t[0]);var s=t.reduce(function(o,l,u){return o+(l.byteLength||l.length)},0),r=new Uint8Array(s),a=0;return t.forEach(function(o){o=ke(o),r.set(o,a),a+=o.byteLength}),r},xt=function(e,t,n){var s=n===void 0?{}:n,r=s.offset,a=r===void 0?0:r,o=s.mask,l=o===void 0?[]:o;e=ke(e),t=ke(t);var u=t.every?t.every:Array.prototype.every;return t.length&&e.length-a>=t.length&&u.call(t,function(h,d){var m=l[d]?l[d]&e[a+d]:e[a+d];return h===m})},eC=function(e,t,n){t.forEach(function(s){for(var r in e.mediaGroups[s])for(var a in e.mediaGroups[s][r]){var o=e.mediaGroups[s][r][a];n(o,s,r,a)}})},tC=function(e){return N.atob?N.atob(e):Buffer.from(e,"base64").toString("binary")};function iC(i){for(var e=tC(i),t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}var ps={},Zn={};function nC(i,e,t){if(t===void 0&&(t=Array.prototype),i&&typeof t.find=="function")return t.find.call(i,e);for(var n=0;n<i.length;n++)if(Object.prototype.hasOwnProperty.call(i,n)){var s=i[n];if(e.call(void 0,s,n,i))return s}}function Dh(i,e){return e===void 0&&(e=Object),e&&typeof e.freeze=="function"?e.freeze(i):i}function sC(i,e){if(i===null||typeof i!="object")throw new TypeError("target is not an object");for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i[t]=e[t]);return i}var zg=Dh({HTML:"text/html",isHTML:function(i){return i===zg.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),Gg=Dh({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(i){return i===Gg.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});Zn.assign=sC;Zn.find=nC;Zn.freeze=Dh;Zn.MIME_TYPE=zg;Zn.NAMESPACE=Gg;var Wg=Zn,Sn=Wg.find,io=Wg.NAMESPACE;function rC(i){return i!==""}function aC(i){return i?i.split(/[\t\n\f\r ]+/).filter(rC):[]}function oC(i,e){return i.hasOwnProperty(e)||(i[e]=!0),i}function Fp(i){if(!i)return[];var e=aC(i);return Object.keys(e.reduce(oC,{}))}function lC(i){return function(e){return i&&i.indexOf(e)!==-1}}function fo(i,e){for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}function Ai(i,e){var t=i.prototype;if(!(t instanceof e)){let n=function(){};n.prototype=e.prototype,n=new n,fo(t,n),i.prototype=t=n}t.constructor!=i&&(typeof i!="function"&&console.error("unknown Class:"+i),t.constructor=i)}var Ci={},nn=Ci.ELEMENT_NODE=1,zr=Ci.ATTRIBUTE_NODE=2,El=Ci.TEXT_NODE=3,qg=Ci.CDATA_SECTION_NODE=4,$g=Ci.ENTITY_REFERENCE_NODE=5,uC=Ci.ENTITY_NODE=6,jg=Ci.PROCESSING_INSTRUCTION_NODE=7,Xg=Ci.COMMENT_NODE=8,Kg=Ci.DOCUMENT_NODE=9,Yg=Ci.DOCUMENT_TYPE_NODE=10,Kn=Ci.DOCUMENT_FRAGMENT_NODE=11,cC=Ci.NOTATION_NODE=12,ri={},Kt={};ri.INDEX_SIZE_ERR=(Kt[1]="Index size error",1);ri.DOMSTRING_SIZE_ERR=(Kt[2]="DOMString size error",2);var yi=ri.HIERARCHY_REQUEST_ERR=(Kt[3]="Hierarchy request error",3);ri.WRONG_DOCUMENT_ERR=(Kt[4]="Wrong document",4);ri.INVALID_CHARACTER_ERR=(Kt[5]="Invalid character",5);ri.NO_DATA_ALLOWED_ERR=(Kt[6]="No data allowed",6);ri.NO_MODIFICATION_ALLOWED_ERR=(Kt[7]="No modification allowed",7);var Qg=ri.NOT_FOUND_ERR=(Kt[8]="Not found",8);ri.NOT_SUPPORTED_ERR=(Kt[9]="Not supported",9);var Bp=ri.INUSE_ATTRIBUTE_ERR=(Kt[10]="Attribute in use",10);ri.INVALID_STATE_ERR=(Kt[11]="Invalid state",11);ri.SYNTAX_ERR=(Kt[12]="Syntax error",12);ri.INVALID_MODIFICATION_ERR=(Kt[13]="Invalid modification",13);ri.NAMESPACE_ERR=(Kt[14]="Invalid namespace",14);ri.INVALID_ACCESS_ERR=(Kt[15]="Invalid access",15);function It(i,e){if(e instanceof Error)var t=e;else t=this,Error.call(this,Kt[i]),this.message=Kt[i],Error.captureStackTrace&&Error.captureStackTrace(this,It);return t.code=i,e&&(this.message=this.message+": "+e),t}It.prototype=Error.prototype;fo(ri,It);function $n(){}$n.prototype={length:0,item:function(i){return i>=0&&i<this.length?this[i]:null},toString:function(i,e){for(var t=[],n=0;n<this.length;n++)Er(this[n],t,i,e);return t.join("")},filter:function(i){return Array.prototype.filter.call(this,i)},indexOf:function(i){return Array.prototype.indexOf.call(this,i)}};function Gr(i,e){this._node=i,this._refresh=e,Rh(this)}function Rh(i){var e=i._node._inc||i._node.ownerDocument._inc;if(i._inc!==e){var t=i._refresh(i._node);if(u0(i,"length",t.length),!i.$$length||t.length<i.$$length)for(var n=t.length;n in i;n++)Object.prototype.hasOwnProperty.call(i,n)&&delete i[n];fo(t,i),i._inc=e}}Gr.prototype.item=function(i){return Rh(this),this[i]||null};Ai(Gr,$n);function Al(){}function Zg(i,e){for(var t=i.length;t--;)if(i[t]===e)return t}function Hp(i,e,t,n){if(n?e[Zg(e,n)]=t:e[e.length++]=t,i){t.ownerElement=i;var s=i.ownerDocument;s&&(n&&t0(s,i,n),hC(s,i,t))}}function Vp(i,e,t){var n=Zg(e,t);if(n>=0){for(var s=e.length-1;n<s;)e[n]=e[++n];if(e.length=s,i){var r=i.ownerDocument;r&&(t0(r,i,t),t.ownerElement=null)}}else throw new It(Qg,new Error(i.tagName+"@"+t))}Al.prototype={length:0,item:$n.prototype.item,getNamedItem:function(i){for(var e=this.length;e--;){var t=this[e];if(t.nodeName==i)return t}},setNamedItem:function(i){var e=i.ownerElement;if(e&&e!=this._ownerElement)throw new It(Bp);var t=this.getNamedItem(i.nodeName);return Hp(this._ownerElement,this,i,t),t},setNamedItemNS:function(i){var e=i.ownerElement,t;if(e&&e!=this._ownerElement)throw new It(Bp);return t=this.getNamedItemNS(i.namespaceURI,i.localName),Hp(this._ownerElement,this,i,t),t},removeNamedItem:function(i){var e=this.getNamedItem(i);return Vp(this._ownerElement,this,e),e},removeNamedItemNS:function(i,e){var t=this.getNamedItemNS(i,e);return Vp(this._ownerElement,this,t),t},getNamedItemNS:function(i,e){for(var t=this.length;t--;){var n=this[t];if(n.localName==e&&n.namespaceURI==i)return n}return null}};function Jg(){}Jg.prototype={hasFeature:function(i,e){return!0},createDocument:function(i,e,t){var n=new po;if(n.implementation=this,n.childNodes=new $n,n.doctype=t||null,t&&n.appendChild(t),e){var s=n.createElementNS(i,e);n.appendChild(s)}return n},createDocumentType:function(i,e,t){var n=new Zl;return n.name=i,n.nodeName=i,n.publicId=e||"",n.systemId=t||"",n}};function mt(){}mt.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(i,e){return Cl(this,i,e)},replaceChild:function(i,e){Cl(this,i,e,n0),e&&this.removeChild(e)},removeChild:function(i){return i0(this,i)},appendChild:function(i){return this.insertBefore(i,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(i){return zc(this.ownerDocument||this,this,i)},normalize:function(){for(var i=this.firstChild;i;){var e=i.nextSibling;e&&e.nodeType==El&&i.nodeType==El?(this.removeChild(e),i.appendData(e.data)):(i.normalize(),i=e)}},isSupported:function(i,e){return this.ownerDocument.implementation.hasFeature(i,e)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(i){for(var e=this;e;){var t=e._nsMap;if(t){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&t[n]===i)return n}e=e.nodeType==zr?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(i){for(var e=this;e;){var t=e._nsMap;if(t&&Object.prototype.hasOwnProperty.call(t,i))return t[i];e=e.nodeType==zr?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(i){var e=this.lookupPrefix(i);return e==null}};function e0(i){return i=="<"&&"&lt;"||i==">"&&"&gt;"||i=="&"&&"&amp;"||i=='"'&&"&quot;"||"&#"+i.charCodeAt()+";"}fo(Ci,mt);fo(Ci,mt.prototype);function no(i,e){if(e(i))return!0;if(i=i.firstChild)do if(no(i,e))return!0;while(i=i.nextSibling)}function po(){this.ownerDocument=this}function hC(i,e,t){i&&i._inc++;var n=t.namespaceURI;n===io.XMLNS&&(e._nsMap[t.prefix?t.localName:""]=t.value)}function t0(i,e,t,n){i&&i._inc++;var s=t.namespaceURI;s===io.XMLNS&&delete e._nsMap[t.prefix?t.localName:""]}function Ph(i,e,t){if(i&&i._inc){i._inc++;var n=e.childNodes;if(t)n[n.length++]=t;else{for(var s=e.firstChild,r=0;s;)n[r++]=s,s=s.nextSibling;n.length=r,delete n[n.length]}}}function i0(i,e){var t=e.previousSibling,n=e.nextSibling;return t?t.nextSibling=n:i.firstChild=n,n?n.previousSibling=t:i.lastChild=t,e.parentNode=null,e.previousSibling=null,e.nextSibling=null,Ph(i.ownerDocument,i),e}function dC(i){return i&&(i.nodeType===mt.DOCUMENT_NODE||i.nodeType===mt.DOCUMENT_FRAGMENT_NODE||i.nodeType===mt.ELEMENT_NODE)}function fC(i){return i&&(bn(i)||Lh(i)||Yn(i)||i.nodeType===mt.DOCUMENT_FRAGMENT_NODE||i.nodeType===mt.COMMENT_NODE||i.nodeType===mt.PROCESSING_INSTRUCTION_NODE)}function Yn(i){return i&&i.nodeType===mt.DOCUMENT_TYPE_NODE}function bn(i){return i&&i.nodeType===mt.ELEMENT_NODE}function Lh(i){return i&&i.nodeType===mt.TEXT_NODE}function zp(i,e){var t=i.childNodes||[];if(Sn(t,bn)||Yn(e))return!1;var n=Sn(t,Yn);return!(e&&n&&t.indexOf(n)>t.indexOf(e))}function Gp(i,e){var t=i.childNodes||[];function n(r){return bn(r)&&r!==e}if(Sn(t,n))return!1;var s=Sn(t,Yn);return!(e&&s&&t.indexOf(s)>t.indexOf(e))}function pC(i,e,t){if(!dC(i))throw new It(yi,"Unexpected parent node type "+i.nodeType);if(t&&t.parentNode!==i)throw new It(Qg,"child not in parent");if(!fC(e)||Yn(e)&&i.nodeType!==mt.DOCUMENT_NODE)throw new It(yi,"Unexpected node type "+e.nodeType+" for parent node type "+i.nodeType)}function mC(i,e,t){var n=i.childNodes||[],s=e.childNodes||[];if(e.nodeType===mt.DOCUMENT_FRAGMENT_NODE){var r=s.filter(bn);if(r.length>1||Sn(s,Lh))throw new It(yi,"More than one element or text in fragment");if(r.length===1&&!zp(i,t))throw new It(yi,"Element in fragment can not be inserted before doctype")}if(bn(e)&&!zp(i,t))throw new It(yi,"Only one element can be added and only after doctype");if(Yn(e)){if(Sn(n,Yn))throw new It(yi,"Only one doctype is allowed");var a=Sn(n,bn);if(t&&n.indexOf(a)<n.indexOf(t))throw new It(yi,"Doctype can only be inserted before an element");if(!t&&a)throw new It(yi,"Doctype can not be appended since element is present")}}function n0(i,e,t){var n=i.childNodes||[],s=e.childNodes||[];if(e.nodeType===mt.DOCUMENT_FRAGMENT_NODE){var r=s.filter(bn);if(r.length>1||Sn(s,Lh))throw new It(yi,"More than one element or text in fragment");if(r.length===1&&!Gp(i,t))throw new It(yi,"Element in fragment can not be inserted before doctype")}if(bn(e)&&!Gp(i,t))throw new It(yi,"Only one element can be added and only after doctype");if(Yn(e)){if(Sn(n,function(l){return Yn(l)&&l!==t}))throw new It(yi,"Only one doctype is allowed");var a=Sn(n,bn);if(t&&n.indexOf(a)<n.indexOf(t))throw new It(yi,"Doctype can only be inserted before an element")}}function Cl(i,e,t,n){pC(i,e,t),i.nodeType===mt.DOCUMENT_NODE&&(n||mC)(i,e,t);var s=e.parentNode;if(s&&s.removeChild(e),e.nodeType===Kn){var r=e.firstChild;if(r==null)return e;var a=e.lastChild}else r=a=e;var o=t?t.previousSibling:i.lastChild;r.previousSibling=o,a.nextSibling=t,o?o.nextSibling=r:i.firstChild=r,t==null?i.lastChild=a:t.previousSibling=a;do r.parentNode=i;while(r!==a&&(r=r.nextSibling));return Ph(i.ownerDocument||i,i),e.nodeType==Kn&&(e.firstChild=e.lastChild=null),e}function gC(i,e){return e.parentNode&&e.parentNode.removeChild(e),e.parentNode=i,e.previousSibling=i.lastChild,e.nextSibling=null,e.previousSibling?e.previousSibling.nextSibling=e:i.firstChild=e,i.lastChild=e,Ph(i.ownerDocument,i,e),e}po.prototype={nodeName:"#document",nodeType:Kg,doctype:null,documentElement:null,_inc:1,insertBefore:function(i,e){if(i.nodeType==Kn){for(var t=i.firstChild;t;){var n=t.nextSibling;this.insertBefore(t,e),t=n}return i}return Cl(this,i,e),i.ownerDocument=this,this.documentElement===null&&i.nodeType===nn&&(this.documentElement=i),i},removeChild:function(i){return this.documentElement==i&&(this.documentElement=null),i0(this,i)},replaceChild:function(i,e){Cl(this,i,e,n0),i.ownerDocument=this,e&&this.removeChild(e),bn(i)&&(this.documentElement=i)},importNode:function(i,e){return l0(this,i,e)},getElementById:function(i){var e=null;return no(this.documentElement,function(t){if(t.nodeType==nn&&t.getAttribute("id")==i)return e=t,!0}),e},getElementsByClassName:function(i){var e=Fp(i);return new Gr(this,function(t){var n=[];return e.length>0&&no(t.documentElement,function(s){if(s!==t&&s.nodeType===nn){var r=s.getAttribute("class");if(r){var a=i===r;if(!a){var o=Fp(r);a=e.every(lC(o))}a&&n.push(s)}}}),n})},createElement:function(i){var e=new qs;e.ownerDocument=this,e.nodeName=i,e.tagName=i,e.localName=i,e.childNodes=new $n;var t=e.attributes=new Al;return t._ownerElement=e,e},createDocumentFragment:function(){var i=new Jl;return i.ownerDocument=this,i.childNodes=new $n,i},createTextNode:function(i){var e=new Ih;return e.ownerDocument=this,e.appendData(i),e},createComment:function(i){var e=new Oh;return e.ownerDocument=this,e.appendData(i),e},createCDATASection:function(i){var e=new Uh;return e.ownerDocument=this,e.appendData(i),e},createProcessingInstruction:function(i,e){var t=new kh;return t.ownerDocument=this,t.tagName=t.nodeName=t.target=i,t.nodeValue=t.data=e,t},createAttribute:function(i){var e=new Ml;return e.ownerDocument=this,e.name=i,e.nodeName=i,e.localName=i,e.specified=!0,e},createEntityReference:function(i){var e=new Nh;return e.ownerDocument=this,e.nodeName=i,e},createElementNS:function(i,e){var t=new qs,n=e.split(":"),s=t.attributes=new Al;return t.childNodes=new $n,t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.namespaceURI=i,n.length==2?(t.prefix=n[0],t.localName=n[1]):t.localName=e,s._ownerElement=t,t},createAttributeNS:function(i,e){var t=new Ml,n=e.split(":");return t.ownerDocument=this,t.nodeName=e,t.name=e,t.namespaceURI=i,t.specified=!0,n.length==2?(t.prefix=n[0],t.localName=n[1]):t.localName=e,t}};Ai(po,mt);function qs(){this._nsMap={}}qs.prototype={nodeType:nn,hasAttribute:function(i){return this.getAttributeNode(i)!=null},getAttribute:function(i){var e=this.getAttributeNode(i);return e&&e.value||""},getAttributeNode:function(i){return this.attributes.getNamedItem(i)},setAttribute:function(i,e){var t=this.ownerDocument.createAttribute(i);t.value=t.nodeValue=""+e,this.setAttributeNode(t)},removeAttribute:function(i){var e=this.getAttributeNode(i);e&&this.removeAttributeNode(e)},appendChild:function(i){return i.nodeType===Kn?this.insertBefore(i,null):gC(this,i)},setAttributeNode:function(i){return this.attributes.setNamedItem(i)},setAttributeNodeNS:function(i){return this.attributes.setNamedItemNS(i)},removeAttributeNode:function(i){return this.attributes.removeNamedItem(i.nodeName)},removeAttributeNS:function(i,e){var t=this.getAttributeNodeNS(i,e);t&&this.removeAttributeNode(t)},hasAttributeNS:function(i,e){return this.getAttributeNodeNS(i,e)!=null},getAttributeNS:function(i,e){var t=this.getAttributeNodeNS(i,e);return t&&t.value||""},setAttributeNS:function(i,e,t){var n=this.ownerDocument.createAttributeNS(i,e);n.value=n.nodeValue=""+t,this.setAttributeNode(n)},getAttributeNodeNS:function(i,e){return this.attributes.getNamedItemNS(i,e)},getElementsByTagName:function(i){return new Gr(this,function(e){var t=[];return no(e,function(n){n!==e&&n.nodeType==nn&&(i==="*"||n.tagName==i)&&t.push(n)}),t})},getElementsByTagNameNS:function(i,e){return new Gr(this,function(t){var n=[];return no(t,function(s){s!==t&&s.nodeType===nn&&(i==="*"||s.namespaceURI===i)&&(e==="*"||s.localName==e)&&n.push(s)}),n})}};po.prototype.getElementsByTagName=qs.prototype.getElementsByTagName;po.prototype.getElementsByTagNameNS=qs.prototype.getElementsByTagNameNS;Ai(qs,mt);function Ml(){}Ml.prototype.nodeType=zr;Ai(Ml,mt);function mo(){}mo.prototype={data:"",substringData:function(i,e){return this.data.substring(i,i+e)},appendData:function(i){i=this.data+i,this.nodeValue=this.data=i,this.length=i.length},insertData:function(i,e){this.replaceData(i,0,e)},appendChild:function(i){throw new Error(Kt[yi])},deleteData:function(i,e){this.replaceData(i,e,"")},replaceData:function(i,e,t){var n=this.data.substring(0,i),s=this.data.substring(i+e);t=n+t+s,this.nodeValue=this.data=t,this.length=t.length}};Ai(mo,mt);function Ih(){}Ih.prototype={nodeName:"#text",nodeType:El,splitText:function(i){var e=this.data,t=e.substring(i);e=e.substring(0,i),this.data=this.nodeValue=e,this.length=e.length;var n=this.ownerDocument.createTextNode(t);return this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling),n}};Ai(Ih,mo);function Oh(){}Oh.prototype={nodeName:"#comment",nodeType:Xg};Ai(Oh,mo);function Uh(){}Uh.prototype={nodeName:"#cdata-section",nodeType:qg};Ai(Uh,mo);function Zl(){}Zl.prototype.nodeType=Yg;Ai(Zl,mt);function s0(){}s0.prototype.nodeType=cC;Ai(s0,mt);function r0(){}r0.prototype.nodeType=uC;Ai(r0,mt);function Nh(){}Nh.prototype.nodeType=$g;Ai(Nh,mt);function Jl(){}Jl.prototype.nodeName="#document-fragment";Jl.prototype.nodeType=Kn;Ai(Jl,mt);function kh(){}kh.prototype.nodeType=jg;Ai(kh,mt);function a0(){}a0.prototype.serializeToString=function(i,e,t){return o0.call(i,e,t)};mt.prototype.toString=o0;function o0(i,e){var t=[],n=this.nodeType==9&&this.documentElement||this,s=n.prefix,r=n.namespaceURI;if(r&&s==null){var s=n.lookupPrefix(r);if(s==null)var a=[{namespace:r,prefix:null}]}return Er(this,t,i,e,a),t.join("")}function Wp(i,e,t){var n=i.prefix||"",s=i.namespaceURI;if(!s||n==="xml"&&s===io.XML||s===io.XMLNS)return!1;for(var r=t.length;r--;){var a=t[r];if(a.prefix===n)return a.namespace!==s}return!0}function pc(i,e,t){i.push(" ",e,'="',t.replace(/[<>&"\t\n\r]/g,e0),'"')}function Er(i,e,t,n,s){if(s||(s=[]),n)if(i=n(i),i){if(typeof i=="string"){e.push(i);return}}else return;switch(i.nodeType){case nn:var r=i.attributes,a=r.length,_=i.firstChild,o=i.tagName;t=io.isHTML(i.namespaceURI)||t;var l=o;if(!t&&!i.prefix&&i.namespaceURI){for(var u,h=0;h<r.length;h++)if(r.item(h).name==="xmlns"){u=r.item(h).value;break}if(!u)for(var d=s.length-1;d>=0;d--){var m=s[d];if(m.prefix===""&&m.namespace===i.namespaceURI){u=m.namespace;break}}if(u!==i.namespaceURI)for(var d=s.length-1;d>=0;d--){var m=s[d];if(m.namespace===i.namespaceURI){m.prefix&&(l=m.prefix+":"+o);break}}}e.push("<",l);for(var y=0;y<a;y++){var v=r.item(y);v.prefix=="xmlns"?s.push({prefix:v.localName,namespace:v.value}):v.nodeName=="xmlns"&&s.push({prefix:"",namespace:v.value})}for(var y=0;y<a;y++){var v=r.item(y);if(Wp(v,t,s)){var b=v.prefix||"",x=v.namespaceURI;pc(e,b?"xmlns:"+b:"xmlns",x),s.push({prefix:b,namespace:x})}Er(v,e,t,n,s)}if(o===l&&Wp(i,t,s)){var b=i.prefix||"",x=i.namespaceURI;pc(e,b?"xmlns:"+b:"xmlns",x),s.push({prefix:b,namespace:x})}if(_||t&&!/^(?:meta|link|img|br|hr|input)$/i.test(o)){if(e.push(">"),t&&/^script$/i.test(o))for(;_;)_.data?e.push(_.data):Er(_,e,t,n,s.slice()),_=_.nextSibling;else for(;_;)Er(_,e,t,n,s.slice()),_=_.nextSibling;e.push("</",l,">")}else e.push("/>");return;case Kg:case Kn:for(var _=i.firstChild;_;)Er(_,e,t,n,s.slice()),_=_.nextSibling;return;case zr:return pc(e,i.name,i.value);case El:return e.push(i.data.replace(/[<&>]/g,e0));case qg:return e.push("<![CDATA[",i.data,"]]>");case Xg:return e.push("<!--",i.data,"-->");case Yg:var E=i.publicId,A=i.systemId;if(e.push("<!DOCTYPE ",i.name),E)e.push(" PUBLIC ",E),A&&A!="."&&e.push(" ",A),e.push(">");else if(A&&A!=".")e.push(" SYSTEM ",A,">");else{var w=i.internalSubset;w&&e.push(" [",w,"]"),e.push(">")}return;case jg:return e.push("<?",i.target," ",i.data,"?>");case $g:return e.push("&",i.nodeName,";");default:e.push("??",i.nodeName)}}function l0(i,e,t){var n;switch(e.nodeType){case nn:n=e.cloneNode(!1),n.ownerDocument=i;case Kn:break;case zr:t=!0;break}if(n||(n=e.cloneNode(!1)),n.ownerDocument=i,n.parentNode=null,t)for(var s=e.firstChild;s;)n.appendChild(l0(i,s,t)),s=s.nextSibling;return n}function zc(i,e,t){var n=new e.constructor;for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var r=e[s];typeof r!="object"&&r!=n[s]&&(n[s]=r)}switch(e.childNodes&&(n.childNodes=new $n),n.ownerDocument=i,n.nodeType){case nn:var a=e.attributes,o=n.attributes=new Al,l=a.length;o._ownerElement=n;for(var u=0;u<l;u++)n.setAttributeNode(zc(i,a.item(u),!0));break;case zr:t=!0}if(t)for(var h=e.firstChild;h;)n.appendChild(zc(i,h,t)),h=h.nextSibling;return n}function u0(i,e,t){i[e]=t}try{if(Object.defineProperty){let i=function(e){switch(e.nodeType){case nn:case Kn:var t=[];for(e=e.firstChild;e;)e.nodeType!==7&&e.nodeType!==8&&t.push(i(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}};Object.defineProperty(Gr.prototype,"length",{get:function(){return Rh(this),this.$$length}}),Object.defineProperty(mt.prototype,"textContent",{get:function(){return i(this)},set:function(e){switch(this.nodeType){case nn:case Kn:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),u0=function(e,t,n){e["$$"+t]=n}}}catch{}ps.DocumentType=Zl;ps.DOMException=It;ps.DOMImplementation=Jg;ps.Element=qs;ps.Node=mt;ps.NodeList=$n;ps.XMLSerializer=a0;var eu={},c0={};(function(i){var e=Zn.freeze;i.XML_ENTITIES=e({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),i.HTML_ENTITIES=e({Aacute:"",aacute:"",Abreve:"",abreve:"",ac:"",acd:"",acE:"",Acirc:"",acirc:"",acute:"",Acy:"",acy:"",AElig:"",aelig:"",af:"",Afr:"",afr:"",Agrave:"",agrave:"",alefsym:"",aleph:"",Alpha:"",alpha:"",Amacr:"",amacr:"",amalg:"",AMP:"&",amp:"&",And:"",and:"",andand:"",andd:"",andslope:"",andv:"",ang:"",ange:"",angle:"",angmsd:"",angmsdaa:"",angmsdab:"",angmsdac:"",angmsdad:"",angmsdae:"",angmsdaf:"",angmsdag:"",angmsdah:"",angrt:"",angrtvb:"",angrtvbd:"",angsph:"",angst:"",angzarr:"",Aogon:"",aogon:"",Aopf:"",aopf:"",ap:"",apacir:"",apE:"",ape:"",apid:"",apos:"'",ApplyFunction:"",approx:"",approxeq:"",Aring:"",aring:"",Ascr:"",ascr:"",Assign:"",ast:"*",asymp:"",asympeq:"",Atilde:"",atilde:"",Auml:"",auml:"",awconint:"",awint:"",backcong:"",backepsilon:"",backprime:"",backsim:"",backsimeq:"",Backslash:"",Barv:"",barvee:"",Barwed:"",barwed:"",barwedge:"",bbrk:"",bbrktbrk:"",bcong:"",Bcy:"",bcy:"",bdquo:"",becaus:"",Because:"",because:"",bemptyv:"",bepsi:"",bernou:"",Bernoullis:"",Beta:"",beta:"",beth:"",between:"",Bfr:"",bfr:"",bigcap:"",bigcirc:"",bigcup:"",bigodot:"",bigoplus:"",bigotimes:"",bigsqcup:"",bigstar:"",bigtriangledown:"",bigtriangleup:"",biguplus:"",bigvee:"",bigwedge:"",bkarow:"",blacklozenge:"",blacksquare:"",blacktriangle:"",blacktriangledown:"",blacktriangleleft:"",blacktriangleright:"",blank:"",blk12:"",blk14:"",blk34:"",block:"",bne:"=",bnequiv:"",bNot:"",bnot:"",Bopf:"",bopf:"",bot:"",bottom:"",bowtie:"",boxbox:"",boxDL:"",boxDl:"",boxdL:"",boxdl:"",boxDR:"",boxDr:"",boxdR:"",boxdr:"",boxH:"",boxh:"",boxHD:"",boxHd:"",boxhD:"",boxhd:"",boxHU:"",boxHu:"",boxhU:"",boxhu:"",boxminus:"",boxplus:"",boxtimes:"",boxUL:"",boxUl:"",boxuL:"",boxul:"",boxUR:"",boxUr:"",boxuR:"",boxur:"",boxV:"",boxv:"",boxVH:"",boxVh:"",boxvH:"",boxvh:"",boxVL:"",boxVl:"",boxvL:"",boxvl:"",boxVR:"",boxVr:"",boxvR:"",boxvr:"",bprime:"",Breve:"",breve:"",brvbar:"",Bscr:"",bscr:"",bsemi:"",bsim:"",bsime:"",bsol:"\\",bsolb:"",bsolhsub:"",bull:"",bullet:"",bump:"",bumpE:"",bumpe:"",Bumpeq:"",bumpeq:"",Cacute:"",cacute:"",Cap:"",cap:"",capand:"",capbrcup:"",capcap:"",capcup:"",capdot:"",CapitalDifferentialD:"",caps:"",caret:"",caron:"",Cayleys:"",ccaps:"",Ccaron:"",ccaron:"",Ccedil:"",ccedil:"",Ccirc:"",ccirc:"",Cconint:"",ccups:"",ccupssm:"",Cdot:"",cdot:"",cedil:"",Cedilla:"",cemptyv:"",cent:"",CenterDot:"",centerdot:"",Cfr:"",cfr:"",CHcy:"",chcy:"",check:"",checkmark:"",Chi:"",chi:"",cir:"",circ:"",circeq:"",circlearrowleft:"",circlearrowright:"",circledast:"",circledcirc:"",circleddash:"",CircleDot:"",circledR:"",circledS:"",CircleMinus:"",CirclePlus:"",CircleTimes:"",cirE:"",cire:"",cirfnint:"",cirmid:"",cirscir:"",ClockwiseContourIntegral:"",CloseCurlyDoubleQuote:"",CloseCurlyQuote:"",clubs:"",clubsuit:"",Colon:"",colon:":",Colone:"",colone:"",coloneq:"",comma:",",commat:"@",comp:"",compfn:"",complement:"",complexes:"",cong:"",congdot:"",Congruent:"",Conint:"",conint:"",ContourIntegral:"",Copf:"",copf:"",coprod:"",Coproduct:"",COPY:"",copy:"",copysr:"",CounterClockwiseContourIntegral:"",crarr:"",Cross:"",cross:"",Cscr:"",cscr:"",csub:"",csube:"",csup:"",csupe:"",ctdot:"",cudarrl:"",cudarrr:"",cuepr:"",cuesc:"",cularr:"",cularrp:"",Cup:"",cup:"",cupbrcap:"",CupCap:"",cupcap:"",cupcup:"",cupdot:"",cupor:"",cups:"",curarr:"",curarrm:"",curlyeqprec:"",curlyeqsucc:"",curlyvee:"",curlywedge:"",curren:"",curvearrowleft:"",curvearrowright:"",cuvee:"",cuwed:"",cwconint:"",cwint:"",cylcty:"",Dagger:"",dagger:"",daleth:"",Darr:"",dArr:"",darr:"",dash:"",Dashv:"",dashv:"",dbkarow:"",dblac:"",Dcaron:"",dcaron:"",Dcy:"",dcy:"",DD:"",dd:"",ddagger:"",ddarr:"",DDotrahd:"",ddotseq:"",deg:"",Del:"",Delta:"",delta:"",demptyv:"",dfisht:"",Dfr:"",dfr:"",dHar:"",dharl:"",dharr:"",DiacriticalAcute:"",DiacriticalDot:"",DiacriticalDoubleAcute:"",DiacriticalGrave:"`",DiacriticalTilde:"",diam:"",Diamond:"",diamond:"",diamondsuit:"",diams:"",die:"",DifferentialD:"",digamma:"",disin:"",div:"",divide:"",divideontimes:"",divonx:"",DJcy:"",djcy:"",dlcorn:"",dlcrop:"",dollar:"$",Dopf:"",dopf:"",Dot:"",dot:"",DotDot:"",doteq:"",doteqdot:"",DotEqual:"",dotminus:"",dotplus:"",dotsquare:"",doublebarwedge:"",DoubleContourIntegral:"",DoubleDot:"",DoubleDownArrow:"",DoubleLeftArrow:"",DoubleLeftRightArrow:"",DoubleLeftTee:"",DoubleLongLeftArrow:"",DoubleLongLeftRightArrow:"",DoubleLongRightArrow:"",DoubleRightArrow:"",DoubleRightTee:"",DoubleUpArrow:"",DoubleUpDownArrow:"",DoubleVerticalBar:"",DownArrow:"",Downarrow:"",downarrow:"",DownArrowBar:"",DownArrowUpArrow:"",DownBreve:"",downdownarrows:"",downharpoonleft:"",downharpoonright:"",DownLeftRightVector:"",DownLeftTeeVector:"",DownLeftVector:"",DownLeftVectorBar:"",DownRightTeeVector:"",DownRightVector:"",DownRightVectorBar:"",DownTee:"",DownTeeArrow:"",drbkarow:"",drcorn:"",drcrop:"",Dscr:"",dscr:"",DScy:"",dscy:"",dsol:"",Dstrok:"",dstrok:"",dtdot:"",dtri:"",dtrif:"",duarr:"",duhar:"",dwangle:"",DZcy:"",dzcy:"",dzigrarr:"",Eacute:"",eacute:"",easter:"",Ecaron:"",ecaron:"",ecir:"",Ecirc:"",ecirc:"",ecolon:"",Ecy:"",ecy:"",eDDot:"",Edot:"",eDot:"",edot:"",ee:"",efDot:"",Efr:"",efr:"",eg:"",Egrave:"",egrave:"",egs:"",egsdot:"",el:"",Element:"",elinters:"",ell:"",els:"",elsdot:"",Emacr:"",emacr:"",empty:"",emptyset:"",EmptySmallSquare:"",emptyv:"",EmptyVerySmallSquare:"",emsp:"",emsp13:"",emsp14:"",ENG:"",eng:"",ensp:"",Eogon:"",eogon:"",Eopf:"",eopf:"",epar:"",eparsl:"",eplus:"",epsi:"",Epsilon:"",epsilon:"",epsiv:"",eqcirc:"",eqcolon:"",eqsim:"",eqslantgtr:"",eqslantless:"",Equal:"",equals:"=",EqualTilde:"",equest:"",Equilibrium:"",equiv:"",equivDD:"",eqvparsl:"",erarr:"",erDot:"",Escr:"",escr:"",esdot:"",Esim:"",esim:"",Eta:"",eta:"",ETH:"",eth:"",Euml:"",euml:"",euro:"",excl:"!",exist:"",Exists:"",expectation:"",ExponentialE:"",exponentiale:"",fallingdotseq:"",Fcy:"",fcy:"",female:"",ffilig:"",fflig:"",ffllig:"",Ffr:"",ffr:"",filig:"",FilledSmallSquare:"",FilledVerySmallSquare:"",fjlig:"fj",flat:"",fllig:"",fltns:"",fnof:"",Fopf:"",fopf:"",ForAll:"",forall:"",fork:"",forkv:"",Fouriertrf:"",fpartint:"",frac12:"",frac13:"",frac14:"",frac15:"",frac16:"",frac18:"",frac23:"",frac25:"",frac34:"",frac35:"",frac38:"",frac45:"",frac56:"",frac58:"",frac78:"",frasl:"",frown:"",Fscr:"",fscr:"",gacute:"",Gamma:"",gamma:"",Gammad:"",gammad:"",gap:"",Gbreve:"",gbreve:"",Gcedil:"",Gcirc:"",gcirc:"",Gcy:"",gcy:"",Gdot:"",gdot:"",gE:"",ge:"",gEl:"",gel:"",geq:"",geqq:"",geqslant:"",ges:"",gescc:"",gesdot:"",gesdoto:"",gesdotol:"",gesl:"",gesles:"",Gfr:"",gfr:"",Gg:"",gg:"",ggg:"",gimel:"",GJcy:"",gjcy:"",gl:"",gla:"",glE:"",glj:"",gnap:"",gnapprox:"",gnE:"",gne:"",gneq:"",gneqq:"",gnsim:"",Gopf:"",gopf:"",grave:"`",GreaterEqual:"",GreaterEqualLess:"",GreaterFullEqual:"",GreaterGreater:"",GreaterLess:"",GreaterSlantEqual:"",GreaterTilde:"",Gscr:"",gscr:"",gsim:"",gsime:"",gsiml:"",Gt:"",GT:">",gt:">",gtcc:"",gtcir:"",gtdot:"",gtlPar:"",gtquest:"",gtrapprox:"",gtrarr:"",gtrdot:"",gtreqless:"",gtreqqless:"",gtrless:"",gtrsim:"",gvertneqq:"",gvnE:"",Hacek:"",hairsp:"",half:"",hamilt:"",HARDcy:"",hardcy:"",hArr:"",harr:"",harrcir:"",harrw:"",Hat:"^",hbar:"",Hcirc:"",hcirc:"",hearts:"",heartsuit:"",hellip:"",hercon:"",Hfr:"",hfr:"",HilbertSpace:"",hksearow:"",hkswarow:"",hoarr:"",homtht:"",hookleftarrow:"",hookrightarrow:"",Hopf:"",hopf:"",horbar:"",HorizontalLine:"",Hscr:"",hscr:"",hslash:"",Hstrok:"",hstrok:"",HumpDownHump:"",HumpEqual:"",hybull:"",hyphen:"",Iacute:"",iacute:"",ic:"",Icirc:"",icirc:"",Icy:"",icy:"",Idot:"",IEcy:"",iecy:"",iexcl:"",iff:"",Ifr:"",ifr:"",Igrave:"",igrave:"",ii:"",iiiint:"",iiint:"",iinfin:"",iiota:"",IJlig:"",ijlig:"",Im:"",Imacr:"",imacr:"",image:"",ImaginaryI:"",imagline:"",imagpart:"",imath:"",imof:"",imped:"",Implies:"",in:"",incare:"",infin:"",infintie:"",inodot:"",Int:"",int:"",intcal:"",integers:"",Integral:"",intercal:"",Intersection:"",intlarhk:"",intprod:"",InvisibleComma:"",InvisibleTimes:"",IOcy:"",iocy:"",Iogon:"",iogon:"",Iopf:"",iopf:"",Iota:"",iota:"",iprod:"",iquest:"",Iscr:"",iscr:"",isin:"",isindot:"",isinE:"",isins:"",isinsv:"",isinv:"",it:"",Itilde:"",itilde:"",Iukcy:"",iukcy:"",Iuml:"",iuml:"",Jcirc:"",jcirc:"",Jcy:"",jcy:"",Jfr:"",jfr:"",jmath:"",Jopf:"",jopf:"",Jscr:"",jscr:"",Jsercy:"",jsercy:"",Jukcy:"",jukcy:"",Kappa:"",kappa:"",kappav:"",Kcedil:"",kcedil:"",Kcy:"",kcy:"",Kfr:"",kfr:"",kgreen:"",KHcy:"",khcy:"",KJcy:"",kjcy:"",Kopf:"",kopf:"",Kscr:"",kscr:"",lAarr:"",Lacute:"",lacute:"",laemptyv:"",lagran:"",Lambda:"",lambda:"",Lang:"",lang:"",langd:"",langle:"",lap:"",Laplacetrf:"",laquo:"",Larr:"",lArr:"",larr:"",larrb:"",larrbfs:"",larrfs:"",larrhk:"",larrlp:"",larrpl:"",larrsim:"",larrtl:"",lat:"",lAtail:"",latail:"",late:"",lates:"",lBarr:"",lbarr:"",lbbrk:"",lbrace:"{",lbrack:"[",lbrke:"",lbrksld:"",lbrkslu:"",Lcaron:"",lcaron:"",Lcedil:"",lcedil:"",lceil:"",lcub:"{",Lcy:"",lcy:"",ldca:"",ldquo:"",ldquor:"",ldrdhar:"",ldrushar:"",ldsh:"",lE:"",le:"",LeftAngleBracket:"",LeftArrow:"",Leftarrow:"",leftarrow:"",LeftArrowBar:"",LeftArrowRightArrow:"",leftarrowtail:"",LeftCeiling:"",LeftDoubleBracket:"",LeftDownTeeVector:"",LeftDownVector:"",LeftDownVectorBar:"",LeftFloor:"",leftharpoondown:"",leftharpoonup:"",leftleftarrows:"",LeftRightArrow:"",Leftrightarrow:"",leftrightarrow:"",leftrightarrows:"",leftrightharpoons:"",leftrightsquigarrow:"",LeftRightVector:"",LeftTee:"",LeftTeeArrow:"",LeftTeeVector:"",leftthreetimes:"",LeftTriangle:"",LeftTriangleBar:"",LeftTriangleEqual:"",LeftUpDownVector:"",LeftUpTeeVector:"",LeftUpVector:"",LeftUpVectorBar:"",LeftVector:"",LeftVectorBar:"",lEg:"",leg:"",leq:"",leqq:"",leqslant:"",les:"",lescc:"",lesdot:"",lesdoto:"",lesdotor:"",lesg:"",lesges:"",lessapprox:"",lessdot:"",lesseqgtr:"",lesseqqgtr:"",LessEqualGreater:"",LessFullEqual:"",LessGreater:"",lessgtr:"",LessLess:"",lesssim:"",LessSlantEqual:"",LessTilde:"",lfisht:"",lfloor:"",Lfr:"",lfr:"",lg:"",lgE:"",lHar:"",lhard:"",lharu:"",lharul:"",lhblk:"",LJcy:"",ljcy:"",Ll:"",ll:"",llarr:"",llcorner:"",Lleftarrow:"",llhard:"",lltri:"",Lmidot:"",lmidot:"",lmoust:"",lmoustache:"",lnap:"",lnapprox:"",lnE:"",lne:"",lneq:"",lneqq:"",lnsim:"",loang:"",loarr:"",lobrk:"",LongLeftArrow:"",Longleftarrow:"",longleftarrow:"",LongLeftRightArrow:"",Longleftrightarrow:"",longleftrightarrow:"",longmapsto:"",LongRightArrow:"",Longrightarrow:"",longrightarrow:"",looparrowleft:"",looparrowright:"",lopar:"",Lopf:"",lopf:"",loplus:"",lotimes:"",lowast:"",lowbar:"_",LowerLeftArrow:"",LowerRightArrow:"",loz:"",lozenge:"",lozf:"",lpar:"(",lparlt:"",lrarr:"",lrcorner:"",lrhar:"",lrhard:"",lrm:"",lrtri:"",lsaquo:"",Lscr:"",lscr:"",Lsh:"",lsh:"",lsim:"",lsime:"",lsimg:"",lsqb:"[",lsquo:"",lsquor:"",Lstrok:"",lstrok:"",Lt:"",LT:"<",lt:"<",ltcc:"",ltcir:"",ltdot:"",lthree:"",ltimes:"",ltlarr:"",ltquest:"",ltri:"",ltrie:"",ltrif:"",ltrPar:"",lurdshar:"",luruhar:"",lvertneqq:"",lvnE:"",macr:"",male:"",malt:"",maltese:"",Map:"",map:"",mapsto:"",mapstodown:"",mapstoleft:"",mapstoup:"",marker:"",mcomma:"",Mcy:"",mcy:"",mdash:"",mDDot:"",measuredangle:"",MediumSpace:"",Mellintrf:"",Mfr:"",mfr:"",mho:"",micro:"",mid:"",midast:"*",midcir:"",middot:"",minus:"",minusb:"",minusd:"",minusdu:"",MinusPlus:"",mlcp:"",mldr:"",mnplus:"",models:"",Mopf:"",mopf:"",mp:"",Mscr:"",mscr:"",mstpos:"",Mu:"",mu:"",multimap:"",mumap:"",nabla:"",Nacute:"",nacute:"",nang:"",nap:"",napE:"",napid:"",napos:"",napprox:"",natur:"",natural:"",naturals:"",nbsp:"",nbump:"",nbumpe:"",ncap:"",Ncaron:"",ncaron:"",Ncedil:"",ncedil:"",ncong:"",ncongdot:"",ncup:"",Ncy:"",ncy:"",ndash:"",ne:"",nearhk:"",neArr:"",nearr:"",nearrow:"",nedot:"",NegativeMediumSpace:"",NegativeThickSpace:"",NegativeThinSpace:"",NegativeVeryThinSpace:"",nequiv:"",nesear:"",nesim:"",NestedGreaterGreater:"",NestedLessLess:"",NewLine:`
`,nexist:"",nexists:"",Nfr:"",nfr:"",ngE:"",nge:"",ngeq:"",ngeqq:"",ngeqslant:"",nges:"",nGg:"",ngsim:"",nGt:"",ngt:"",ngtr:"",nGtv:"",nhArr:"",nharr:"",nhpar:"",ni:"",nis:"",nisd:"",niv:"",NJcy:"",njcy:"",nlArr:"",nlarr:"",nldr:"",nlE:"",nle:"",nLeftarrow:"",nleftarrow:"",nLeftrightarrow:"",nleftrightarrow:"",nleq:"",nleqq:"",nleqslant:"",nles:"",nless:"",nLl:"",nlsim:"",nLt:"",nlt:"",nltri:"",nltrie:"",nLtv:"",nmid:"",NoBreak:"",NonBreakingSpace:"",Nopf:"",nopf:"",Not:"",not:"",NotCongruent:"",NotCupCap:"",NotDoubleVerticalBar:"",NotElement:"",NotEqual:"",NotEqualTilde:"",NotExists:"",NotGreater:"",NotGreaterEqual:"",NotGreaterFullEqual:"",NotGreaterGreater:"",NotGreaterLess:"",NotGreaterSlantEqual:"",NotGreaterTilde:"",NotHumpDownHump:"",NotHumpEqual:"",notin:"",notindot:"",notinE:"",notinva:"",notinvb:"",notinvc:"",NotLeftTriangle:"",NotLeftTriangleBar:"",NotLeftTriangleEqual:"",NotLess:"",NotLessEqual:"",NotLessGreater:"",NotLessLess:"",NotLessSlantEqual:"",NotLessTilde:"",NotNestedGreaterGreater:"",NotNestedLessLess:"",notni:"",notniva:"",notnivb:"",notnivc:"",NotPrecedes:"",NotPrecedesEqual:"",NotPrecedesSlantEqual:"",NotReverseElement:"",NotRightTriangle:"",NotRightTriangleBar:"",NotRightTriangleEqual:"",NotSquareSubset:"",NotSquareSubsetEqual:"",NotSquareSuperset:"",NotSquareSupersetEqual:"",NotSubset:"",NotSubsetEqual:"",NotSucceeds:"",NotSucceedsEqual:"",NotSucceedsSlantEqual:"",NotSucceedsTilde:"",NotSuperset:"",NotSupersetEqual:"",NotTilde:"",NotTildeEqual:"",NotTildeFullEqual:"",NotTildeTilde:"",NotVerticalBar:"",npar:"",nparallel:"",nparsl:"",npart:"",npolint:"",npr:"",nprcue:"",npre:"",nprec:"",npreceq:"",nrArr:"",nrarr:"",nrarrc:"",nrarrw:"",nRightarrow:"",nrightarrow:"",nrtri:"",nrtrie:"",nsc:"",nsccue:"",nsce:"",Nscr:"",nscr:"",nshortmid:"",nshortparallel:"",nsim:"",nsime:"",nsimeq:"",nsmid:"",nspar:"",nsqsube:"",nsqsupe:"",nsub:"",nsubE:"",nsube:"",nsubset:"",nsubseteq:"",nsubseteqq:"",nsucc:"",nsucceq:"",nsup:"",nsupE:"",nsupe:"",nsupset:"",nsupseteq:"",nsupseteqq:"",ntgl:"",Ntilde:"",ntilde:"",ntlg:"",ntriangleleft:"",ntrianglelefteq:"",ntriangleright:"",ntrianglerighteq:"",Nu:"",nu:"",num:"#",numero:"",numsp:"",nvap:"",nVDash:"",nVdash:"",nvDash:"",nvdash:"",nvge:"",nvgt:">",nvHarr:"",nvinfin:"",nvlArr:"",nvle:"",nvlt:"<",nvltrie:"",nvrArr:"",nvrtrie:"",nvsim:"",nwarhk:"",nwArr:"",nwarr:"",nwarrow:"",nwnear:"",Oacute:"",oacute:"",oast:"",ocir:"",Ocirc:"",ocirc:"",Ocy:"",ocy:"",odash:"",Odblac:"",odblac:"",odiv:"",odot:"",odsold:"",OElig:"",oelig:"",ofcir:"",Ofr:"",ofr:"",ogon:"",Ograve:"",ograve:"",ogt:"",ohbar:"",ohm:"",oint:"",olarr:"",olcir:"",olcross:"",oline:"",olt:"",Omacr:"",omacr:"",Omega:"",omega:"",Omicron:"",omicron:"",omid:"",ominus:"",Oopf:"",oopf:"",opar:"",OpenCurlyDoubleQuote:"",OpenCurlyQuote:"",operp:"",oplus:"",Or:"",or:"",orarr:"",ord:"",order:"",orderof:"",ordf:"",ordm:"",origof:"",oror:"",orslope:"",orv:"",oS:"",Oscr:"",oscr:"",Oslash:"",oslash:"",osol:"",Otilde:"",otilde:"",Otimes:"",otimes:"",otimesas:"",Ouml:"",ouml:"",ovbar:"",OverBar:"",OverBrace:"",OverBracket:"",OverParenthesis:"",par:"",para:"",parallel:"",parsim:"",parsl:"",part:"",PartialD:"",Pcy:"",pcy:"",percnt:"%",period:".",permil:"",perp:"",pertenk:"",Pfr:"",pfr:"",Phi:"",phi:"",phiv:"",phmmat:"",phone:"",Pi:"",pi:"",pitchfork:"",piv:"",planck:"",planckh:"",plankv:"",plus:"+",plusacir:"",plusb:"",pluscir:"",plusdo:"",plusdu:"",pluse:"",PlusMinus:"",plusmn:"",plussim:"",plustwo:"",pm:"",Poincareplane:"",pointint:"",Popf:"",popf:"",pound:"",Pr:"",pr:"",prap:"",prcue:"",prE:"",pre:"",prec:"",precapprox:"",preccurlyeq:"",Precedes:"",PrecedesEqual:"",PrecedesSlantEqual:"",PrecedesTilde:"",preceq:"",precnapprox:"",precneqq:"",precnsim:"",precsim:"",Prime:"",prime:"",primes:"",prnap:"",prnE:"",prnsim:"",prod:"",Product:"",profalar:"",profline:"",profsurf:"",prop:"",Proportion:"",Proportional:"",propto:"",prsim:"",prurel:"",Pscr:"",pscr:"",Psi:"",psi:"",puncsp:"",Qfr:"",qfr:"",qint:"",Qopf:"",qopf:"",qprime:"",Qscr:"",qscr:"",quaternions:"",quatint:"",quest:"?",questeq:"",QUOT:'"',quot:'"',rAarr:"",race:"",Racute:"",racute:"",radic:"",raemptyv:"",Rang:"",rang:"",rangd:"",range:"",rangle:"",raquo:"",Rarr:"",rArr:"",rarr:"",rarrap:"",rarrb:"",rarrbfs:"",rarrc:"",rarrfs:"",rarrhk:"",rarrlp:"",rarrpl:"",rarrsim:"",Rarrtl:"",rarrtl:"",rarrw:"",rAtail:"",ratail:"",ratio:"",rationals:"",RBarr:"",rBarr:"",rbarr:"",rbbrk:"",rbrace:"}",rbrack:"]",rbrke:"",rbrksld:"",rbrkslu:"",Rcaron:"",rcaron:"",Rcedil:"",rcedil:"",rceil:"",rcub:"}",Rcy:"",rcy:"",rdca:"",rdldhar:"",rdquo:"",rdquor:"",rdsh:"",Re:"",real:"",realine:"",realpart:"",reals:"",rect:"",REG:"",reg:"",ReverseElement:"",ReverseEquilibrium:"",ReverseUpEquilibrium:"",rfisht:"",rfloor:"",Rfr:"",rfr:"",rHar:"",rhard:"",rharu:"",rharul:"",Rho:"",rho:"",rhov:"",RightAngleBracket:"",RightArrow:"",Rightarrow:"",rightarrow:"",RightArrowBar:"",RightArrowLeftArrow:"",rightarrowtail:"",RightCeiling:"",RightDoubleBracket:"",RightDownTeeVector:"",RightDownVector:"",RightDownVectorBar:"",RightFloor:"",rightharpoondown:"",rightharpoonup:"",rightleftarrows:"",rightleftharpoons:"",rightrightarrows:"",rightsquigarrow:"",RightTee:"",RightTeeArrow:"",RightTeeVector:"",rightthreetimes:"",RightTriangle:"",RightTriangleBar:"",RightTriangleEqual:"",RightUpDownVector:"",RightUpTeeVector:"",RightUpVector:"",RightUpVectorBar:"",RightVector:"",RightVectorBar:"",ring:"",risingdotseq:"",rlarr:"",rlhar:"",rlm:"",rmoust:"",rmoustache:"",rnmid:"",roang:"",roarr:"",robrk:"",ropar:"",Ropf:"",ropf:"",roplus:"",rotimes:"",RoundImplies:"",rpar:")",rpargt:"",rppolint:"",rrarr:"",Rrightarrow:"",rsaquo:"",Rscr:"",rscr:"",Rsh:"",rsh:"",rsqb:"]",rsquo:"",rsquor:"",rthree:"",rtimes:"",rtri:"",rtrie:"",rtrif:"",rtriltri:"",RuleDelayed:"",ruluhar:"",rx:"",Sacute:"",sacute:"",sbquo:"",Sc:"",sc:"",scap:"",Scaron:"",scaron:"",sccue:"",scE:"",sce:"",Scedil:"",scedil:"",Scirc:"",scirc:"",scnap:"",scnE:"",scnsim:"",scpolint:"",scsim:"",Scy:"",scy:"",sdot:"",sdotb:"",sdote:"",searhk:"",seArr:"",searr:"",searrow:"",sect:"",semi:";",seswar:"",setminus:"",setmn:"",sext:"",Sfr:"",sfr:"",sfrown:"",sharp:"",SHCHcy:"",shchcy:"",SHcy:"",shcy:"",ShortDownArrow:"",ShortLeftArrow:"",shortmid:"",shortparallel:"",ShortRightArrow:"",ShortUpArrow:"",shy:"",Sigma:"",sigma:"",sigmaf:"",sigmav:"",sim:"",simdot:"",sime:"",simeq:"",simg:"",simgE:"",siml:"",simlE:"",simne:"",simplus:"",simrarr:"",slarr:"",SmallCircle:"",smallsetminus:"",smashp:"",smeparsl:"",smid:"",smile:"",smt:"",smte:"",smtes:"",SOFTcy:"",softcy:"",sol:"/",solb:"",solbar:"",Sopf:"",sopf:"",spades:"",spadesuit:"",spar:"",sqcap:"",sqcaps:"",sqcup:"",sqcups:"",Sqrt:"",sqsub:"",sqsube:"",sqsubset:"",sqsubseteq:"",sqsup:"",sqsupe:"",sqsupset:"",sqsupseteq:"",squ:"",Square:"",square:"",SquareIntersection:"",SquareSubset:"",SquareSubsetEqual:"",SquareSuperset:"",SquareSupersetEqual:"",SquareUnion:"",squarf:"",squf:"",srarr:"",Sscr:"",sscr:"",ssetmn:"",ssmile:"",sstarf:"",Star:"",star:"",starf:"",straightepsilon:"",straightphi:"",strns:"",Sub:"",sub:"",subdot:"",subE:"",sube:"",subedot:"",submult:"",subnE:"",subne:"",subplus:"",subrarr:"",Subset:"",subset:"",subseteq:"",subseteqq:"",SubsetEqual:"",subsetneq:"",subsetneqq:"",subsim:"",subsub:"",subsup:"",succ:"",succapprox:"",succcurlyeq:"",Succeeds:"",SucceedsEqual:"",SucceedsSlantEqual:"",SucceedsTilde:"",succeq:"",succnapprox:"",succneqq:"",succnsim:"",succsim:"",SuchThat:"",Sum:"",sum:"",sung:"",Sup:"",sup:"",sup1:"",sup2:"",sup3:"",supdot:"",supdsub:"",supE:"",supe:"",supedot:"",Superset:"",SupersetEqual:"",suphsol:"",suphsub:"",suplarr:"",supmult:"",supnE:"",supne:"",supplus:"",Supset:"",supset:"",supseteq:"",supseteqq:"",supsetneq:"",supsetneqq:"",supsim:"",supsub:"",supsup:"",swarhk:"",swArr:"",swarr:"",swarrow:"",swnwar:"",szlig:"",Tab:"	",target:"",Tau:"",tau:"",tbrk:"",Tcaron:"",tcaron:"",Tcedil:"",tcedil:"",Tcy:"",tcy:"",tdot:"",telrec:"",Tfr:"",tfr:"",there4:"",Therefore:"",therefore:"",Theta:"",theta:"",thetasym:"",thetav:"",thickapprox:"",thicksim:"",ThickSpace:"",thinsp:"",ThinSpace:"",thkap:"",thksim:"",THORN:"",thorn:"",Tilde:"",tilde:"",TildeEqual:"",TildeFullEqual:"",TildeTilde:"",times:"",timesb:"",timesbar:"",timesd:"",tint:"",toea:"",top:"",topbot:"",topcir:"",Topf:"",topf:"",topfork:"",tosa:"",tprime:"",TRADE:"",trade:"",triangle:"",triangledown:"",triangleleft:"",trianglelefteq:"",triangleq:"",triangleright:"",trianglerighteq:"",tridot:"",trie:"",triminus:"",TripleDot:"",triplus:"",trisb:"",tritime:"",trpezium:"",Tscr:"",tscr:"",TScy:"",tscy:"",TSHcy:"",tshcy:"",Tstrok:"",tstrok:"",twixt:"",twoheadleftarrow:"",twoheadrightarrow:"",Uacute:"",uacute:"",Uarr:"",uArr:"",uarr:"",Uarrocir:"",Ubrcy:"",ubrcy:"",Ubreve:"",ubreve:"",Ucirc:"",ucirc:"",Ucy:"",ucy:"",udarr:"",Udblac:"",udblac:"",udhar:"",ufisht:"",Ufr:"",ufr:"",Ugrave:"",ugrave:"",uHar:"",uharl:"",uharr:"",uhblk:"",ulcorn:"",ulcorner:"",ulcrop:"",ultri:"",Umacr:"",umacr:"",uml:"",UnderBar:"_",UnderBrace:"",UnderBracket:"",UnderParenthesis:"",Union:"",UnionPlus:"",Uogon:"",uogon:"",Uopf:"",uopf:"",UpArrow:"",Uparrow:"",uparrow:"",UpArrowBar:"",UpArrowDownArrow:"",UpDownArrow:"",Updownarrow:"",updownarrow:"",UpEquilibrium:"",upharpoonleft:"",upharpoonright:"",uplus:"",UpperLeftArrow:"",UpperRightArrow:"",Upsi:"",upsi:"",upsih:"",Upsilon:"",upsilon:"",UpTee:"",UpTeeArrow:"",upuparrows:"",urcorn:"",urcorner:"",urcrop:"",Uring:"",uring:"",urtri:"",Uscr:"",uscr:"",utdot:"",Utilde:"",utilde:"",utri:"",utrif:"",uuarr:"",Uuml:"",uuml:"",uwangle:"",vangrt:"",varepsilon:"",varkappa:"",varnothing:"",varphi:"",varpi:"",varpropto:"",vArr:"",varr:"",varrho:"",varsigma:"",varsubsetneq:"",varsubsetneqq:"",varsupsetneq:"",varsupsetneqq:"",vartheta:"",vartriangleleft:"",vartriangleright:"",Vbar:"",vBar:"",vBarv:"",Vcy:"",vcy:"",VDash:"",Vdash:"",vDash:"",vdash:"",Vdashl:"",Vee:"",vee:"",veebar:"",veeeq:"",vellip:"",Verbar:"",verbar:"|",Vert:"",vert:"|",VerticalBar:"",VerticalLine:"|",VerticalSeparator:"",VerticalTilde:"",VeryThinSpace:"",Vfr:"",vfr:"",vltri:"",vnsub:"",vnsup:"",Vopf:"",vopf:"",vprop:"",vrtri:"",Vscr:"",vscr:"",vsubnE:"",vsubne:"",vsupnE:"",vsupne:"",Vvdash:"",vzigzag:"",Wcirc:"",wcirc:"",wedbar:"",Wedge:"",wedge:"",wedgeq:"",weierp:"",Wfr:"",wfr:"",Wopf:"",wopf:"",wp:"",wr:"",wreath:"",Wscr:"",wscr:"",xcap:"",xcirc:"",xcup:"",xdtri:"",Xfr:"",xfr:"",xhArr:"",xharr:"",Xi:"",xi:"",xlArr:"",xlarr:"",xmap:"",xnis:"",xodot:"",Xopf:"",xopf:"",xoplus:"",xotime:"",xrArr:"",xrarr:"",Xscr:"",xscr:"",xsqcup:"",xuplus:"",xutri:"",xvee:"",xwedge:"",Yacute:"",yacute:"",YAcy:"",yacy:"",Ycirc:"",ycirc:"",Ycy:"",ycy:"",yen:"",Yfr:"",yfr:"",YIcy:"",yicy:"",Yopf:"",yopf:"",Yscr:"",yscr:"",YUcy:"",yucy:"",Yuml:"",yuml:"",Zacute:"",zacute:"",Zcaron:"",zcaron:"",Zcy:"",zcy:"",Zdot:"",zdot:"",zeetrf:"",ZeroWidthSpace:"",Zeta:"",zeta:"",Zfr:"",zfr:"",ZHcy:"",zhcy:"",zigrarr:"",Zopf:"",zopf:"",Zscr:"",zscr:"",zwj:"",zwnj:""}),i.entityMap=i.HTML_ENTITIES})(c0);var Fh={},so=Zn.NAMESPACE,Gc=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,qp=new RegExp("[\\-\\.0-9"+Gc.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),$p=new RegExp("^"+Gc.source+qp.source+"*(?::"+Gc.source+qp.source+"*)?$"),Ca=0,as=1,gr=2,Ma=3,_r=4,vr=5,wa=6,ol=7;function Wr(i,e){this.message=i,this.locator=e,Error.captureStackTrace&&Error.captureStackTrace(this,Wr)}Wr.prototype=new Error;Wr.prototype.name=Wr.name;function h0(){}h0.prototype={parse:function(i,e,t){var n=this.domBuilder;n.startDocument(),d0(e,e={}),_C(i,e,t,n,this.errorHandler),n.endDocument()}};function _C(i,e,t,n,s){function r(le){if(le>65535){le-=65536;var ie=55296+(le>>10),ue=56320+(le&1023);return String.fromCharCode(ie,ue)}else return String.fromCharCode(le)}function a(le){var ie=le.slice(1,-1);return Object.hasOwnProperty.call(t,ie)?t[ie]:ie.charAt(0)==="#"?r(parseInt(ie.substr(1).replace("x","0x"))):(s.error("entity not found:"+le),le)}function o(le){if(le>b){var ie=i.substring(b,le).replace(/&#?\w+;/g,a);m&&l(b),n.characters(ie,0,le-b),b=le}}function l(le,ie){for(;le>=h&&(ie=d.exec(i));)u=ie.index,h=u+ie[0].length,m.lineNumber++;m.columnNumber=le-u+1}for(var u=0,h=0,d=/.*(?:\r\n?|\n)|.*$/g,m=n.locator,y=[{currentNSMap:e}],v={},b=0;;){try{var x=i.indexOf("<",b);if(x<0){if(!i.substr(b).match(/^\s*$/)){var _=n.doc,E=_.createTextNode(i.substr(b));_.appendChild(E),n.currentElement=E}return}switch(x>b&&o(x),i.charAt(x+1)){case"/":var Q=i.indexOf(">",x+3),A=i.substring(x+2,Q).replace(/[ \t\n\r]+$/g,""),w=y.pop();Q<0?(A=i.substring(x+2).replace(/[\s<].*/,""),s.error("end tag name: "+A+" is not complete:"+w.tagName),Q=x+1+A.length):A.match(/\s</)&&(A=A.replace(/[\s<].*/,""),s.error("end tag name: "+A+" maybe not complete"),Q=x+1+A.length);var C=w.localNSMap,I=w.tagName==A,B=I||w.tagName&&w.tagName.toLowerCase()==A.toLowerCase();if(B){if(n.endElement(w.uri,w.localName,A),C)for(var X in C)Object.prototype.hasOwnProperty.call(C,X)&&n.endPrefixMapping(X);I||s.fatalError("end tag name: "+A+" is not match the current start tagName:"+w.tagName)}else y.push(w);Q++;break;case"?":m&&l(x),Q=SC(i,x,n);break;case"!":m&&l(x),Q=xC(i,x,n,s);break;default:m&&l(x);var M=new f0,F=y[y.length-1].currentNSMap,Q=vC(i,x,M,F,a,s),oe=M.length;if(!M.closed&&TC(i,Q,M.tagName,v)&&(M.closed=!0,t.nbsp||s.warning("unclosed xml attribute")),m&&oe){for(var H=jp(m,{}),$=0;$<oe;$++){var Z=M[$];l(Z.offset),Z.locator=jp(m,{})}n.locator=H,Xp(M,n,F)&&y.push(M),n.locator=m}else Xp(M,n,F)&&y.push(M);so.isHTML(M.uri)&&!M.closed?Q=yC(i,Q,M.tagName,a,n):Q++}}catch(le){if(le instanceof Wr)throw le;s.error("element parse error: "+le),Q=-1}Q>b?b=Q:o(Math.max(x,b)+1)}}function jp(i,e){return e.lineNumber=i.lineNumber,e.columnNumber=i.columnNumber,e}function vC(i,e,t,n,s,r){function a(m,y,v){t.attributeNames.hasOwnProperty(m)&&r.fatalError("Attribute "+m+" redefined"),t.addValue(m,y.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,s),v)}for(var o,l,u=++e,h=Ca;;){var d=i.charAt(u);switch(d){case"=":if(h===as)o=i.slice(e,u),h=Ma;else if(h===gr)h=Ma;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(h===Ma||h===as)if(h===as&&(r.warning('attribute value must after "="'),o=i.slice(e,u)),e=u+1,u=i.indexOf(d,e),u>0)l=i.slice(e,u),a(o,l,e-1),h=vr;else throw new Error("attribute value no end '"+d+"' match");else if(h==_r)l=i.slice(e,u),a(o,l,e),r.warning('attribute "'+o+'" missed start quot('+d+")!!"),e=u+1,h=vr;else throw new Error('attribute value must after "="');break;case"/":switch(h){case Ca:t.setTagName(i.slice(e,u));case vr:case wa:case ol:h=ol,t.closed=!0;case _r:case as:break;case gr:t.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return r.error("unexpected end of input"),h==Ca&&t.setTagName(i.slice(e,u)),u;case">":switch(h){case Ca:t.setTagName(i.slice(e,u));case vr:case wa:case ol:break;case _r:case as:l=i.slice(e,u),l.slice(-1)==="/"&&(t.closed=!0,l=l.slice(0,-1));case gr:h===gr&&(l=o),h==_r?(r.warning('attribute "'+l+'" missed quot(")!'),a(o,l,e)):((!so.isHTML(n[""])||!l.match(/^(?:disabled|checked|selected)$/i))&&r.warning('attribute "'+l+'" missed value!! "'+l+'" instead!!'),a(l,l,e));break;case Ma:throw new Error("attribute value missed!!")}return u;case"":d=" ";default:if(d<=" ")switch(h){case Ca:t.setTagName(i.slice(e,u)),h=wa;break;case as:o=i.slice(e,u),h=gr;break;case _r:var l=i.slice(e,u);r.warning('attribute "'+l+'" missed quot(")!!'),a(o,l,e);case vr:h=wa;break}else switch(h){case gr:t.tagName,(!so.isHTML(n[""])||!o.match(/^(?:disabled|checked|selected)$/i))&&r.warning('attribute "'+o+'" missed value!! "'+o+'" instead2!!'),a(o,o,e),e=u,h=as;break;case vr:r.warning('attribute space is required"'+o+'"!!');case wa:h=as,e=u;break;case Ma:h=_r,e=u;break;case ol:throw new Error("elements closed character '/' and '>' must be connected to")}}u++}}function Xp(i,e,t){for(var n=i.tagName,s=null,d=i.length;d--;){var r=i[d],a=r.qName,o=r.value,m=a.indexOf(":");if(m>0)var l=r.prefix=a.slice(0,m),u=a.slice(m+1),h=l==="xmlns"&&u;else u=a,l=null,h=a==="xmlns"&&"";r.localName=u,h!==!1&&(s==null&&(s={},d0(t,t={})),t[h]=s[h]=o,r.uri=so.XMLNS,e.startPrefixMapping(h,o))}for(var d=i.length;d--;){r=i[d];var l=r.prefix;l&&(l==="xml"&&(r.uri=so.XML),l!=="xmlns"&&(r.uri=t[l||""]))}var m=n.indexOf(":");m>0?(l=i.prefix=n.slice(0,m),u=i.localName=n.slice(m+1)):(l=null,u=i.localName=n);var y=i.uri=t[l||""];if(e.startElement(y,u,n,i),i.closed){if(e.endElement(y,u,n),s)for(l in s)Object.prototype.hasOwnProperty.call(s,l)&&e.endPrefixMapping(l)}else return i.currentNSMap=t,i.localNSMap=s,!0}function yC(i,e,t,n,s){if(/^(?:script|textarea)$/i.test(t)){var r=i.indexOf("</"+t+">",e),a=i.substring(e+1,r);if(/[&<]/.test(a))return/^script$/i.test(t)?(s.characters(a,0,a.length),r):(a=a.replace(/&#?\w+;/g,n),s.characters(a,0,a.length),r)}return e+1}function TC(i,e,t,n){var s=n[t];return s==null&&(s=i.lastIndexOf("</"+t+">"),s<e&&(s=i.lastIndexOf("</"+t)),n[t]=s),s<e}function d0(i,e){for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}function xC(i,e,t,n){var s=i.charAt(e+2);switch(s){case"-":if(i.charAt(e+3)==="-"){var r=i.indexOf("-->",e+4);return r>e?(t.comment(i,e+4,r-e-4),r+3):(n.error("Unclosed comment"),-1)}else return-1;default:if(i.substr(e+3,6)=="CDATA["){var r=i.indexOf("]]>",e+9);return t.startCDATA(),t.characters(i,e+9,r-e-9),t.endCDATA(),r+3}var a=bC(i,e),o=a.length;if(o>1&&/!doctype/i.test(a[0][0])){var l=a[1][0],u=!1,h=!1;o>3&&(/^public$/i.test(a[2][0])?(u=a[3][0],h=o>4&&a[4][0]):/^system$/i.test(a[2][0])&&(h=a[3][0]));var d=a[o-1];return t.startDTD(l,u,h),t.endDTD(),d.index+d[0].length}}return-1}function SC(i,e,t){var n=i.indexOf("?>",e);if(n){var s=i.substring(e,n).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return s?(s[0].length,t.processingInstruction(s[1],s[2]),n+2):-1}return-1}function f0(){this.attributeNames={}}f0.prototype={setTagName:function(i){if(!$p.test(i))throw new Error("invalid tagName:"+i);this.tagName=i},addValue:function(i,e,t){if(!$p.test(i))throw new Error("invalid attribute:"+i);this.attributeNames[i]=this.length,this[this.length++]={qName:i,value:e,offset:t}},length:0,getLocalName:function(i){return this[i].localName},getLocator:function(i){return this[i].locator},getQName:function(i){return this[i].qName},getURI:function(i){return this[i].uri},getValue:function(i){return this[i].value}};function bC(i,e){var t,n=[],s=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(s.lastIndex=e,s.exec(i);t=s.exec(i);)if(n.push(t),t[1])return n}Fh.XMLReader=h0;Fh.ParseError=Wr;var EC=Zn,AC=ps,Kp=c0,p0=Fh,CC=AC.DOMImplementation,Yp=EC.NAMESPACE,MC=p0.ParseError,wC=p0.XMLReader;function m0(i){return i.replace(/\r[\n\u0085]/g,`
`).replace(/[\r\u0085\u2028]/g,`
`)}function g0(i){this.options=i||{locator:{}}}g0.prototype.parseFromString=function(i,e){var t=this.options,n=new wC,s=t.domBuilder||new go,r=t.errorHandler,a=t.locator,o=t.xmlns||{},l=/\/x?html?$/.test(e),u=l?Kp.HTML_ENTITIES:Kp.XML_ENTITIES;a&&s.setDocumentLocator(a),n.errorHandler=DC(r,s,a),n.domBuilder=t.domBuilder||s,l&&(o[""]=Yp.HTML),o.xml=o.xml||Yp.XML;var h=t.normalizeLineEndings||m0;return i&&typeof i=="string"?n.parse(h(i),o,u):n.errorHandler.error("invalid doc source"),s.doc};function DC(i,e,t){if(!i){if(e instanceof go)return e;i=e}var n={},s=i instanceof Function;t=t||{};function r(a){var o=i[a];!o&&s&&(o=i.length==2?function(l){i(a,l)}:i),n[a]=o&&function(l){o("[xmldom "+a+"]	"+l+Wc(t))}||function(){}}return r("warning"),r("error"),r("fatalError"),n}function go(){this.cdata=!1}function yr(i,e){e.lineNumber=i.lineNumber,e.columnNumber=i.columnNumber}go.prototype={startDocument:function(){this.doc=new CC().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(i,e,t,n){var s=this.doc,r=s.createElementNS(i,t||e),a=n.length;ll(this,r),this.currentElement=r,this.locator&&yr(this.locator,r);for(var o=0;o<a;o++){var i=n.getURI(o),l=n.getValue(o),t=n.getQName(o),u=s.createAttributeNS(i,t);this.locator&&yr(n.getLocator(o),u),u.value=u.nodeValue=l,r.setAttributeNode(u)}},endElement:function(i,e,t){var n=this.currentElement;n.tagName,this.currentElement=n.parentNode},startPrefixMapping:function(i,e){},endPrefixMapping:function(i){},processingInstruction:function(i,e){var t=this.doc.createProcessingInstruction(i,e);this.locator&&yr(this.locator,t),ll(this,t)},ignorableWhitespace:function(i,e,t){},characters:function(i,e,t){if(i=Qp.apply(this,arguments),i){if(this.cdata)var n=this.doc.createCDATASection(i);else var n=this.doc.createTextNode(i);this.currentElement?this.currentElement.appendChild(n):/^\s*$/.test(i)&&this.doc.appendChild(n),this.locator&&yr(this.locator,n)}},skippedEntity:function(i){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(i){(this.locator=i)&&(i.lineNumber=0)},comment:function(i,e,t){i=Qp.apply(this,arguments);var n=this.doc.createComment(i);this.locator&&yr(this.locator,n),ll(this,n)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(i,e,t){var n=this.doc.implementation;if(n&&n.createDocumentType){var s=n.createDocumentType(i,e,t);this.locator&&yr(this.locator,s),ll(this,s),this.doc.doctype=s}},warning:function(i){console.warn("[xmldom warning]	"+i,Wc(this.locator))},error:function(i){console.error("[xmldom error]	"+i,Wc(this.locator))},fatalError:function(i){throw new MC(i,this.locator)}};function Wc(i){if(i)return`
@`+(i.systemId||"")+"#[line:"+i.lineNumber+",col:"+i.columnNumber+"]"}function Qp(i,e,t){return typeof i=="string"?i.substr(e,t):i.length>=e+t||e?new java.lang.String(i,e,t)+"":i}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(i){go.prototype[i]=function(){return null}});function ll(i,e){i.currentElement?i.currentElement.appendChild(e):i.doc.appendChild(e)}eu.__DOMHandler=go;eu.normalizeLineEndings=m0;eu.DOMParser=g0;var RC=eu.DOMParser;/*! @name mpd-parser @version 1.3.0 @license Apache-2.0 */const Zp=i=>!!i&&typeof i=="object",Xt=(...i)=>i.reduce((e,t)=>(typeof t!="object"||Object.keys(t).forEach(n=>{Array.isArray(e[n])&&Array.isArray(t[n])?e[n]=e[n].concat(t[n]):Zp(e[n])&&Zp(t[n])?e[n]=Xt(e[n],t[n]):e[n]=t[n]}),e),{}),_0=i=>Object.keys(i).map(e=>i[e]),PC=(i,e)=>{const t=[];for(let n=i;n<e;n++)t.push(n);return t},qr=i=>i.reduce((e,t)=>e.concat(t),[]),v0=i=>{if(!i.length)return[];const e=[];for(let t=0;t<i.length;t++)e.push(i[t]);return e},LC=(i,e)=>i.reduce((t,n,s)=>(n[e]&&t.push(s),t),[]),IC=(i,e)=>_0(i.reduce((t,n)=>(n.forEach(s=>{t[e(s)]=s}),t),{}));var $r={INVALID_NUMBER_OF_PERIOD:"INVALID_NUMBER_OF_PERIOD",INVALID_NUMBER_OF_CONTENT_STEERING:"INVALID_NUMBER_OF_CONTENT_STEERING",DASH_EMPTY_MANIFEST:"DASH_EMPTY_MANIFEST",DASH_INVALID_XML:"DASH_INVALID_XML",NO_BASE_URL:"NO_BASE_URL",MISSING_SEGMENT_INFORMATION:"MISSING_SEGMENT_INFORMATION",SEGMENT_TIME_UNSPECIFIED:"SEGMENT_TIME_UNSPECIFIED",UNSUPPORTED_UTC_TIMING_SCHEME:"UNSUPPORTED_UTC_TIMING_SCHEME"};const ro=({baseUrl:i="",source:e="",range:t="",indexRange:n=""})=>{const s={uri:e,resolvedUri:Ql(i||"",e)};if(t||n){const a=(t||n).split("-");let o=N.BigInt?N.BigInt(a[0]):parseInt(a[0],10),l=N.BigInt?N.BigInt(a[1]):parseInt(a[1],10);o<Number.MAX_SAFE_INTEGER&&typeof o=="bigint"&&(o=Number(o)),l<Number.MAX_SAFE_INTEGER&&typeof l=="bigint"&&(l=Number(l));let u;typeof l=="bigint"||typeof o=="bigint"?u=N.BigInt(l)-N.BigInt(o)+N.BigInt(1):u=l-o+1,typeof u=="bigint"&&u<Number.MAX_SAFE_INTEGER&&(u=Number(u)),s.byterange={length:u,offset:o}}return s},OC=i=>{let e;return typeof i.offset=="bigint"||typeof i.length=="bigint"?e=N.BigInt(i.offset)+N.BigInt(i.length)-N.BigInt(1):e=i.offset+i.length-1,`${i.offset}-${e}`},Jp=i=>(i&&typeof i!="number"&&(i=parseInt(i,10)),isNaN(i)?null:i),UC={static(i){const{duration:e,timescale:t=1,sourceDuration:n,periodDuration:s}=i,r=Jp(i.endNumber),a=e/t;return typeof r=="number"?{start:0,end:r}:typeof s=="number"?{start:0,end:s/a}:{start:0,end:n/a}},dynamic(i){const{NOW:e,clientOffset:t,availabilityStartTime:n,timescale:s=1,duration:r,periodStart:a=0,minimumUpdatePeriod:o=0,timeShiftBufferDepth:l=1/0}=i,u=Jp(i.endNumber),h=(e+t)/1e3,d=n+a,y=h+o-d,v=Math.ceil(y*s/r),b=Math.floor((h-d-l)*s/r),x=Math.floor((h-d)*s/r);return{start:Math.max(0,b),end:typeof u=="number"?u:Math.min(v,x)}}},NC=i=>e=>{const{duration:t,timescale:n=1,periodStart:s,startNumber:r=1}=i;return{number:r+e,duration:t/n,timeline:s,time:e*t}},Bh=i=>{const{type:e,duration:t,timescale:n=1,periodDuration:s,sourceDuration:r}=i,{start:a,end:o}=UC[e](i),l=PC(a,o).map(NC(i));if(e==="static"){const u=l.length-1,h=typeof s=="number"?s:r;l[u].duration=h-t/n*u}return l},y0=i=>{const{baseUrl:e,initialization:t={},sourceDuration:n,indexRange:s="",periodStart:r,presentationTime:a,number:o=0,duration:l}=i;if(!e)throw new Error($r.NO_BASE_URL);const u=ro({baseUrl:e,source:t.sourceURL,range:t.range}),h=ro({baseUrl:e,source:e,indexRange:s});if(h.map=u,l){const d=Bh(i);d.length&&(h.duration=d[0].duration,h.timeline=d[0].timeline)}else n&&(h.duration=n,h.timeline=r);return h.presentationTime=a||r,h.number=o,[h]},Hh=(i,e,t)=>{const n=i.sidx.map?i.sidx.map:null,s=i.sidx.duration,r=i.timeline||0,a=i.sidx.byterange,o=a.offset+a.length,l=e.timescale,u=e.references.filter(x=>x.referenceType!==1),h=[],d=i.endList?"static":"dynamic",m=i.sidx.timeline;let y=m,v=i.mediaSequence||0,b;typeof e.firstOffset=="bigint"?b=N.BigInt(o)+e.firstOffset:b=o+e.firstOffset;for(let x=0;x<u.length;x++){const _=e.references[x],E=_.referencedSize,A=_.subsegmentDuration;let w;typeof b=="bigint"?w=b+N.BigInt(E)-N.BigInt(1):w=b+E-1;const C=`${b}-${w}`,B=y0({baseUrl:t,timescale:l,timeline:r,periodStart:m,presentationTime:y,number:v,duration:A,sourceDuration:s,indexRange:C,type:d})[0];n&&(B.map=n),h.push(B),typeof b=="bigint"?b+=N.BigInt(E):b+=E,y+=A/l,v++}return i.segments=h,i},kC=["AUDIO","SUBTITLES"],FC=1/60,T0=i=>IC(i,({timeline:e})=>e).sort((e,t)=>e.timeline>t.timeline?1:-1),BC=(i,e)=>{for(let t=0;t<i.length;t++)if(i[t].attributes.NAME===e)return i[t];return null},em=i=>{let e=[];return eC(i,kC,(t,n,s,r)=>{e=e.concat(t.playlists||[])}),e},tm=({playlist:i,mediaSequence:e})=>{i.mediaSequence=e,i.segments.forEach((t,n)=>{t.number=i.mediaSequence+n})},HC=({oldPlaylists:i,newPlaylists:e,timelineStarts:t})=>{e.forEach(n=>{n.discontinuitySequence=t.findIndex(function({timeline:l}){return l===n.timeline});const s=BC(i,n.attributes.NAME);if(!s||n.sidx)return;const r=n.segments[0],a=s.segments.findIndex(function(l){return Math.abs(l.presentationTime-r.presentationTime)<FC});if(a===-1){tm({playlist:n,mediaSequence:s.mediaSequence+s.segments.length}),n.segments[0].discontinuity=!0,n.discontinuityStarts.unshift(0),(!s.segments.length&&n.timeline>s.timeline||s.segments.length&&n.timeline>s.segments[s.segments.length-1].timeline)&&n.discontinuitySequence--;return}s.segments[a].discontinuity&&!r.discontinuity&&(r.discontinuity=!0,n.discontinuityStarts.unshift(0),n.discontinuitySequence--),tm({playlist:n,mediaSequence:s.segments[a].number})})},VC=({oldManifest:i,newManifest:e})=>{const t=i.playlists.concat(em(i)),n=e.playlists.concat(em(e));return e.timelineStarts=T0([i.timelineStarts,e.timelineStarts]),HC({oldPlaylists:t,newPlaylists:n,timelineStarts:e.timelineStarts}),e},tu=i=>i&&i.uri+"-"+OC(i.byterange),mc=i=>{const e=i.reduce(function(n,s){return n[s.attributes.baseUrl]||(n[s.attributes.baseUrl]=[]),n[s.attributes.baseUrl].push(s),n},{});let t=[];return Object.values(e).forEach(n=>{const s=_0(n.reduce((r,a)=>{const o=a.attributes.id+(a.attributes.lang||"");return r[o]?(a.segments&&(a.segments[0]&&(a.segments[0].discontinuity=!0),r[o].segments.push(...a.segments)),a.attributes.contentProtection&&(r[o].attributes.contentProtection=a.attributes.contentProtection)):(r[o]=a,r[o].attributes.timelineStarts=[]),r[o].attributes.timelineStarts.push({start:a.attributes.periodStart,timeline:a.attributes.periodStart}),r},{}));t=t.concat(s)}),t.map(n=>(n.discontinuityStarts=LC(n.segments||[],"discontinuity"),n))},Vh=(i,e)=>{const t=tu(i.sidx),n=t&&e[t]&&e[t].sidx;return n&&Hh(i,n,i.sidx.resolvedUri),i},zC=(i,e={})=>{if(!Object.keys(e).length)return i;for(const t in i)i[t]=Vh(i[t],e);return i},GC=({attributes:i,segments:e,sidx:t,mediaSequence:n,discontinuitySequence:s,discontinuityStarts:r},a)=>{const o={attributes:{NAME:i.id,BANDWIDTH:i.bandwidth,CODECS:i.codecs,["PROGRAM-ID"]:1},uri:"",endList:i.type==="static",timeline:i.periodStart,resolvedUri:i.baseUrl||"",targetDuration:i.duration,discontinuitySequence:s,discontinuityStarts:r,timelineStarts:i.timelineStarts,mediaSequence:n,segments:e};return i.contentProtection&&(o.contentProtection=i.contentProtection),i.serviceLocation&&(o.attributes.serviceLocation=i.serviceLocation),t&&(o.sidx=t),a&&(o.attributes.AUDIO="audio",o.attributes.SUBTITLES="subs"),o},WC=({attributes:i,segments:e,mediaSequence:t,discontinuityStarts:n,discontinuitySequence:s})=>{typeof e>"u"&&(e=[{uri:i.baseUrl,timeline:i.periodStart,resolvedUri:i.baseUrl||"",duration:i.sourceDuration,number:0}],i.duration=i.sourceDuration);const r={NAME:i.id,BANDWIDTH:i.bandwidth,["PROGRAM-ID"]:1};i.codecs&&(r.CODECS=i.codecs);const a={attributes:r,uri:"",endList:i.type==="static",timeline:i.periodStart,resolvedUri:i.baseUrl||"",targetDuration:i.duration,timelineStarts:i.timelineStarts,discontinuityStarts:n,discontinuitySequence:s,mediaSequence:t,segments:e};return i.serviceLocation&&(a.attributes.serviceLocation=i.serviceLocation),a},qC=(i,e={},t=!1)=>{let n;const s=i.reduce((r,a)=>{const o=a.attributes.role&&a.attributes.role.value||"",l=a.attributes.lang||"";let u=a.attributes.label||"main";if(l&&!a.attributes.label){const d=o?` (${o})`:"";u=`${a.attributes.lang}${d}`}r[u]||(r[u]={language:l,autoselect:!0,default:o==="main",playlists:[],uri:""});const h=Vh(GC(a,t),e);return r[u].playlists.push(h),typeof n>"u"&&o==="main"&&(n=a,n.default=!0),r},{});if(!n){const r=Object.keys(s)[0];s[r].default=!0}return s},$C=(i,e={})=>i.reduce((t,n)=>{const s=n.attributes.label||n.attributes.lang||"text";return t[s]||(t[s]={language:s,default:!1,autoselect:!1,playlists:[],uri:""}),t[s].playlists.push(Vh(WC(n),e)),t},{}),jC=i=>i.reduce((e,t)=>(t&&t.forEach(n=>{const{channel:s,language:r}=n;e[r]={autoselect:!1,default:!1,instreamId:s,language:r},n.hasOwnProperty("aspectRatio")&&(e[r].aspectRatio=n.aspectRatio),n.hasOwnProperty("easyReader")&&(e[r].easyReader=n.easyReader),n.hasOwnProperty("3D")&&(e[r]["3D"]=n["3D"])}),e),{}),XC=({attributes:i,segments:e,sidx:t,discontinuityStarts:n})=>{const s={attributes:{NAME:i.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:i.width,height:i.height},CODECS:i.codecs,BANDWIDTH:i.bandwidth,["PROGRAM-ID"]:1},uri:"",endList:i.type==="static",timeline:i.periodStart,resolvedUri:i.baseUrl||"",targetDuration:i.duration,discontinuityStarts:n,timelineStarts:i.timelineStarts,segments:e};return i.frameRate&&(s.attributes["FRAME-RATE"]=i.frameRate),i.contentProtection&&(s.contentProtection=i.contentProtection),i.serviceLocation&&(s.attributes.serviceLocation=i.serviceLocation),t&&(s.sidx=t),s},KC=({attributes:i})=>i.mimeType==="video/mp4"||i.mimeType==="video/webm"||i.contentType==="video",YC=({attributes:i})=>i.mimeType==="audio/mp4"||i.mimeType==="audio/webm"||i.contentType==="audio",QC=({attributes:i})=>i.mimeType==="text/vtt"||i.contentType==="text",ZC=(i,e)=>{i.forEach(t=>{t.mediaSequence=0,t.discontinuitySequence=e.findIndex(function({timeline:n}){return n===t.timeline}),t.segments&&t.segments.forEach((n,s)=>{n.number=s})})},im=i=>i?Object.keys(i).reduce((e,t)=>{const n=i[t];return e.concat(n.playlists)},[]):[],JC=({dashPlaylists:i,locations:e,contentSteering:t,sidxMapping:n={},previousManifest:s,eventStream:r})=>{if(!i.length)return{};const{sourceDuration:a,type:o,suggestedPresentationDelay:l,minimumUpdatePeriod:u}=i[0].attributes,h=mc(i.filter(KC)).map(XC),d=mc(i.filter(YC)),m=mc(i.filter(QC)),y=i.map(w=>w.attributes.captionServices).filter(Boolean),v={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:{AUDIO:{},VIDEO:{},["CLOSED-CAPTIONS"]:{},SUBTITLES:{}},uri:"",duration:a,playlists:zC(h,n)};u>=0&&(v.minimumUpdatePeriod=u*1e3),e&&(v.locations=e),t&&(v.contentSteering=t),o==="dynamic"&&(v.suggestedPresentationDelay=l),r&&r.length>0&&(v.eventStream=r);const b=v.playlists.length===0,x=d.length?qC(d,n,b):null,_=m.length?$C(m,n):null,E=h.concat(im(x),im(_)),A=E.map(({timelineStarts:w})=>w);return v.timelineStarts=T0(A),ZC(E,v.timelineStarts),x&&(v.mediaGroups.AUDIO.audio=x),_&&(v.mediaGroups.SUBTITLES.subs=_),y.length&&(v.mediaGroups["CLOSED-CAPTIONS"].cc=jC(y)),s?VC({oldManifest:s,newManifest:v}):v},eM=(i,e,t)=>{const{NOW:n,clientOffset:s,availabilityStartTime:r,timescale:a=1,periodStart:o=0,minimumUpdatePeriod:l=0}=i,u=(n+s)/1e3,h=r+o,m=u+l-h;return Math.ceil((m*a-e)/t)},x0=(i,e)=>{const{type:t,minimumUpdatePeriod:n=0,media:s="",sourceDuration:r,timescale:a=1,startNumber:o=1,periodStart:l}=i,u=[];let h=-1;for(let d=0;d<e.length;d++){const m=e[d],y=m.d,v=m.r||0,b=m.t||0;h<0&&(h=b),b&&b>h&&(h=b);let x;if(v<0){const A=d+1;A===e.length?t==="dynamic"&&n>0&&s.indexOf("$Number$")>0?x=eM(i,h,y):x=(r*a-h)/y:x=(e[A].t-h)/y}else x=v+1;const _=o+u.length+x;let E=o+u.length;for(;E<_;)u.push({number:E,duration:y/a,time:h,timeline:l}),h+=y,E++}return u},tM=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,iM=i=>(e,t,n,s)=>{if(e==="$$")return"$";if(typeof i[t]>"u")return e;const r=""+i[t];return t==="RepresentationID"||(n?s=parseInt(s,10):s=1,r.length>=s)?r:`${new Array(s-r.length+1).join("0")}${r}`},nm=(i,e)=>i.replace(tM,iM(e)),nM=(i,e)=>!i.duration&&!e?[{number:i.startNumber||1,duration:i.sourceDuration,time:0,timeline:i.periodStart}]:i.duration?Bh(i):x0(i,e),sM=(i,e)=>{const t={RepresentationID:i.id,Bandwidth:i.bandwidth||0},{initialization:n={sourceURL:"",range:""}}=i,s=ro({baseUrl:i.baseUrl,source:nm(n.sourceURL,t),range:n.range});return nM(i,e).map(a=>{t.Number=a.number,t.Time=a.time;const o=nm(i.media||"",t),l=i.timescale||1,u=i.presentationTimeOffset||0,h=i.periodStart+(a.time-u)/l;return{uri:o,timeline:a.timeline,duration:a.duration,resolvedUri:Ql(i.baseUrl||"",o),map:s,number:a.number,presentationTime:h}})},rM=(i,e)=>{const{baseUrl:t,initialization:n={}}=i,s=ro({baseUrl:t,source:n.sourceURL,range:n.range}),r=ro({baseUrl:t,source:e.media,range:e.mediaRange});return r.map=s,r},aM=(i,e)=>{const{duration:t,segmentUrls:n=[],periodStart:s}=i;if(!t&&!e||t&&e)throw new Error($r.SEGMENT_TIME_UNSPECIFIED);const r=n.map(l=>rM(i,l));let a;return t&&(a=Bh(i)),e&&(a=x0(i,e)),a.map((l,u)=>{if(r[u]){const h=r[u],d=i.timescale||1,m=i.presentationTimeOffset||0;return h.timeline=l.timeline,h.duration=l.duration,h.number=l.number,h.presentationTime=s+(l.time-m)/d,h}}).filter(l=>l)},oM=({attributes:i,segmentInfo:e})=>{let t,n;e.template?(n=sM,t=Xt(i,e.template)):e.base?(n=y0,t=Xt(i,e.base)):e.list&&(n=aM,t=Xt(i,e.list));const s={attributes:i};if(!n)return s;const r=n(t,e.segmentTimeline);if(t.duration){const{duration:a,timescale:o=1}=t;t.duration=a/o}else r.length?t.duration=r.reduce((a,o)=>Math.max(a,Math.ceil(o.duration)),0):t.duration=0;return s.attributes=t,s.segments=r,e.base&&t.indexRange&&(s.sidx=r[0],s.segments=[]),s},lM=i=>i.map(oM),St=(i,e)=>v0(i.childNodes).filter(({tagName:t})=>t===e),_o=i=>i.textContent.trim(),uM=i=>parseFloat(i.split("/").reduce((e,t)=>e/t)),Tr=i=>{const o=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(i);if(!o)return 0;const[l,u,h,d,m,y]=o.slice(1);return parseFloat(l||0)*31536e3+parseFloat(u||0)*2592e3+parseFloat(h||0)*86400+parseFloat(d||0)*3600+parseFloat(m||0)*60+parseFloat(y||0)},cM=i=>(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(i)&&(i+="Z"),Date.parse(i)),sm={mediaPresentationDuration(i){return Tr(i)},availabilityStartTime(i){return cM(i)/1e3},minimumUpdatePeriod(i){return Tr(i)},suggestedPresentationDelay(i){return Tr(i)},type(i){return i},timeShiftBufferDepth(i){return Tr(i)},start(i){return Tr(i)},width(i){return parseInt(i,10)},height(i){return parseInt(i,10)},bandwidth(i){return parseInt(i,10)},frameRate(i){return uM(i)},startNumber(i){return parseInt(i,10)},timescale(i){return parseInt(i,10)},presentationTimeOffset(i){return parseInt(i,10)},duration(i){const e=parseInt(i,10);return isNaN(e)?Tr(i):e},d(i){return parseInt(i,10)},t(i){return parseInt(i,10)},r(i){return parseInt(i,10)},presentationTime(i){return parseInt(i,10)},DEFAULT(i){return i}},Bt=i=>i&&i.attributes?v0(i.attributes).reduce((e,t)=>{const n=sm[t.name]||sm.DEFAULT;return e[t.name]=n(t.value),e},{}):{},hM={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime","urn:mpeg:dash:mp4protection:2011":"mp4protection"},iu=(i,e)=>e.length?qr(i.map(function(t){return e.map(function(n){const s=_o(n),r=Ql(t.baseUrl,s),a=Xt(Bt(n),{baseUrl:r});return r!==s&&!a.serviceLocation&&t.serviceLocation&&(a.serviceLocation=t.serviceLocation),a})})):i,zh=i=>{const e=St(i,"SegmentTemplate")[0],t=St(i,"SegmentList")[0],n=t&&St(t,"SegmentURL").map(d=>Xt({tag:"SegmentURL"},Bt(d))),s=St(i,"SegmentBase")[0],r=t||e,a=r&&St(r,"SegmentTimeline")[0],o=t||s||e,l=o&&St(o,"Initialization")[0],u=e&&Bt(e);u&&l?u.initialization=l&&Bt(l):u&&u.initialization&&(u.initialization={sourceURL:u.initialization});const h={template:u,segmentTimeline:a&&St(a,"S").map(d=>Bt(d)),list:t&&Xt(Bt(t),{segmentUrls:n,initialization:Bt(l)}),base:s&&Xt(Bt(s),{initialization:Bt(l)})};return Object.keys(h).forEach(d=>{h[d]||delete h[d]}),h},dM=(i,e,t)=>n=>{const s=St(n,"BaseURL"),r=iu(e,s),a=Xt(i,Bt(n)),o=zh(n);return r.map(l=>({segmentInfo:Xt(t,o),attributes:Xt(a,l)}))},fM=i=>i.reduce((e,t)=>{const n=Bt(t);n.schemeIdUri&&(n.schemeIdUri=n.schemeIdUri.toLowerCase());const s=hM[n.schemeIdUri];if(s){e[s]={attributes:n};const r=St(t,"cenc:pssh")[0];if(r){const a=_o(r);e[s].pssh=a&&iC(a)}}return e},{}),pM=i=>{if(i.schemeIdUri==="urn:scte:dash:cc:cea-608:2015")return(typeof i.value!="string"?[]:i.value.split(";")).map(t=>{let n,s;return s=t,/^CC\d=/.test(t)?[n,s]=t.split("="):/^CC\d$/.test(t)&&(n=t),{channel:n,language:s}});if(i.schemeIdUri==="urn:scte:dash:cc:cea-708:2015")return(typeof i.value!="string"?[]:i.value.split(";")).map(t=>{const n={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};if(/=/.test(t)){const[s,r=""]=t.split("=");n.channel=s,n.language=t,r.split(",").forEach(a=>{const[o,l]=a.split(":");o==="lang"?n.language=l:o==="er"?n.easyReader=Number(l):o==="war"?n.aspectRatio=Number(l):o==="3D"&&(n["3D"]=Number(l))})}else n.language=t;return n.channel&&(n.channel="SERVICE"+n.channel),n})},mM=i=>qr(St(i.node,"EventStream").map(e=>{const t=Bt(e),n=t.schemeIdUri;return St(e,"Event").map(s=>{const r=Bt(s),a=r.presentationTime||0,o=t.timescale||1,l=r.duration||0,u=a/o+i.attributes.start;return{schemeIdUri:n,value:t.value,id:r.id,start:u,end:u+l/o,messageData:_o(s)||r.messageData,contentEncoding:t.contentEncoding,presentationTimeOffset:t.presentationTimeOffset||0}})})),gM=(i,e,t)=>n=>{const s=Bt(n),r=iu(e,St(n,"BaseURL")),a=St(n,"Role")[0],o={role:Bt(a)};let l=Xt(i,s,o);const u=St(n,"Accessibility")[0],h=pM(Bt(u));h&&(l=Xt(l,{captionServices:h}));const d=St(n,"Label")[0];if(d&&d.childNodes.length){const x=d.childNodes[0].nodeValue.trim();l=Xt(l,{label:x})}const m=fM(St(n,"ContentProtection"));Object.keys(m).length&&(l=Xt(l,{contentProtection:m}));const y=zh(n),v=St(n,"Representation"),b=Xt(t,y);return qr(v.map(dM(l,r,b)))},_M=(i,e)=>(t,n)=>{const s=iu(e,St(t.node,"BaseURL")),r=Xt(i,{periodStart:t.attributes.start});typeof t.attributes.duration=="number"&&(r.periodDuration=t.attributes.duration);const a=St(t.node,"AdaptationSet"),o=zh(t.node);return qr(a.map(gM(r,s,o)))},vM=(i,e)=>{if(i.length>1&&e({type:"warn",message:"The MPD manifest should contain no more than one ContentSteering tag"}),!i.length)return null;const t=Xt({serverURL:_o(i[0])},Bt(i[0]));return t.queryBeforeStart=t.queryBeforeStart==="true",t},yM=({attributes:i,priorPeriodAttributes:e,mpdType:t})=>typeof i.start=="number"?i.start:e&&typeof e.start=="number"&&typeof e.duration=="number"?e.start+e.duration:!e&&t==="static"?0:null,TM=(i,e={})=>{const{manifestUri:t="",NOW:n=Date.now(),clientOffset:s=0,eventHandler:r=function(){}}=e,a=St(i,"Period");if(!a.length)throw new Error($r.INVALID_NUMBER_OF_PERIOD);const o=St(i,"Location"),l=Bt(i),u=iu([{baseUrl:t}],St(i,"BaseURL")),h=St(i,"ContentSteering");l.type=l.type||"static",l.sourceDuration=l.mediaPresentationDuration||0,l.NOW=n,l.clientOffset=s,o.length&&(l.locations=o.map(_o));const d=[];return a.forEach((m,y)=>{const v=Bt(m),b=d[y-1];v.start=yM({attributes:v,priorPeriodAttributes:b?b.attributes:null,mpdType:l.type}),d.push({node:m,attributes:v})}),{locations:l.locations,contentSteeringInfo:vM(h,r),representationInfo:qr(d.map(_M(l,u))),eventStream:qr(d.map(mM))}},S0=i=>{if(i==="")throw new Error($r.DASH_EMPTY_MANIFEST);const e=new RC;let t,n;try{t=e.parseFromString(i,"application/xml"),n=t&&t.documentElement.tagName==="MPD"?t.documentElement:null}catch{}if(!n||n&&n.getElementsByTagName("parsererror").length>0)throw new Error($r.DASH_INVALID_XML);return n},xM=i=>{const e=St(i,"UTCTiming")[0];if(!e)return null;const t=Bt(e);switch(t.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":t.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":t.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":t.method="DIRECT",t.value=Date.parse(t.value);break;case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":default:throw new Error($r.UNSUPPORTED_UTC_TIMING_SCHEME)}return t},SM=(i,e={})=>{const t=TM(S0(i),e),n=lM(t.representationInfo);return JC({dashPlaylists:n,locations:t.locations,contentSteering:t.contentSteeringInfo,sidxMapping:e.sidxMapping,previousManifest:e.previousManifest,eventStream:t.eventStream})},bM=i=>xM(S0(i));var b0=Math.pow(2,32),EM=function(i){var e=new DataView(i.buffer,i.byteOffset,i.byteLength),t;return e.getBigUint64?(t=e.getBigUint64(0),t<Number.MAX_SAFE_INTEGER?Number(t):t):e.getUint32(0)*b0+e.getUint32(4)},AM={getUint64:EM,MAX_UINT32:b0},rm=AM.getUint64,CM=function(i){var e=new DataView(i.buffer,i.byteOffset,i.byteLength),t={version:i[0],flags:new Uint8Array(i.subarray(1,4)),references:[],referenceId:e.getUint32(4),timescale:e.getUint32(8)},n=12;t.version===0?(t.earliestPresentationTime=e.getUint32(n),t.firstOffset=e.getUint32(n+4),n+=8):(t.earliestPresentationTime=rm(i.subarray(n)),t.firstOffset=rm(i.subarray(n+8)),n+=16),n+=2;var s=e.getUint16(n);for(n+=2;s>0;n+=12,s--)t.references.push({referenceType:(i[n]&128)>>>7,referencedSize:e.getUint32(n)&2147483647,subsegmentDuration:e.getUint32(n+4),startsWithSap:!!(i[n+8]&128),sapType:(i[n+8]&112)>>>4,sapDeltaTime:e.getUint32(n+8)&268435455});return t},MM=CM,wM=ke([73,68,51]),DM=function(e,t){t===void 0&&(t=0),e=ke(e);var n=e[t+5],s=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9],r=(n&16)>>4;return r?s+20:s+10},Fa=function i(e,t){return t===void 0&&(t=0),e=ke(e),e.length-t<10||!xt(e,wM,{offset:t})?t:(t+=DM(e,t),i(e,t))},am=function(e){return typeof e=="string"?Vg(e):e},RM=function(e){return Array.isArray(e)?e.map(function(t){return am(t)}):[am(e)]},PM=function i(e,t,n){n===void 0&&(n=!1),t=RM(t),e=ke(e);var s=[];if(!t.length)return s;for(var r=0;r<e.length;){var a=(e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3])>>>0,o=e.subarray(r+4,r+8);if(a===0)break;var l=r+a;if(l>e.length){if(n)break;l=e.length}var u=e.subarray(r+8,l);xt(o,t[0])&&(t.length===1?s.push(u):s.push.apply(s,i(u,t.slice(1),n))),r=l}return s},ul={EBML:ke([26,69,223,163]),DocType:ke([66,130]),Segment:ke([24,83,128,103]),SegmentInfo:ke([21,73,169,102]),Tracks:ke([22,84,174,107]),Track:ke([174]),TrackNumber:ke([215]),DefaultDuration:ke([35,227,131]),TrackEntry:ke([174]),TrackType:ke([131]),FlagDefault:ke([136]),CodecID:ke([134]),CodecPrivate:ke([99,162]),VideoTrack:ke([224]),AudioTrack:ke([225]),Cluster:ke([31,67,182,117]),Timestamp:ke([231]),TimestampScale:ke([42,215,177]),BlockGroup:ke([160]),BlockDuration:ke([155]),Block:ke([161]),SimpleBlock:ke([163])},qc=[128,64,32,16,8,4,2,1],LM=function(e){for(var t=1,n=0;n<qc.length&&!(e&qc[n]);n++)t++;return t},wl=function(e,t,n,s){n===void 0&&(n=!0),s===void 0&&(s=!1);var r=LM(e[t]),a=e.subarray(t,t+r);return n&&(a=Array.prototype.slice.call(e,t,t+r),a[0]^=qc[r-1]),{length:r,value:QA(a,{signed:s}),bytes:a}},om=function i(e){return typeof e=="string"?e.match(/.{1,2}/g).map(function(t){return i(t)}):typeof e=="number"?ZA(e):e},IM=function(e){return Array.isArray(e)?e.map(function(t){return om(t)}):[om(e)]},OM=function i(e,t,n){if(n>=t.length)return t.length;var s=wl(t,n,!1);if(xt(e.bytes,s.bytes))return n;var r=wl(t,n+s.length);return i(e,t,n+r.length+r.value+s.length)},lm=function i(e,t){t=IM(t),e=ke(e);var n=[];if(!t.length)return n;for(var s=0;s<e.length;){var r=wl(e,s,!1),a=wl(e,s+r.length),o=s+r.length+a.length;a.value===127&&(a.value=OM(r,e,o),a.value!==e.length&&(a.value-=o));var l=o+a.value>e.length?e.length:o+a.value,u=e.subarray(o,l);xt(t[0],r.bytes)&&(t.length===1?n.push(u):n=n.concat(i(u,t.slice(1))));var h=r.length+a.length+u.length;s+=h}return n},UM=ke([0,0,0,1]),NM=ke([0,0,1]),kM=ke([0,0,3]),FM=function(e){for(var t=[],n=1;n<e.length-2;)xt(e.subarray(n,n+3),kM)&&(t.push(n+2),n++),n++;if(t.length===0)return e;var s=e.length-t.length,r=new Uint8Array(s),a=0;for(n=0;n<s;a++,n++)a===t[0]&&(a++,t.shift()),r[n]=e[a];return r},E0=function(e,t,n,s){s===void 0&&(s=1/0),e=ke(e),n=[].concat(n);for(var r=0,a,o=0;r<e.length&&(o<s||a);){var l=void 0;if(xt(e.subarray(r),UM)?l=4:xt(e.subarray(r),NM)&&(l=3),!l){r++;continue}if(o++,a)return FM(e.subarray(a,r));var u=void 0;t==="h264"?u=e[r+l]&31:t==="h265"&&(u=e[r+l]>>1&63),n.indexOf(u)!==-1&&(a=r+l),r+=l+(t==="h264"?1:2)}return e.subarray(0,0)},BM=function(e,t,n){return E0(e,"h264",t,n)},HM=function(e,t,n){return E0(e,"h265",t,n)},oi={webm:ke([119,101,98,109]),matroska:ke([109,97,116,114,111,115,107,97]),flac:ke([102,76,97,67]),ogg:ke([79,103,103,83]),ac3:ke([11,119]),riff:ke([82,73,70,70]),avi:ke([65,86,73]),wav:ke([87,65,86,69]),"3gp":ke([102,116,121,112,51,103]),mp4:ke([102,116,121,112]),fmp4:ke([115,116,121,112]),mov:ke([102,116,121,112,113,116]),moov:ke([109,111,111,118]),moof:ke([109,111,111,102])},jr={aac:function(e){var t=Fa(e);return xt(e,[255,16],{offset:t,mask:[255,22]})},mp3:function(e){var t=Fa(e);return xt(e,[255,2],{offset:t,mask:[255,6]})},webm:function(e){var t=lm(e,[ul.EBML,ul.DocType])[0];return xt(t,oi.webm)},mkv:function(e){var t=lm(e,[ul.EBML,ul.DocType])[0];return xt(t,oi.matroska)},mp4:function(e){if(jr["3gp"](e)||jr.mov(e))return!1;if(xt(e,oi.mp4,{offset:4})||xt(e,oi.fmp4,{offset:4})||xt(e,oi.moof,{offset:4})||xt(e,oi.moov,{offset:4}))return!0},mov:function(e){return xt(e,oi.mov,{offset:4})},"3gp":function(e){return xt(e,oi["3gp"],{offset:4})},ac3:function(e){var t=Fa(e);return xt(e,oi.ac3,{offset:t})},ts:function(e){if(e.length<189&&e.length>=1)return e[0]===71;for(var t=0;t+188<e.length&&t<188;){if(e[t]===71&&e[t+188]===71)return!0;t+=1}return!1},flac:function(e){var t=Fa(e);return xt(e,oi.flac,{offset:t})},ogg:function(e){return xt(e,oi.ogg)},avi:function(e){return xt(e,oi.riff)&&xt(e,oi.avi,{offset:8})},wav:function(e){return xt(e,oi.riff)&&xt(e,oi.wav,{offset:8})},h264:function(e){return BM(e,7,3).length},h265:function(e){return HM(e,[32,33],3).length}},$c=Object.keys(jr).filter(function(i){return i!=="ts"&&i!=="h264"&&i!=="h265"}).concat(["ts","h264","h265"]);$c.forEach(function(i){var e=jr[i];jr[i]=function(t){return e(ke(t))}});var VM=jr,Gh=function(e){e=ke(e);for(var t=0;t<$c.length;t++){var n=$c[t];if(VM[n](e))return n}return""},zM=function(e){return PM(e,["moof"]).length>0},Wh=9e4,qh,$h,nu,jh,A0,C0,M0;qh=function(i){return i*Wh};$h=function(i,e){return i*e};nu=function(i){return i/Wh};jh=function(i,e){return i/e};A0=function(i,e){return qh(jh(i,e))};C0=function(i,e){return $h(nu(i),e)};M0=function(i,e,t){return nu(t?i:i-e)};var Os={ONE_SECOND_IN_TS:Wh,secondsToVideoTs:qh,secondsToAudioTs:$h,videoTsToSeconds:nu,audioTsToSeconds:jh,audioTsToVideoTs:A0,videoTsToAudioTs:C0,metadataTsToSeconds:M0};/**
 * @license
 * Video.js 8.12.0 <http://videojs.com/>
 * Copyright Brightcove, Inc. <https://www.brightcove.com/>
 * Available under Apache License Version 2.0
 * <https://github.com/videojs/video.js/blob/main/LICENSE>
 *
 * Includes vtt.js <https://github.com/mozilla/vtt.js>
 * Available under Apache License Version 2.0
 * <https://github.com/mozilla/vtt.js/blob/main/LICENSE>
 */var jc="8.12.0";const zn={},hs=function(i,e){return zn[i]=zn[i]||[],e&&(zn[i]=zn[i].concat(e)),zn[i]},GM=function(i,e){hs(i,e)},w0=function(i,e){const t=hs(i).indexOf(e);return t<=-1?!1:(zn[i]=zn[i].slice(),zn[i].splice(t,1),!0)},WM=function(i,e){hs(i,[].concat(e).map(t=>{const n=(...s)=>(w0(i,n),t(...s));return n}))},Dl={prefixed:!0},_l=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"]],um=_l[0];let Ba;for(let i=0;i<_l.length;i++)if(_l[i][1]in _e){Ba=_l[i];break}if(Ba){for(let i=0;i<Ba.length;i++)Dl[um[i]]=Ba[i];Dl.prefixed=Ba[0]!==um[0]}let _i=[];const qM=(i,e,t)=>(n,s,r)=>{const a=e.levels[s],o=new RegExp(`^(${a})$`);let l=i;if(n!=="log"&&r.unshift(n.toUpperCase()+":"),t&&(l=`%c${i}`,r.unshift(t)),r.unshift(l+":"),_i){_i.push([].concat(r));const h=_i.length-1e3;_i.splice(0,h>0?h:0)}if(!N.console)return;let u=N.console[n];!u&&n==="debug"&&(u=N.console.info||N.console.log),!(!u||!a||!o.test(n))&&u[Array.isArray(r)?"apply":"call"](N.console,r)};function Xc(i,e=":",t=""){let n="info",s;const r=function(...a){s("log",n,a)};return s=qM(i,r,t),r.createLogger=(a,o,l)=>{const u=o!==void 0?o:e,h=l!==void 0?l:t,d=`${i} ${u} ${a}`;return Xc(d,u,h)},r.createNewLogger=(a,o,l)=>Xc(a,o,l),r.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:n},r.level=a=>{if(typeof a=="string"){if(!r.levels.hasOwnProperty(a))throw new Error(`"${a}" in not a valid log level`);n=a}return n},r.history=()=>_i?[].concat(_i):[],r.history.filter=a=>(_i||[]).filter(o=>new RegExp(`.*${a}.*`).test(o[0])),r.history.clear=()=>{_i&&(_i.length=0)},r.history.disable=()=>{_i!==null&&(_i.length=0,_i=null)},r.history.enable=()=>{_i===null&&(_i=[])},r.error=(...a)=>s("error",n,a),r.warn=(...a)=>s("warn",n,a),r.debug=(...a)=>s("debug",n,a),r}const rt=Xc("VIDEOJS"),D0=rt.createLogger,$M=Object.prototype.toString,R0=function(i){return An(i)?Object.keys(i):[]};function Pr(i,e){R0(i).forEach(t=>e(i[t],t))}function P0(i,e,t=0){return R0(i).reduce((n,s)=>e(n,i[s],s),t)}function An(i){return!!i&&typeof i=="object"}function Xr(i){return An(i)&&$M.call(i)==="[object Object]"&&i.constructor===Object}function _t(...i){const e={};return i.forEach(t=>{t&&Pr(t,(n,s)=>{if(!Xr(n)){e[s]=n;return}Xr(e[s])||(e[s]={}),e[s]=_t(e[s],n)})}),e}function L0(i={}){const e=[];for(const t in i)if(i.hasOwnProperty(t)){const n=i[t];e.push(n)}return e}function su(i,e,t,n=!0){const s=a=>Object.defineProperty(i,e,{value:a,enumerable:!0,writable:!0}),r={configurable:!0,enumerable:!0,get(){const a=t();return s(a),a}};return n&&(r.set=s),Object.defineProperty(i,e,r)}var jM=Object.freeze({__proto__:null,each:Pr,reduce:P0,isObject:An,isPlain:Xr,merge:_t,values:L0,defineLazyProperty:su});let Xh=!1,I0=null,Cn=!1,O0,U0=!1,Lr=!1,Ir=!1,Mn=!1,Kh=null,ru=null,N0=null,Rl=!1,au=!1,Pl=!1,ou=!1,Kc=!1,Yc=!1,Qc=!1;const ao=Boolean(sa()&&("ontouchstart"in N||N.navigator.maxTouchPoints||N.DocumentTouch&&N.document instanceof N.DocumentTouch)),os=N.navigator&&N.navigator.userAgentData;os&&os.platform&&os.brands&&(Cn=os.platform==="Android",Lr=Boolean(os.brands.find(i=>i.brand==="Microsoft Edge")),Ir=Boolean(os.brands.find(i=>i.brand==="Chromium")),Mn=!Lr&&Ir,Kh=ru=(os.brands.find(i=>i.brand==="Chromium")||{}).version||null,au=os.platform==="Windows");if(!Ir){const i=N.navigator&&N.navigator.userAgent||"";Xh=/iPod/i.test(i),I0=function(){const e=i.match(/OS (\d+)_/i);return e&&e[1]?e[1]:null}(),Cn=/Android/i.test(i),O0=function(){const e=i.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;const t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return t&&n?parseFloat(e[1]+"."+e[2]):t||null}(),U0=/Firefox/i.test(i),Lr=/Edg/i.test(i),Ir=/Chrome/i.test(i)||/CriOS/i.test(i),Mn=!Lr&&Ir,Kh=ru=function(){const e=i.match(/(Chrome|CriOS)\/(\d+)/);return e&&e[2]?parseFloat(e[2]):null}(),N0=function(){const e=/MSIE\s(\d+)\.\d/.exec(i);let t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(i)&&/rv:11.0/.test(i)&&(t=11),t}(),Kc=/Tizen/i.test(i),Yc=/Web0S/i.test(i),Qc=Kc||Yc,Rl=/Safari/i.test(i)&&!Mn&&!Cn&&!Lr&&!Qc,au=/Windows/i.test(i),Pl=/iPad/i.test(i)||Rl&&ao&&!/iPhone/i.test(i),ou=/iPhone/i.test(i)&&!Pl}const pi=ou||Pl||Xh,lu=(Rl||pi)&&!Mn;var k0=Object.freeze({__proto__:null,get IS_IPOD(){return Xh},get IOS_VERSION(){return I0},get IS_ANDROID(){return Cn},get ANDROID_VERSION(){return O0},get IS_FIREFOX(){return U0},get IS_EDGE(){return Lr},get IS_CHROMIUM(){return Ir},get IS_CHROME(){return Mn},get CHROMIUM_VERSION(){return Kh},get CHROME_VERSION(){return ru},get IE_VERSION(){return N0},get IS_SAFARI(){return Rl},get IS_WINDOWS(){return au},get IS_IPAD(){return Pl},get IS_IPHONE(){return ou},get IS_TIZEN(){return Kc},get IS_WEBOS(){return Yc},get IS_SMART_TV(){return Qc},TOUCH_ENABLED:ao,IS_IOS:pi,IS_ANY_SAFARI:lu});function cm(i){return typeof i=="string"&&Boolean(i.trim())}function XM(i){if(i.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}function sa(){return _e===N.document}function ra(i){return An(i)&&i.nodeType===1}function F0(){try{return N.parent!==N.self}catch{return!0}}function B0(i){return function(e,t){if(!cm(e))return _e[i](null);cm(t)&&(t=_e.querySelector(t));const n=ra(t)?t:_e;return n[i]&&n[i](e)}}function Je(i="div",e={},t={},n){const s=_e.createElement(i);return Object.getOwnPropertyNames(e).forEach(function(r){const a=e[r];r==="textContent"?ms(s,a):(s[r]!==a||r==="tabIndex")&&(s[r]=a)}),Object.getOwnPropertyNames(t).forEach(function(r){s.setAttribute(r,t[r])}),n&&Yh(s,n),s}function ms(i,e){return typeof i.textContent>"u"?i.innerText=e:i.textContent=e,i}function Zc(i,e){e.firstChild?e.insertBefore(i,e.firstChild):e.appendChild(i)}function qa(i,e){return XM(e),i.classList.contains(e)}function Hs(i,...e){return i.classList.add(...e.reduce((t,n)=>t.concat(n.split(/\s+/)),[])),i}function uu(i,...e){return i?(i.classList.remove(...e.reduce((t,n)=>t.concat(n.split(/\s+/)),[])),i):(rt.warn("removeClass was called with an element that doesn't exist"),null)}function H0(i,e,t){return typeof t=="function"&&(t=t(i,e)),typeof t!="boolean"&&(t=void 0),e.split(/\s+/).forEach(n=>i.classList.toggle(n,t)),i}function V0(i,e){Object.getOwnPropertyNames(e).forEach(function(t){const n=e[t];n===null||typeof n>"u"||n===!1?i.removeAttribute(t):i.setAttribute(t,n===!0?"":n)})}function ls(i){const e={},t=["autoplay","controls","playsinline","loop","muted","default","defaultMuted"];if(i&&i.attributes&&i.attributes.length>0){const n=i.attributes;for(let s=n.length-1;s>=0;s--){const r=n[s].name;let a=n[s].value;t.includes(r)&&(a=a!==null),e[r]=a}}return e}function z0(i,e){return i.getAttribute(e)}function Kr(i,e,t){i.setAttribute(e,t)}function cu(i,e){i.removeAttribute(e)}function G0(){_e.body.focus(),_e.onselectstart=function(){return!1}}function W0(){_e.onselectstart=function(){return!0}}function Yr(i){if(i&&i.getBoundingClientRect&&i.parentNode){const e=i.getBoundingClientRect(),t={};return["bottom","height","left","right","top","width"].forEach(n=>{e[n]!==void 0&&(t[n]=e[n])}),t.height||(t.height=parseFloat(Qr(i,"height"))),t.width||(t.width=parseFloat(Qr(i,"width"))),t}}function oo(i){if(!i||i&&!i.offsetParent)return{left:0,top:0,width:0,height:0};const e=i.offsetWidth,t=i.offsetHeight;let n=0,s=0;for(;i.offsetParent&&i!==_e[Dl.fullscreenElement];)n+=i.offsetLeft,s+=i.offsetTop,i=i.offsetParent;return{left:n,top:s,width:e,height:t}}function hu(i,e){const t={x:0,y:0};if(pi){let h=i;for(;h&&h.nodeName.toLowerCase()!=="html";){const d=Qr(h,"transform");if(/^matrix/.test(d)){const m=d.slice(7,-1).split(/,\s/).map(Number);t.x+=m[4],t.y+=m[5]}else if(/^matrix3d/.test(d)){const m=d.slice(9,-1).split(/,\s/).map(Number);t.x+=m[12],t.y+=m[13]}h=h.parentNode}}const n={},s=oo(e.target),r=oo(i),a=r.width,o=r.height;let l=e.offsetY-(r.top-s.top),u=e.offsetX-(r.left-s.left);return e.changedTouches&&(u=e.changedTouches[0].pageX-r.left,l=e.changedTouches[0].pageY+r.top,pi&&(u-=t.x,l-=t.y)),n.y=1-Math.max(0,Math.min(1,l/o)),n.x=Math.max(0,Math.min(1,u/a)),n}function q0(i){return An(i)&&i.nodeType===3}function du(i){for(;i.firstChild;)i.removeChild(i.firstChild);return i}function $0(i){return typeof i=="function"&&(i=i()),(Array.isArray(i)?i:[i]).map(e=>{if(typeof e=="function"&&(e=e()),ra(e)||q0(e))return e;if(typeof e=="string"&&/\S/.test(e))return _e.createTextNode(e)}).filter(e=>e)}function Yh(i,e){return $0(e).forEach(t=>i.appendChild(t)),i}function j0(i,e){return Yh(du(i),e)}function lo(i){return i.button===void 0&&i.buttons===void 0||i.button===0&&i.buttons===void 0||i.type==="mouseup"&&i.button===0&&i.buttons===0?!0:!(i.button!==0||i.buttons!==1)}const ds=B0("querySelector"),X0=B0("querySelectorAll");function Qr(i,e){if(!i||!e)return"";if(typeof N.getComputedStyle=="function"){let t;try{t=N.getComputedStyle(i)}catch{return""}return t?t.getPropertyValue(e)||t[e]:""}return""}function K0(i){[..._e.styleSheets].forEach(e=>{try{const t=[...e.cssRules].map(s=>s.cssText).join(""),n=_e.createElement("style");n.textContent=t,i.document.head.appendChild(n)}catch{const n=_e.createElement("link");n.rel="stylesheet",n.type=e.type,n.media=e.media.mediaText,n.href=e.href,i.document.head.appendChild(n)}})}var Y0=Object.freeze({__proto__:null,isReal:sa,isEl:ra,isInFrame:F0,createEl:Je,textContent:ms,prependTo:Zc,hasClass:qa,addClass:Hs,removeClass:uu,toggleClass:H0,setAttributes:V0,getAttributes:ls,getAttribute:z0,setAttribute:Kr,removeAttribute:cu,blockTextSelection:G0,unblockTextSelection:W0,getBoundingClientRect:Yr,findPosition:oo,getPointerPosition:hu,isTextNode:q0,emptyEl:du,normalizeContent:$0,appendContent:Yh,insertContent:j0,isSingleLeftClick:lo,$:ds,$$:X0,computedStyle:Qr,copyStyleSheetsToWindow:K0});let Q0=!1,Jc;const KM=function(){if(Jc.options.autoSetup===!1)return;const i=Array.prototype.slice.call(_e.getElementsByTagName("video")),e=Array.prototype.slice.call(_e.getElementsByTagName("audio")),t=Array.prototype.slice.call(_e.getElementsByTagName("video-js")),n=i.concat(e,t);if(n&&n.length>0)for(let s=0,r=n.length;s<r;s++){const a=n[s];if(a&&a.getAttribute)a.player===void 0&&a.getAttribute("data-setup")!==null&&Jc(a);else{eh(1);break}}else Q0||eh(1)};function eh(i,e){sa()&&(e&&(Jc=e),N.setTimeout(KM,i))}function th(){Q0=!0,N.removeEventListener("load",th)}sa()&&(_e.readyState==="complete"?th():N.addEventListener("load",th));const Z0=function(i){const e=_e.createElement("style");return e.className=i,e},J0=function(i,e){i.styleSheet?i.styleSheet.cssText=e:i.textContent=e};var fi=new WeakMap;const YM=3;let QM=YM;function rn(){return QM++}function hm(i,e){if(!fi.has(i))return;const t=fi.get(i);t.handlers[e].length===0&&(delete t.handlers[e],i.removeEventListener?i.removeEventListener(e,t.dispatcher,!1):i.detachEvent&&i.detachEvent("on"+e,t.dispatcher)),Object.getOwnPropertyNames(t.handlers).length<=0&&(delete t.handlers,delete t.dispatcher,delete t.disabled),Object.getOwnPropertyNames(t).length===0&&fi.delete(i)}function Qh(i,e,t,n){t.forEach(function(s){i(e,s,n)})}function fu(i){if(i.fixed_)return i;function e(){return!0}function t(){return!1}if(!i||!i.isPropagationStopped||!i.isImmediatePropagationStopped){const n=i||N.event;i={};for(const s in n)s!=="layerX"&&s!=="layerY"&&s!=="keyLocation"&&s!=="webkitMovementX"&&s!=="webkitMovementY"&&s!=="path"&&(s==="returnValue"&&n.preventDefault||(i[s]=n[s]));if(i.target||(i.target=i.srcElement||_e),i.relatedTarget||(i.relatedTarget=i.fromElement===i.target?i.toElement:i.fromElement),i.preventDefault=function(){n.preventDefault&&n.preventDefault(),i.returnValue=!1,n.returnValue=!1,i.defaultPrevented=!0},i.defaultPrevented=!1,i.stopPropagation=function(){n.stopPropagation&&n.stopPropagation(),i.cancelBubble=!0,n.cancelBubble=!0,i.isPropagationStopped=e},i.isPropagationStopped=t,i.stopImmediatePropagation=function(){n.stopImmediatePropagation&&n.stopImmediatePropagation(),i.isImmediatePropagationStopped=e,i.stopPropagation()},i.isImmediatePropagationStopped=t,i.clientX!==null&&i.clientX!==void 0){const s=_e.documentElement,r=_e.body;i.pageX=i.clientX+(s&&s.scrollLeft||r&&r.scrollLeft||0)-(s&&s.clientLeft||r&&r.clientLeft||0),i.pageY=i.clientY+(s&&s.scrollTop||r&&r.scrollTop||0)-(s&&s.clientTop||r&&r.clientTop||0)}i.which=i.charCode||i.keyCode,i.button!==null&&i.button!==void 0&&(i.button=i.button&1?0:i.button&4?1:i.button&2?2:0)}return i.fixed_=!0,i}let cl;const ZM=function(){if(typeof cl!="boolean"){cl=!1;try{const i=Object.defineProperty({},"passive",{get(){cl=!0}});N.addEventListener("test",null,i),N.removeEventListener("test",null,i)}catch{}}return cl},JM=["touchstart","touchmove"];function Ni(i,e,t){if(Array.isArray(e))return Qh(Ni,i,e,t);fi.has(i)||fi.set(i,{});const n=fi.get(i);if(n.handlers||(n.handlers={}),n.handlers[e]||(n.handlers[e]=[]),t.guid||(t.guid=rn()),n.handlers[e].push(t),n.dispatcher||(n.disabled=!1,n.dispatcher=function(s,r){if(n.disabled)return;s=fu(s);const a=n.handlers[s.type];if(a){const o=a.slice(0);for(let l=0,u=o.length;l<u&&!s.isImmediatePropagationStopped();l++)try{o[l].call(i,s,r)}catch(h){rt.error(h)}}}),n.handlers[e].length===1)if(i.addEventListener){let s=!1;ZM()&&JM.indexOf(e)>-1&&(s={passive:!0}),i.addEventListener(e,n.dispatcher,s)}else i.attachEvent&&i.attachEvent("on"+e,n.dispatcher)}function si(i,e,t){if(!fi.has(i))return;const n=fi.get(i);if(!n.handlers)return;if(Array.isArray(e))return Qh(si,i,e,t);const s=function(a,o){n.handlers[o]=[],hm(a,o)};if(e===void 0){for(const a in n.handlers)Object.prototype.hasOwnProperty.call(n.handlers||{},a)&&s(i,a);return}const r=n.handlers[e];if(r){if(!t){s(i,e);return}if(t.guid)for(let a=0;a<r.length;a++)r[a].guid===t.guid&&r.splice(a--,1);hm(i,e)}}function aa(i,e,t){const n=fi.has(i)?fi.get(i):{},s=i.parentNode||i.ownerDocument;if(typeof e=="string"?e={type:e,target:i}:e.target||(e.target=i),e=fu(e),n.dispatcher&&n.dispatcher.call(i,e,t),s&&!e.isPropagationStopped()&&e.bubbles===!0)aa.call(null,s,e,t);else if(!s&&!e.defaultPrevented&&e.target&&e.target[e.type]){fi.has(e.target)||fi.set(e.target,{});const r=fi.get(e.target);e.target[e.type]&&(r.disabled=!0,typeof e.target[e.type]=="function"&&e.target[e.type](),r.disabled=!1)}return!e.defaultPrevented}function pu(i,e,t){if(Array.isArray(e))return Qh(pu,i,e,t);const n=function(){si(i,e,n),t.apply(this,arguments)};n.guid=t.guid=t.guid||rn(),Ni(i,e,n)}function Zh(i,e,t){const n=function(){si(i,e,n),t.apply(this,arguments)};n.guid=t.guid=t.guid||rn(),Ni(i,e,n)}var ew=Object.freeze({__proto__:null,fixEvent:fu,on:Ni,off:si,trigger:aa,one:pu,any:Zh});const Wi=30,vt=function(i,e,t){e.guid||(e.guid=rn());const n=e.bind(i);return n.guid=t?t+"_"+e.guid:e.guid,n},wn=function(i,e){let t=N.performance.now();return function(...s){const r=N.performance.now();r-t>=e&&(i(...s),t=r)}},e_=function(i,e,t,n=N){let s;const r=()=>{n.clearTimeout(s),s=null},a=function(){const o=this,l=arguments;let u=function(){s=null,u=null,t||i.apply(o,l)};!s&&t&&i.apply(o,l),n.clearTimeout(s),s=n.setTimeout(u,e)};return a.cancel=r,a};var tw=Object.freeze({__proto__:null,UPDATE_REFRESH_INTERVAL:Wi,bind_:vt,throttle:wn,debounce:e_});let Da;class qi{on(e,t){const n=this.addEventListener;this.addEventListener=()=>{},Ni(this,e,t),this.addEventListener=n}off(e,t){si(this,e,t)}one(e,t){const n=this.addEventListener;this.addEventListener=()=>{},pu(this,e,t),this.addEventListener=n}any(e,t){const n=this.addEventListener;this.addEventListener=()=>{},Zh(this,e,t),this.addEventListener=n}trigger(e){const t=e.type||e;typeof e=="string"&&(e={type:t}),e=fu(e),this.allowedEvents_[t]&&this["on"+t]&&this["on"+t](e),aa(this,e)}queueTrigger(e){Da||(Da=new Map);const t=e.type||e;let n=Da.get(this);n||(n=new Map,Da.set(this,n));const s=n.get(t);n.delete(t),N.clearTimeout(s);const r=N.setTimeout(()=>{n.delete(t),n.size===0&&(n=null,Da.delete(this)),this.trigger(e)},0);n.set(t,r)}}qi.prototype.allowedEvents_={};qi.prototype.addEventListener=qi.prototype.on;qi.prototype.removeEventListener=qi.prototype.off;qi.prototype.dispatchEvent=qi.prototype.trigger;const mu=i=>typeof i.name=="function"?i.name():typeof i.name=="string"?i.name:i.name_?i.name_:i.constructor&&i.constructor.name?i.constructor.name:typeof i,jn=i=>i instanceof qi||!!i.eventBusEl_&&["on","one","off","trigger"].every(e=>typeof i[e]=="function"),iw=(i,e)=>{jn(i)?e():(i.eventedCallbacks||(i.eventedCallbacks=[]),i.eventedCallbacks.push(e))},ih=i=>typeof i=="string"&&/\S/.test(i)||Array.isArray(i)&&!!i.length,Ll=(i,e,t)=>{if(!i||!i.nodeName&&!jn(i))throw new Error(`Invalid target for ${mu(e)}#${t}; must be a DOM node or evented object.`)},t_=(i,e,t)=>{if(!ih(i))throw new Error(`Invalid event type for ${mu(e)}#${t}; must be a non-empty string or array.`)},i_=(i,e,t)=>{if(typeof i!="function")throw new Error(`Invalid listener for ${mu(e)}#${t}; must be a function.`)},gc=(i,e,t)=>{const n=e.length<3||e[0]===i||e[0]===i.eventBusEl_;let s,r,a;return n?(s=i.eventBusEl_,e.length>=3&&e.shift(),[r,a]=e):[s,r,a]=e,Ll(s,i,t),t_(r,i,t),i_(a,i,t),a=vt(i,a),{isTargetingSelf:n,target:s,type:r,listener:a}},Cs=(i,e,t,n)=>{Ll(i,i,e),i.nodeName?ew[e](i,t,n):i[e](t,n)},nw={on(...i){const{isTargetingSelf:e,target:t,type:n,listener:s}=gc(this,i,"on");if(Cs(t,"on",n,s),!e){const r=()=>this.off(t,n,s);r.guid=s.guid;const a=()=>this.off("dispose",r);a.guid=s.guid,Cs(this,"on","dispose",r),Cs(t,"on","dispose",a)}},one(...i){const{isTargetingSelf:e,target:t,type:n,listener:s}=gc(this,i,"one");if(e)Cs(t,"one",n,s);else{const r=(...a)=>{this.off(t,n,r),s.apply(null,a)};r.guid=s.guid,Cs(t,"one",n,r)}},any(...i){const{isTargetingSelf:e,target:t,type:n,listener:s}=gc(this,i,"any");if(e)Cs(t,"any",n,s);else{const r=(...a)=>{this.off(t,n,r),s.apply(null,a)};r.guid=s.guid,Cs(t,"any",n,r)}},off(i,e,t){if(!i||ih(i))si(this.eventBusEl_,i,e);else{const n=i,s=e;Ll(n,this,"off"),t_(s,this,"off"),i_(t,this,"off"),t=vt(this,t),this.off("dispose",t),n.nodeName?(si(n,s,t),si(n,"dispose",t)):jn(n)&&(n.off(s,t),n.off("dispose",t))}},trigger(i,e){Ll(this.eventBusEl_,this,"trigger");const t=i&&typeof i!="string"?i.type:i;if(!ih(t))throw new Error(`Invalid event type for ${mu(this)}#trigger; must be a non-empty string or object with a type key that has a non-empty value.`);return aa(this.eventBusEl_,i,e)}};function Jh(i,e={}){const{eventBusKey:t}=e;if(t){if(!i[t].nodeName)throw new Error(`The eventBusKey "${t}" does not refer to an element.`);i.eventBusEl_=i[t]}else i.eventBusEl_=Je("span",{className:"vjs-event-bus"});return Object.assign(i,nw),i.eventedCallbacks&&i.eventedCallbacks.forEach(n=>{n()}),i.on("dispose",()=>{i.off(),[i,i.el_,i.eventBusEl_].forEach(function(n){n&&fi.has(n)&&fi.delete(n)}),N.setTimeout(()=>{i.eventBusEl_=null},0)}),i}const sw={state:{},setState(i){typeof i=="function"&&(i=i());let e;return Pr(i,(t,n)=>{this.state[n]!==t&&(e=e||{},e[n]={from:this.state[n],to:t}),this.state[n]=t}),e&&jn(this)&&this.trigger({changes:e,type:"statechanged"}),e}};function n_(i,e){return Object.assign(i,sw),i.state=Object.assign({},i.state,e),typeof i.handleStateChanged=="function"&&jn(i)&&i.on("statechanged",i.handleStateChanged),i}const $a=function(i){return typeof i!="string"?i:i.replace(/./,e=>e.toLowerCase())},Rt=function(i){return typeof i!="string"?i:i.replace(/./,e=>e.toUpperCase())},s_=function(i,e){return Rt(i)===Rt(e)};var rw=Object.freeze({__proto__:null,toLowerCase:$a,toTitleCase:Rt,titleCaseEquals:s_});class re{constructor(e,t,n){if(!e&&this.play?this.player_=e=this:this.player_=e,this.isDisposed_=!1,this.parentComponent_=null,this.options_=_t({},this.options_),t=this.options_=_t(this.options_,t),this.id_=t.id||t.el&&t.el.id,!this.id_){const s=e&&e.id&&e.id()||"no_player";this.id_=`${s}_component_${rn()}`}this.name_=t.name||null,t.el?this.el_=t.el:t.createEl!==!1&&(this.el_=this.createEl()),t.className&&this.el_&&t.className.split(" ").forEach(s=>this.addClass(s)),["on","off","one","any","trigger"].forEach(s=>{this[s]=void 0}),t.evented!==!1&&(Jh(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),n_(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new Set,this.setIntervalIds_=new Set,this.rafIds_=new Set,this.namedRafs_=new Map,this.clearingTimersOnDispose_=!1,t.initChildren!==!1&&this.initChildren(),this.ready(n),t.reportTouchActivity!==!1&&this.enableTouchActivity()}on(e,t){}off(e,t){}one(e,t){}any(e,t){}trigger(e,t){}dispose(e={}){if(!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(let t=this.children_.length-1;t>=0;t--)this.children_[t].dispose&&this.children_[t].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&(e.restoreEl?this.el_.parentNode.replaceChild(e.restoreEl,this.el_):this.el_.parentNode.removeChild(this.el_)),this.el_=null),this.player_=null}}isDisposed(){return Boolean(this.isDisposed_)}player(){return this.player_}options(e){return e?(this.options_=_t(this.options_,e),this.options_):this.options_}el(){return this.el_}createEl(e,t,n){return Je(e,t,n)}localize(e,t,n=e){const s=this.player_.language&&this.player_.language(),r=this.player_.languages&&this.player_.languages(),a=r&&r[s],o=s&&s.split("-")[0],l=r&&r[o];let u=n;return a&&a[e]?u=a[e]:l&&l[e]&&(u=l[e]),t&&(u=u.replace(/\{(\d+)\}/g,function(h,d){const m=t[d-1];let y=m;return typeof m>"u"&&(y=h),y})),u}handleLanguagechange(){}contentEl(){return this.contentEl_||this.el_}id(){return this.id_}name(){return this.name_}children(){return this.children_}getChildById(e){return this.childIndex_[e]}getChild(e){if(e)return this.childNameIndex_[e]}getDescendant(...e){e=e.reduce((n,s)=>n.concat(s),[]);let t=this;for(let n=0;n<e.length;n++)if(t=t.getChild(e[n]),!t||!t.getChild)return;return t}setIcon(e,t=this.el()){if(!this.player_.options_.experimentalSvgIcons)return;const n="http://www.w3.org/2000/svg",s=Je("span",{className:"vjs-icon-placeholder vjs-svg-icon"},{"aria-hidden":"true"}),r=_e.createElementNS(n,"svg");r.setAttributeNS(null,"viewBox","0 0 512 512");const a=_e.createElementNS(n,"use");return r.appendChild(a),a.setAttributeNS(null,"href",`#vjs-icon-${e}`),s.appendChild(r),this.iconIsSet_?t.replaceChild(s,t.querySelector(".vjs-icon-placeholder")):t.appendChild(s),this.iconIsSet_=!0,s}addChild(e,t={},n=this.children_.length){let s,r;if(typeof e=="string"){r=Rt(e);const a=t.componentClass||r;t.name=r;const o=re.getComponent(a);if(!o)throw new Error(`Component ${a} does not exist`);if(typeof o!="function")return null;s=new o(this.player_||this,t)}else s=e;if(s.parentComponent_&&s.parentComponent_.removeChild(s),this.children_.splice(n,0,s),s.parentComponent_=this,typeof s.id=="function"&&(this.childIndex_[s.id()]=s),r=r||s.name&&Rt(s.name()),r&&(this.childNameIndex_[r]=s,this.childNameIndex_[$a(r)]=s),typeof s.el=="function"&&s.el()){let a=null;this.children_[n+1]&&(this.children_[n+1].el_?a=this.children_[n+1].el_:ra(this.children_[n+1])&&(a=this.children_[n+1])),this.contentEl().insertBefore(s.el(),a)}return s}removeChild(e){if(typeof e=="string"&&(e=this.getChild(e)),!e||!this.children_)return;let t=!1;for(let s=this.children_.length-1;s>=0;s--)if(this.children_[s]===e){t=!0,this.children_.splice(s,1);break}if(!t)return;e.parentComponent_=null,this.childIndex_[e.id()]=null,this.childNameIndex_[Rt(e.name())]=null,this.childNameIndex_[$a(e.name())]=null;const n=e.el();n&&n.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el())}initChildren(){const e=this.options_.children;if(e){const t=this.options_,n=a=>{const o=a.name;let l=a.opts;if(t[o]!==void 0&&(l=t[o]),l===!1)return;l===!0&&(l={}),l.playerOptions=this.options_.playerOptions;const u=this.addChild(o,l);u&&(this[o]=u)};let s;const r=re.getComponent("Tech");Array.isArray(e)?s=e:s=Object.keys(e),s.concat(Object.keys(this.options_).filter(function(a){return!s.some(function(o){return typeof o=="string"?a===o:a===o.name})})).map(a=>{let o,l;return typeof a=="string"?(o=a,l=e[o]||this.options_[o]||{}):(o=a.name,l=a),{name:o,opts:l}}).filter(a=>{const o=re.getComponent(a.opts.componentClass||Rt(a.name));return o&&!r.isTech(o)}).forEach(n)}}buildCSSClass(){return""}ready(e,t=!1){if(e){if(!this.isReady_){this.readyQueue_=this.readyQueue_||[],this.readyQueue_.push(e);return}t?e.call(this):this.setTimeout(e,1)}}triggerReady(){this.isReady_=!0,this.setTimeout(function(){const e=this.readyQueue_;this.readyQueue_=[],e&&e.length>0&&e.forEach(function(t){t.call(this)},this),this.trigger("ready")},1)}$(e,t){return ds(e,t||this.contentEl())}$$(e,t){return X0(e,t||this.contentEl())}hasClass(e){return qa(this.el_,e)}addClass(...e){Hs(this.el_,...e)}removeClass(...e){uu(this.el_,...e)}toggleClass(e,t){H0(this.el_,e,t)}show(){this.removeClass("vjs-hidden")}hide(){this.addClass("vjs-hidden")}lockShowing(){this.addClass("vjs-lock-showing")}unlockShowing(){this.removeClass("vjs-lock-showing")}getAttribute(e){return z0(this.el_,e)}setAttribute(e,t){Kr(this.el_,e,t)}removeAttribute(e){cu(this.el_,e)}width(e,t){return this.dimension("width",e,t)}height(e,t){return this.dimension("height",e,t)}dimensions(e,t){this.width(e,!0),this.height(t)}dimension(e,t,n){if(t!==void 0){(t===null||t!==t)&&(t=0),(""+t).indexOf("%")!==-1||(""+t).indexOf("px")!==-1?this.el_.style[e]=t:t==="auto"?this.el_.style[e]="":this.el_.style[e]=t+"px",n||this.trigger("componentresize");return}if(!this.el_)return 0;const s=this.el_.style[e],r=s.indexOf("px");return parseInt(r!==-1?s.slice(0,r):this.el_["offset"+Rt(e)],10)}currentDimension(e){let t=0;if(e!=="width"&&e!=="height")throw new Error("currentDimension only accepts width or height value");if(t=Qr(this.el_,e),t=parseFloat(t),t===0||isNaN(t)){const n=`offset${Rt(e)}`;t=this.el_[n]}return t}currentDimensions(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}}currentWidth(){return this.currentDimension("width")}currentHeight(){return this.currentDimension("height")}focus(){this.el_.focus()}blur(){this.el_.blur()}handleKeyDown(e){this.player_&&(qe.isEventKey(e,"Tab")||e.stopPropagation(),this.player_.handleKeyDown(e))}handleKeyPress(e){this.handleKeyDown(e)}emitTapEvents(){let e=0,t=null;const n=10,s=200;let r;this.on("touchstart",function(o){o.touches.length===1&&(t={pageX:o.touches[0].pageX,pageY:o.touches[0].pageY},e=N.performance.now(),r=!0)}),this.on("touchmove",function(o){if(o.touches.length>1)r=!1;else if(t){const l=o.touches[0].pageX-t.pageX,u=o.touches[0].pageY-t.pageY;Math.sqrt(l*l+u*u)>n&&(r=!1)}});const a=function(){r=!1};this.on("touchleave",a),this.on("touchcancel",a),this.on("touchend",function(o){t=null,r===!0&&N.performance.now()-e<s&&(o.preventDefault(),this.trigger("tap"))})}enableTouchActivity(){if(!this.player()||!this.player().reportUserActivity)return;const e=vt(this.player(),this.player().reportUserActivity);let t;this.on("touchstart",function(){e(),this.clearInterval(t),t=this.setInterval(e,250)});const n=function(s){e(),this.clearInterval(t)};this.on("touchmove",e),this.on("touchend",n),this.on("touchcancel",n)}setTimeout(e,t){var n;return e=vt(this,e),this.clearTimersOnDispose_(),n=N.setTimeout(()=>{this.setTimeoutIds_.has(n)&&this.setTimeoutIds_.delete(n),e()},t),this.setTimeoutIds_.add(n),n}clearTimeout(e){return this.setTimeoutIds_.has(e)&&(this.setTimeoutIds_.delete(e),N.clearTimeout(e)),e}setInterval(e,t){e=vt(this,e),this.clearTimersOnDispose_();const n=N.setInterval(e,t);return this.setIntervalIds_.add(n),n}clearInterval(e){return this.setIntervalIds_.has(e)&&(this.setIntervalIds_.delete(e),N.clearInterval(e)),e}requestAnimationFrame(e){this.clearTimersOnDispose_();var t;return e=vt(this,e),t=N.requestAnimationFrame(()=>{this.rafIds_.has(t)&&this.rafIds_.delete(t),e()}),this.rafIds_.add(t),t}requestNamedAnimationFrame(e,t){if(this.namedRafs_.has(e))return;this.clearTimersOnDispose_(),t=vt(this,t);const n=this.requestAnimationFrame(()=>{t(),this.namedRafs_.has(e)&&this.namedRafs_.delete(e)});return this.namedRafs_.set(e,n),e}cancelNamedAnimationFrame(e){this.namedRafs_.has(e)&&(this.cancelAnimationFrame(this.namedRafs_.get(e)),this.namedRafs_.delete(e))}cancelAnimationFrame(e){return this.rafIds_.has(e)&&(this.rafIds_.delete(e),N.cancelAnimationFrame(e)),e}clearTimersOnDispose_(){this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",()=>{[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(([e,t])=>{this[e].forEach((n,s)=>this[t](s))}),this.clearingTimersOnDispose_=!1}))}static registerComponent(e,t){if(typeof e!="string"||!e)throw new Error(`Illegal component name, "${e}"; must be a non-empty string.`);const n=re.getComponent("Tech"),s=n&&n.isTech(t),r=re===t||re.prototype.isPrototypeOf(t.prototype);if(s||!r){let o;throw s?o="techs must be registered using Tech.registerTech()":o="must be a Component subclass",new Error(`Illegal component, "${e}"; ${o}.`)}e=Rt(e),re.components_||(re.components_={});const a=re.getComponent("Player");if(e==="Player"&&a&&a.players){const o=a.players,l=Object.keys(o);if(o&&l.length>0&&l.map(u=>o[u]).every(Boolean))throw new Error("Can not register Player component after player has been created.")}return re.components_[e]=t,re.components_[$a(e)]=t,t}static getComponent(e){if(!(!e||!re.components_))return re.components_[e]}}re.registerComponent("Component",re);function aw(i,e,t){if(typeof e!="number"||e<0||e>t)throw new Error(`Failed to execute '${i}' on 'TimeRanges': The index provided (${e}) is non-numeric or out of bounds (0-${t}).`)}function dm(i,e,t,n){return aw(i,n,t.length-1),t[n][e]}function _c(i){let e;return i===void 0||i.length===0?e={length:0,start(){throw new Error("This TimeRanges object is empty")},end(){throw new Error("This TimeRanges object is empty")}}:e={length:i.length,start:dm.bind(null,"start",0,i),end:dm.bind(null,"end",1,i)},N.Symbol&&N.Symbol.iterator&&(e[N.Symbol.iterator]=()=>(i||[]).values()),e}function sn(i,e){return Array.isArray(i)?_c(i):i===void 0||e===void 0?_c():_c([[i,e]])}const r_=function(i,e){i=i<0?0:i;let t=Math.floor(i%60),n=Math.floor(i/60%60),s=Math.floor(i/3600);const r=Math.floor(e/60%60),a=Math.floor(e/3600);return(isNaN(i)||i===1/0)&&(s=n=t="-"),s=s>0||a>0?s+":":"",n=((s||r>=10)&&n<10?"0"+n:n)+":",t=t<10?"0"+t:t,s+n+t};let ed=r_;function a_(i){ed=i}function o_(){ed=r_}function $s(i,e=i){return ed(i,e)}var ow=Object.freeze({__proto__:null,createTimeRanges:sn,createTimeRange:sn,setFormatTime:a_,resetFormatTime:o_,formatTime:$s});function l_(i,e){let t=0,n,s;if(!e)return 0;(!i||!i.length)&&(i=sn(0,0));for(let r=0;r<i.length;r++)n=i.start(r),s=i.end(r),s>e&&(s=e),t+=s-n;return t/e}function Mt(i){if(i instanceof Mt)return i;typeof i=="number"?this.code=i:typeof i=="string"?this.message=i:An(i)&&(typeof i.code=="number"&&(this.code=i.code),Object.assign(this,i)),this.message||(this.message=Mt.defaultMessages[this.code]||"")}Mt.prototype.code=0;Mt.prototype.message="";Mt.prototype.status=null;Mt.prototype.metadata=null;Mt.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"];Mt.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};Mt.MEDIA_ERR_CUSTOM=0;Mt.prototype.MEDIA_ERR_CUSTOM=0;Mt.MEDIA_ERR_ABORTED=1;Mt.prototype.MEDIA_ERR_ABORTED=1;Mt.MEDIA_ERR_NETWORK=2;Mt.prototype.MEDIA_ERR_NETWORK=2;Mt.MEDIA_ERR_DECODE=3;Mt.prototype.MEDIA_ERR_DECODE=3;Mt.MEDIA_ERR_SRC_NOT_SUPPORTED=4;Mt.prototype.MEDIA_ERR_SRC_NOT_SUPPORTED=4;Mt.MEDIA_ERR_ENCRYPTED=5;Mt.prototype.MEDIA_ERR_ENCRYPTED=5;function ja(i){return i!=null&&typeof i.then=="function"}function mn(i){ja(i)&&i.then(null,e=>{})}const nh=function(i){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce((t,n,s)=>(i[n]&&(t[n]=i[n]),t),{cues:i.cues&&Array.prototype.map.call(i.cues,function(t){return{startTime:t.startTime,endTime:t.endTime,text:t.text,id:t.id}})})},lw=function(i){const e=i.$$("track"),t=Array.prototype.map.call(e,s=>s.track);return Array.prototype.map.call(e,function(s){const r=nh(s.track);return s.src&&(r.src=s.src),r}).concat(Array.prototype.filter.call(i.textTracks(),function(s){return t.indexOf(s)===-1}).map(nh))},uw=function(i,e){return i.forEach(function(t){const n=e.addRemoteTextTrack(t).track;!t.src&&t.cues&&t.cues.forEach(s=>n.addCue(s))}),e.textTracks()};var fm={textTracksToJson:lw,jsonToTextTracks:uw,trackToJson_:nh};const vc="vjs-modal-dialog";class oa extends re{constructor(e,t){super(e,t),this.handleKeyDown_=n=>this.handleKeyDown(n),this.close_=n=>this.close(n),this.opened_=this.hasBeenOpened_=this.hasBeenFilled_=!1,this.closeable(!this.options_.uncloseable),this.content(this.options_.content),this.contentEl_=Je("div",{className:`${vc}-content`},{role:"document"}),this.descEl_=Je("p",{className:`${vc}-description vjs-control-text`,id:this.el().getAttribute("aria-describedby")}),ms(this.descEl_,this.description()),this.el_.appendChild(this.descEl_),this.el_.appendChild(this.contentEl_)}createEl(){return super.createEl("div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":`${this.id()}_description`,"aria-hidden":"true","aria-label":this.label(),role:"dialog","aria-live":"polite"})}dispose(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,super.dispose()}buildCSSClass(){return`${vc} vjs-hidden ${super.buildCSSClass()}`}label(){return this.localize(this.options_.label||"Modal Window")}description(){let e=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),e}open(){if(this.opened_){this.options_.fillAlways&&this.fill();return}const e=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}opened(e){return typeof e=="boolean"&&this[e?"open":"close"](),this.opened_}close(){if(!this.opened_)return;const e=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger("modalclose"),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}closeable(e){if(typeof e=="boolean"){const t=this.closeable_=!!e;let n=this.getChild("closeButton");if(t&&!n){const s=this.contentEl_;this.contentEl_=this.el_,n=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=s,this.on(n,"close",this.close_)}!t&&n&&(this.off(n,"close",this.close_),this.removeChild(n),n.dispose())}return this.closeable_}fill(){this.fillWith(this.content())}fillWith(e){const t=this.contentEl(),n=t.parentNode,s=t.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,n.removeChild(t),this.empty(),j0(t,e),this.trigger("modalfill"),s?n.insertBefore(t,s):n.appendChild(t);const r=this.getChild("closeButton");r&&n.appendChild(r.el_)}empty(){this.trigger("beforemodalempty"),du(this.contentEl()),this.trigger("modalempty")}content(e){return typeof e<"u"&&(this.content_=e),this.content_}conditionalFocus_(){const e=_e.activeElement,t=this.player_.el_;this.previouslyActiveEl_=null,(t.contains(e)||t===e)&&(this.previouslyActiveEl_=e,this.focus())}conditionalBlur_(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)}handleKeyDown(e){if(e.stopPropagation(),qe.isEventKey(e,"Escape")&&this.closeable()){e.preventDefault(),this.close();return}if(!qe.isEventKey(e,"Tab"))return;const t=this.focusableEls_(),n=this.el_.querySelector(":focus");let s;for(let r=0;r<t.length;r++)if(n===t[r]){s=r;break}_e.activeElement===this.el_&&(s=0),e.shiftKey&&s===0?(t[t.length-1].focus(),e.preventDefault()):!e.shiftKey&&s===t.length-1&&(t[0].focus(),e.preventDefault())}focusableEls_(){const e=this.el_.querySelectorAll("*");return Array.prototype.filter.call(e,t=>(t instanceof N.HTMLAnchorElement||t instanceof N.HTMLAreaElement)&&t.hasAttribute("href")||(t instanceof N.HTMLInputElement||t instanceof N.HTMLSelectElement||t instanceof N.HTMLTextAreaElement||t instanceof N.HTMLButtonElement)&&!t.hasAttribute("disabled")||t instanceof N.HTMLIFrameElement||t instanceof N.HTMLObjectElement||t instanceof N.HTMLEmbedElement||t.hasAttribute("tabindex")&&t.getAttribute("tabindex")!==-1||t.hasAttribute("contenteditable"))}}oa.prototype.options_={pauseOnOpen:!0,temporary:!0};re.registerComponent("ModalDialog",oa);class Zr extends qi{constructor(e=[]){super(),this.tracks_=[],Object.defineProperty(this,"length",{get(){return this.tracks_.length}});for(let t=0;t<e.length;t++)this.addTrack(e[t])}addTrack(e){const t=this.tracks_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.tracks_[t]}}),this.tracks_.indexOf(e)===-1&&(this.tracks_.push(e),this.trigger({track:e,type:"addtrack",target:this})),e.labelchange_=()=>{this.trigger({track:e,type:"labelchange",target:this})},jn(e)&&e.addEventListener("labelchange",e.labelchange_)}removeTrack(e){let t;for(let n=0,s=this.length;n<s;n++)if(this[n]===e){t=this[n],t.off&&t.off(),this.tracks_.splice(n,1);break}t&&this.trigger({track:t,type:"removetrack",target:this})}getTrackById(e){let t=null;for(let n=0,s=this.length;n<s;n++){const r=this[n];if(r.id===e){t=r;break}}return t}}Zr.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"};for(const i in Zr.prototype.allowedEvents_)Zr.prototype["on"+i]=null;const yc=function(i,e){for(let t=0;t<i.length;t++)!Object.keys(i[t]).length||e.id===i[t].id||(i[t].enabled=!1)};class cw extends Zr{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].enabled){yc(e,e[t]);break}super(e),this.changing_=!1}addTrack(e){e.enabled&&yc(this,e),super.addTrack(e),e.addEventListener&&(e.enabledChange_=()=>{this.changing_||(this.changing_=!0,yc(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("enabledchange",e.enabledChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.enabledChange_&&(e.removeEventListener("enabledchange",e.enabledChange_),e.enabledChange_=null)}}const Tc=function(i,e){for(let t=0;t<i.length;t++)!Object.keys(i[t]).length||e.id===i[t].id||(i[t].selected=!1)};class hw extends Zr{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].selected){Tc(e,e[t]);break}super(e),this.changing_=!1,Object.defineProperty(this,"selectedIndex",{get(){for(let t=0;t<this.length;t++)if(this[t].selected)return t;return-1},set(){}})}addTrack(e){e.selected&&Tc(this,e),super.addTrack(e),e.addEventListener&&(e.selectedChange_=()=>{this.changing_||(this.changing_=!0,Tc(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("selectedchange",e.selectedChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.selectedChange_&&(e.removeEventListener("selectedchange",e.selectedChange_),e.selectedChange_=null)}}class u_ extends Zr{addTrack(e){super.addTrack(e),this.queueChange_||(this.queueChange_=()=>this.queueTrigger("change")),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=()=>this.trigger("selectedlanguagechange")),e.addEventListener("modechange",this.queueChange_),["metadata","chapters"].indexOf(e.kind)===-1&&e.addEventListener("modechange",this.triggerSelectedlanguagechange_)}removeTrack(e){super.removeTrack(e),e.removeEventListener&&(this.queueChange_&&e.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&e.removeEventListener("modechange",this.triggerSelectedlanguagechange_))}}class dw{constructor(e=[]){this.trackElements_=[],Object.defineProperty(this,"length",{get(){return this.trackElements_.length}});for(let t=0,n=e.length;t<n;t++)this.addTrackElement_(e[t])}addTrackElement_(e){const t=this.trackElements_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.trackElements_[t]}}),this.trackElements_.indexOf(e)===-1&&this.trackElements_.push(e)}getTrackElementByTrack_(e){let t;for(let n=0,s=this.trackElements_.length;n<s;n++)if(e===this.trackElements_[n].track){t=this.trackElements_[n];break}return t}removeTrackElement_(e){for(let t=0,n=this.trackElements_.length;t<n;t++)if(e===this.trackElements_[t]){this.trackElements_[t].track&&typeof this.trackElements_[t].track.off=="function"&&this.trackElements_[t].track.off(),typeof this.trackElements_[t].off=="function"&&this.trackElements_[t].off(),this.trackElements_.splice(t,1);break}}}class Il{constructor(e){Il.prototype.setCues_.call(this,e),Object.defineProperty(this,"length",{get(){return this.length_}})}setCues_(e){const t=this.length||0;let n=0;const s=e.length;this.cues_=e,this.length_=e.length;const r=function(a){""+a in this||Object.defineProperty(this,""+a,{get(){return this.cues_[a]}})};if(t<s)for(n=t;n<s;n++)r.call(this,n)}getCueById(e){let t=null;for(let n=0,s=this.length;n<s;n++){const r=this[n];if(r.id===e){t=r;break}}return t}}const fw={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},pw={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},mw={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},pm={disabled:"disabled",hidden:"hidden",showing:"showing"};class td extends qi{constructor(e={}){super();const t={id:e.id||"vjs_track_"+rn(),kind:e.kind||"",language:e.language||""};let n=e.label||"";for(const s in t)Object.defineProperty(this,s,{get(){return t[s]},set(){}});Object.defineProperty(this,"label",{get(){return n},set(s){s!==n&&(n=s,this.trigger("labelchange"))}})}}const id=function(i){const e=["protocol","hostname","port","pathname","search","hash","host"],t=_e.createElement("a");t.href=i;const n={};for(let s=0;s<e.length;s++)n[e[s]]=t[e[s]];return n.protocol==="http:"&&(n.host=n.host.replace(/:80$/,"")),n.protocol==="https:"&&(n.host=n.host.replace(/:443$/,"")),n.protocol||(n.protocol=N.location.protocol),n.host||(n.host=N.location.host),n},c_=function(i){if(!i.match(/^https?:\/\//)){const e=_e.createElement("a");e.href=i,i=e.href}return i},nd=function(i){if(typeof i=="string"){const t=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/.exec(i);if(t)return t.pop().toLowerCase()}return""},gu=function(i,e=N.location){const t=id(i);return(t.protocol===":"?e.protocol:t.protocol)+t.host!==e.protocol+e.host};var gw=Object.freeze({__proto__:null,parseUrl:id,getAbsoluteURL:c_,getFileExtension:nd,isCrossOrigin:gu});const mm=function(i,e){const t=new N.WebVTT.Parser(N,N.vttjs,N.WebVTT.StringDecoder()),n=[];t.oncue=function(s){e.addCue(s)},t.onparsingerror=function(s){n.push(s)},t.onflush=function(){e.trigger({type:"loadeddata",target:e})},t.parse(i),n.length>0&&(N.console&&N.console.groupCollapsed&&N.console.groupCollapsed(`Text Track parsing errors for ${e.src}`),n.forEach(s=>rt.error(s)),N.console&&N.console.groupEnd&&N.console.groupEnd()),t.flush()},gm=function(i,e){const t={uri:i},n=gu(i);n&&(t.cors=n);const s=e.tech_.crossOrigin()==="use-credentials";s&&(t.withCredentials=s),eo(t,vt(this,function(r,a,o){if(r)return rt.error(r,a);e.loaded_=!0,typeof N.WebVTT!="function"?e.tech_&&e.tech_.any(["vttjsloaded","vttjserror"],l=>{if(l.type==="vttjserror"){rt.error(`vttjs failed to load, stopping trying to process ${e.src}`);return}return mm(o,e)}):mm(o,e)}))};class vo extends td{constructor(e={}){if(!e.tech)throw new Error("A tech was not provided.");const t=_t(e,{kind:mw[e.kind]||"subtitles",language:e.language||e.srclang||""});let n=pm[t.mode]||"disabled";const s=t.default;(t.kind==="metadata"||t.kind==="chapters")&&(n="hidden"),super(t),this.tech_=t.tech,this.cues_=[],this.activeCues_=[],this.preload_=this.tech_.preloadTextTracks!==!1;const r=new Il(this.cues_),a=new Il(this.activeCues_);let o=!1;this.timeupdateHandler=vt(this,function(u={}){if(!this.tech_.isDisposed()){if(!this.tech_.isReady_){u.type!=="timeupdate"&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler));return}this.activeCues=this.activeCues,o&&(this.trigger("cuechange"),o=!1),u.type!=="timeupdate"&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler))}});const l=()=>{this.stopTracking()};this.tech_.one("dispose",l),n!=="disabled"&&this.startTracking(),Object.defineProperties(this,{default:{get(){return s},set(){}},mode:{get(){return n},set(u){pm[u]&&n!==u&&(n=u,!this.preload_&&n!=="disabled"&&this.cues.length===0&&gm(this.src,this),this.stopTracking(),n!=="disabled"&&this.startTracking(),this.trigger("modechange"))}},cues:{get(){return this.loaded_?r:null},set(){}},activeCues:{get(){if(!this.loaded_)return null;if(this.cues.length===0)return a;const u=this.tech_.currentTime(),h=[];for(let d=0,m=this.cues.length;d<m;d++){const y=this.cues[d];y.startTime<=u&&y.endTime>=u&&h.push(y)}if(o=!1,h.length!==this.activeCues_.length)o=!0;else for(let d=0;d<h.length;d++)this.activeCues_.indexOf(h[d])===-1&&(o=!0);return this.activeCues_=h,a.setCues_(this.activeCues_),a},set(){}}}),t.src?(this.src=t.src,this.preload_||(this.loaded_=!0),(this.preload_||t.kind!=="subtitles"&&t.kind!=="captions")&&gm(this.src,this)):this.loaded_=!0}startTracking(){this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler),this.tech_.on("timeupdate",this.timeupdateHandler)}stopTracking(){this.rvf_&&(this.tech_.cancelVideoFrameCallback(this.rvf_),this.rvf_=void 0),this.tech_.off("timeupdate",this.timeupdateHandler)}addCue(e){let t=e;if(!("getCueAsHTML"in t)){t=new N.vttjs.VTTCue(e.startTime,e.endTime,e.text);for(const s in e)s in t||(t[s]=e[s]);t.id=e.id,t.originalCue_=e}const n=this.tech_.textTracks();for(let s=0;s<n.length;s++)n[s]!==this&&n[s].removeCue(t);this.cues_.push(t),this.cues.setCues_(this.cues_)}removeCue(e){let t=this.cues_.length;for(;t--;){const n=this.cues_[t];if(n===e||n.originalCue_&&n.originalCue_===e){this.cues_.splice(t,1),this.cues.setCues_(this.cues_);break}}}}vo.prototype.allowedEvents_={cuechange:"cuechange"};class h_ extends td{constructor(e={}){const t=_t(e,{kind:pw[e.kind]||""});super(t);let n=!1;Object.defineProperty(this,"enabled",{get(){return n},set(s){typeof s!="boolean"||s===n||(n=s,this.trigger("enabledchange"))}}),t.enabled&&(this.enabled=t.enabled),this.loaded_=!0}}class d_ extends td{constructor(e={}){const t=_t(e,{kind:fw[e.kind]||""});super(t);let n=!1;Object.defineProperty(this,"selected",{get(){return n},set(s){typeof s!="boolean"||s===n||(n=s,this.trigger("selectedchange"))}}),t.selected&&(this.selected=t.selected)}}class Qn extends qi{constructor(e={}){super();let t;const n=new vo(e);this.kind=n.kind,this.src=n.src,this.srclang=n.language,this.label=n.label,this.default=n.default,Object.defineProperties(this,{readyState:{get(){return t}},track:{get(){return n}}}),t=Qn.NONE,n.addEventListener("loadeddata",()=>{t=Qn.LOADED,this.trigger({type:"load",target:this})})}}Qn.prototype.allowedEvents_={load:"load"};Qn.NONE=0;Qn.LOADING=1;Qn.LOADED=2;Qn.ERROR=3;const Gi={audio:{ListClass:cw,TrackClass:h_,capitalName:"Audio"},video:{ListClass:hw,TrackClass:d_,capitalName:"Video"},text:{ListClass:u_,TrackClass:vo,capitalName:"Text"}};Object.keys(Gi).forEach(function(i){Gi[i].getterName=`${i}Tracks`,Gi[i].privateName=`${i}Tracks_`});const Jr={remoteText:{ListClass:u_,TrackClass:vo,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:dw,TrackClass:Qn,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},hi=Object.assign({},Gi,Jr);Jr.names=Object.keys(Jr);Gi.names=Object.keys(Gi);hi.names=[].concat(Jr.names).concat(Gi.names);function _w(i,e,t,n,s={}){const r=i.textTracks();s.kind=e,t&&(s.label=t),n&&(s.language=n),s.tech=i;const a=new hi.text.TrackClass(s);return r.addTrack(a),a}class Qe extends re{constructor(e={},t=function(){}){e.reportTouchActivity=!1,super(null,e,t),this.onDurationChange_=n=>this.onDurationChange(n),this.trackProgress_=n=>this.trackProgress(n),this.trackCurrentTime_=n=>this.trackCurrentTime(n),this.stopTrackingCurrentTime_=n=>this.stopTrackingCurrentTime(n),this.disposeSourceHandler_=n=>this.disposeSourceHandler(n),this.queuedHanders_=new Set,this.hasStarted_=!1,this.on("playing",function(){this.hasStarted_=!0}),this.on("loadstart",function(){this.hasStarted_=!1}),hi.names.forEach(n=>{const s=hi[n];e&&e[s.getterName]&&(this[s.privateName]=e[s.getterName])}),this.featuresProgressEvents||this.manualProgressOn(),this.featuresTimeupdateEvents||this.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(n=>{e[`native${n}Tracks`]===!1&&(this[`featuresNative${n}Tracks`]=!1)}),e.nativeCaptions===!1||e.nativeTextTracks===!1?this.featuresNativeTextTracks=!1:(e.nativeCaptions===!0||e.nativeTextTracks===!0)&&(this.featuresNativeTextTracks=!0),this.featuresNativeTextTracks||this.emulateTextTracks(),this.preloadTextTracks=e.preloadTextTracks!==!1,this.autoRemoteTextTracks_=new hi.text.ListClass,this.initTrackListeners(),e.nativeControlsForTouch||this.emitTapEvents(),this.constructor&&(this.name_=this.constructor.name||"Unknown Tech")}triggerSourceset(e){this.isReady_||this.one("ready",()=>this.setTimeout(()=>this.triggerSourceset(e),1)),this.trigger({src:e,type:"sourceset"})}manualProgressOn(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)}manualProgressOff(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)}trackProgress(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(vt(this,function(){const t=this.bufferedPercent();this.bufferedPercent_!==t&&this.trigger("progress"),this.bufferedPercent_=t,t===1&&this.stopTrackingProgress()}),500)}onDurationChange(e){this.duration_=this.duration()}buffered(){return sn(0,0)}bufferedPercent(){return l_(this.buffered(),this.duration_)}stopTrackingProgress(){this.clearInterval(this.progressInterval)}manualTimeUpdatesOn(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)}manualTimeUpdatesOff(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)}trackCurrentTime(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)}stopTrackingCurrentTime(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}dispose(){this.clearTracks(Gi.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),super.dispose()}clearTracks(e){e=[].concat(e),e.forEach(t=>{const n=this[`${t}Tracks`]()||[];let s=n.length;for(;s--;){const r=n[s];t==="text"&&this.removeRemoteTextTrack(r),n.removeTrack(r)}})}cleanupAutoTextTracks(){const e=this.autoRemoteTextTracks_||[];let t=e.length;for(;t--;){const n=e[t];this.removeRemoteTextTrack(n)}}reset(){}crossOrigin(){}setCrossOrigin(){}error(e){return e!==void 0&&(this.error_=new Mt(e),this.trigger("error")),this.error_}played(){return this.hasStarted_?sn(0,0):sn()}play(){}setScrubbing(e){}scrubbing(){}setCurrentTime(e){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}initTrackListeners(){Gi.names.forEach(e=>{const t=Gi[e],n=()=>{this.trigger(`${e}trackchange`)},s=this[t.getterName]();s.addEventListener("removetrack",n),s.addEventListener("addtrack",n),this.on("dispose",()=>{s.removeEventListener("removetrack",n),s.removeEventListener("addtrack",n)})})}addWebVttScript_(){if(!N.WebVTT)if(_e.body.contains(this.el())){if(!this.options_["vtt.js"]&&Xr(Sl)&&Object.keys(Sl).length>0){this.trigger("vttjsloaded");return}const e=_e.createElement("script");e.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",e.onload=()=>{this.trigger("vttjsloaded")},e.onerror=()=>{this.trigger("vttjserror")},this.on("dispose",()=>{e.onload=null,e.onerror=null}),N.WebVTT=!0,this.el().parentNode.appendChild(e)}else this.ready(this.addWebVttScript_)}emulateTextTracks(){const e=this.textTracks(),t=this.remoteTextTracks(),n=o=>e.addTrack(o.track),s=o=>e.removeTrack(o.track);t.on("addtrack",n),t.on("removetrack",s),this.addWebVttScript_();const r=()=>this.trigger("texttrackchange"),a=()=>{r();for(let o=0;o<e.length;o++){const l=e[o];l.removeEventListener("cuechange",r),l.mode==="showing"&&l.addEventListener("cuechange",r)}};a(),e.addEventListener("change",a),e.addEventListener("addtrack",a),e.addEventListener("removetrack",a),this.on("dispose",function(){t.off("addtrack",n),t.off("removetrack",s),e.removeEventListener("change",a),e.removeEventListener("addtrack",a),e.removeEventListener("removetrack",a);for(let o=0;o<e.length;o++)e[o].removeEventListener("cuechange",r)})}addTextTrack(e,t,n){if(!e)throw new Error("TextTrack kind is required but was not provided");return _w(this,e,t,n)}createRemoteTextTrack(e){const t=_t(e,{tech:this});return new Jr.remoteTextEl.TrackClass(t)}addRemoteTextTrack(e={},t){const n=this.createRemoteTextTrack(e);return typeof t!="boolean"&&(t=!1),this.remoteTextTrackEls().addTrackElement_(n),this.remoteTextTracks().addTrack(n.track),t===!1&&this.ready(()=>this.autoRemoteTextTracks_.addTrack(n.track)),n}removeRemoteTextTrack(e){const t=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(t),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)}getVideoPlaybackQuality(){return{}}requestPictureInPicture(){return Promise.reject()}disablePictureInPicture(){return!0}setDisablePictureInPicture(){}requestVideoFrameCallback(e){const t=rn();return!this.isReady_||this.paused()?(this.queuedHanders_.add(t),this.one("playing",()=>{this.queuedHanders_.has(t)&&(this.queuedHanders_.delete(t),e())})):this.requestNamedAnimationFrame(t,e),t}cancelVideoFrameCallback(e){this.queuedHanders_.has(e)?this.queuedHanders_.delete(e):this.cancelNamedAnimationFrame(e)}setPoster(){}playsinline(){}setPlaysinline(){}overrideNativeAudioTracks(e){}overrideNativeVideoTracks(e){}canPlayType(e){return""}static canPlayType(e){return""}static canPlaySource(e,t){return Qe.canPlayType(e.type)}static isTech(e){return e.prototype instanceof Qe||e instanceof Qe||e===Qe}static registerTech(e,t){if(Qe.techs_||(Qe.techs_={}),!Qe.isTech(t))throw new Error(`Tech ${e} must be a Tech`);if(!Qe.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!Qe.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return e=Rt(e),Qe.techs_[e]=t,Qe.techs_[$a(e)]=t,e!=="Tech"&&Qe.defaultTechOrder_.push(e),t}static getTech(e){if(e){if(Qe.techs_&&Qe.techs_[e])return Qe.techs_[e];if(e=Rt(e),N&&N.videojs&&N.videojs[e])return rt.warn(`The ${e} tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)`),N.videojs[e]}}}hi.names.forEach(function(i){const e=hi[i];Qe.prototype[e.getterName]=function(){return this[e.privateName]=this[e.privateName]||new e.ListClass,this[e.privateName]}});Qe.prototype.featuresVolumeControl=!0;Qe.prototype.featuresMuteControl=!0;Qe.prototype.featuresFullscreenResize=!1;Qe.prototype.featuresPlaybackRate=!1;Qe.prototype.featuresProgressEvents=!1;Qe.prototype.featuresSourceset=!1;Qe.prototype.featuresTimeupdateEvents=!1;Qe.prototype.featuresNativeTextTracks=!1;Qe.prototype.featuresVideoFrameCallback=!1;Qe.withSourceHandlers=function(i){i.registerSourceHandler=function(t,n){let s=i.sourceHandlers;s||(s=i.sourceHandlers=[]),n===void 0&&(n=s.length),s.splice(n,0,t)},i.canPlayType=function(t){const n=i.sourceHandlers||[];let s;for(let r=0;r<n.length;r++)if(s=n[r].canPlayType(t),s)return s;return""},i.selectSourceHandler=function(t,n){const s=i.sourceHandlers||[];let r;for(let a=0;a<s.length;a++)if(r=s[a].canHandleSource(t,n),r)return s[a];return null},i.canPlaySource=function(t,n){const s=i.selectSourceHandler(t,n);return s?s.canHandleSource(t,n):""},["seekable","seeking","duration"].forEach(function(t){const n=this[t];typeof n=="function"&&(this[t]=function(){return this.sourceHandler_&&this.sourceHandler_[t]?this.sourceHandler_[t].apply(this.sourceHandler_,arguments):n.apply(this,arguments)})},i.prototype),i.prototype.setSource=function(t){let n=i.selectSourceHandler(t,this.options_);n||(i.nativeSourceHandler?n=i.nativeSourceHandler:rt.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),n!==i.nativeSourceHandler&&(this.currentSource_=t),this.sourceHandler_=n.handleSource(t,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},i.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}};re.registerComponent("Tech",Qe);Qe.registerTech("Tech",Qe);Qe.defaultTechOrder_=[];const Vs={},sh={},Ol={};function vw(i,e){Vs[i]=Vs[i]||[],Vs[i].push(e)}function yw(i,e,t){i.setTimeout(()=>Ds(e,Vs[e.type],t,i),1)}function Tw(i,e){i.forEach(t=>t.setTech&&t.setTech(e))}function xw(i,e,t){return i.reduceRight(sd(t),e[t]())}function Sw(i,e,t,n){return e[t](i.reduce(sd(t),n))}function _m(i,e,t,n=null){const s="call"+Rt(t),r=i.reduce(sd(s),n),a=r===Ol,o=a?null:e[t](r);return Aw(i,t,o,a),o}const bw={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},Ew={setCurrentTime:1,setMuted:1,setVolume:1},vm={play:1,pause:1};function sd(i){return(e,t)=>e===Ol?Ol:t[i]?t[i](e):e}function Aw(i,e,t,n){for(let s=i.length-1;s>=0;s--){const r=i[s];r[e]&&r[e](n,t)}}function Cw(i){sh[i.id()]=null}function Mw(i,e){const t=sh[i.id()];let n=null;if(t==null)return n=e(i),sh[i.id()]=[[e,n]],n;for(let s=0;s<t.length;s++){const[r,a]=t[s];r===e&&(n=a)}return n===null&&(n=e(i),t.push([e,n])),n}function Ds(i={},e=[],t,n,s=[],r=!1){const[a,...o]=e;if(typeof a=="string")Ds(i,Vs[a],t,n,s,r);else if(a){const l=Mw(n,a);if(!l.setSource)return s.push(l),Ds(i,o,t,n,s,r);l.setSource(Object.assign({},i),function(u,h){if(u)return Ds(i,o,t,n,s,r);s.push(l),Ds(h,i.type===h.type?o:Vs[h.type],t,n,s,r)})}else o.length?Ds(i,o,t,n,s,r):r?t(i,s):Ds(i,Vs["*"],t,n,s,!0)}const ww={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},Ul=function(i=""){const e=nd(i);return ww[e.toLowerCase()]||""},Dw=(i,e)=>{if(!e)return"";if(i.cache_.source.src===e&&i.cache_.source.type)return i.cache_.source.type;const t=i.cache_.sources.filter(s=>s.src===e);if(t.length)return t[0].type;const n=i.$$("source");for(let s=0;s<n.length;s++){const r=n[s];if(r.type&&r.src&&r.src===e)return r.type}return Ul(e)},f_=function(i){if(Array.isArray(i)){let e=[];i.forEach(function(t){t=f_(t),Array.isArray(t)?e=e.concat(t):An(t)&&e.push(t)}),i=e}else typeof i=="string"&&i.trim()?i=[ym({src:i})]:An(i)&&typeof i.src=="string"&&i.src&&i.src.trim()?i=[ym(i)]:i=[];return i};function ym(i){if(!i.type){const e=Ul(i.src);e&&(i.type=e)}return i}var Rw=`<svg xmlns="http://www.w3.org/2000/svg">
  <defs>
    <symbol viewBox="0 0 48 48" id="vjs-icon-play">
      <path d="M16 10v28l22-14z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-pause">
      <path d="M12 38h8V10h-8v28zm16-28v28h8V10h-8z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-audio">
      <path d="M24 2C14.06 2 6 10.06 6 20v14c0 3.31 2.69 6 6 6h6V24h-8v-4c0-7.73 6.27-14 14-14s14 6.27 14 14v4h-8v16h6c3.31 0 6-2.69 6-6V20c0-9.94-8.06-18-18-18z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-captions">
      <path d="M38 8H10c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h28c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM22 22h-3v-1h-4v6h4v-1h3v2a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2zm14 0h-3v-1h-4v6h4v-1h3v2a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-subtitles">
      <path d="M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM8 24h8v4H8v-4zm20 12H8v-4h20v4zm12 0h-8v-4h8v4zm0-8H20v-4h20v4z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-fullscreen-enter">
      <path d="M14 28h-4v10h10v-4h-6v-6zm-4-8h4v-6h6v-4H10v10zm24 14h-6v4h10V28h-4v6zm-6-24v4h6v6h4V10H28z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-fullscreen-exit">
      <path d="M10 32h6v6h4V28H10v4zm6-16h-6v4h10V10h-4v6zm12 22h4v-6h6v-4H28v10zm4-22v-6h-4v10h10v-4h-6z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-play-circle">
      <path d="M20 33l12-9-12-9v18zm4-29C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-mute">
      <path d="M33 24c0-3.53-2.04-6.58-5-8.05v4.42l4.91 4.91c.06-.42.09-.85.09-1.28zm5 0c0 1.88-.41 3.65-1.08 5.28l3.03 3.03C41.25 29.82 42 27 42 24c0-8.56-5.99-15.72-14-17.54v4.13c5.78 1.72 10 7.07 10 13.41zM8.55 6L6 8.55 15.45 18H6v12h8l10 10V26.55l8.51 8.51c-1.34 1.03-2.85 1.86-4.51 2.36v4.13a17.94 17.94 0 0 0 7.37-3.62L39.45 42 42 39.45l-18-18L8.55 6zM24 8l-4.18 4.18L24 16.36V8z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-low">
      <path d="M14 18v12h8l10 10V8L22 18h-8z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-medium">
      <path d="M37 24c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zm-27-6v12h8l10 10V8L18 18h-8z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-high">
      <path d="M6 18v12h8l10 10V8L14 18H6zm27 6c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zM28 6.46v4.13c5.78 1.72 10 7.07 10 13.41s-4.22 11.69-10 13.41v4.13c8.01-1.82 14-8.97 14-17.54S36.01 8.28 28 6.46z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-spinner">
      <path d="M18.8 21l9.53-16.51C26.94 4.18 25.49 4 24 4c-4.8 0-9.19 1.69-12.64 4.51l7.33 12.69.11-.2zm24.28-3c-1.84-5.85-6.3-10.52-11.99-12.68L23.77 18h19.31zm.52 2H28.62l.58 1 9.53 16.5C41.99 33.94 44 29.21 44 24c0-1.37-.14-2.71-.4-4zm-26.53 4l-7.8-13.5C6.01 14.06 4 18.79 4 24c0 1.37.14 2.71.4 4h14.98l-2.31-4zM4.92 30c1.84 5.85 6.3 10.52 11.99 12.68L24.23 30H4.92zm22.54 0l-7.8 13.51c1.4.31 2.85.49 4.34.49 4.8 0 9.19-1.69 12.64-4.51L29.31 26.8 27.46 30z"></path>
    </symbol>
    <symbol viewBox="0 0 24 24" id="vjs-icon-hd">
      <path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-8 12H9.5v-2h-2v2H6V9h1.5v2.5h2V9H11v6zm2-6h4c.55 0 1 .45 1 1v4c0 .55-.45 1-1 1h-4V9zm1.5 4.5h2v-3h-2v3z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-chapters">
      <path d="M6 26h4v-4H6v4zm0 8h4v-4H6v4zm0-16h4v-4H6v4zm8 8h28v-4H14v4zm0 8h28v-4H14v4zm0-20v4h28v-4H14z"></path>
    </symbol>
    <symbol viewBox="0 0 40 40" id="vjs-icon-downloading">
      <path d="M18.208 36.875q-3.208-.292-5.979-1.729-2.771-1.438-4.812-3.729-2.042-2.292-3.188-5.229-1.146-2.938-1.146-6.23 0-6.583 4.334-11.416 4.333-4.834 10.833-5.5v3.166q-5.167.75-8.583 4.646Q6.25 14.75 6.25 19.958q0 5.209 3.396 9.104 3.396 3.896 8.562 4.646zM20 28.417L11.542 20l2.083-2.083 4.917 4.916v-11.25h2.916v11.25l4.875-4.916L28.417 20zm1.792 8.458v-3.167q1.833-.25 3.541-.958 1.709-.708 3.167-1.875l2.333 2.292q-1.958 1.583-4.25 2.541-2.291.959-4.791 1.167zm6.791-27.792q-1.541-1.125-3.25-1.854-1.708-.729-3.541-1.021V3.042q2.5.25 4.77 1.208 2.271.958 4.271 2.5zm4.584 21.584l-2.25-2.25q1.166-1.5 1.854-3.209.687-1.708.937-3.541h3.209q-.292 2.5-1.229 4.791-.938 2.292-2.521 4.209zm.541-12.417q-.291-1.833-.958-3.562-.667-1.73-1.833-3.188l2.375-2.208q1.541 1.916 2.458 4.208.917 2.292 1.167 4.75z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download">
      <path d="M10.8 40.55q-1.35 0-2.375-1T7.4 37.15v-7.7h3.4v7.7h26.35v-7.7h3.4v7.7q0 1.4-1 2.4t-2.4 1zM24 32.1L13.9 22.05l2.45-2.45 5.95 5.95V7.15h3.4v18.4l5.95-5.95 2.45 2.45z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download-done">
      <path d="M9.8 40.5v-3.45h28.4v3.45zm9.2-9.05L7.4 19.85l2.45-2.35L19 26.65l19.2-19.2 2.4 2.4z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download-off">
      <path d="M4.9 4.75L43.25 43.1 41 45.3l-4.75-4.75q-.05.05-.075.025-.025-.025-.075-.025H10.8q-1.35 0-2.375-1T7.4 37.15v-7.7h3.4v7.7h22.05l-7-7-1.85 1.8L13.9 21.9l1.85-1.85L2.7 7zm26.75 14.7l2.45 2.45-3.75 3.8-2.45-2.5zM25.7 7.15V21.1l-3.4-3.45V7.15z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-share">
      <path d="M36 32.17c-1.52 0-2.89.59-3.93 1.54L17.82 25.4c.11-.45.18-.92.18-1.4s-.07-.95-.18-1.4l14.1-8.23c1.07 1 2.5 1.62 4.08 1.62 3.31 0 6-2.69 6-6s-2.69-6-6-6-6 2.69-6 6c0 .48.07.95.18 1.4l-14.1 8.23c-1.07-1-2.5-1.62-4.08-1.62-3.31 0-6 2.69-6 6s2.69 6 6 6c1.58 0 3.01-.62 4.08-1.62l14.25 8.31c-.1.42-.16.86-.16 1.31A5.83 5.83 0 1 0 36 32.17z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-cog">
      <path d="M38.86 25.95c.08-.64.14-1.29.14-1.95s-.06-1.31-.14-1.95l4.23-3.31c.38-.3.49-.84.24-1.28l-4-6.93c-.25-.43-.77-.61-1.22-.43l-4.98 2.01c-1.03-.79-2.16-1.46-3.38-1.97L29 4.84c-.09-.47-.5-.84-1-.84h-8c-.5 0-.91.37-.99.84l-.75 5.3a14.8 14.8 0 0 0-3.38 1.97L9.9 10.1a1 1 0 0 0-1.22.43l-4 6.93c-.25.43-.14.97.24 1.28l4.22 3.31C9.06 22.69 9 23.34 9 24s.06 1.31.14 1.95l-4.22 3.31c-.38.3-.49.84-.24 1.28l4 6.93c.25.43.77.61 1.22.43l4.98-2.01c1.03.79 2.16 1.46 3.38 1.97l.75 5.3c.08.47.49.84.99.84h8c.5 0 .91-.37.99-.84l.75-5.3a14.8 14.8 0 0 0 3.38-1.97l4.98 2.01a1 1 0 0 0 1.22-.43l4-6.93c.25-.43.14-.97-.24-1.28l-4.22-3.31zM24 31c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-square">
      <path d="M36 8H12c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h24c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zm0 28H12V12h24v24z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-circle">
      <circle cx="24" cy="24" r="20"></circle>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-circle-outline">
      <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-circle-inner-circle">
      <path d="M24 4C12.97 4 4 12.97 4 24s8.97 20 20 20 20-8.97 20-20S35.03 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16zm6-16c0 3.31-2.69 6-6 6s-6-2.69-6-6 2.69-6 6-6 6 2.69 6 6z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-cancel">
      <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm10 27.17L31.17 34 24 26.83 16.83 34 14 31.17 21.17 24 14 16.83 16.83 14 24 21.17 31.17 14 34 16.83 26.83 24 34 31.17z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-replay">
      <path d="M24 10V2L14 12l10 10v-8c6.63 0 12 5.37 12 12s-5.37 12-12 12-12-5.37-12-12H8c0 8.84 7.16 16 16 16s16-7.16 16-16-7.16-16-16-16z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-repeat">
      <path d="M14 14h20v6l8-8-8-8v6H10v12h4v-8zm20 20H14v-6l-8 8 8 8v-6h24V26h-4v8z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-5">
      <path d="M17.689 98l-8.697 8.696 8.697 8.697 2.486-2.485-4.32-4.319h1.302c4.93 0 9.071 1.722 12.424 5.165 3.352 3.443 5.029 7.638 5.029 12.584h3.55c0-2.958-.553-5.73-1.658-8.313-1.104-2.583-2.622-4.841-4.555-6.774-1.932-1.932-4.19-3.45-6.773-4.555-2.584-1.104-5.355-1.657-8.313-1.657H15.5l4.615-4.615zm-8.08 21.659v13.861h11.357v5.008H9.609V143h12.7c.834 0 1.55-.298 2.146-.894.596-.597.895-1.31.895-2.145v-7.781c0-.835-.299-1.55-.895-2.147a2.929 2.929 0 0 0-2.147-.894h-8.227v-5.096H25.35v-4.384z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-10">
      <path d="M42.315 125.63c0-4.997-1.694-9.235-5.08-12.713-3.388-3.479-7.571-5.218-12.552-5.218h-1.315l4.363 4.363-2.51 2.51-8.787-8.786L25.221 97l2.45 2.45-4.662 4.663h1.375c2.988 0 5.788.557 8.397 1.673 2.61 1.116 4.892 2.65 6.844 4.602 1.953 1.953 3.487 4.234 4.602 6.844 1.116 2.61 1.674 5.41 1.674 8.398zM8.183 142v-19.657H3.176V117.8h9.643V142zm13.63 0c-1.156 0-2.127-.393-2.912-1.178-.778-.778-1.168-1.746-1.168-2.902v-16.04c0-1.156.393-2.127 1.178-2.912.779-.779 1.746-1.168 2.902-1.168h7.696c1.156 0 2.126.392 2.911 1.177.779.78 1.168 1.747 1.168 2.903v16.04c0 1.156-.392 2.127-1.177 2.912-.779.779-1.746 1.168-2.902 1.168zm.556-4.636h6.583v-15.02H22.37z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-30">
      <path d="M26.047 97l-8.733 8.732 8.733 8.733 2.496-2.494-4.336-4.338h1.307c4.95 0 9.108 1.73 12.474 5.187 3.367 3.458 5.051 7.668 5.051 12.635h3.565c0-2.97-.556-5.751-1.665-8.346-1.109-2.594-2.633-4.862-4.574-6.802-1.94-1.941-4.208-3.466-6.803-4.575-2.594-1.109-5.375-1.664-8.345-1.664H23.85l4.634-4.634zM2.555 117.531v4.688h10.297v5.25H5.873v4.687h6.979v5.156H2.555V142H13.36c1.061 0 1.95-.395 2.668-1.186.718-.79 1.076-1.772 1.076-2.94v-16.218c0-1.168-.358-2.149-1.076-2.94-.717-.79-1.607-1.185-2.668-1.185zm22.482.14c-1.149 0-2.11.39-2.885 1.165-.78.78-1.172 1.744-1.172 2.893v15.943c0 1.149.388 2.11 1.163 2.885.78.78 1.745 1.172 2.894 1.172h7.649c1.148 0 2.11-.388 2.884-1.163.78-.78 1.17-1.745 1.17-2.894v-15.943c0-1.15-.386-2.111-1.16-2.885-.78-.78-1.746-1.172-2.894-1.172zm.553 4.518h6.545v14.93H25.59z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-5">
      <path d="M29.508 97l-2.431 2.43 4.625 4.625h-1.364c-2.965 0-5.742.554-8.332 1.66-2.589 1.107-4.851 2.629-6.788 4.566-1.937 1.937-3.458 4.2-4.565 6.788-1.107 2.59-1.66 5.367-1.66 8.331h3.557c0-4.957 1.68-9.16 5.04-12.611 3.36-3.45 7.51-5.177 12.451-5.177h1.304l-4.326 4.33 2.49 2.49 8.715-8.716zm-9.783 21.61v13.89h11.382v5.018H19.725V142h12.727a2.93 2.93 0 0 0 2.15-.896 2.93 2.93 0 0 0 .896-2.15v-7.798c0-.837-.299-1.554-.896-2.152a2.93 2.93 0 0 0-2.15-.896h-8.245V123h11.29v-4.392z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-10">
      <path d="M23.119 97l-2.386 2.383 4.538 4.538h-1.339c-2.908 0-5.633.543-8.173 1.63-2.54 1.085-4.76 2.577-6.66 4.478-1.9 1.9-3.392 4.12-4.478 6.66-1.085 2.54-1.629 5.264-1.629 8.172h3.49c0-4.863 1.648-8.986 4.944-12.372 3.297-3.385 7.368-5.078 12.216-5.078h1.279l-4.245 4.247 2.443 2.442 8.55-8.55zm-9.52 21.45v4.42h4.871V142h4.513v-23.55zm18.136 0c-1.125 0-2.066.377-2.824 1.135-.764.764-1.148 1.709-1.148 2.834v15.612c0 1.124.38 2.066 1.139 2.824.764.764 1.708 1.145 2.833 1.145h7.489c1.125 0 2.066-.378 2.824-1.136.764-.764 1.145-1.709 1.145-2.833v-15.612c0-1.125-.378-2.067-1.136-2.825-.764-.764-1.708-1.145-2.833-1.145zm.54 4.42h6.408v14.617h-6.407z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-30">
      <path d="M25.549 97l-2.437 2.434 4.634 4.635H26.38c-2.97 0-5.753.555-8.347 1.664-2.594 1.109-4.861 2.633-6.802 4.574-1.94 1.94-3.465 4.207-4.574 6.802-1.109 2.594-1.664 5.377-1.664 8.347h3.565c0-4.967 1.683-9.178 5.05-12.636 3.366-3.458 7.525-5.187 12.475-5.187h1.307l-4.335 4.338 2.495 2.494 8.732-8.732zm-11.553 20.53v4.689h10.297v5.249h-6.978v4.688h6.978v5.156H13.996V142h10.808c1.06 0 1.948-.395 2.666-1.186.718-.79 1.077-1.771 1.077-2.94v-16.217c0-1.169-.36-2.15-1.077-2.94-.718-.79-1.605-1.186-2.666-1.186zm21.174.168c-1.149 0-2.11.389-2.884 1.163-.78.78-1.172 1.745-1.172 2.894v15.942c0 1.15.388 2.11 1.162 2.885.78.78 1.745 1.17 2.894 1.17h7.649c1.149 0 2.11-.386 2.885-1.16.78-.78 1.17-1.746 1.17-2.895v-15.942c0-1.15-.387-2.11-1.161-2.885-.78-.78-1.745-1.172-2.894-1.172zm.552 4.516h6.542v14.931h-6.542z"></path>
    </symbol>
    <symbol viewBox="0 0 512 512" id="vjs-icon-audio-description">
      <g fill-rule="evenodd"><path d="M227.29 381.351V162.993c50.38-1.017 89.108-3.028 117.631 17.126 27.374 19.342 48.734 56.965 44.89 105.325-4.067 51.155-41.335 94.139-89.776 98.475-24.085 2.155-71.972 0-71.972 0s-.84-1.352-.773-2.568m48.755-54.804c31.43 1.26 53.208-16.633 56.495-45.386 4.403-38.51-21.188-63.552-58.041-60.796v103.612c-.036 1.466.575 2.22 1.546 2.57"></path><path d="M383.78 381.328c13.336 3.71 17.387-11.06 23.215-21.408 12.722-22.571 22.294-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.51c-.587 3.874 2.226 7.315 3.865 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894"></path><path d="M425.154 381.328c13.336 3.71 17.384-11.061 23.215-21.408 12.721-22.571 22.291-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.511c-.586 3.874 2.226 7.315 3.866 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894"></path><path d="M466.26 381.328c13.337 3.71 17.385-11.061 23.216-21.408 12.722-22.571 22.292-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.51c-.587 3.874 2.225 7.315 3.865 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894M4.477 383.005H72.58l18.573-28.484 64.169-.135s.065 19.413.065 28.62h48.756V160.307h-58.816c-5.653 9.537-140.85 222.697-140.85 222.697zm152.667-145.282v71.158l-40.453-.27 40.453-70.888z"></path></g>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-next-item">
      <path d="M12 36l17-12-17-12v24zm20-24v24h4V12h-4z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-previous-item">
      <path d="M12 12h4v24h-4zm7 12l17 12V12z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-shuffle">
      <path d="M21.17 18.34L10.83 8 8 10.83l10.34 10.34 2.83-2.83zM29 8l4.09 4.09L8 37.17 10.83 40l25.09-25.09L40 19V8H29zm.66 18.83l-2.83 2.83 6.26 6.26L29 40h11V29l-4.09 4.09-6.25-6.26z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-cast">
      <path d="M42 6H6c-2.21 0-4 1.79-4 4v6h4v-6h36v28H28v4h14c2.21 0 4-1.79 4-4V10c0-2.21-1.79-4-4-4zM2 36v6h6c0-3.31-2.69-6-6-6zm0-8v4c5.52 0 10 4.48 10 10h4c0-7.73-6.27-14-14-14zm0-8v4c9.94 0 18 8.06 18 18h4c0-12.15-9.85-22-22-22z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-picture-in-picture-enter">
      <path d="M38 22H22v11.99h16V22zm8 16V9.96C46 7.76 44.2 6 42 6H6C3.8 6 2 7.76 2 9.96V38c0 2.2 1.8 4 4 4h36c2.2 0 4-1.8 4-4zm-4 .04H6V9.94h36v28.1z"></path>
    </symbol>
    <symbol viewBox="0 0 22 18" id="vjs-icon-picture-in-picture-exit">
      <path d="M18 4H4v10h14V4zm4 12V1.98C22 .88 21.1 0 20 0H2C.9 0 0 .88 0 1.98V16c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2zm-2 .02H2V1.97h18v14.05z"></path>
      <path fill="none" d="M-1-3h24v24H-1z"></path>
    </symbol>
    <symbol viewBox="0 0 1792 1792" id="vjs-icon-facebook">
      <path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759H734V905H479V609h255V391q0-186 104-288.5T1115 0q147 0 228 12z"></path>
    </symbol>
    <symbol viewBox="0 0 1792 1792" id="vjs-icon-linkedin">
      <path d="M477 625v991H147V625h330zm21-306q1 73-50.5 122T312 490h-2q-82 0-132-49t-50-122q0-74 51.5-122.5T314 148t133 48.5T498 319zm1166 729v568h-329v-530q0-105-40.5-164.5T1168 862q-63 0-105.5 34.5T999 982q-11 30-11 81v553H659q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5T1285 602q171 0 275 113.5t104 332.5z"></path>
    </symbol>
    <symbol viewBox="0 0 1792 1792" id="vjs-icon-twitter">
      <path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5T1369.5 1125 1185 1335.5t-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5T285 1033q33 5 61 5 43 0 85-11-112-23-185.5-111.5T172 710v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5T884 653q-8-38-8-74 0-134 94.5-228.5T1199 256q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"></path>
    </symbol>
    <symbol viewBox="0 0 1792 1792" id="vjs-icon-tumblr">
      <path d="M1328 1329l80 237q-23 35-111 66t-177 32q-104 2-190.5-26T787 1564t-95-106-55.5-120-16.5-118V676H452V461q72-26 129-69.5t91-90 58-102 34-99T779 12q1-5 4.5-8.5T791 0h244v424h333v252h-334v518q0 30 6.5 56t22.5 52.5 49.5 41.5 81.5 14q78-2 134-29z"></path>
    </symbol>
    <symbol viewBox="0 0 1792 1792" id="vjs-icon-pinterest">
      <path d="M1664 896q0 209-103 385.5T1281.5 1561 896 1664q-111 0-218-32 59-93 78-164 9-34 54-211 20 39 73 67.5t114 28.5q121 0 216-68.5t147-188.5 52-270q0-114-59.5-214T1180 449t-255-63q-105 0-196 29t-154.5 77-109 110.5-67 129.5T377 866q0 104 40 183t117 111q30 12 38-20 2-7 8-31t8-30q6-23-11-43-51-61-51-151 0-151 104.5-259.5T904 517q151 0 235.5 82t84.5 213q0 170-68.5 289T980 1220q-61 0-98-43.5T859 1072q8-35 26.5-93.5t30-103T927 800q0-50-27-83t-77-33q-62 0-105 57t-43 142q0 73 25 122l-99 418q-17 70-13 177-206-91-333-281T128 896q0-209 103-385.5T510.5 231 896 128t385.5 103T1561 510.5 1664 896z"></path>
    </symbol>
  </defs>
</svg>`;class Pw extends re{constructor(e,t,n){const s=_t({createEl:!1},t);if(super(e,s,n),!t.playerOptions.sources||t.playerOptions.sources.length===0)for(let r=0,a=t.playerOptions.techOrder;r<a.length;r++){const o=Rt(a[r]);let l=Qe.getTech(o);if(o||(l=re.getComponent(o)),l&&l.isSupported()){e.loadTech_(o);break}}else e.src(t.playerOptions.sources)}}re.registerComponent("MediaLoader",Pw);class _u extends re{constructor(e,t){super(e,t),this.options_.controlText&&this.controlText(this.options_.controlText),this.handleMouseOver_=n=>this.handleMouseOver(n),this.handleMouseOut_=n=>this.handleMouseOut(n),this.handleClick_=n=>this.handleClick(n),this.handleKeyDown_=n=>this.handleKeyDown(n),this.emitTapEvents(),this.enable()}createEl(e="div",t={},n={}){t=Object.assign({className:this.buildCSSClass(),tabIndex:0},t),e==="button"&&rt.error(`Creating a ClickableComponent with an HTML element of ${e} is not supported; use a Button instead.`),n=Object.assign({role:"button"},n),this.tabIndex_=t.tabIndex;const s=Je(e,t,n);return this.player_.options_.experimentalSvgIcons||s.appendChild(Je("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(s),s}dispose(){this.controlTextEl_=null,super.dispose()}createControlTextEl(e){return this.controlTextEl_=Je("span",{className:"vjs-control-text"},{"aria-live":"polite"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_}controlText(e,t=this.el()){if(e===void 0)return this.controlText_||"Need Text";const n=this.localize(e);this.controlText_=e,ms(this.controlTextEl_,n),!this.nonIconControl&&!this.player_.options_.noUITitleAttributes&&t.setAttribute("title",n)}buildCSSClass(){return`vjs-control vjs-button ${super.buildCSSClass()}`}enable(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),typeof this.tabIndex_<"u"&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))}disable(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),typeof this.tabIndex_<"u"&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)}handleLanguagechange(){this.controlText(this.controlText_)}handleClick(e){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)}handleKeyDown(e){qe.isEventKey(e,"Space")||qe.isEventKey(e,"Enter")?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}}re.registerComponent("ClickableComponent",_u);class rh extends _u{constructor(e,t){super(e,t),this.update(),this.update_=n=>this.update(n),e.on("posterchange",this.update_)}dispose(){this.player().off("posterchange",this.update_),super.dispose()}createEl(){return Je("div",{className:"vjs-poster"})}crossOrigin(e){if(typeof e>"u")return this.$("img")?this.$("img").crossOrigin:this.player_.tech_&&this.player_.tech_.isReady_?this.player_.crossOrigin():this.player_.options_.crossOrigin||this.player_.options_.crossorigin||null;if(e!==null&&e!=="anonymous"&&e!=="use-credentials"){this.player_.log.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`);return}this.$("img")&&(this.$("img").crossOrigin=e)}update(e){const t=this.player().poster();this.setSrc(t),t?this.show():this.hide()}setSrc(e){if(!e){this.el_.textContent="";return}this.$("img")||this.el_.appendChild(Je("picture",{className:"vjs-poster",tabIndex:-1},{},Je("img",{loading:"lazy",crossOrigin:this.crossOrigin()},{alt:""}))),this.$("img").src=e}handleClick(e){this.player_.controls()&&(this.player_.tech(!0)&&this.player_.tech(!0).focus(),this.player_.paused()?mn(this.player_.play()):this.player_.pause())}}rh.prototype.crossorigin=rh.prototype.crossOrigin;re.registerComponent("PosterImage",rh);const Hi="#222",Tm="#ccc",Lw={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function xc(i,e){let t;if(i.length===4)t=i[1]+i[1]+i[2]+i[2]+i[3]+i[3];else if(i.length===7)t=i.slice(1);else throw new Error("Invalid color code provided, "+i+"; must be formatted as e.g. #f0e or #f604e2.");return"rgba("+parseInt(t.slice(0,2),16)+","+parseInt(t.slice(2,4),16)+","+parseInt(t.slice(4,6),16)+","+e+")"}function Ra(i,e,t){try{i.style[e]=t}catch{return}}function xm(i){return i?`${i}px`:""}class Iw extends re{constructor(e,t,n){super(e,t,n);const s=a=>this.updateDisplay(a),r=a=>{this.updateDisplayOverlay(),this.updateDisplay(a)};e.on("loadstart",a=>this.toggleDisplay(a)),e.on("texttrackchange",s),e.on("loadedmetadata",a=>{this.updateDisplayOverlay(),this.preselectTrack(a)}),e.ready(vt(this,function(){if(e.tech_&&e.tech_.featuresNativeTextTracks){this.hide();return}e.on("fullscreenchange",r),e.on("playerresize",r);const a=N.screen.orientation||N,o=N.screen.orientation?"change":"orientationchange";a.addEventListener(o,r),e.on("dispose",()=>a.removeEventListener(o,r));const l=this.options_.playerOptions.tracks||[];for(let u=0;u<l.length;u++)this.player_.addRemoteTextTrack(l[u],!0);this.preselectTrack()}))}preselectTrack(){const e={captions:1,subtitles:1},t=this.player_.textTracks(),n=this.player_.cache_.selectedLanguage;let s,r,a;for(let o=0;o<t.length;o++){const l=t[o];n&&n.enabled&&n.language&&n.language===l.language&&l.kind in e?l.kind===n.kind?a=l:a||(a=l):n&&!n.enabled?(a=null,s=null,r=null):l.default&&(l.kind==="descriptions"&&!s?s=l:l.kind in e&&!r&&(r=l))}a?a.mode="showing":r?r.mode="showing":s&&(s.mode="showing")}toggleDisplay(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()}createEl(){return super.createEl("div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})}clearDisplay(){typeof N.WebVTT=="function"&&N.WebVTT.processCues(N,[],this.el_)}updateDisplay(){const e=this.player_.textTracks(),t=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),t){const a=[];for(let o=0;o<e.length;++o){const l=e[o];l.mode==="showing"&&a.push(l)}this.updateForTrack(a);return}let n=null,s=null,r=e.length;for(;r--;){const a=e[r];a.mode==="showing"&&(a.kind==="descriptions"?n=a:s=a)}s?(this.getAttribute("aria-live")!=="off"&&this.setAttribute("aria-live","off"),this.updateForTrack(s)):n&&(this.getAttribute("aria-live")!=="assertive"&&this.setAttribute("aria-live","assertive"),this.updateForTrack(n))}updateDisplayOverlay(){if(!this.player_.videoHeight()||!N.CSS.supports("inset-inline: 10px"))return;const e=this.player_.currentWidth(),t=this.player_.currentHeight(),n=e/t,s=this.player_.videoWidth()/this.player_.videoHeight();let r=0,a=0;Math.abs(n-s)>.1&&(n>s?r=Math.round((e-t*s)/2):a=Math.round((t-e/s)/2)),Ra(this.el_,"insetInline",xm(r)),Ra(this.el_,"insetBlock",xm(a))}updateDisplayState(e){const t=this.player_.textTrackSettings.getValues(),n=e.activeCues;let s=n.length;for(;s--;){const r=n[s];if(!r)continue;const a=r.displayState;if(t.color&&(a.firstChild.style.color=t.color),t.textOpacity&&Ra(a.firstChild,"color",xc(t.color||"#fff",t.textOpacity)),t.backgroundColor&&(a.firstChild.style.backgroundColor=t.backgroundColor),t.backgroundOpacity&&Ra(a.firstChild,"backgroundColor",xc(t.backgroundColor||"#000",t.backgroundOpacity)),t.windowColor&&(t.windowOpacity?Ra(a,"backgroundColor",xc(t.windowColor,t.windowOpacity)):a.style.backgroundColor=t.windowColor),t.edgeStyle&&(t.edgeStyle==="dropshadow"?a.firstChild.style.textShadow=`2px 2px 3px ${Hi}, 2px 2px 4px ${Hi}, 2px 2px 5px ${Hi}`:t.edgeStyle==="raised"?a.firstChild.style.textShadow=`1px 1px ${Hi}, 2px 2px ${Hi}, 3px 3px ${Hi}`:t.edgeStyle==="depressed"?a.firstChild.style.textShadow=`1px 1px ${Tm}, 0 1px ${Tm}, -1px -1px ${Hi}, 0 -1px ${Hi}`:t.edgeStyle==="uniform"&&(a.firstChild.style.textShadow=`0 0 4px ${Hi}, 0 0 4px ${Hi}, 0 0 4px ${Hi}, 0 0 4px ${Hi}`)),t.fontPercent&&t.fontPercent!==1){const o=N.parseFloat(a.style.fontSize);a.style.fontSize=o*t.fontPercent+"px",a.style.height="auto",a.style.top="auto"}t.fontFamily&&t.fontFamily!=="default"&&(t.fontFamily==="small-caps"?a.firstChild.style.fontVariant="small-caps":a.firstChild.style.fontFamily=Lw[t.fontFamily])}}updateForTrack(e){if(Array.isArray(e)||(e=[e]),typeof N.WebVTT!="function"||e.every(n=>!n.activeCues))return;const t=[];for(let n=0;n<e.length;++n){const s=e[n];for(let r=0;r<s.activeCues.length;++r)t.push(s.activeCues[r])}N.WebVTT.processCues(N,t,this.el_);for(let n=0;n<e.length;++n){const s=e[n];for(let r=0;r<s.activeCues.length;++r){const a=s.activeCues[r].displayState;Hs(a,"vjs-text-track-cue","vjs-text-track-cue-"+(s.language?s.language:n)),s.language&&Kr(a,"lang",s.language)}this.player_.textTrackSettings&&this.updateDisplayState(s)}}}re.registerComponent("TextTrackDisplay",Iw);class Ow extends re{createEl(){const e=this.player_.isAudio(),t=this.localize(e?"Audio Player":"Video Player"),n=Je("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[t])}),s=super.createEl("div",{className:"vjs-loading-spinner",dir:"ltr"});return s.appendChild(n),s}handleLanguagechange(){this.$(".vjs-control-text").textContent=this.localize("{1} is loading.",[this.player_.isAudio()?"Audio Player":"Video Player"])}}re.registerComponent("LoadingSpinner",Ow);class Ui extends _u{createEl(e,t={},n={}){e="button",t=Object.assign({className:this.buildCSSClass()},t),n=Object.assign({type:"button"},n);const s=Je(e,t,n);return this.player_.options_.experimentalSvgIcons||s.appendChild(Je("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(s),s}addChild(e,t={}){const n=this.constructor.name;return rt.warn(`Adding an actionable (user controllable) child to a Button (${n}) is not supported; use a ClickableComponent instead.`),re.prototype.addChild.call(this,e,t)}enable(){super.enable(),this.el_.removeAttribute("disabled")}disable(){super.disable(),this.el_.setAttribute("disabled","disabled")}handleKeyDown(e){if(qe.isEventKey(e,"Space")||qe.isEventKey(e,"Enter")){e.stopPropagation();return}super.handleKeyDown(e)}}re.registerComponent("Button",Ui);class p_ extends Ui{constructor(e,t){super(e,t),this.mouseused_=!1,this.setIcon("play"),this.on("mousedown",n=>this.handleMouseDown(n))}buildCSSClass(){return"vjs-big-play-button"}handleClick(e){const t=this.player_.play();if(this.mouseused_&&"clientX"in e&&"clientY"in e){mn(t),this.player_.tech(!0)&&this.player_.tech(!0).focus();return}const n=this.player_.getChild("controlBar"),s=n&&n.getChild("playToggle");if(!s){this.player_.tech(!0).focus();return}const r=()=>s.focus();ja(t)?t.then(r,()=>{}):this.setTimeout(r,1)}handleKeyDown(e){this.mouseused_=!1,super.handleKeyDown(e)}handleMouseDown(e){this.mouseused_=!0}}p_.prototype.controlText_="Play Video";re.registerComponent("BigPlayButton",p_);class Uw extends Ui{constructor(e,t){super(e,t),this.setIcon("cancel"),this.controlText(t&&t.controlText||this.localize("Close"))}buildCSSClass(){return`vjs-close-button ${super.buildCSSClass()}`}handleClick(e){this.trigger({type:"close",bubbles:!1})}handleKeyDown(e){qe.isEventKey(e,"Esc")?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}}re.registerComponent("CloseButton",Uw);class m_ extends Ui{constructor(e,t={}){super(e,t),t.replay=t.replay===void 0||t.replay,this.setIcon("play"),this.on(e,"play",n=>this.handlePlay(n)),this.on(e,"pause",n=>this.handlePause(n)),t.replay&&this.on(e,"ended",n=>this.handleEnded(n))}buildCSSClass(){return`vjs-play-control ${super.buildCSSClass()}`}handleClick(e){this.player_.paused()?mn(this.player_.play()):this.player_.pause()}handleSeeked(e){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)}handlePlay(e){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.setIcon("pause"),this.controlText("Pause")}handlePause(e){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.setIcon("play"),this.controlText("Play")}handleEnded(e){this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.setIcon("replay"),this.controlText("Replay"),this.one(this.player_,"seeked",t=>this.handleSeeked(t))}}m_.prototype.controlText_="Play";re.registerComponent("PlayToggle",m_);class la extends re{constructor(e,t){super(e,t),this.on(e,["timeupdate","ended","seeking"],n=>this.update(n)),this.updateTextNode_()}createEl(){const e=this.buildCSSClass(),t=super.createEl("div",{className:`${e} vjs-time-control vjs-control`}),n=Je("span",{className:"vjs-control-text",textContent:`${this.localize(this.labelText_)}`},{role:"presentation"});return t.appendChild(n),this.contentEl_=Je("span",{className:`${e}-display`},{role:"presentation"}),t.appendChild(this.contentEl_),t}dispose(){this.contentEl_=null,this.textNode_=null,super.dispose()}update(e){!this.player_.options_.enableSmoothSeeking&&e.type==="seeking"||this.updateContent(e)}updateTextNode_(e=0){e=$s(e),this.formattedTime_!==e&&(this.formattedTime_=e,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",()=>{if(!this.contentEl_)return;let t=this.textNode_;t&&this.contentEl_.firstChild!==t&&(t=null,rt.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),this.textNode_=_e.createTextNode(this.formattedTime_),this.textNode_&&(t?this.contentEl_.replaceChild(this.textNode_,t):this.contentEl_.appendChild(this.textNode_))}))}updateContent(e){}}la.prototype.labelText_="Time";la.prototype.controlText_="Time";re.registerComponent("TimeDisplay",la);class rd extends la{buildCSSClass(){return"vjs-current-time"}updateContent(e){let t;this.player_.ended()?t=this.player_.duration():t=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(t)}}rd.prototype.labelText_="Current Time";rd.prototype.controlText_="Current Time";re.registerComponent("CurrentTimeDisplay",rd);class ad extends la{constructor(e,t){super(e,t);const n=s=>this.updateContent(s);this.on(e,"durationchange",n),this.on(e,"loadstart",n),this.on(e,"loadedmetadata",n)}buildCSSClass(){return"vjs-duration"}updateContent(e){const t=this.player_.duration();this.updateTextNode_(t)}}ad.prototype.labelText_="Duration";ad.prototype.controlText_="Duration";re.registerComponent("DurationDisplay",ad);class Nw extends re{createEl(){const e=super.createEl("div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),t=super.createEl("div"),n=super.createEl("span",{textContent:"/"});return t.appendChild(n),e.appendChild(t),e}}re.registerComponent("TimeDivider",Nw);class od extends la{constructor(e,t){super(e,t),this.on(e,"durationchange",n=>this.updateContent(n))}buildCSSClass(){return"vjs-remaining-time"}createEl(){const e=super.createEl();return this.options_.displayNegative!==!1&&e.insertBefore(Je("span",{},{"aria-hidden":!0},"-"),this.contentEl_),e}updateContent(e){if(typeof this.player_.duration()!="number")return;let t;this.player_.ended()?t=0:this.player_.remainingTimeDisplay?t=this.player_.remainingTimeDisplay():t=this.player_.remainingTime(),this.updateTextNode_(t)}}od.prototype.labelText_="Remaining Time";od.prototype.controlText_="Remaining Time";re.registerComponent("RemainingTimeDisplay",od);class kw extends re{constructor(e,t){super(e,t),this.updateShowing(),this.on(this.player(),"durationchange",n=>this.updateShowing(n))}createEl(){const e=super.createEl("div",{className:"vjs-live-control vjs-control"});return this.contentEl_=Je("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(Je("span",{className:"vjs-control-text",textContent:`${this.localize("Stream Type")}`})),this.contentEl_.appendChild(_e.createTextNode(this.localize("LIVE"))),e.appendChild(this.contentEl_),e}dispose(){this.contentEl_=null,super.dispose()}updateShowing(e){this.player().duration()===1/0?this.show():this.hide()}}re.registerComponent("LiveDisplay",kw);class g_ extends Ui{constructor(e,t){super(e,t),this.updateLiveEdgeStatus(),this.player_.liveTracker&&(this.updateLiveEdgeStatusHandler_=n=>this.updateLiveEdgeStatus(n),this.on(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_))}createEl(){const e=super.createEl("button",{className:"vjs-seek-to-live-control vjs-control"});return this.setIcon("circle",e),this.textEl_=Je("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),e.appendChild(this.textEl_),e}updateLiveEdgeStatus(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))}handleClick(){this.player_.liveTracker.seekToLiveEdge()}dispose(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,super.dispose()}}g_.prototype.controlText_="Seek to live, currently playing live";re.registerComponent("SeekToLive",g_);function yo(i,e,t){return i=Number(i),Math.min(t,Math.max(e,isNaN(i)?e:i))}var Fw=Object.freeze({__proto__:null,clamp:yo});class ld extends re{constructor(e,t){super(e,t),this.handleMouseDown_=n=>this.handleMouseDown(n),this.handleMouseUp_=n=>this.handleMouseUp(n),this.handleKeyDown_=n=>this.handleKeyDown(n),this.handleClick_=n=>this.handleClick(n),this.handleMouseMove_=n=>this.handleMouseMove(n),this.update_=n=>this.update(n),this.bar=this.getChild(this.options_.barName),this.vertical(!!this.options_.vertical),this.enable()}enabled(){return this.enabled_}enable(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)}disable(){if(!this.enabled())return;const e=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}createEl(e,t={},n={}){return t.className=t.className+" vjs-slider",t=Object.assign({tabIndex:0},t),n=Object.assign({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100},n),super.createEl(e,t,n)}handleMouseDown(e){const t=this.bar.el_.ownerDocument;e.type==="mousedown"&&e.preventDefault(),e.type==="touchstart"&&!Mn&&e.preventDefault(),G0(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(t,"mousemove",this.handleMouseMove_),this.on(t,"mouseup",this.handleMouseUp_),this.on(t,"touchmove",this.handleMouseMove_),this.on(t,"touchend",this.handleMouseUp_),this.handleMouseMove(e,!0)}handleMouseMove(e){}handleMouseUp(e){const t=this.bar.el_.ownerDocument;W0(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(t,"mousemove",this.handleMouseMove_),this.off(t,"mouseup",this.handleMouseUp_),this.off(t,"touchmove",this.handleMouseMove_),this.off(t,"touchend",this.handleMouseUp_),this.update()}update(){if(!this.el_||!this.bar)return;const e=this.getProgress();return e===this.progress_||(this.progress_=e,this.requestNamedAnimationFrame("Slider#update",()=>{const t=this.vertical()?"height":"width";this.bar.el().style[t]=(e*100).toFixed(2)+"%"})),e}getProgress(){return Number(yo(this.getPercent(),0,1).toFixed(4))}calculateDistance(e){const t=hu(this.el_,e);return this.vertical()?t.y:t.x}handleKeyDown(e){qe.isEventKey(e,"Left")||qe.isEventKey(e,"Down")?(e.preventDefault(),e.stopPropagation(),this.stepBack()):qe.isEventKey(e,"Right")||qe.isEventKey(e,"Up")?(e.preventDefault(),e.stopPropagation(),this.stepForward()):super.handleKeyDown(e)}handleClick(e){e.stopPropagation(),e.preventDefault()}vertical(e){if(e===void 0)return this.vertical_||!1;this.vertical_=!!e,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")}}re.registerComponent("Slider",ld);const Sc=(i,e)=>yo(i/e*100,0,100).toFixed(2)+"%";class Bw extends re{constructor(e,t){super(e,t),this.partEls_=[],this.on(e,"progress",n=>this.update(n))}createEl(){const e=super.createEl("div",{className:"vjs-load-progress"}),t=Je("span",{className:"vjs-control-text"}),n=Je("span",{textContent:this.localize("Loaded")}),s=_e.createTextNode(": ");return this.percentageEl_=Je("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),e.appendChild(t),t.appendChild(n),t.appendChild(s),t.appendChild(this.percentageEl_),e}dispose(){this.partEls_=null,this.percentageEl_=null,super.dispose()}update(e){this.requestNamedAnimationFrame("LoadProgressBar#update",()=>{const t=this.player_.liveTracker,n=this.player_.buffered(),s=t&&t.isLive()?t.seekableEnd():this.player_.duration(),r=this.player_.bufferedEnd(),a=this.partEls_,o=Sc(r,s);this.percent_!==o&&(this.el_.style.width=o,ms(this.percentageEl_,o),this.percent_=o);for(let l=0;l<n.length;l++){const u=n.start(l),h=n.end(l);let d=a[l];d||(d=this.el_.appendChild(Je()),a[l]=d),!(d.dataset.start===u&&d.dataset.end===h)&&(d.dataset.start=u,d.dataset.end=h,d.style.left=Sc(u,r),d.style.width=Sc(h-u,r))}for(let l=a.length;l>n.length;l--)this.el_.removeChild(a[l-1]);a.length=n.length})}}re.registerComponent("LoadProgressBar",Bw);class Hw extends re{constructor(e,t){super(e,t),this.update=wn(vt(this,this.update),Wi)}createEl(){return super.createEl("div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})}update(e,t,n){const s=oo(this.el_),r=Yr(this.player_.el()),a=e.width*t;if(!r||!s)return;let o=e.left-r.left+a,l=e.width-a+(r.right-e.right);l||(l=e.width-a,o=a);let u=s.width/2;o<u?u+=u-o:l<u&&(u=l),u<0?u=0:u>s.width&&(u=s.width),u=Math.round(u),this.el_.style.right=`-${u}px`,this.write(n)}write(e){ms(this.el_,e)}updateTime(e,t,n,s){this.requestNamedAnimationFrame("TimeTooltip#updateTime",()=>{let r;const a=this.player_.duration();if(this.player_.liveTracker&&this.player_.liveTracker.isLive()){const o=this.player_.liveTracker.liveWindow(),l=o-t*o;r=(l<1?"":"-")+$s(l,o)}else r=$s(n,a);this.update(e,t,r),s&&s()})}}re.registerComponent("TimeTooltip",Hw);class ud extends re{constructor(e,t){super(e,t),this.setIcon("circle"),this.update=wn(vt(this,this.update),Wi)}createEl(){return super.createEl("div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})}update(e,t){const n=this.getChild("timeTooltip");if(!n)return;const s=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();n.updateTime(e,t,s)}}ud.prototype.options_={children:[]};!pi&&!Cn&&ud.prototype.options_.children.push("timeTooltip");re.registerComponent("PlayProgressBar",ud);class __ extends re{constructor(e,t){super(e,t),this.update=wn(vt(this,this.update),Wi)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t){const n=t*this.player_.duration();this.getChild("timeTooltip").updateTime(e,t,n,()=>{this.el_.style.left=`${e.width*t}px`})}}__.prototype.options_={children:["timeTooltip"]};re.registerComponent("MouseTimeDisplay",__);const hl=5,Sm=12;class cd extends ld{constructor(e,t){super(e,t),this.setEventHandlers_()}setEventHandlers_(){this.update_=vt(this,this.update),this.update=wn(this.update_,Wi),this.on(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=e=>this.enableInterval_(e),this.disableIntervalHandler_=e=>this.disableInterval_(e),this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in _e&&"visibilityState"in _e&&this.on(_e,"visibilitychange",this.toggleVisibility_)}toggleVisibility_(e){_e.visibilityState==="hidden"?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(e)):(!this.player_.ended()&&!this.player_.paused()&&this.enableInterval_(),this.update())}enableInterval_(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,Wi))}disableInterval_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&e&&e.type!=="ended"||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)}createEl(){return super.createEl("div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})}update(e){if(_e.visibilityState==="hidden")return;const t=super.update();return this.requestNamedAnimationFrame("SeekBar#update",()=>{const n=this.player_.ended()?this.player_.duration():this.getCurrentTime_(),s=this.player_.liveTracker;let r=this.player_.duration();s&&s.isLive()&&(r=this.player_.liveTracker.liveCurrentTime()),this.percent_!==t&&(this.el_.setAttribute("aria-valuenow",(t*100).toFixed(2)),this.percent_=t),(this.currentTime_!==n||this.duration_!==r)&&(this.el_.setAttribute("aria-valuetext",this.localize("progress bar timing: currentTime={1} duration={2}",[$s(n,r),$s(r,r)],"{1} of {2}")),this.currentTime_=n,this.duration_=r),this.bar&&this.bar.update(Yr(this.el()),this.getProgress())}),t}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}getCurrentTime_(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()}getPercent(){const e=this.getCurrentTime_();let t;const n=this.player_.liveTracker;return n&&n.isLive()?(t=(e-n.seekableStart())/n.liveWindow(),n.atLiveEdge()&&(t=1)):t=e/this.player_.duration(),t}handleMouseDown(e){lo(e)&&(e.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.player_.pause(),super.handleMouseDown(e))}handleMouseMove(e,t=!1){if(!lo(e)||isNaN(this.player_.duration()))return;!t&&!this.player_.scrubbing()&&this.player_.scrubbing(!0);let n;const s=this.calculateDistance(e),r=this.player_.liveTracker;if(!r||!r.isLive())n=s*this.player_.duration(),n===this.player_.duration()&&(n=n-.1);else{if(s>=.99){r.seekToLiveEdge();return}const a=r.seekableStart(),o=r.liveCurrentTime();if(n=a+s*r.liveWindow(),n>=o&&(n=o),n<=a&&(n=a+.1),n===1/0)return}this.userSeek_(n),this.player_.options_.enableSmoothSeeking&&this.update()}enable(){super.enable();const e=this.getChild("mouseTimeDisplay");e&&e.show()}disable(){super.disable();const e=this.getChild("mouseTimeDisplay");e&&e.hide()}handleMouseUp(e){super.handleMouseUp(e),e&&e.stopPropagation(),this.player_.scrubbing(!1),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?mn(this.player_.play()):this.update_()}stepForward(){this.userSeek_(this.player_.currentTime()+hl)}stepBack(){this.userSeek_(this.player_.currentTime()-hl)}handleAction(e){this.player_.paused()?this.player_.play():this.player_.pause()}handleKeyDown(e){const t=this.player_.liveTracker;if(qe.isEventKey(e,"Space")||qe.isEventKey(e,"Enter"))e.preventDefault(),e.stopPropagation(),this.handleAction(e);else if(qe.isEventKey(e,"Home"))e.preventDefault(),e.stopPropagation(),this.userSeek_(0);else if(qe.isEventKey(e,"End"))e.preventDefault(),e.stopPropagation(),t&&t.isLive()?this.userSeek_(t.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test(qe(e))){e.preventDefault(),e.stopPropagation();const n=(qe.codes[qe(e)]-qe.codes[0])*10/100;t&&t.isLive()?this.userSeek_(t.seekableStart()+t.liveWindow()*n):this.userSeek_(this.player_.duration()*n)}else qe.isEventKey(e,"PgDn")?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()-hl*Sm)):qe.isEventKey(e,"PgUp")?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()+hl*Sm)):super.handleKeyDown(e)}dispose(){this.disableInterval_(),this.off(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in _e&&"visibilityState"in _e&&this.off(_e,"visibilitychange",this.toggleVisibility_),super.dispose()}}cd.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"};!pi&&!Cn&&cd.prototype.options_.children.splice(1,0,"mouseTimeDisplay");re.registerComponent("SeekBar",cd);class v_ extends re{constructor(e,t){super(e,t),this.handleMouseMove=wn(vt(this,this.handleMouseMove),Wi),this.throttledHandleMouseSeek=wn(vt(this,this.handleMouseSeek),Wi),this.handleMouseUpHandler_=n=>this.handleMouseUp(n),this.handleMouseDownHandler_=n=>this.handleMouseDown(n),this.enable()}createEl(){return super.createEl("div",{className:"vjs-progress-control vjs-control"})}handleMouseMove(e){const t=this.getChild("seekBar");if(!t)return;const n=t.getChild("playProgressBar"),s=t.getChild("mouseTimeDisplay");if(!n&&!s)return;const r=t.el(),a=oo(r);let o=hu(r,e).x;o=yo(o,0,1),s&&s.update(a,o),n&&n.update(a,t.getProgress())}handleMouseSeek(e){const t=this.getChild("seekBar");t&&t.handleMouseMove(e)}enabled(){return this.enabled_}disable(){if(this.children().forEach(e=>e.disable&&e.disable()),!!this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,"mousemove",this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){const e=this.getChild("seekBar");this.player_.scrubbing(!1),e.videoWasPlaying&&mn(this.player_.play())}}enable(){this.children().forEach(e=>e.enable&&e.enable()),!this.enabled()&&(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,"mousemove",this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)}removeListenersAddedOnMousedownAndTouchstart(){const e=this.el_.ownerDocument;this.off(e,"mousemove",this.throttledHandleMouseSeek),this.off(e,"touchmove",this.throttledHandleMouseSeek),this.off(e,"mouseup",this.handleMouseUpHandler_),this.off(e,"touchend",this.handleMouseUpHandler_)}handleMouseDown(e){const t=this.el_.ownerDocument,n=this.getChild("seekBar");n&&n.handleMouseDown(e),this.on(t,"mousemove",this.throttledHandleMouseSeek),this.on(t,"touchmove",this.throttledHandleMouseSeek),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.getChild("seekBar");t&&t.handleMouseUp(e),this.removeListenersAddedOnMousedownAndTouchstart()}}v_.prototype.options_={children:["seekBar"]};re.registerComponent("ProgressControl",v_);class y_ extends Ui{constructor(e,t){super(e,t),this.setIcon("picture-in-picture-enter"),this.on(e,["enterpictureinpicture","leavepictureinpicture"],n=>this.handlePictureInPictureChange(n)),this.on(e,["disablepictureinpicturechanged","loadedmetadata"],n=>this.handlePictureInPictureEnabledChange(n)),this.on(e,["loadedmetadata","audioonlymodechange","audiopostermodechange"],()=>this.handlePictureInPictureAudioModeChange()),this.disable()}buildCSSClass(){return`vjs-picture-in-picture-control vjs-hidden ${super.buildCSSClass()}`}handlePictureInPictureAudioModeChange(){if(!(this.player_.currentType().substring(0,5)==="audio"||this.player_.audioPosterMode()||this.player_.audioOnlyMode())){this.show();return}this.player_.isInPictureInPicture()&&this.player_.exitPictureInPicture(),this.hide()}handlePictureInPictureEnabledChange(){_e.pictureInPictureEnabled&&this.player_.disablePictureInPicture()===!1||this.player_.options_.enableDocumentPictureInPicture&&"documentPictureInPicture"in N?this.enable():this.disable()}handlePictureInPictureChange(e){this.player_.isInPictureInPicture()?(this.setIcon("picture-in-picture-exit"),this.controlText("Exit Picture-in-Picture")):(this.setIcon("picture-in-picture-enter"),this.controlText("Picture-in-Picture")),this.handlePictureInPictureEnabledChange()}handleClick(e){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()}show(){typeof _e.exitPictureInPicture=="function"&&super.show()}}y_.prototype.controlText_="Picture-in-Picture";re.registerComponent("PictureInPictureToggle",y_);class T_ extends Ui{constructor(e,t){super(e,t),this.setIcon("fullscreen-enter"),this.on(e,"fullscreenchange",n=>this.handleFullscreenChange(n)),_e[e.fsApi_.fullscreenEnabled]===!1&&this.disable()}buildCSSClass(){return`vjs-fullscreen-control ${super.buildCSSClass()}`}handleFullscreenChange(e){this.player_.isFullscreen()?(this.controlText("Exit Fullscreen"),this.setIcon("fullscreen-exit")):(this.controlText("Fullscreen"),this.setIcon("fullscreen-enter"))}handleClick(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()}}T_.prototype.controlText_="Fullscreen";re.registerComponent("FullscreenToggle",T_);const Vw=function(i,e){e.tech_&&!e.tech_.featuresVolumeControl&&i.addClass("vjs-hidden"),i.on(e,"loadstart",function(){e.tech_.featuresVolumeControl?i.removeClass("vjs-hidden"):i.addClass("vjs-hidden")})};class zw extends re{createEl(){const e=super.createEl("div",{className:"vjs-volume-level"});return this.setIcon("circle",e),e.appendChild(super.createEl("span",{className:"vjs-control-text"})),e}}re.registerComponent("VolumeLevel",zw);class Gw extends re{constructor(e,t){super(e,t),this.update=wn(vt(this,this.update),Wi)}createEl(){return super.createEl("div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})}update(e,t,n,s){if(!n){const r=Yr(this.el_),a=Yr(this.player_.el()),o=e.width*t;if(!a||!r)return;const l=e.left-a.left+o,u=e.width-o+(a.right-e.right);let h=r.width/2;l<h?h+=h-l:u<h&&(h=u),h<0?h=0:h>r.width&&(h=r.width),this.el_.style.right=`-${h}px`}this.write(`${s}%`)}write(e){ms(this.el_,e)}updateVolume(e,t,n,s,r){this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",()=>{this.update(e,t,n,s.toFixed(0)),r&&r()})}}re.registerComponent("VolumeLevelTooltip",Gw);class x_ extends re{constructor(e,t){super(e,t),this.update=wn(vt(this,this.update),Wi)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t,n){const s=100*t;this.getChild("volumeLevelTooltip").updateVolume(e,t,n,s,()=>{n?this.el_.style.bottom=`${e.height*t}px`:this.el_.style.left=`${e.width*t}px`})}}x_.prototype.options_={children:["volumeLevelTooltip"]};re.registerComponent("MouseVolumeLevelDisplay",x_);class vu extends ld{constructor(e,t){super(e,t),this.on("slideractive",n=>this.updateLastVolume_(n)),this.on(e,"volumechange",n=>this.updateARIAAttributes(n)),e.ready(()=>this.updateARIAAttributes())}createEl(){return super.createEl("div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})}handleMouseDown(e){lo(e)&&super.handleMouseDown(e)}handleMouseMove(e){const t=this.getChild("mouseVolumeLevelDisplay");if(t){const n=this.el(),s=Yr(n),r=this.vertical();let a=hu(n,e);a=r?a.y:a.x,a=yo(a,0,1),t.update(s,a,r)}lo(e)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))}checkMuted(){this.player_.muted()&&this.player_.muted(!1)}getPercent(){return this.player_.muted()?0:this.player_.volume()}stepForward(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)}stepBack(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)}updateARIAAttributes(e){const t=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",t),this.el_.setAttribute("aria-valuetext",t+"%")}volumeAsPercentage_(){return Math.round(this.player_.volume()*100)}updateLastVolume_(){const e=this.player_.volume();this.one("sliderinactive",()=>{this.player_.volume()===0&&this.player_.lastVolume_(e)})}}vu.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"};!pi&&!Cn&&vu.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay");vu.prototype.playerEvent="volumechange";re.registerComponent("VolumeBar",vu);class S_ extends re{constructor(e,t={}){t.vertical=t.vertical||!1,(typeof t.volumeBar>"u"||Xr(t.volumeBar))&&(t.volumeBar=t.volumeBar||{},t.volumeBar.vertical=t.vertical),super(e,t),Vw(this,e),this.throttledHandleMouseMove=wn(vt(this,this.handleMouseMove),Wi),this.handleMouseUpHandler_=n=>this.handleMouseUp(n),this.on("mousedown",n=>this.handleMouseDown(n)),this.on("touchstart",n=>this.handleMouseDown(n)),this.on("mousemove",n=>this.handleMouseMove(n)),this.on(this.volumeBar,["focus","slideractive"],()=>{this.volumeBar.addClass("vjs-slider-active"),this.addClass("vjs-slider-active"),this.trigger("slideractive")}),this.on(this.volumeBar,["blur","sliderinactive"],()=>{this.volumeBar.removeClass("vjs-slider-active"),this.removeClass("vjs-slider-active"),this.trigger("sliderinactive")})}createEl(){let e="vjs-volume-horizontal";return this.options_.vertical&&(e="vjs-volume-vertical"),super.createEl("div",{className:`vjs-volume-control vjs-control ${e}`})}handleMouseDown(e){const t=this.el_.ownerDocument;this.on(t,"mousemove",this.throttledHandleMouseMove),this.on(t,"touchmove",this.throttledHandleMouseMove),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.el_.ownerDocument;this.off(t,"mousemove",this.throttledHandleMouseMove),this.off(t,"touchmove",this.throttledHandleMouseMove),this.off(t,"mouseup",this.handleMouseUpHandler_),this.off(t,"touchend",this.handleMouseUpHandler_)}handleMouseMove(e){this.volumeBar.handleMouseMove(e)}}S_.prototype.options_={children:["volumeBar"]};re.registerComponent("VolumeControl",S_);const Ww=function(i,e){e.tech_&&!e.tech_.featuresMuteControl&&i.addClass("vjs-hidden"),i.on(e,"loadstart",function(){e.tech_.featuresMuteControl?i.removeClass("vjs-hidden"):i.addClass("vjs-hidden")})};class b_ extends Ui{constructor(e,t){super(e,t),Ww(this,e),this.on(e,["loadstart","volumechange"],n=>this.update(n))}buildCSSClass(){return`vjs-mute-control ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.volume(),n=this.player_.lastVolume_();if(t===0){const s=n<.1?.1:n;this.player_.volume(s),this.player_.muted(!1)}else this.player_.muted(!this.player_.muted())}update(e){this.updateIcon_(),this.updateControlText_()}updateIcon_(){const e=this.player_.volume();let t=3;this.setIcon("volume-high"),pi&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),e===0||this.player_.muted()?(this.setIcon("volume-mute"),t=0):e<.33?(this.setIcon("volume-low"),t=1):e<.67&&(this.setIcon("volume-medium"),t=2),uu(this.el_,[0,1,2,3].reduce((n,s)=>n+`${s?" ":""}vjs-vol-${s}`,"")),Hs(this.el_,`vjs-vol-${t}`)}updateControlText_(){const t=this.player_.muted()||this.player_.volume()===0?"Unmute":"Mute";this.controlText()!==t&&this.controlText(t)}}b_.prototype.controlText_="Mute";re.registerComponent("MuteToggle",b_);class E_ extends re{constructor(e,t={}){typeof t.inline<"u"?t.inline=t.inline:t.inline=!0,(typeof t.volumeControl>"u"||Xr(t.volumeControl))&&(t.volumeControl=t.volumeControl||{},t.volumeControl.vertical=!t.inline),super(e,t),this.handleKeyPressHandler_=n=>this.handleKeyPress(n),this.on(e,["loadstart"],n=>this.volumePanelState_(n)),this.on(this.muteToggle,"keyup",n=>this.handleKeyPress(n)),this.on(this.volumeControl,"keyup",n=>this.handleVolumeControlKeyUp(n)),this.on("keydown",n=>this.handleKeyPress(n)),this.on("mouseover",n=>this.handleMouseOver(n)),this.on("mouseout",n=>this.handleMouseOut(n)),this.on(this.volumeControl,["slideractive"],this.sliderActive_),this.on(this.volumeControl,["sliderinactive"],this.sliderInactive_)}sliderActive_(){this.addClass("vjs-slider-active")}sliderInactive_(){this.removeClass("vjs-slider-active")}volumePanelState_(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")}createEl(){let e="vjs-volume-panel-horizontal";return this.options_.inline||(e="vjs-volume-panel-vertical"),super.createEl("div",{className:`vjs-volume-panel vjs-control ${e}`})}dispose(){this.handleMouseOut(),super.dispose()}handleVolumeControlKeyUp(e){qe.isEventKey(e,"Esc")&&this.muteToggle.focus()}handleMouseOver(e){this.addClass("vjs-hover"),Ni(_e,"keyup",this.handleKeyPressHandler_)}handleMouseOut(e){this.removeClass("vjs-hover"),si(_e,"keyup",this.handleKeyPressHandler_)}handleKeyPress(e){qe.isEventKey(e,"Esc")&&this.handleMouseOut()}}E_.prototype.options_={children:["muteToggle","volumeControl"]};re.registerComponent("VolumePanel",E_);class A_ extends Ui{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipForwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.setIcon(`forward-${this.skipTime}`),this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime.toLocaleString(e.language())])),this.show()):this.hide()}getSkipForwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.forward}buildCSSClass(){return`vjs-skip-forward-${this.getSkipForwardTime()} ${super.buildCSSClass()}`}handleClick(e){if(isNaN(this.player_.duration()))return;const t=this.player_.currentTime(),n=this.player_.liveTracker,s=n&&n.isLive()?n.seekableEnd():this.player_.duration();let r;t+this.skipTime<=s?r=t+this.skipTime:r=s,this.player_.currentTime(r)}handleLanguagechange(){this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime]))}}A_.prototype.controlText_="Skip Forward";re.registerComponent("SkipForward",A_);class C_ extends Ui{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipBackwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.setIcon(`replay-${this.skipTime}`),this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime.toLocaleString(e.language())])),this.show()):this.hide()}getSkipBackwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.backward}buildCSSClass(){return`vjs-skip-backward-${this.getSkipBackwardTime()} ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.currentTime(),n=this.player_.liveTracker,s=n&&n.isLive()&&n.seekableStart();let r;s&&t-this.skipTime<=s?r=s:t>=this.skipTime?r=t-this.skipTime:r=0,this.player_.currentTime(r)}handleLanguagechange(){this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime]))}}C_.prototype.controlText_="Skip Backward";re.registerComponent("SkipBackward",C_);class M_ extends re{constructor(e,t){super(e,t),t&&(this.menuButton_=t.menuButton),this.focusedChild_=-1,this.on("keydown",n=>this.handleKeyDown(n)),this.boundHandleBlur_=n=>this.handleBlur(n),this.boundHandleTapClick_=n=>this.handleTapClick(n)}addEventListenerForItem(e){e instanceof re&&(this.on(e,"blur",this.boundHandleBlur_),this.on(e,["tap","click"],this.boundHandleTapClick_))}removeEventListenerForItem(e){e instanceof re&&(this.off(e,"blur",this.boundHandleBlur_),this.off(e,["tap","click"],this.boundHandleTapClick_))}removeChild(e){typeof e=="string"&&(e=this.getChild(e)),this.removeEventListenerForItem(e),super.removeChild(e)}addItem(e){const t=this.addChild(e);t&&this.addEventListenerForItem(t)}createEl(){const e=this.options_.contentElType||"ul";this.contentEl_=Je(e,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");const t=super.createEl("div",{append:this.contentEl_,className:"vjs-menu"});return t.appendChild(this.contentEl_),Ni(t,"click",function(n){n.preventDefault(),n.stopImmediatePropagation()}),t}dispose(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,super.dispose()}handleBlur(e){const t=e.relatedTarget||_e.activeElement;if(!this.children().some(n=>n.el()===t)){const n=this.menuButton_;n&&n.buttonPressed_&&t!==n.el().firstChild&&n.unpressButton()}}handleTapClick(e){if(this.menuButton_){this.menuButton_.unpressButton();const t=this.children();if(!Array.isArray(t))return;const n=t.filter(s=>s.el()===e.target)[0];if(!n)return;n.name()!=="CaptionSettingsMenuItem"&&this.menuButton_.focus()}}handleKeyDown(e){qe.isEventKey(e,"Left")||qe.isEventKey(e,"Down")?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(qe.isEventKey(e,"Right")||qe.isEventKey(e,"Up"))&&(e.preventDefault(),e.stopPropagation(),this.stepBack())}stepForward(){let e=0;this.focusedChild_!==void 0&&(e=this.focusedChild_+1),this.focus(e)}stepBack(){let e=0;this.focusedChild_!==void 0&&(e=this.focusedChild_-1),this.focus(e)}focus(e=0){const t=this.children().slice();t.length&&t[0].hasClass("vjs-menu-title")&&t.shift(),t.length>0&&(e<0?e=0:e>=t.length&&(e=t.length-1),this.focusedChild_=e,t[e].el_.focus())}}re.registerComponent("Menu",M_);class hd extends re{constructor(e,t={}){super(e,t),this.menuButton_=new Ui(e,t),this.menuButton_.controlText(this.controlText_),this.menuButton_.el_.setAttribute("aria-haspopup","true");const n=Ui.prototype.buildCSSClass();this.menuButton_.el_.className=this.buildCSSClass()+" "+n,this.menuButton_.removeClass("vjs-control"),this.addChild(this.menuButton_),this.update(),this.enabled_=!0;const s=r=>this.handleClick(r);this.handleMenuKeyUp_=r=>this.handleMenuKeyUp(r),this.on(this.menuButton_,"tap",s),this.on(this.menuButton_,"click",s),this.on(this.menuButton_,"keydown",r=>this.handleKeyDown(r)),this.on(this.menuButton_,"mouseenter",()=>{this.addClass("vjs-hover"),this.menu.show(),Ni(_e,"keyup",this.handleMenuKeyUp_)}),this.on("mouseleave",r=>this.handleMouseLeave(r)),this.on("keydown",r=>this.handleSubmenuKeyDown(r))}update(){const e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?(this.hide(),this.menu.contentEl_.removeAttribute("role")):(this.show(),this.menu.contentEl_.setAttribute("role","menu"))}createMenu(){const e=new M_(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){const t=Je("li",{className:"vjs-menu-title",textContent:Rt(this.options_.title),tabIndex:-1}),n=new re(this.player_,{el:t});e.addItem(n)}if(this.items=this.createItems(),this.items)for(let t=0;t<this.items.length;t++)e.addItem(this.items[t]);return e}createItems(){}createEl(){return super.createEl("div",{className:this.buildWrapperCSSClass()},{})}setIcon(e){super.setIcon(e,this.menuButton_.el_)}buildWrapperCSSClass(){let e="vjs-menu-button";this.options_.inline===!0?e+="-inline":e+="-popup";const t=Ui.prototype.buildCSSClass();return`vjs-menu-button ${e} ${t} ${super.buildCSSClass()}`}buildCSSClass(){let e="vjs-menu-button";return this.options_.inline===!0?e+="-inline":e+="-popup",`vjs-menu-button ${e} ${super.buildCSSClass()}`}controlText(e,t=this.menuButton_.el()){return this.menuButton_.controlText(e,t)}dispose(){this.handleMouseLeave(),super.dispose()}handleClick(e){this.buttonPressed_?this.unpressButton():this.pressButton()}handleMouseLeave(e){this.removeClass("vjs-hover"),si(_e,"keyup",this.handleMenuKeyUp_)}focus(){this.menuButton_.focus()}blur(){this.menuButton_.blur()}handleKeyDown(e){qe.isEventKey(e,"Esc")||qe.isEventKey(e,"Tab")?(this.buttonPressed_&&this.unpressButton(),qe.isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus())):(qe.isEventKey(e,"Up")||qe.isEventKey(e,"Down"))&&(this.buttonPressed_||(e.preventDefault(),this.pressButton()))}handleMenuKeyUp(e){(qe.isEventKey(e,"Esc")||qe.isEventKey(e,"Tab"))&&this.removeClass("vjs-hover")}handleSubmenuKeyPress(e){this.handleSubmenuKeyDown(e)}handleSubmenuKeyDown(e){(qe.isEventKey(e,"Esc")||qe.isEventKey(e,"Tab"))&&(this.buttonPressed_&&this.unpressButton(),qe.isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus()))}pressButton(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),pi&&F0())return;this.menu.focus()}}unpressButton(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))}disable(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()}enable(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()}}re.registerComponent("MenuButton",hd);class dd extends hd{constructor(e,t){const n=t.tracks;if(super(e,t),this.items.length<=1&&this.hide(),!n)return;const s=vt(this,this.update);n.addEventListener("removetrack",s),n.addEventListener("addtrack",s),n.addEventListener("labelchange",s),this.player_.on("ready",s),this.player_.on("dispose",function(){n.removeEventListener("removetrack",s),n.removeEventListener("addtrack",s),n.removeEventListener("labelchange",s)})}}re.registerComponent("TrackButton",dd);const qw=["Tab","Esc","Up","Down","Right","Left"];class To extends _u{constructor(e,t){super(e,t),this.selectable=t.selectable,this.isSelected_=t.selected||!1,this.multiSelectable=t.multiSelectable,this.selected(this.isSelected_),this.selectable?this.multiSelectable?this.el_.setAttribute("role","menuitemcheckbox"):this.el_.setAttribute("role","menuitemradio"):this.el_.setAttribute("role","menuitem")}createEl(e,t,n){this.nonIconControl=!0;const s=super.createEl("li",Object.assign({className:"vjs-menu-item",tabIndex:-1},t),n),r=Je("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)});return this.player_.options_.experimentalSvgIcons?s.appendChild(r):s.replaceChild(r,s.querySelector(".vjs-icon-placeholder")),s}handleKeyDown(e){qw.some(t=>qe.isEventKey(e,t))||super.handleKeyDown(e)}handleClick(e){this.selected(!0)}selected(e){this.selectable&&(e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))}}re.registerComponent("MenuItem",To);class xo extends To{constructor(e,t){const n=t.track,s=e.textTracks();t.label=n.label||n.language||"Unknown",t.selected=n.mode==="showing",super(e,t),this.track=n,this.kinds=(t.kinds||[t.kind||this.track.kind]).filter(Boolean);const r=(...o)=>{this.handleTracksChange.apply(this,o)},a=(...o)=>{this.handleSelectedLanguageChange.apply(this,o)};if(e.on(["loadstart","texttrackchange"],r),s.addEventListener("change",r),s.addEventListener("selectedlanguagechange",a),this.on("dispose",function(){e.off(["loadstart","texttrackchange"],r),s.removeEventListener("change",r),s.removeEventListener("selectedlanguagechange",a)}),s.onchange===void 0){let o;this.on(["tap","click"],function(){if(typeof N.Event!="object")try{o=new N.Event("change")}catch{}o||(o=_e.createEvent("Event"),o.initEvent("change",!0,!0)),s.dispatchEvent(o)})}this.handleTracksChange()}handleClick(e){const t=this.track,n=this.player_.textTracks();if(super.handleClick(e),!!n)for(let s=0;s<n.length;s++){const r=n[s];this.kinds.indexOf(r.kind)!==-1&&(r===t?r.mode!=="showing"&&(r.mode="showing"):r.mode!=="disabled"&&(r.mode="disabled"))}}handleTracksChange(e){const t=this.track.mode==="showing";t!==this.isSelected_&&this.selected(t)}handleSelectedLanguageChange(e){if(this.track.mode==="showing"){const t=this.player_.cache_.selectedLanguage;if(t&&t.enabled&&t.language===this.track.language&&t.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}}dispose(){this.track=null,super.dispose()}}re.registerComponent("TextTrackMenuItem",xo);class w_ extends xo{constructor(e,t){t.track={player:e,kind:t.kind,kinds:t.kinds,default:!1,mode:"disabled"},t.kinds||(t.kinds=[t.kind]),t.label?t.track.label=t.label:t.track.label=t.kinds.join(" and ")+" off",t.selectable=!0,t.multiSelectable=!1,super(e,t)}handleTracksChange(e){const t=this.player().textTracks();let n=!0;for(let s=0,r=t.length;s<r;s++){const a=t[s];if(this.options_.kinds.indexOf(a.kind)>-1&&a.mode==="showing"){n=!1;break}}n!==this.isSelected_&&this.selected(n)}handleSelectedLanguageChange(e){const t=this.player().textTracks();let n=!0;for(let s=0,r=t.length;s<r;s++){const a=t[s];if(["captions","descriptions","subtitles"].indexOf(a.kind)>-1&&a.mode==="showing"){n=!1;break}}n&&(this.player_.cache_.selectedLanguage={enabled:!1})}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.label),super.handleLanguagechange()}}re.registerComponent("OffTextTrackMenuItem",w_);class ua extends dd{constructor(e,t={}){t.tracks=e.textTracks(),super(e,t)}createItems(e=[],t=xo){let n;this.label_&&(n=`${this.label_} off`),e.push(new w_(this.player_,{kinds:this.kinds_,kind:this.kind_,label:n})),this.hideThreshold_+=1;const s=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(let r=0;r<s.length;r++){const a=s[r];if(this.kinds_.indexOf(a.kind)>-1){const o=new t(this.player_,{track:a,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});o.addClass(`vjs-${a.kind}-menu-item`),e.push(o)}}return e}}re.registerComponent("TextTrackButton",ua);class D_ extends To{constructor(e,t){const n=t.track,s=t.cue,r=e.currentTime();t.selectable=!0,t.multiSelectable=!1,t.label=s.text,t.selected=s.startTime<=r&&r<s.endTime,super(e,t),this.track=n,this.cue=s}handleClick(e){super.handleClick(),this.player_.currentTime(this.cue.startTime)}}re.registerComponent("ChaptersTrackMenuItem",D_);class fd extends ua{constructor(e,t,n){super(e,t,n),this.setIcon("chapters"),this.selectCurrentItem_=()=>{this.items.forEach(s=>{s.selected(this.track_.activeCues[0]===s.cue)})}}buildCSSClass(){return`vjs-chapters-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-chapters-button ${super.buildWrapperCSSClass()}`}update(e){if(e&&e.track&&e.track.kind!=="chapters")return;const t=this.findChaptersTrack();t!==this.track_?(this.setTrack(t),super.update()):(!this.items||t&&t.cues&&t.cues.length!==this.items.length)&&super.update()}setTrack(e){if(this.track_!==e){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){const t=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);t&&t.removeEventListener("load",this.updateHandler_),this.track_.removeEventListener("cuechange",this.selectCurrentItem_),this.track_=null}if(this.track_=e,this.track_){this.track_.mode="hidden";const t=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);t&&t.addEventListener("load",this.updateHandler_),this.track_.addEventListener("cuechange",this.selectCurrentItem_)}}}findChaptersTrack(){const e=this.player_.textTracks()||[];for(let t=e.length-1;t>=0;t--){const n=e[t];if(n.kind===this.kind_)return n}}getMenuCaption(){return this.track_&&this.track_.label?this.track_.label:this.localize(Rt(this.kind_))}createMenu(){return this.options_.title=this.getMenuCaption(),super.createMenu()}createItems(){const e=[];if(!this.track_)return e;const t=this.track_.cues;if(!t)return e;for(let n=0,s=t.length;n<s;n++){const r=t[n],a=new D_(this.player_,{track:this.track_,cue:r});e.push(a)}return e}}fd.prototype.kind_="chapters";fd.prototype.controlText_="Chapters";re.registerComponent("ChaptersButton",fd);class pd extends ua{constructor(e,t,n){super(e,t,n),this.setIcon("audio-description");const s=e.textTracks(),r=vt(this,this.handleTracksChange);s.addEventListener("change",r),this.on("dispose",function(){s.removeEventListener("change",r)})}handleTracksChange(e){const t=this.player().textTracks();let n=!1;for(let s=0,r=t.length;s<r;s++){const a=t[s];if(a.kind!==this.kind_&&a.mode==="showing"){n=!0;break}}n?this.disable():this.enable()}buildCSSClass(){return`vjs-descriptions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-descriptions-button ${super.buildWrapperCSSClass()}`}}pd.prototype.kind_="descriptions";pd.prototype.controlText_="Descriptions";re.registerComponent("DescriptionsButton",pd);class md extends ua{constructor(e,t,n){super(e,t,n),this.setIcon("subtitles")}buildCSSClass(){return`vjs-subtitles-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subtitles-button ${super.buildWrapperCSSClass()}`}}md.prototype.kind_="subtitles";md.prototype.controlText_="Subtitles";re.registerComponent("SubtitlesButton",md);class gd extends xo{constructor(e,t){t.track={player:e,kind:t.kind,label:t.kind+" settings",selectable:!1,default:!1,mode:"disabled"},t.selectable=!1,t.name="CaptionSettingsMenuItem",super(e,t),this.addClass("vjs-texttrack-settings"),this.controlText(", opens "+t.kind+" settings dialog")}handleClick(e){this.player().getChild("textTrackSettings").open()}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.kind+" settings"),super.handleLanguagechange()}}re.registerComponent("CaptionSettingsMenuItem",gd);class _d extends ua{constructor(e,t,n){super(e,t,n),this.setIcon("captions")}buildCSSClass(){return`vjs-captions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-captions-button ${super.buildWrapperCSSClass()}`}createItems(){const e=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(e.push(new gd(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),super.createItems(e)}}_d.prototype.kind_="captions";_d.prototype.controlText_="Captions";re.registerComponent("CaptionsButton",_d);class R_ extends xo{createEl(e,t,n){const s=super.createEl(e,t,n),r=s.querySelector(".vjs-menu-item-text");return this.options_.track.kind==="captions"&&(this.player_.options_.experimentalSvgIcons?this.setIcon("captions",s):r.appendChild(Je("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),r.appendChild(Je("span",{className:"vjs-control-text",textContent:` ${this.localize("Captions")}`}))),s}}re.registerComponent("SubsCapsMenuItem",R_);class vd extends ua{constructor(e,t={}){super(e,t),this.label_="subtitles",this.setIcon("subtitles"),["en","en-us","en-ca","fr-ca"].indexOf(this.player_.language_)>-1&&(this.label_="captions",this.setIcon("captions")),this.menuButton_.controlText(Rt(this.label_))}buildCSSClass(){return`vjs-subs-caps-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subs-caps-button ${super.buildWrapperCSSClass()}`}createItems(){let e=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(e.push(new gd(this.player_,{kind:this.label_})),this.hideThreshold_+=1),e=super.createItems(e,R_),e}}vd.prototype.kinds_=["captions","subtitles"];vd.prototype.controlText_="Subtitles";re.registerComponent("SubsCapsButton",vd);class P_ extends To{constructor(e,t){const n=t.track,s=e.audioTracks();t.label=n.label||n.language||"Unknown",t.selected=n.enabled,super(e,t),this.track=n,this.addClass(`vjs-${n.kind}-menu-item`);const r=(...a)=>{this.handleTracksChange.apply(this,a)};s.addEventListener("change",r),this.on("dispose",()=>{s.removeEventListener("change",r)})}createEl(e,t,n){const s=super.createEl(e,t,n),r=s.querySelector(".vjs-menu-item-text");return["main-desc","description"].indexOf(this.options_.track.kind)>=0&&(r.appendChild(Je("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),r.appendChild(Je("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),s}handleClick(e){if(super.handleClick(e),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks){const t=this.player_.audioTracks();for(let n=0;n<t.length;n++){const s=t[n];s!==this.track&&(s.enabled=s===this.track)}}}handleTracksChange(e){this.selected(this.track.enabled)}}re.registerComponent("AudioTrackMenuItem",P_);class L_ extends dd{constructor(e,t={}){t.tracks=e.audioTracks(),super(e,t),this.setIcon("audio")}buildCSSClass(){return`vjs-audio-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-audio-button ${super.buildWrapperCSSClass()}`}createItems(e=[]){this.hideThreshold_=1;const t=this.player_.audioTracks();for(let n=0;n<t.length;n++){const s=t[n];e.push(new P_(this.player_,{track:s,selectable:!0,multiSelectable:!1}))}return e}}L_.prototype.controlText_="Audio Track";re.registerComponent("AudioTrackButton",L_);class yd extends To{constructor(e,t){const n=t.rate,s=parseFloat(n,10);t.label=n,t.selected=s===e.playbackRate(),t.selectable=!0,t.multiSelectable=!1,super(e,t),this.label=n,this.rate=s,this.on(e,"ratechange",r=>this.update(r))}handleClick(e){super.handleClick(),this.player().playbackRate(this.rate)}update(e){this.selected(this.player().playbackRate()===this.rate)}}yd.prototype.contentElType="button";re.registerComponent("PlaybackRateMenuItem",yd);class I_ extends hd{constructor(e,t){super(e,t),this.menuButton_.el_.setAttribute("aria-describedby",this.labelElId_),this.updateVisibility(),this.updateLabel(),this.on(e,"loadstart",n=>this.updateVisibility(n)),this.on(e,"ratechange",n=>this.updateLabel(n)),this.on(e,"playbackrateschange",n=>this.handlePlaybackRateschange(n))}createEl(){const e=super.createEl();return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=Je("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),e.appendChild(this.labelEl_),e}dispose(){this.labelEl_=null,super.dispose()}buildCSSClass(){return`vjs-playback-rate ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-playback-rate ${super.buildWrapperCSSClass()}`}createItems(){const e=this.playbackRates(),t=[];for(let n=e.length-1;n>=0;n--)t.push(new yd(this.player(),{rate:e[n]+"x"}));return t}handlePlaybackRateschange(e){this.update()}playbackRates(){const e=this.player();return e.playbackRates&&e.playbackRates()||[]}playbackRateSupported(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0}updateVisibility(e){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")}updateLabel(e){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")}}I_.prototype.controlText_="Playback Rate";re.registerComponent("PlaybackRateMenuButton",I_);class O_ extends re{buildCSSClass(){return`vjs-spacer ${super.buildCSSClass()}`}createEl(e="div",t={},n={}){return t.className||(t.className=this.buildCSSClass()),super.createEl(e,t,n)}}re.registerComponent("Spacer",O_);class $w extends O_{buildCSSClass(){return`vjs-custom-control-spacer ${super.buildCSSClass()}`}createEl(){return super.createEl("div",{className:this.buildCSSClass(),textContent:""})}}re.registerComponent("CustomControlSpacer",$w);class U_ extends re{createEl(){return super.createEl("div",{className:"vjs-control-bar",dir:"ltr"})}}U_.prototype.options_={children:["playToggle","skipBackward","skipForward","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","pictureInPictureToggle","fullscreenToggle"]};re.registerComponent("ControlBar",U_);class N_ extends oa{constructor(e,t){super(e,t),this.on(e,"error",n=>{this.open(n)})}buildCSSClass(){return`vjs-error-display ${super.buildCSSClass()}`}content(){const e=this.player().error();return e?this.localize(e.message):""}}N_.prototype.options_=Object.assign({},oa.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0});re.registerComponent("ErrorDisplay",N_);const bc="vjs-text-track-settings",bm=["#000","Black"],Em=["#00F","Blue"],Am=["#0FF","Cyan"],Cm=["#0F0","Green"],Mm=["#F0F","Magenta"],wm=["#F00","Red"],Dm=["#FFF","White"],Rm=["#FF0","Yellow"],Ec=["1","Opaque"],Ac=["0.5","Semi-Transparent"],Pm=["0","Transparent"],Ps={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[bm,Dm,wm,Cm,Em,Rm,Mm,Am]},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Opacity",options:[Ec,Ac,Pm]},color:{selector:".vjs-text-color > select",id:"captions-foreground-color-%s",label:"Color",options:[Dm,bm,wm,Cm,Em,Rm,Mm,Am]},edgeStyle:{selector:".vjs-edge-style > select",id:"%s",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Drop shadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"captions-font-family-%s",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"captions-font-size-%s",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:i=>i==="1.00"?null:Number(i)},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Opacity",options:[Ec,Ac]},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Opacity",options:[Pm,Ac,Ec]}};Ps.windowColor.options=Ps.backgroundColor.options;function k_(i,e){if(e&&(i=e(i)),i&&i!=="none")return i}function jw(i,e){const t=i.options[i.options.selectedIndex].value;return k_(t,e)}function Xw(i,e,t){if(e){for(let n=0;n<i.options.length;n++)if(k_(i.options[n].value,t)===e){i.selectedIndex=n;break}}}class Kw extends oa{constructor(e,t){t.temporary=!1,super(e,t),this.updateDisplay=this.updateDisplay.bind(this),this.fill(),this.hasBeenOpened_=this.hasBeenFilled_=!0,this.endDialog=Je("p",{className:"vjs-control-text",textContent:this.localize("End of dialog window.")}),this.el().appendChild(this.endDialog),this.setDefaults(),t.persistTextTrackSettings===void 0&&(this.options_.persistTextTrackSettings=this.options_.playerOptions.persistTextTrackSettings),this.on(this.$(".vjs-done-button"),"click",()=>{this.saveSettings(),this.close()}),this.on(this.$(".vjs-default-button"),"click",()=>{this.setDefaults(),this.updateDisplay()}),Pr(Ps,n=>{this.on(this.$(n.selector),"change",this.updateDisplay)}),this.options_.persistTextTrackSettings&&this.restoreSettings()}dispose(){this.endDialog=null,super.dispose()}createElSelect_(e,t="",n="label"){const s=Ps[e],r=s.id.replace("%s",this.id_),a=[t,r].join(" ").trim(),o=`vjs_select_${rn()}`;return[`<${n} id="${r}"${n==="label"?` for="${o}" class="vjs-label"`:""}>`,this.localize(s.label),`</${n}>`,`<select aria-labelledby="${a}" id="${o}">`].concat(s.options.map(l=>{const u=r+"-"+l[1].replace(/\W+/g,"");return[`<option id="${u}" value="${l[0]}" `,`aria-labelledby="${a} ${u}">`,this.localize(l[1]),"</option>"].join("")})).concat("</select>").join("")}createElFgColor_(){const e=`captions-text-legend-${this.id_}`;return['<fieldset class="vjs-fg vjs-track-setting">',`<legend id="${e}">`,this.localize("Text"),"</legend>",'<span class="vjs-text-color">',this.createElSelect_("color",e),"</span>",'<span class="vjs-text-opacity vjs-opacity">',this.createElSelect_("textOpacity",e),"</span>","</fieldset>"].join("")}createElBgColor_(){const e=`captions-background-${this.id_}`;return['<fieldset class="vjs-bg vjs-track-setting">',`<legend id="${e}">`,this.localize("Text Background"),"</legend>",'<span class="vjs-bg-color">',this.createElSelect_("backgroundColor",e),"</span>",'<span class="vjs-bg-opacity vjs-opacity">',this.createElSelect_("backgroundOpacity",e),"</span>","</fieldset>"].join("")}createElWinColor_(){const e=`captions-window-${this.id_}`;return['<fieldset class="vjs-window vjs-track-setting">',`<legend id="${e}">`,this.localize("Caption Area Background"),"</legend>",'<span class="vjs-window-color">',this.createElSelect_("windowColor",e),"</span>",'<span class="vjs-window-opacity vjs-opacity">',this.createElSelect_("windowOpacity",e),"</span>","</fieldset>"].join("")}createElColors_(){return Je("div",{className:"vjs-track-settings-colors",innerHTML:[this.createElFgColor_(),this.createElBgColor_(),this.createElWinColor_()].join("")})}createElFont_(){return Je("div",{className:"vjs-track-settings-font",innerHTML:['<fieldset class="vjs-font-percent vjs-track-setting">',this.createElSelect_("fontPercent","","legend"),"</fieldset>",'<fieldset class="vjs-edge-style vjs-track-setting">',this.createElSelect_("edgeStyle","","legend"),"</fieldset>",'<fieldset class="vjs-font-family vjs-track-setting">',this.createElSelect_("fontFamily","","legend"),"</fieldset>"].join("")})}createElControls_(){const e=this.localize("restore all settings to the default values");return Je("div",{className:"vjs-track-settings-controls",innerHTML:[`<button type="button" class="vjs-default-button" title="${e}">`,this.localize("Reset"),`<span class="vjs-control-text"> ${e}</span>`,"</button>",`<button type="button" class="vjs-done-button">${this.localize("Done")}</button>`].join("")})}content(){return[this.createElColors_(),this.createElFont_(),this.createElControls_()]}label(){return this.localize("Caption Settings Dialog")}description(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")}buildCSSClass(){return super.buildCSSClass()+" vjs-text-track-settings"}getValues(){return P0(Ps,(e,t,n)=>{const s=jw(this.$(t.selector),t.parser);return s!==void 0&&(e[n]=s),e},{})}setValues(e){Pr(Ps,(t,n)=>{Xw(this.$(t.selector),e[n],t.parser)})}setDefaults(){Pr(Ps,e=>{const t=e.hasOwnProperty("default")?e.default:0;this.$(e.selector).selectedIndex=t})}restoreSettings(){let e;try{e=JSON.parse(N.localStorage.getItem(bc))}catch(t){rt.warn(t)}e&&this.setValues(e)}saveSettings(){if(!this.options_.persistTextTrackSettings)return;const e=this.getValues();try{Object.keys(e).length?N.localStorage.setItem(bc,JSON.stringify(e)):N.localStorage.removeItem(bc)}catch(t){rt.warn(t)}}updateDisplay(){const e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()}conditionalBlur_(){this.previouslyActiveEl_=null;const e=this.player_.controlBar,t=e&&e.subsCapsButton,n=e&&e.captionsButton;t?t.focus():n&&n.focus()}handleLanguagechange(){this.fill()}}re.registerComponent("TextTrackSettings",Kw);class Yw extends re{constructor(e,t){let n=t.ResizeObserver||N.ResizeObserver;t.ResizeObserver===null&&(n=!1);const s=_t({createEl:!n,reportTouchActivity:!1},t);super(e,s),this.ResizeObserver=t.ResizeObserver||N.ResizeObserver,this.loadListener_=null,this.resizeObserver_=null,this.debouncedHandler_=e_(()=>{this.resizeHandler()},100,!1,this),n?(this.resizeObserver_=new this.ResizeObserver(this.debouncedHandler_),this.resizeObserver_.observe(e.el())):(this.loadListener_=()=>{if(!this.el_||!this.el_.contentWindow)return;const r=this.debouncedHandler_;let a=this.unloadListener_=function(){si(this,"resize",r),si(this,"unload",a),a=null};Ni(this.el_.contentWindow,"unload",a),Ni(this.el_.contentWindow,"resize",r)},this.one("load",this.loadListener_))}createEl(){return super.createEl("iframe",{className:"vjs-resize-manager",tabIndex:-1,title:this.localize("No content")},{"aria-hidden":"true"})}resizeHandler(){!this.player_||!this.player_.trigger||this.player_.trigger("playerresize")}dispose(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,super.dispose()}}re.registerComponent("ResizeManager",Yw);const Qw={trackingThreshold:20,liveTolerance:15};class Zw extends re{constructor(e,t){const n=_t(Qw,t,{createEl:!1});super(e,n),this.trackLiveHandler_=()=>this.trackLive_(),this.handlePlay_=s=>this.handlePlay(s),this.handleFirstTimeupdate_=s=>this.handleFirstTimeupdate(s),this.handleSeeked_=s=>this.handleSeeked(s),this.seekToLiveEdge_=s=>this.seekToLiveEdge(s),this.reset_(),this.on(this.player_,"durationchange",s=>this.handleDurationchange(s)),this.on(this.player_,"canplay",()=>this.toggleTracking())}trackLive_(){const e=this.player_.seekable();if(!e||!e.length)return;const t=Number(N.performance.now().toFixed(4)),n=this.lastTime_===-1?0:(t-this.lastTime_)/1e3;this.lastTime_=t,this.pastSeekEnd_=this.pastSeekEnd()+n;const s=this.liveCurrentTime(),r=this.player_.currentTime();let a=this.player_.paused()||this.seekedBehindLive_||Math.abs(s-r)>this.options_.liveTolerance;(!this.timeupdateSeen_||s===1/0)&&(a=!1),a!==this.behindLiveEdge_&&(this.behindLiveEdge_=a,this.trigger("liveedgechange"))}handleDurationchange(){this.toggleTracking()}toggleTracking(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())}startTracking(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,Wi),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))}handleFirstTimeupdate(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)}handleSeeked(){const e=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&e>2,this.nextSeekedFromUser_=!1,this.trackLive_()}handlePlay(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)}reset_(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)}nextSeekedFromUser(){this.nextSeekedFromUser_=!0}stopTracking(){this.isTracking()&&(this.reset_(),this.trigger("liveedgechange"))}seekableEnd(){const e=this.player_.seekable(),t=[];let n=e?e.length:0;for(;n--;)t.push(e.end(n));return t.length?t.sort()[t.length-1]:1/0}seekableStart(){const e=this.player_.seekable(),t=[];let n=e?e.length:0;for(;n--;)t.push(e.start(n));return t.length?t.sort()[0]:0}liveWindow(){const e=this.liveCurrentTime();return e===1/0?0:e-this.seekableStart()}isLive(){return this.isTracking()}atLiveEdge(){return!this.behindLiveEdge()}liveCurrentTime(){return this.pastSeekEnd()+this.seekableEnd()}pastSeekEnd(){const e=this.seekableEnd();return this.lastSeekEnd_!==-1&&e!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=e,this.pastSeekEnd_}behindLiveEdge(){return this.behindLiveEdge_}isTracking(){return typeof this.trackingInterval_=="number"}seekToLiveEdge(){this.seekedBehindLive_=!1,!this.atLiveEdge()&&(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))}dispose(){this.stopTracking(),super.dispose()}}re.registerComponent("LiveTracker",Zw);class Jw extends re{constructor(e,t){super(e,t),this.on("statechanged",n=>this.updateDom_()),this.updateDom_()}createEl(){return this.els={title:Je("div",{className:"vjs-title-bar-title",id:`vjs-title-bar-title-${rn()}`}),description:Je("div",{className:"vjs-title-bar-description",id:`vjs-title-bar-description-${rn()}`})},Je("div",{className:"vjs-title-bar"},{},L0(this.els))}updateDom_(){const e=this.player_.tech_,t=e&&e.el_,n={title:"aria-labelledby",description:"aria-describedby"};["title","description"].forEach(s=>{const r=this.state[s],a=this.els[s],o=n[s];du(a),r&&ms(a,r),t&&(t.removeAttribute(o),r&&t.setAttribute(o,a.id))}),this.state.title||this.state.description?this.show():this.hide()}update(e){this.setState(e)}dispose(){const e=this.player_.tech_,t=e&&e.el_;t&&(t.removeAttribute("aria-labelledby"),t.removeAttribute("aria-describedby")),super.dispose(),this.els=null}}re.registerComponent("TitleBar",Jw);const ah=i=>{const e=i.el();if(e.hasAttribute("src"))return i.triggerSourceset(e.src),!0;const t=i.$$("source"),n=[];let s="";if(!t.length)return!1;for(let r=0;r<t.length;r++){const a=t[r].src;a&&n.indexOf(a)===-1&&n.push(a)}return n.length?(n.length===1&&(s=n[0]),i.triggerSourceset(s),!0):!1},eD=Object.defineProperty({},"innerHTML",{get(){return this.cloneNode(!0).innerHTML},set(i){const e=_e.createElement(this.nodeName.toLowerCase());e.innerHTML=i;const t=_e.createDocumentFragment();for(;e.childNodes.length;)t.appendChild(e.childNodes[0]);return this.innerText="",N.Element.prototype.appendChild.call(this,t),this.innerHTML}}),F_=(i,e)=>{let t={};for(let n=0;n<i.length&&(t=Object.getOwnPropertyDescriptor(i[n],e),!(t&&t.set&&t.get));n++);return t.enumerable=!0,t.configurable=!0,t},tD=i=>F_([i.el(),N.HTMLMediaElement.prototype,N.Element.prototype,eD],"innerHTML"),Lm=function(i){const e=i.el();if(e.resetSourceWatch_)return;const t={},n=tD(i),s=r=>(...a)=>{const o=r.apply(e,a);return ah(i),o};["append","appendChild","insertAdjacentHTML"].forEach(r=>{e[r]&&(t[r]=e[r],e[r]=s(t[r]))}),Object.defineProperty(e,"innerHTML",_t(n,{set:s(n.set)})),e.resetSourceWatch_=()=>{e.resetSourceWatch_=null,Object.keys(t).forEach(r=>{e[r]=t[r]}),Object.defineProperty(e,"innerHTML",n)},i.one("sourceset",e.resetSourceWatch_)},iD=Object.defineProperty({},"src",{get(){return this.hasAttribute("src")?c_(N.Element.prototype.getAttribute.call(this,"src")):""},set(i){return N.Element.prototype.setAttribute.call(this,"src",i),i}}),nD=i=>F_([i.el(),N.HTMLMediaElement.prototype,iD],"src"),sD=function(i){if(!i.featuresSourceset)return;const e=i.el();if(e.resetSourceset_)return;const t=nD(i),n=e.setAttribute,s=e.load;Object.defineProperty(e,"src",_t(t,{set:r=>{const a=t.set.call(e,r);return i.triggerSourceset(e.src),a}})),e.setAttribute=(r,a)=>{const o=n.call(e,r,a);return/src/i.test(r)&&i.triggerSourceset(e.src),o},e.load=()=>{const r=s.call(e);return ah(i)||(i.triggerSourceset(""),Lm(i)),r},e.currentSrc?i.triggerSourceset(e.currentSrc):ah(i)||Lm(i),e.resetSourceset_=()=>{e.resetSourceset_=null,e.load=s,e.setAttribute=n,Object.defineProperty(e,"src",t),e.resetSourceWatch_&&e.resetSourceWatch_()}};class Me extends Qe{constructor(e,t){super(e,t);const n=e.source;let s=!1;if(this.featuresVideoFrameCallback=this.featuresVideoFrameCallback&&this.el_.tagName==="VIDEO",n&&(this.el_.currentSrc!==n.src||e.tag&&e.tag.initNetworkState_===3)?this.setSource(n):this.handleLateInit_(this.el_),e.enableSourceset&&this.setupSourcesetHandling_(),this.isScrubbing_=!1,this.el_.hasChildNodes()){const r=this.el_.childNodes;let a=r.length;const o=[];for(;a--;){const l=r[a];l.nodeName.toLowerCase()==="track"&&(this.featuresNativeTextTracks?(this.remoteTextTrackEls().addTrackElement_(l),this.remoteTextTracks().addTrack(l.track),this.textTracks().addTrack(l.track),!s&&!this.el_.hasAttribute("crossorigin")&&gu(l.src)&&(s=!0)):o.push(l))}for(let l=0;l<o.length;l++)this.el_.removeChild(o[l])}this.proxyNativeTracks_(),this.featuresNativeTextTracks&&s&&rt.warn(`Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.
This may prevent text tracks from loading.`),this.restoreMetadataTracksInIOSNativePlayer_(),(ao||ou)&&e.nativeControlsForTouch===!0&&this.setControls(!0),this.proxyWebkitFullscreen_(),this.triggerReady()}dispose(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),Me.disposeMediaElement(this.el_),this.options_=null,super.dispose()}setupSourcesetHandling_(){sD(this)}restoreMetadataTracksInIOSNativePlayer_(){const e=this.textTracks();let t;const n=()=>{t=[];for(let r=0;r<e.length;r++){const a=e[r];a.kind==="metadata"&&t.push({track:a,storedMode:a.mode})}};n(),e.addEventListener("change",n),this.on("dispose",()=>e.removeEventListener("change",n));const s=()=>{for(let r=0;r<t.length;r++){const a=t[r];a.track.mode==="disabled"&&a.track.mode!==a.storedMode&&(a.track.mode=a.storedMode)}e.removeEventListener("change",s)};this.on("webkitbeginfullscreen",()=>{e.removeEventListener("change",n),e.removeEventListener("change",s),e.addEventListener("change",s)}),this.on("webkitendfullscreen",()=>{e.removeEventListener("change",n),e.addEventListener("change",n),e.removeEventListener("change",s)})}overrideNative_(e,t){if(t!==this[`featuresNative${e}Tracks`])return;const n=e.toLowerCase();this[`${n}TracksListeners_`]&&Object.keys(this[`${n}TracksListeners_`]).forEach(s=>{this.el()[`${n}Tracks`].removeEventListener(s,this[`${n}TracksListeners_`][s])}),this[`featuresNative${e}Tracks`]=!t,this[`${n}TracksListeners_`]=null,this.proxyNativeTracksForType_(n)}overrideNativeAudioTracks(e){this.overrideNative_("Audio",e)}overrideNativeVideoTracks(e){this.overrideNative_("Video",e)}proxyNativeTracksForType_(e){const t=Gi[e],n=this.el()[t.getterName],s=this[t.getterName]();if(!this[`featuresNative${t.capitalName}Tracks`]||!n||!n.addEventListener)return;const r={change:o=>{const l={type:"change",target:s,currentTarget:s,srcElement:s};s.trigger(l),e==="text"&&this[Jr.remoteText.getterName]().trigger(l)},addtrack(o){s.addTrack(o.track)},removetrack(o){s.removeTrack(o.track)}},a=function(){const o=[];for(let l=0;l<s.length;l++){let u=!1;for(let h=0;h<n.length;h++)if(n[h]===s[l]){u=!0;break}u||o.push(s[l])}for(;o.length;)s.removeTrack(o.shift())};this[t.getterName+"Listeners_"]=r,Object.keys(r).forEach(o=>{const l=r[o];n.addEventListener(o,l),this.on("dispose",u=>n.removeEventListener(o,l))}),this.on("loadstart",a),this.on("dispose",o=>this.off("loadstart",a))}proxyNativeTracks_(){Gi.names.forEach(e=>{this.proxyNativeTracksForType_(e)})}createEl(){let e=this.options_.tag;if(!e||!(this.options_.playerElIngest||this.movingMediaElementInDOM)){if(e){const n=e.cloneNode(!0);e.parentNode&&e.parentNode.insertBefore(n,e),Me.disposeMediaElement(e),e=n}else{e=_e.createElement("video");const n=this.options_.tag&&ls(this.options_.tag),s=_t({},n);(!ao||this.options_.nativeControlsForTouch!==!0)&&delete s.controls,V0(e,Object.assign(s,{id:this.options_.techId,class:"vjs-tech"}))}e.playerId=this.options_.playerId}typeof this.options_.preload<"u"&&Kr(e,"preload",this.options_.preload),this.options_.disablePictureInPicture!==void 0&&(e.disablePictureInPicture=this.options_.disablePictureInPicture);const t=["loop","muted","playsinline","autoplay"];for(let n=0;n<t.length;n++){const s=t[n],r=this.options_[s];typeof r<"u"&&(r?Kr(e,s,s):cu(e,s),e[s]=r)}return e}handleLateInit_(e){if(e.networkState===0||e.networkState===3)return;if(e.readyState===0){let n=!1;const s=function(){n=!0};this.on("loadstart",s);const r=function(){n||this.trigger("loadstart")};this.on("loadedmetadata",r),this.ready(function(){this.off("loadstart",s),this.off("loadedmetadata",r),n||this.trigger("loadstart")});return}const t=["loadstart"];t.push("loadedmetadata"),e.readyState>=2&&t.push("loadeddata"),e.readyState>=3&&t.push("canplay"),e.readyState>=4&&t.push("canplaythrough"),this.ready(function(){t.forEach(function(n){this.trigger(n)},this)})}setScrubbing(e){this.isScrubbing_=e}scrubbing(){return this.isScrubbing_}setCurrentTime(e){try{this.isScrubbing_&&this.el_.fastSeek&&lu?this.el_.fastSeek(e):this.el_.currentTime=e}catch(t){rt(t,"Video is not ready. (Video.js)")}}duration(){if(this.el_.duration===1/0&&Cn&&Mn&&this.el_.currentTime===0){const e=()=>{this.el_.currentTime>0&&(this.el_.duration===1/0&&this.trigger("durationchange"),this.off("timeupdate",e))};return this.on("timeupdate",e),NaN}return this.el_.duration||NaN}width(){return this.el_.offsetWidth}height(){return this.el_.offsetHeight}proxyWebkitFullscreen_(){if(!("webkitDisplayingFullscreen"in this.el_))return;const e=function(){this.trigger("fullscreenchange",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},t=function(){"webkitPresentationMode"in this.el_&&this.el_.webkitPresentationMode!=="picture-in-picture"&&(this.one("webkitendfullscreen",e),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",t),this.on("dispose",()=>{this.off("webkitbeginfullscreen",t),this.off("webkitendfullscreen",e)})}supportsFullScreen(){return typeof this.el_.webkitEnterFullScreen=="function"}enterFullScreen(){const e=this.el_;if(e.paused&&e.networkState<=e.HAVE_METADATA)mn(this.el_.play()),this.setTimeout(function(){e.pause();try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}},0);else try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}}exitFullScreen(){if(!this.el_.webkitDisplayingFullscreen){this.trigger("fullscreenerror",new Error("The video is not fullscreen"));return}this.el_.webkitExitFullScreen()}requestPictureInPicture(){return this.el_.requestPictureInPicture()}requestVideoFrameCallback(e){return this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.requestVideoFrameCallback(e):super.requestVideoFrameCallback(e)}cancelVideoFrameCallback(e){this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.cancelVideoFrameCallback(e):super.cancelVideoFrameCallback(e)}src(e){if(e===void 0)return this.el_.src;this.setSrc(e)}reset(){Me.resetMediaElement(this.el_)}currentSrc(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc}setControls(e){this.el_.controls=!!e}addTextTrack(e,t,n){return this.featuresNativeTextTracks?this.el_.addTextTrack(e,t,n):super.addTextTrack(e,t,n)}createRemoteTextTrack(e){if(!this.featuresNativeTextTracks)return super.createRemoteTextTrack(e);const t=_e.createElement("track");return e.kind&&(t.kind=e.kind),e.label&&(t.label=e.label),(e.language||e.srclang)&&(t.srclang=e.language||e.srclang),e.default&&(t.default=e.default),e.id&&(t.id=e.id),e.src&&(t.src=e.src),t}addRemoteTextTrack(e,t){const n=super.addRemoteTextTrack(e,t);return this.featuresNativeTextTracks&&this.el().appendChild(n),n}removeRemoteTextTrack(e){if(super.removeRemoteTextTrack(e),this.featuresNativeTextTracks){const t=this.$$("track");let n=t.length;for(;n--;)(e===t[n]||e===t[n].track)&&this.el().removeChild(t[n])}}getVideoPlaybackQuality(){if(typeof this.el().getVideoPlaybackQuality=="function")return this.el().getVideoPlaybackQuality();const e={};return typeof this.el().webkitDroppedFrameCount<"u"&&typeof this.el().webkitDecodedFrameCount<"u"&&(e.droppedVideoFrames=this.el().webkitDroppedFrameCount,e.totalVideoFrames=this.el().webkitDecodedFrameCount),N.performance&&(e.creationTime=N.performance.now()),e}}su(Me,"TEST_VID",function(){if(!sa())return;const i=_e.createElement("video"),e=_e.createElement("track");return e.kind="captions",e.srclang="en",e.label="English",i.appendChild(e),i});Me.isSupported=function(){try{Me.TEST_VID.volume=.5}catch{return!1}return!!(Me.TEST_VID&&Me.TEST_VID.canPlayType)};Me.canPlayType=function(i){return Me.TEST_VID.canPlayType(i)};Me.canPlaySource=function(i,e){return Me.canPlayType(i.type)};Me.canControlVolume=function(){try{const i=Me.TEST_VID.volume;Me.TEST_VID.volume=i/2+.1;const e=i!==Me.TEST_VID.volume;return e&&pi?(N.setTimeout(()=>{Me&&Me.prototype&&(Me.prototype.featuresVolumeControl=i!==Me.TEST_VID.volume)}),!1):e}catch{return!1}};Me.canMuteVolume=function(){try{const i=Me.TEST_VID.muted;return Me.TEST_VID.muted=!i,Me.TEST_VID.muted?Kr(Me.TEST_VID,"muted","muted"):cu(Me.TEST_VID,"muted","muted"),i!==Me.TEST_VID.muted}catch{return!1}};Me.canControlPlaybackRate=function(){if(Cn&&Mn&&ru<58)return!1;try{const i=Me.TEST_VID.playbackRate;return Me.TEST_VID.playbackRate=i/2+.1,i!==Me.TEST_VID.playbackRate}catch{return!1}};Me.canOverrideAttributes=function(){try{const i=()=>{};Object.defineProperty(_e.createElement("video"),"src",{get:i,set:i}),Object.defineProperty(_e.createElement("audio"),"src",{get:i,set:i}),Object.defineProperty(_e.createElement("video"),"innerHTML",{get:i,set:i}),Object.defineProperty(_e.createElement("audio"),"innerHTML",{get:i,set:i})}catch{return!1}return!0};Me.supportsNativeTextTracks=function(){return lu||pi&&Mn};Me.supportsNativeVideoTracks=function(){return!!(Me.TEST_VID&&Me.TEST_VID.videoTracks)};Me.supportsNativeAudioTracks=function(){return!!(Me.TEST_VID&&Me.TEST_VID.audioTracks)};Me.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"];[["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach(function([i,e]){su(Me.prototype,i,()=>Me[e](),!0)});Me.prototype.featuresVolumeControl=Me.canControlVolume();Me.prototype.movingMediaElementInDOM=!pi;Me.prototype.featuresFullscreenResize=!0;Me.prototype.featuresProgressEvents=!0;Me.prototype.featuresTimeupdateEvents=!0;Me.prototype.featuresVideoFrameCallback=!!(Me.TEST_VID&&Me.TEST_VID.requestVideoFrameCallback);Me.disposeMediaElement=function(i){if(i){for(i.parentNode&&i.parentNode.removeChild(i);i.hasChildNodes();)i.removeChild(i.firstChild);i.removeAttribute("src"),typeof i.load=="function"&&function(){try{i.load()}catch{}}()}};Me.resetMediaElement=function(i){if(!i)return;const e=i.querySelectorAll("source");let t=e.length;for(;t--;)i.removeChild(e[t]);i.removeAttribute("src"),typeof i.load=="function"&&function(){try{i.load()}catch{}}()};["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(i){Me.prototype[i]=function(){return this.el_[i]||this.el_.hasAttribute(i)}});["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(i){Me.prototype["set"+Rt(i)]=function(e){this.el_[i]=e,e?this.el_.setAttribute(i,i):this.el_.removeAttribute(i)}});["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach(function(i){Me.prototype[i]=function(){return this.el_[i]}});["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach(function(i){Me.prototype["set"+Rt(i)]=function(e){this.el_[i]=e}});["pause","load","play"].forEach(function(i){Me.prototype[i]=function(){return this.el_[i]()}});Qe.withSourceHandlers(Me);Me.nativeSourceHandler={};Me.nativeSourceHandler.canPlayType=function(i){try{return Me.TEST_VID.canPlayType(i)}catch{return""}};Me.nativeSourceHandler.canHandleSource=function(i,e){if(i.type)return Me.nativeSourceHandler.canPlayType(i.type);if(i.src){const t=nd(i.src);return Me.nativeSourceHandler.canPlayType(`video/${t}`)}return""};Me.nativeSourceHandler.handleSource=function(i,e,t){e.setSrc(i.src)};Me.nativeSourceHandler.dispose=function(){};Me.registerSourceHandler(Me.nativeSourceHandler);Qe.registerTech("Html5",Me);const B_=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],Cc={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},oh=["tiny","xsmall","small","medium","large","xlarge","huge"],vl={};oh.forEach(i=>{const e=i.charAt(0)==="x"?`x-${i.substring(1)}`:i;vl[i]=`vjs-layout-${e}`});const rD={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0};class yt extends re{constructor(e,t,n){if(e.id=e.id||t.id||`vjs_video_${rn()}`,t=Object.assign(yt.getTagSettings(e),t),t.initChildren=!1,t.createEl=!1,t.evented=!1,t.reportTouchActivity=!1,!t.language){const a=e.closest("[lang]");a&&(t.language=a.getAttribute("lang"))}if(super(null,t,n),this.boundDocumentFullscreenChange_=a=>this.documentFullscreenChange_(a),this.boundFullWindowOnEscKey_=a=>this.fullWindowOnEscKey(a),this.boundUpdateStyleEl_=a=>this.updateStyleEl_(a),this.boundApplyInitTime_=a=>this.applyInitTime_(a),this.boundUpdateCurrentBreakpoint_=a=>this.updateCurrentBreakpoint_(a),this.boundHandleTechClick_=a=>this.handleTechClick_(a),this.boundHandleTechDoubleClick_=a=>this.handleTechDoubleClick_(a),this.boundHandleTechTouchStart_=a=>this.handleTechTouchStart_(a),this.boundHandleTechTouchMove_=a=>this.handleTechTouchMove_(a),this.boundHandleTechTouchEnd_=a=>this.handleTechTouchEnd_(a),this.boundHandleTechTap_=a=>this.handleTechTap_(a),this.isFullscreen_=!1,this.log=D0(this.id_),this.fsApi_=Dl,this.isPosterFromTech_=!1,this.queuedCallbacks_=[],this.isReady_=!1,this.hasStarted_=!1,this.userActive_=!1,this.debugEnabled_=!1,this.audioOnlyMode_=!1,this.audioPosterMode_=!1,this.audioOnlyCache_={playerHeight:null,hiddenChildren:[]},!this.options_||!this.options_.techOrder||!this.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(this.tag=e,this.tagAttributes=e&&ls(e),this.language(this.options_.language),t.languages){const a={};Object.getOwnPropertyNames(t.languages).forEach(function(o){a[o.toLowerCase()]=t.languages[o]}),this.languages_=a}else this.languages_=yt.prototype.options_.languages;this.resetCache_(),this.poster_=t.poster||"",this.controls_=!!t.controls,e.controls=!1,e.removeAttribute("controls"),this.changingSrc_=!1,this.playCallbacks_=[],this.playTerminatedQueue_=[],e.hasAttribute("autoplay")?this.autoplay(!0):this.autoplay(this.options_.autoplay),t.plugins&&Object.keys(t.plugins).forEach(a=>{if(typeof this[a]!="function")throw new Error(`plugin "${a}" does not exist`)}),this.scrubbing_=!1,this.el_=this.createEl(),Jh(this,{eventBusKey:"el_"}),this.fsApi_.requestFullscreen&&(Ni(_e,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),this.on(this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_)),this.fluid_&&this.on(["playerreset","resize"],this.boundUpdateStyleEl_);const s=_t(this.options_);if(t.plugins&&Object.keys(t.plugins).forEach(a=>{this[a](t.plugins[a])}),t.debug&&this.debug(!0),this.options_.playerOptions=s,this.middleware_=[],this.playbackRates(t.playbackRates),t.experimentalSvgIcons){const o=new N.DOMParser().parseFromString(Rw,"image/svg+xml");if(o.querySelector("parsererror"))rt.warn("Failed to load SVG Icons. Falling back to Font Icons."),this.options_.experimentalSvgIcons=null;else{const u=o.documentElement;u.style.display="none",this.el_.appendChild(u),this.addClass("vjs-svg-icons-enabled")}}this.initChildren(),this.isAudio(e.nodeName.toLowerCase()==="audio"),this.controls()?this.addClass("vjs-controls-enabled"):this.addClass("vjs-controls-disabled"),this.el_.setAttribute("role","region"),this.isAudio()?this.el_.setAttribute("aria-label",this.localize("Audio Player")):this.el_.setAttribute("aria-label",this.localize("Video Player")),this.isAudio()&&this.addClass("vjs-audio"),ao&&this.addClass("vjs-touch-enabled"),pi||this.addClass("vjs-workinghover"),yt.players[this.id_]=this;const r=jc.split(".")[0];this.addClass(`vjs-v${r}`),this.userActive(!0),this.reportUserActivity(),this.one("play",a=>this.listenForUserActivity_(a)),this.on("keydown",a=>this.handleKeyDown(a)),this.on("languagechange",a=>this.handleLanguagechange(a)),this.breakpoints(this.options_.breakpoints),this.responsive(this.options_.responsive),this.on("ready",()=>{this.audioPosterMode(this.options_.audioPosterMode),this.audioOnlyMode(this.options_.audioOnlyMode)})}dispose(){this.trigger("dispose"),this.off("dispose"),si(_e,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),si(_e,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),yt.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),Cw(this),hi.names.forEach(e=>{const t=hi[e],n=this[t.getterName]();n&&n.off&&n.off()}),super.dispose({restoreEl:this.options_.restoreEl})}createEl(){let e=this.tag,t,n=this.playerElIngest_=e.parentNode&&e.parentNode.hasAttribute&&e.parentNode.hasAttribute("data-vjs-player");const s=this.tag.tagName.toLowerCase()==="video-js";n?t=this.el_=e.parentNode:s||(t=this.el_=super.createEl("div"));const r=ls(e);if(s){for(t=this.el_=e,e=this.tag=_e.createElement("video");t.children.length;)e.appendChild(t.firstChild);qa(t,"video-js")||Hs(t,"video-js"),t.appendChild(e),n=this.playerElIngest_=t,Object.keys(t).forEach(l=>{try{e[l]=t[l]}catch{}})}e.setAttribute("tabindex","-1"),r.tabindex="-1",Mn&&au&&(e.setAttribute("role","application"),r.role="application"),e.removeAttribute("width"),e.removeAttribute("height"),"width"in r&&delete r.width,"height"in r&&delete r.height,Object.getOwnPropertyNames(r).forEach(function(l){s&&l==="class"||t.setAttribute(l,r[l]),s&&e.setAttribute(l,r[l])}),e.playerId=e.id,e.id+="_html5_api",e.className="vjs-tech",e.player=t.player=this,this.addClass("vjs-paused");const a=["IS_SMART_TV","IS_TIZEN","IS_WEBOS","IS_ANDROID","IS_IPAD","IS_IPHONE"].filter(l=>k0[l]).map(l=>"vjs-device-"+l.substring(3).toLowerCase().replace(/\_/g,"-"));if(this.addClass(...a),N.VIDEOJS_NO_DYNAMIC_STYLE!==!0){this.styleEl_=Z0("vjs-styles-dimensions");const l=ds(".vjs-styles-defaults"),u=ds("head");u.insertBefore(this.styleEl_,l?l.nextSibling:u.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);const o=e.getElementsByTagName("a");for(let l=0;l<o.length;l++){const u=o.item(l);Hs(u,"vjs-hidden"),u.setAttribute("hidden","hidden")}return e.initNetworkState_=e.networkState,e.parentNode&&!n&&e.parentNode.insertBefore(t,e),Zc(e,t),this.children_.unshift(e),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=t,t}crossOrigin(e){if(typeof e>"u")return this.techGet_("crossOrigin");if(e!==null&&e!=="anonymous"&&e!=="use-credentials"){rt.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`);return}this.techCall_("setCrossOrigin",e),this.posterImage&&this.posterImage.crossOrigin(e)}width(e){return this.dimension("width",e)}height(e){return this.dimension("height",e)}dimension(e,t){const n=e+"_";if(t===void 0)return this[n]||0;if(t===""||t==="auto"){this[n]=void 0,this.updateStyleEl_();return}const s=parseFloat(t);if(isNaN(s)){rt.error(`Improper value "${t}" supplied for for ${e}`);return}this[n]=s,this.updateStyleEl_()}fluid(e){if(e===void 0)return!!this.fluid_;this.fluid_=!!e,jn(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),e?(this.addClass("vjs-fluid"),this.fill(!1),iw(this,()=>{this.on(["playerreset","resize"],this.boundUpdateStyleEl_)})):this.removeClass("vjs-fluid"),this.updateStyleEl_()}fill(e){if(e===void 0)return!!this.fill_;this.fill_=!!e,e?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")}aspectRatio(e){if(e===void 0)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(e))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()}updateStyleEl_(){if(N.VIDEOJS_NO_DYNAMIC_STYLE===!0){const o=typeof this.width_=="number"?this.width_:this.options_.width,l=typeof this.height_=="number"?this.height_:this.options_.height,u=this.tech_&&this.tech_.el();u&&(o>=0&&(u.width=o),l>=0&&(u.height=l));return}let e,t,n,s;this.aspectRatio_!==void 0&&this.aspectRatio_!=="auto"?n=this.aspectRatio_:this.videoWidth()>0?n=this.videoWidth()+":"+this.videoHeight():n="16:9";const r=n.split(":"),a=r[1]/r[0];this.width_!==void 0?e=this.width_:this.height_!==void 0?e=this.height_/a:e=this.videoWidth()||300,this.height_!==void 0?t=this.height_:t=e*a,/^[^a-zA-Z]/.test(this.id())?s="dimensions-"+this.id():s=this.id()+"-dimensions",this.addClass(s),J0(this.styleEl_,`
      .${s} {
        width: ${e}px;
        height: ${t}px;
      }

      .${s}.vjs-fluid:not(.vjs-audio-only-mode) {
        padding-top: ${a*100}%;
      }
    `)}loadTech_(e,t){this.tech_&&this.unloadTech_();const n=Rt(e),s=e.charAt(0).toLowerCase()+e.slice(1);n!=="Html5"&&this.tag&&(Qe.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=n,this.isReady_=!1;let r=this.autoplay();(typeof this.autoplay()=="string"||this.autoplay()===!0&&this.options_.normalizeAutoplay)&&(r=!1);const a={source:t,autoplay:r,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:`${this.id()}_${s}_api`,playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset};hi.names.forEach(l=>{const u=hi[l];a[u.getterName]=this[u.privateName]}),Object.assign(a,this.options_[n]),Object.assign(a,this.options_[s]),Object.assign(a,this.options_[e.toLowerCase()]),this.tag&&(a.tag=this.tag),t&&t.src===this.cache_.src&&this.cache_.currentTime>0&&(a.startTime=this.cache_.currentTime);const o=Qe.getTech(e);if(!o)throw new Error(`No Tech named '${n}' exists! '${n}' should be registered using videojs.registerTech()'`);this.tech_=new o(a),this.tech_.ready(vt(this,this.handleTechReady_),!0),fm.jsonToTextTracks(this.textTracksJson_||[],this.tech_),B_.forEach(l=>{this.on(this.tech_,l,u=>this[`handleTech${Rt(l)}_`](u))}),Object.keys(Cc).forEach(l=>{this.on(this.tech_,l,u=>{if(this.tech_.playbackRate()===0&&this.tech_.seeking()){this.queuedCallbacks_.push({callback:this[`handleTech${Cc[l]}_`].bind(this),event:u});return}this[`handleTech${Cc[l]}_`](u)})}),this.on(this.tech_,"loadstart",l=>this.handleTechLoadStart_(l)),this.on(this.tech_,"sourceset",l=>this.handleTechSourceset_(l)),this.on(this.tech_,"waiting",l=>this.handleTechWaiting_(l)),this.on(this.tech_,"ended",l=>this.handleTechEnded_(l)),this.on(this.tech_,"seeking",l=>this.handleTechSeeking_(l)),this.on(this.tech_,"play",l=>this.handleTechPlay_(l)),this.on(this.tech_,"pause",l=>this.handleTechPause_(l)),this.on(this.tech_,"durationchange",l=>this.handleTechDurationChange_(l)),this.on(this.tech_,"fullscreenchange",(l,u)=>this.handleTechFullscreenChange_(l,u)),this.on(this.tech_,"fullscreenerror",(l,u)=>this.handleTechFullscreenError_(l,u)),this.on(this.tech_,"enterpictureinpicture",l=>this.handleTechEnterPictureInPicture_(l)),this.on(this.tech_,"leavepictureinpicture",l=>this.handleTechLeavePictureInPicture_(l)),this.on(this.tech_,"error",l=>this.handleTechError_(l)),this.on(this.tech_,"posterchange",l=>this.handleTechPosterChange_(l)),this.on(this.tech_,"textdata",l=>this.handleTechTextData_(l)),this.on(this.tech_,"ratechange",l=>this.handleTechRateChange_(l)),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode!==this.el()&&(n!=="Html5"||!this.tag)&&Zc(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)}unloadTech_(){hi.names.forEach(e=>{const t=hi[e];this[t.privateName]=this[t.getterName]()}),this.textTracksJson_=fm.textTracksToJson(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1}tech(e){return e===void 0&&rt.warn(`Using the tech directly can be dangerous. I hope you know what you're doing.
See https://github.com/videojs/video.js/issues/2617 for more info.
`),this.tech_}version(){return{"video.js":jc}}addTechControlsListeners_(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)}removeTechControlsListeners_(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)}handleTechReady_(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()}handleTechLoadStart_(){this.removeClass("vjs-ended","vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):this.trigger("loadstart"),this.manualAutoplay_(this.autoplay()===!0&&this.options_.normalizeAutoplay?"play":this.autoplay())}manualAutoplay_(e){if(!this.tech_||typeof e!="string")return;const t=()=>{const s=this.muted();this.muted(!0);const r=()=>{this.muted(s)};this.playTerminatedQueue_.push(r);const a=this.play();if(ja(a))return a.catch(o=>{throw r(),new Error(`Rejection at manualAutoplay. Restoring muted value. ${o||""}`)})};let n;if(e==="any"&&!this.muted()?(n=this.play(),ja(n)&&(n=n.catch(t))):e==="muted"&&!this.muted()?n=t():n=this.play(),!!ja(n))return n.then(()=>{this.trigger({type:"autoplay-success",autoplay:e})}).catch(()=>{this.trigger({type:"autoplay-failure",autoplay:e})})}updateSourceCaches_(e=""){let t=e,n="";typeof t!="string"&&(t=e.src,n=e.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],t&&!n&&(n=Dw(this,t)),this.cache_.source=_t({},e,{src:t,type:n});const s=this.cache_.sources.filter(l=>l.src&&l.src===t),r=[],a=this.$$("source"),o=[];for(let l=0;l<a.length;l++){const u=ls(a[l]);r.push(u),u.src&&u.src===t&&o.push(u.src)}o.length&&!s.length?this.cache_.sources=r:s.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=t}handleTechSourceset_(e){if(!this.changingSrc_){let t=r=>this.updateSourceCaches_(r);const n=this.currentSource().src,s=e.src;n&&!/^blob:/.test(n)&&/^blob:/.test(s)&&(!this.lastSource_||this.lastSource_.tech!==s&&this.lastSource_.player!==n)&&(t=()=>{}),t(s),e.src||this.tech_.any(["sourceset","loadstart"],r=>{if(r.type==="sourceset")return;const a=this.techGet_("currentSrc");this.lastSource_.tech=a,this.updateSourceCaches_(a)})}this.lastSource_={player:this.currentSource().src,tech:e.src},this.trigger({src:e.src,type:"sourceset"})}hasStarted(e){if(e===void 0)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?this.addClass("vjs-has-started"):this.removeClass("vjs-has-started"))}handleTechPlay_(){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")}handleTechRateChange_(){this.tech_.playbackRate()>0&&this.cache_.lastPlaybackRate===0&&(this.queuedCallbacks_.forEach(e=>e.callback(e.event)),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")}handleTechWaiting_(){this.addClass("vjs-waiting"),this.trigger("waiting");const e=this.currentTime(),t=()=>{e!==this.currentTime()&&(this.removeClass("vjs-waiting"),this.off("timeupdate",t))};this.on("timeupdate",t)}handleTechCanPlay_(){this.removeClass("vjs-waiting"),this.trigger("canplay")}handleTechCanPlayThrough_(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")}handleTechPlaying_(){this.removeClass("vjs-waiting"),this.trigger("playing")}handleTechSeeking_(){this.addClass("vjs-seeking"),this.trigger("seeking")}handleTechSeeked_(){this.removeClass("vjs-seeking","vjs-ended"),this.trigger("seeked")}handleTechPause_(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")}handleTechEnded_(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")}handleTechDurationChange_(){this.duration(this.techGet_("duration"))}handleTechClick_(e){this.controls_&&(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.click===void 0||this.options_.userActions.click!==!1)&&(this.options_!==void 0&&this.options_.userActions!==void 0&&typeof this.options_.userActions.click=="function"?this.options_.userActions.click.call(this,e):this.paused()?mn(this.play()):this.pause())}handleTechDoubleClick_(e){if(!this.controls_)return;Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),n=>n.contains(e.target))||(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.doubleClick===void 0||this.options_.userActions.doubleClick!==!1)&&(this.options_!==void 0&&this.options_.userActions!==void 0&&typeof this.options_.userActions.doubleClick=="function"?this.options_.userActions.doubleClick.call(this,e):this.isFullscreen()?this.exitFullscreen():this.requestFullscreen())}handleTechTap_(){this.userActive(!this.userActive())}handleTechTouchStart_(){this.userWasActive=this.userActive()}handleTechTouchMove_(){this.userWasActive&&this.reportUserActivity()}handleTechTouchEnd_(e){e.cancelable&&e.preventDefault()}toggleFullscreenClass_(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")}documentFullscreenChange_(e){const t=e.target.player;if(t&&t!==this)return;const n=this.el();let s=_e[this.fsApi_.fullscreenElement]===n;!s&&n.matches&&(s=n.matches(":"+this.fsApi_.fullscreen)),this.isFullscreen(s)}handleTechFullscreenChange_(e,t){t&&(t.nativeIOSFullscreen&&(this.addClass("vjs-ios-native-fs"),this.tech_.one("webkitendfullscreen",()=>{this.removeClass("vjs-ios-native-fs")})),this.isFullscreen(t.isFullscreen))}handleTechFullscreenError_(e,t){this.trigger("fullscreenerror",t)}togglePictureInPictureClass_(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")}handleTechEnterPictureInPicture_(e){this.isInPictureInPicture(!0)}handleTechLeavePictureInPicture_(e){this.isInPictureInPicture(!1)}handleTechError_(){const e=this.tech_.error();e&&this.error(e)}handleTechTextData_(){let e=null;arguments.length>1&&(e=arguments[1]),this.trigger("textdata",e)}getCache(){return this.cache_}resetCache_(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}}techCall_(e,t){this.ready(function(){if(e in Ew)return Sw(this.middleware_,this.tech_,e,t);if(e in vm)return _m(this.middleware_,this.tech_,e,t);try{this.tech_&&this.tech_[e](t)}catch(n){throw rt(n),n}},!0)}techGet_(e){if(!(!this.tech_||!this.tech_.isReady_)){if(e in bw)return xw(this.middleware_,this.tech_,e);if(e in vm)return _m(this.middleware_,this.tech_,e);try{return this.tech_[e]()}catch(t){throw this.tech_[e]===void 0?(rt(`Video.js: ${e} method not defined for ${this.techName_} playback technology.`,t),t):t.name==="TypeError"?(rt(`Video.js: ${e} unavailable on ${this.techName_} playback technology element.`,t),this.tech_.isReady_=!1,t):(rt(t),t)}}}play(){return new Promise(e=>{this.play_(e)})}play_(e=mn){this.playCallbacks_.push(e);const t=Boolean(!this.changingSrc_&&(this.src()||this.currentSrc())),n=Boolean(lu||pi);if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!t){this.waitToPlay_=a=>{this.play_()},this.one(["ready","loadstart"],this.waitToPlay_),!t&&n&&this.load();return}const s=this.techGet_("play");n&&this.hasClass("vjs-ended")&&this.resetProgressBar_(),s===null?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(s)}runPlayTerminatedQueue_(){const e=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],e.forEach(function(t){t()})}runPlayCallbacks_(e){const t=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],t.forEach(function(n){n(e)})}pause(){this.techCall_("pause")}paused(){return this.techGet_("paused")!==!1}played(){return this.techGet_("played")||sn(0,0)}scrubbing(e){if(typeof e>"u")return this.scrubbing_;this.scrubbing_=!!e,this.techCall_("setScrubbing",this.scrubbing_),e?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")}currentTime(e){if(e===void 0)return this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime;if(e<0&&(e=0),!this.isReady_||this.changingSrc_||!this.tech_||!this.tech_.isReady_){this.cache_.initTime=e,this.off("canplay",this.boundApplyInitTime_),this.one("canplay",this.boundApplyInitTime_);return}this.techCall_("setCurrentTime",e),this.cache_.initTime=0,isFinite(e)&&(this.cache_.currentTime=Number(e))}applyInitTime_(){this.currentTime(this.cache_.initTime)}duration(e){if(e===void 0)return this.cache_.duration!==void 0?this.cache_.duration:NaN;e=parseFloat(e),e<0&&(e=1/0),e!==this.cache_.duration&&(this.cache_.duration=e,e===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(e)||this.trigger("durationchange"))}remainingTime(){return this.duration()-this.currentTime()}remainingTimeDisplay(){return Math.floor(this.duration())-Math.floor(this.currentTime())}buffered(){let e=this.techGet_("buffered");return(!e||!e.length)&&(e=sn(0,0)),e}seekable(){let e=this.techGet_("seekable");return(!e||!e.length)&&(e=sn(0,0)),e}seeking(){return this.techGet_("seeking")}ended(){return this.techGet_("ended")}networkState(){return this.techGet_("networkState")}readyState(){return this.techGet_("readyState")}bufferedPercent(){return l_(this.buffered(),this.duration())}bufferedEnd(){const e=this.buffered(),t=this.duration();let n=e.end(e.length-1);return n>t&&(n=t),n}volume(e){let t;if(e!==void 0){t=Math.max(0,Math.min(1,e)),this.cache_.volume=t,this.techCall_("setVolume",t),t>0&&this.lastVolume_(t);return}return t=parseFloat(this.techGet_("volume")),isNaN(t)?1:t}muted(e){if(e!==void 0){this.techCall_("setMuted",e);return}return this.techGet_("muted")||!1}defaultMuted(e){return e!==void 0&&this.techCall_("setDefaultMuted",e),this.techGet_("defaultMuted")||!1}lastVolume_(e){if(e!==void 0&&e!==0){this.cache_.lastVolume=e;return}return this.cache_.lastVolume}supportsFullScreen(){return this.techGet_("supportsFullScreen")||!1}isFullscreen(e){if(e!==void 0){const t=this.isFullscreen_;this.isFullscreen_=Boolean(e),this.isFullscreen_!==t&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),this.toggleFullscreenClass_();return}return this.isFullscreen_}requestFullscreen(e){this.isInPictureInPicture()&&this.exitPictureInPicture();const t=this;return new Promise((n,s)=>{function r(){t.off("fullscreenerror",o),t.off("fullscreenchange",a)}function a(){r(),n()}function o(u,h){r(),s(h)}t.one("fullscreenchange",a),t.one("fullscreenerror",o);const l=t.requestFullscreenHelper_(e);l&&(l.then(r,r),l.then(n,s))})}requestFullscreenHelper_(e){let t;if(this.fsApi_.prefixed||(t=this.options_.fullscreen&&this.options_.fullscreen.options||{},e!==void 0&&(t=e)),this.fsApi_.requestFullscreen){const n=this.el_[this.fsApi_.requestFullscreen](t);return n&&n.then(()=>this.isFullscreen(!0),()=>this.isFullscreen(!1)),n}else this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()}exitFullscreen(){const e=this;return new Promise((t,n)=>{function s(){e.off("fullscreenerror",a),e.off("fullscreenchange",r)}function r(){s(),t()}function a(l,u){s(),n(u)}e.one("fullscreenchange",r),e.one("fullscreenerror",a);const o=e.exitFullscreenHelper_();o&&(o.then(s,s),o.then(t,n))})}exitFullscreenHelper_(){if(this.fsApi_.requestFullscreen){const e=_e[this.fsApi_.exitFullscreen]();return e&&mn(e.then(()=>this.isFullscreen(!1))),e}else this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()}enterFullWindow(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=_e.documentElement.style.overflow,Ni(_e,"keydown",this.boundFullWindowOnEscKey_),_e.documentElement.style.overflow="hidden",Hs(_e.body,"vjs-full-window"),this.trigger("enterFullWindow")}fullWindowOnEscKey(e){qe.isEventKey(e,"Esc")&&this.isFullscreen()===!0&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())}exitFullWindow(){this.isFullscreen(!1),this.isFullWindow=!1,si(_e,"keydown",this.boundFullWindowOnEscKey_),_e.documentElement.style.overflow=this.docOrigOverflow,uu(_e.body,"vjs-full-window"),this.trigger("exitFullWindow")}disablePictureInPicture(e){if(e===void 0)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",e),this.options_.disablePictureInPicture=e,this.trigger("disablepictureinpicturechanged")}isInPictureInPicture(e){if(e!==void 0){this.isInPictureInPicture_=!!e,this.togglePictureInPictureClass_();return}return!!this.isInPictureInPicture_}requestPictureInPicture(){if(this.options_.enableDocumentPictureInPicture&&N.documentPictureInPicture){const e=_e.createElement(this.el().tagName);return e.classList=this.el().classList,e.classList.add("vjs-pip-container"),this.posterImage&&e.appendChild(this.posterImage.el().cloneNode(!0)),this.titleBar&&e.appendChild(this.titleBar.el().cloneNode(!0)),e.appendChild(Je("p",{className:"vjs-pip-text"},{},this.localize("Playing in picture-in-picture"))),N.documentPictureInPicture.requestWindow({width:this.videoWidth(),height:this.videoHeight()}).then(t=>(K0(t),this.el_.parentNode.insertBefore(e,this.el_),t.document.body.appendChild(this.el_),t.document.body.classList.add("vjs-pip-window"),this.player_.isInPictureInPicture(!0),this.player_.trigger({type:"enterpictureinpicture",pipWindow:t}),t.addEventListener("pagehide",n=>{const s=n.target.querySelector(".video-js");e.parentNode.replaceChild(s,e),this.player_.isInPictureInPicture(!1),this.player_.trigger("leavepictureinpicture")}),t))}return"pictureInPictureEnabled"in _e&&this.disablePictureInPicture()===!1?this.techGet_("requestPictureInPicture"):Promise.reject("No PiP mode is available")}exitPictureInPicture(){if(N.documentPictureInPicture&&N.documentPictureInPicture.window)return N.documentPictureInPicture.window.close(),Promise.resolve();if("pictureInPictureEnabled"in _e)return _e.exitPictureInPicture()}handleKeyDown(e){const{userActions:t}=this.options_;!t||!t.hotkeys||(s=>{const r=s.tagName.toLowerCase();if(s.isContentEditable)return!0;const a=["button","checkbox","hidden","radio","reset","submit"];return r==="input"?a.indexOf(s.type)===-1:["textarea"].indexOf(r)!==-1})(this.el_.ownerDocument.activeElement)||(typeof t.hotkeys=="function"?t.hotkeys.call(this,e):this.handleHotkeys(e))}handleHotkeys(e){const t=this.options_.userActions?this.options_.userActions.hotkeys:{},{fullscreenKey:n=a=>qe.isEventKey(a,"f"),muteKey:s=a=>qe.isEventKey(a,"m"),playPauseKey:r=a=>qe.isEventKey(a,"k")||qe.isEventKey(a,"Space")}=t;if(n.call(this,e)){e.preventDefault(),e.stopPropagation();const a=re.getComponent("FullscreenToggle");_e[this.fsApi_.fullscreenEnabled]!==!1&&a.prototype.handleClick.call(this,e)}else s.call(this,e)?(e.preventDefault(),e.stopPropagation(),re.getComponent("MuteToggle").prototype.handleClick.call(this,e)):r.call(this,e)&&(e.preventDefault(),e.stopPropagation(),re.getComponent("PlayToggle").prototype.handleClick.call(this,e))}canPlayType(e){let t;for(let n=0,s=this.options_.techOrder;n<s.length;n++){const r=s[n];let a=Qe.getTech(r);if(a||(a=re.getComponent(r)),!a){rt.error(`The "${r}" tech is undefined. Skipped browser support check for that tech.`);continue}if(a.isSupported()&&(t=a.canPlayType(e),t))return t}return""}selectSource(e){const t=this.options_.techOrder.map(o=>[o,Qe.getTech(o)]).filter(([o,l])=>l?l.isSupported():(rt.error(`The "${o}" tech is undefined. Skipped browser support check for that tech.`),!1)),n=function(o,l,u){let h;return o.some(d=>l.some(m=>{if(h=u(d,m),h)return!0})),h};let s;const r=o=>(l,u)=>o(u,l),a=([o,l],u)=>{if(l.canPlaySource(u,this.options_[o.toLowerCase()]))return{source:u,tech:o}};return this.options_.sourceOrder?s=n(e,t,r(a)):s=n(t,e,a),s||!1}handleSrc_(e,t){if(typeof e>"u")return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();const n=f_(e);if(!n.length){this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0);return}if(this.changingSrc_=!0,t||(this.cache_.sources=n),this.updateSourceCaches_(n[0]),yw(this,n[0],(s,r)=>{if(this.middleware_=r,t||(this.cache_.sources=n),this.updateSourceCaches_(s),this.src_(s)){if(n.length>1)return this.handleSrc_(n.slice(1));this.changingSrc_=!1,this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0),this.triggerReady();return}Tw(r,this.tech_)}),n.length>1){const s=()=>{this.error(null),this.handleSrc_(n.slice(1),!0)},r=()=>{this.off("error",s)};this.one("error",s),this.one("playing",r),this.resetRetryOnError_=()=>{this.off("error",s),this.off("playing",r)}}}src(e){return this.handleSrc_(e,!1)}src_(e){const t=this.selectSource([e]);return t?s_(t.tech,this.techName_)?(this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",e):this.techCall_("src",e.src),this.changingSrc_=!1},!0),!1):(this.changingSrc_=!0,this.loadTech_(t.tech,t.source),this.tech_.ready(()=>{this.changingSrc_=!1}),!1):!0}load(){if(this.tech_&&this.tech_.vhs){this.src(this.currentSource());return}this.techCall_("load")}reset(){if(this.paused())this.doReset_();else{const e=this.play();mn(e.then(()=>this.doReset_()))}}doReset_(){this.tech_&&this.tech_.clearTracks("text"),this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),this.error(null),this.titleBar&&this.titleBar.update({title:void 0,description:void 0}),jn(this)&&this.trigger("playerreset")}resetControlBarUI_(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()}resetProgressBar_(){this.currentTime(0);const{currentTimeDisplay:e,durationDisplay:t,progressControl:n,remainingTimeDisplay:s}=this.controlBar||{},{seekBar:r}=n||{};e&&e.updateContent(),t&&t.updateContent(),s&&s.updateContent(),r&&(r.update(),r.loadProgressBar&&r.loadProgressBar.update())}resetPlaybackRate_(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()}resetVolumeBar_(){this.volume(1),this.trigger("volumechange")}currentSources(){const e=this.currentSource(),t=[];return Object.keys(e).length!==0&&t.push(e),this.cache_.sources||t}currentSource(){return this.cache_.source||{}}currentSrc(){return this.currentSource()&&this.currentSource().src||""}currentType(){return this.currentSource()&&this.currentSource().type||""}preload(e){if(e!==void 0){this.techCall_("setPreload",e),this.options_.preload=e;return}return this.techGet_("preload")}autoplay(e){if(e===void 0)return this.options_.autoplay||!1;let t;typeof e=="string"&&/(any|play|muted)/.test(e)||e===!0&&this.options_.normalizeAutoplay?(this.options_.autoplay=e,this.manualAutoplay_(typeof e=="string"?e:"play"),t=!1):e?this.options_.autoplay=!0:this.options_.autoplay=!1,t=typeof t>"u"?this.options_.autoplay:t,this.tech_&&this.techCall_("setAutoplay",t)}playsinline(e){return e!==void 0&&(this.techCall_("setPlaysinline",e),this.options_.playsinline=e),this.techGet_("playsinline")}loop(e){if(e!==void 0){this.techCall_("setLoop",e),this.options_.loop=e;return}return this.techGet_("loop")}poster(e){if(e===void 0)return this.poster_;e||(e=""),e!==this.poster_&&(this.poster_=e,this.techCall_("setPoster",e),this.isPosterFromTech_=!1,this.trigger("posterchange"))}handleTechPosterChange_(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){const e=this.tech_.poster()||"";e!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger("posterchange"))}}controls(e){if(e===void 0)return!!this.controls_;e=!!e,this.controls_!==e&&(this.controls_=e,this.usingNativeControls()&&this.techCall_("setControls",e),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))}usingNativeControls(e){if(e===void 0)return!!this.usingNativeControls_;e=!!e,this.usingNativeControls_!==e&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))}error(e){if(e===void 0)return this.error_||null;if(hs("beforeerror").forEach(t=>{const n=t(this,e);if(!(An(n)&&!Array.isArray(n)||typeof n=="string"||typeof n=="number"||n===null)){this.log.error("please return a value that MediaError expects in beforeerror hooks");return}e=n}),this.options_.suppressNotSupportedError&&e&&e.code===4){const t=function(){this.error(e)};this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],t),this.one("loadstart",function(){this.off(["click","touchstart"],t)});return}if(e===null){this.error_=null,this.removeClass("vjs-error"),this.errorDisplay&&this.errorDisplay.close();return}this.error_=new Mt(e),this.addClass("vjs-error"),rt.error(`(CODE:${this.error_.code} ${Mt.errorTypes[this.error_.code]})`,this.error_.message,this.error_),this.trigger("error"),hs("error").forEach(t=>t(this,this.error_))}reportUserActivity(e){this.userActivity_=!0}userActive(e){if(e===void 0)return this.userActive_;if(e=!!e,e!==this.userActive_){if(this.userActive_=e,this.userActive_){this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),this.trigger("useractive");return}this.tech_&&this.tech_.one("mousemove",function(t){t.stopPropagation(),t.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}}listenForUserActivity_(){let e,t,n;const s=vt(this,this.reportUserActivity),r=function(d){(d.screenX!==t||d.screenY!==n)&&(t=d.screenX,n=d.screenY,s())},a=function(){s(),this.clearInterval(e),e=this.setInterval(s,250)},o=function(d){s(),this.clearInterval(e)};this.on("mousedown",a),this.on("mousemove",r),this.on("mouseup",o),this.on("mouseleave",o);const l=this.getChild("controlBar");l&&!pi&&!Cn&&(l.on("mouseenter",function(d){this.player().options_.inactivityTimeout!==0&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0}),l.on("mouseleave",function(d){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on("keydown",s),this.on("keyup",s);let u;const h=function(){if(!this.userActivity_)return;this.userActivity_=!1,this.userActive(!0),this.clearTimeout(u);const d=this.options_.inactivityTimeout;d<=0||(u=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},d))};this.setInterval(h,250)}playbackRate(e){if(e!==void 0){this.techCall_("setPlaybackRate",e);return}return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1}defaultPlaybackRate(e){return e!==void 0?this.techCall_("setDefaultPlaybackRate",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1}isAudio(e){if(e!==void 0){this.isAudio_=!!e;return}return!!this.isAudio_}enableAudioOnlyUI_(){this.addClass("vjs-audio-only-mode");const e=this.children(),t=this.getChild("ControlBar"),n=t&&t.currentHeight();e.forEach(s=>{s!==t&&s.el_&&!s.hasClass("vjs-hidden")&&(s.hide(),this.audioOnlyCache_.hiddenChildren.push(s))}),this.audioOnlyCache_.playerHeight=this.currentHeight(),this.height(n),this.trigger("audioonlymodechange")}disableAudioOnlyUI_(){this.removeClass("vjs-audio-only-mode"),this.audioOnlyCache_.hiddenChildren.forEach(e=>e.show()),this.height(this.audioOnlyCache_.playerHeight),this.trigger("audioonlymodechange")}audioOnlyMode(e){if(typeof e!="boolean"||e===this.audioOnlyMode_)return this.audioOnlyMode_;if(this.audioOnlyMode_=e,e){const t=[];return this.isInPictureInPicture()&&t.push(this.exitPictureInPicture()),this.isFullscreen()&&t.push(this.exitFullscreen()),this.audioPosterMode()&&t.push(this.audioPosterMode(!1)),Promise.all(t).then(()=>this.enableAudioOnlyUI_())}return Promise.resolve().then(()=>this.disableAudioOnlyUI_())}enablePosterModeUI_(){(this.tech_&&this.tech_).hide(),this.addClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}disablePosterModeUI_(){(this.tech_&&this.tech_).show(),this.removeClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}audioPosterMode(e){return typeof e!="boolean"||e===this.audioPosterMode_?this.audioPosterMode_:(this.audioPosterMode_=e,e?this.audioOnlyMode()?this.audioOnlyMode(!1).then(()=>{this.enablePosterModeUI_()}):Promise.resolve().then(()=>{this.enablePosterModeUI_()}):Promise.resolve().then(()=>{this.disablePosterModeUI_()}))}addTextTrack(e,t,n){if(this.tech_)return this.tech_.addTextTrack(e,t,n)}addRemoteTextTrack(e,t){if(this.tech_)return this.tech_.addRemoteTextTrack(e,t)}removeRemoteTextTrack(e={}){let{track:t}=e;if(t||(t=e),this.tech_)return this.tech_.removeRemoteTextTrack(t)}getVideoPlaybackQuality(){return this.techGet_("getVideoPlaybackQuality")}videoWidth(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0}videoHeight(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0}language(e){if(e===void 0)return this.language_;this.language_!==String(e).toLowerCase()&&(this.language_=String(e).toLowerCase(),jn(this)&&this.trigger("languagechange"))}languages(){return _t(yt.prototype.options_.languages,this.languages_)}toJSON(){const e=_t(this.options_),t=e.tracks;e.tracks=[];for(let n=0;n<t.length;n++){let s=t[n];s=_t(s),s.player=void 0,e.tracks[n]=s}return e}createModal(e,t){t=t||{},t.content=e||"";const n=new oa(this,t);return this.addChild(n),n.on("dispose",()=>{this.removeChild(n)}),n.open(),n}updateCurrentBreakpoint_(){if(!this.responsive())return;const e=this.currentBreakpoint(),t=this.currentWidth();for(let n=0;n<oh.length;n++){const s=oh[n],r=this.breakpoints_[s];if(t<=r){if(e===s)return;e&&this.removeClass(vl[e]),this.addClass(vl[s]),this.breakpoint_=s;break}}}removeCurrentBreakpoint_(){const e=this.currentBreakpointClass();this.breakpoint_="",e&&this.removeClass(e)}breakpoints(e){return e===void 0?Object.assign(this.breakpoints_):(this.breakpoint_="",this.breakpoints_=Object.assign({},rD,e),this.updateCurrentBreakpoint_(),Object.assign(this.breakpoints_))}responsive(e){if(e===void 0)return this.responsive_;e=Boolean(e);const t=this.responsive_;if(e!==t)return this.responsive_=e,e?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),e}currentBreakpoint(){return this.breakpoint_}currentBreakpointClass(){return vl[this.breakpoint_]||""}loadMedia(e,t){if(!e||typeof e!="object")return;const n=this.crossOrigin();this.reset(),this.cache_.media=_t(e);const{artist:s,artwork:r,description:a,poster:o,src:l,textTracks:u,title:h}=this.cache_.media;!r&&o&&(this.cache_.media.artwork=[{src:o,type:Ul(o)}]),n&&this.crossOrigin(n),l&&this.src(l),o&&this.poster(o),Array.isArray(u)&&u.forEach(d=>this.addRemoteTextTrack(d,!1)),this.titleBar&&this.titleBar.update({title:h,description:a||s||""}),this.ready(t)}getMedia(){if(!this.cache_.media){const e=this.poster(),t=this.currentSources(),n=Array.prototype.map.call(this.remoteTextTracks(),r=>({kind:r.kind,label:r.label,language:r.language,src:r.src})),s={src:t,textTracks:n};return e&&(s.poster=e,s.artwork=[{src:s.poster,type:Ul(s.poster)}]),s}return _t(this.cache_.media)}static getTagSettings(e){const t={sources:[],tracks:[]},n=ls(e),s=n["data-setup"];if(qa(e,"vjs-fill")&&(n.fill=!0),qa(e,"vjs-fluid")&&(n.fluid=!0),s!==null){const[r,a]=G1(s||"{}");r&&rt.error(r),Object.assign(n,a)}if(Object.assign(t,n),e.hasChildNodes()){const r=e.childNodes;for(let a=0,o=r.length;a<o;a++){const l=r[a],u=l.nodeName.toLowerCase();u==="source"?t.sources.push(ls(l)):u==="track"&&t.tracks.push(ls(l))}}return t}debug(e){if(e===void 0)return this.debugEnabled_;e?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)}playbackRates(e){if(e===void 0)return this.cache_.playbackRates;Array.isArray(e)&&e.every(t=>typeof t=="number")&&(this.cache_.playbackRates=e,this.trigger("playbackrateschange"))}}hi.names.forEach(function(i){const e=hi[i];yt.prototype[e.getterName]=function(){return this.tech_?this.tech_[e.getterName]():(this[e.privateName]=this[e.privateName]||new e.ListClass,this[e.privateName])}});yt.prototype.crossorigin=yt.prototype.crossOrigin;yt.players={};const Pa=N.navigator;yt.prototype.options_={techOrder:Qe.defaultTechOrder_,html5:{},enableSourceset:!0,inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","titleBar","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:Pa&&(Pa.languages&&Pa.languages[0]||Pa.userLanguage||Pa.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1,audioOnlyMode:!1,audioPosterMode:!1,enableSmoothSeeking:!1};B_.forEach(function(i){yt.prototype[`handleTech${Rt(i)}_`]=function(){return this.trigger(i)}});re.registerComponent("Player",yt);const Nl="plugin",Or="activePlugins_",Ar={},kl=i=>Ar.hasOwnProperty(i),yl=i=>kl(i)?Ar[i]:void 0,H_=(i,e)=>{i[Or]=i[Or]||{},i[Or][e]=!0},Fl=(i,e,t)=>{const n=(t?"before":"")+"pluginsetup";i.trigger(n,e),i.trigger(n+":"+e.name,e)},aD=function(i,e){const t=function(){Fl(this,{name:i,plugin:e,instance:null},!0);const n=e.apply(this,arguments);return H_(this,i),Fl(this,{name:i,plugin:e,instance:n}),n};return Object.keys(e).forEach(function(n){t[n]=e[n]}),t},Im=(i,e)=>(e.prototype.name=i,function(...t){Fl(this,{name:i,plugin:e,instance:null},!0);const n=new e(this,...t);return this[i]=()=>n,Fl(this,n.getEventHash()),n});class Ei{constructor(e){if(this.constructor===Ei)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=e,this.log||(this.log=this.player.log.createLogger(this.name)),Jh(this),delete this.trigger,n_(this,this.constructor.defaultState),H_(e,this.name),this.dispose=this.dispose.bind(this),e.on("dispose",this.dispose)}version(){return this.constructor.VERSION}getEventHash(e={}){return e.name=this.name,e.plugin=this.constructor,e.instance=this,e}trigger(e,t={}){return aa(this.eventBusEl_,e,this.getEventHash(t))}handleStateChanged(e){}dispose(){const{name:e,player:t}=this;this.trigger("dispose"),this.off(),t.off("dispose",this.dispose),t[Or][e]=!1,this.player=this.state=null,t[e]=Im(e,Ar[e])}static isBasic(e){const t=typeof e=="string"?yl(e):e;return typeof t=="function"&&!Ei.prototype.isPrototypeOf(t.prototype)}static registerPlugin(e,t){if(typeof e!="string")throw new Error(`Illegal plugin name, "${e}", must be a string, was ${typeof e}.`);if(kl(e))rt.warn(`A plugin named "${e}" already exists. You may want to avoid re-registering plugins!`);else if(yt.prototype.hasOwnProperty(e))throw new Error(`Illegal plugin name, "${e}", cannot share a name with an existing player method!`);if(typeof t!="function")throw new Error(`Illegal plugin for "${e}", must be a function, was ${typeof t}.`);return Ar[e]=t,e!==Nl&&(Ei.isBasic(t)?yt.prototype[e]=aD(e,t):yt.prototype[e]=Im(e,t)),t}static deregisterPlugin(e){if(e===Nl)throw new Error("Cannot de-register base plugin.");kl(e)&&(delete Ar[e],delete yt.prototype[e])}static getPlugins(e=Object.keys(Ar)){let t;return e.forEach(n=>{const s=yl(n);s&&(t=t||{},t[n]=s)}),t}static getPluginVersion(e){const t=yl(e);return t&&t.VERSION||""}}Ei.getPlugin=yl;Ei.BASE_PLUGIN_NAME=Nl;Ei.registerPlugin(Nl,Ei);yt.prototype.usingPlugin=function(i){return!!this[Or]&&this[Or][i]===!0};yt.prototype.hasPlugin=function(i){return!!kl(i)};function oD(i,e){let t=!1;return function(...n){return t||rt.warn(i),t=!0,e.apply(this,n)}}function an(i,e,t,n){return oD(`${e} is deprecated and will be removed in ${i}.0; please use ${t} instead.`,n)}var lD={UnsupportedSidxContainer:"unsupported-sidx-container-error",DashManifestSidxParsingError:"dash-manifest-sidx-parsing-error",HlsPlaylistRequestError:"hls-playlist-request-error",SegmentUnsupportedMediaFormat:"segment-unsupported-media-format-error",UnsupportedMediaInitialization:"unsupported-media-initialization-error",SegmentSwitchError:"segment-switch-error",SegmentExceedsSourceBufferQuota:"segment-exceeds-source-buffer-quota-error",SegmentAppendError:"segment-append-error",VttLoadError:"vtt-load-error",VttCueParsingError:"vtt-cue-parsing-error",AdsBeforePrerollError:"ads-before-preroll-error",AdsPrerollError:"ads-preroll-error",AdsMidrollError:"ads-midroll-error",AdsPostrollError:"ads-postroll-error",AdsMacroReplacementFailed:"ads-macro-replacement-failed",AdsResumeContentFailed:"ads-resume-content-failed",EMEFailedToRequestMediaKeySystemAccess:"eme-failed-request-media-key-system-access",EMEFailedToCreateMediaKeys:"eme-failed-create-media-keys",EMEFailedToAttachMediaKeysToVideoElement:"eme-failed-attach-media-keys-to-video",EMEFailedToCreateMediaKeySession:"eme-failed-create-media-key-session",EMEFailedToSetServerCertificate:"eme-failed-set-server-certificate",EMEFailedToGenerateLicenseRequest:"eme-failed-generate-license-request",EMEFailedToUpdateSessionWithReceivedLicenseKeys:"eme-failed-update-session",EMEFailedToCloseSession:"eme-failed-close-session",EMEFailedToRemoveKeysFromSession:"eme-failed-remove-keys",EMEFailedToLoadSessionBySessionId:"eme-failed-load-session"};const V_=i=>i.indexOf("#")===0?i.slice(1):i;function q(i,e,t){let n=q.getPlayer(i);if(n)return e&&rt.warn(`Player "${i}" is already initialised. Options will not be applied.`),t&&n.ready(t),n;const s=typeof i=="string"?ds("#"+V_(i)):i;if(!ra(s))throw new TypeError("The element or ID supplied is not valid. (videojs)");const a=("getRootNode"in s?s.getRootNode()instanceof N.ShadowRoot:!1)?s.getRootNode():s.ownerDocument.body;(!s.ownerDocument.defaultView||!a.contains(s))&&rt.warn("The element supplied is not included in the DOM"),e=e||{},e.restoreEl===!0&&(e.restoreEl=(s.parentNode&&s.parentNode.hasAttribute("data-vjs-player")?s.parentNode:s).cloneNode(!0)),hs("beforesetup").forEach(l=>{const u=l(s,_t(e));if(!An(u)||Array.isArray(u)){rt.error("please return an object in beforesetup hooks");return}e=_t(e,u)});const o=re.getComponent("Player");return n=new o(s,e,t),hs("setup").forEach(l=>l(n)),n}q.hooks_=zn;q.hooks=hs;q.hook=GM;q.hookOnce=WM;q.removeHook=w0;if(N.VIDEOJS_NO_DYNAMIC_STYLE!==!0&&sa()){let i=ds(".vjs-styles-defaults");if(!i){i=Z0("vjs-styles-defaults");const e=ds("head");e&&e.insertBefore(i,e.firstChild),J0(i,`
      .video-js {
        width: 300px;
        height: 150px;
      }

      .vjs-fluid:not(.vjs-audio-only-mode) {
        padding-top: 56.25%
      }
    `)}}eh(1,q);q.VERSION=jc;q.options=yt.prototype.options_;q.getPlayers=()=>yt.players;q.getPlayer=i=>{const e=yt.players;let t;if(typeof i=="string"){const n=V_(i),s=e[n];if(s)return s;t=ds("#"+n)}else t=i;if(ra(t)){const{player:n,playerId:s}=t;if(n||e[s])return n||e[s]}};q.getAllPlayers=()=>Object.keys(yt.players).map(i=>yt.players[i]).filter(Boolean);q.players=yt.players;q.getComponent=re.getComponent;q.registerComponent=(i,e)=>(Qe.isTech(e)&&rt.warn(`The ${i} tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)`),re.registerComponent.call(re,i,e));q.getTech=Qe.getTech;q.registerTech=Qe.registerTech;q.use=vw;Object.defineProperty(q,"middleware",{value:{},writeable:!1,enumerable:!0});Object.defineProperty(q.middleware,"TERMINATOR",{value:Ol,writeable:!1,enumerable:!0});q.browser=k0;q.obj=jM;q.mergeOptions=an(9,"videojs.mergeOptions","videojs.obj.merge",_t);q.defineLazyProperty=an(9,"videojs.defineLazyProperty","videojs.obj.defineLazyProperty",su);q.bind=an(9,"videojs.bind","native Function.prototype.bind",vt);q.registerPlugin=Ei.registerPlugin;q.deregisterPlugin=Ei.deregisterPlugin;q.plugin=(i,e)=>(rt.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),Ei.registerPlugin(i,e));q.getPlugins=Ei.getPlugins;q.getPlugin=Ei.getPlugin;q.getPluginVersion=Ei.getPluginVersion;q.addLanguage=function(i,e){return i=(""+i).toLowerCase(),q.options.languages=_t(q.options.languages,{[i]:e}),q.options.languages[i]};q.log=rt;q.createLogger=D0;q.time=ow;q.createTimeRange=an(9,"videojs.createTimeRange","videojs.time.createTimeRanges",sn);q.createTimeRanges=an(9,"videojs.createTimeRanges","videojs.time.createTimeRanges",sn);q.formatTime=an(9,"videojs.formatTime","videojs.time.formatTime",$s);q.setFormatTime=an(9,"videojs.setFormatTime","videojs.time.setFormatTime",a_);q.resetFormatTime=an(9,"videojs.resetFormatTime","videojs.time.resetFormatTime",o_);q.parseUrl=an(9,"videojs.parseUrl","videojs.url.parseUrl",id);q.isCrossOrigin=an(9,"videojs.isCrossOrigin","videojs.url.isCrossOrigin",gu);q.EventTarget=qi;q.any=Zh;q.on=Ni;q.one=pu;q.off=si;q.trigger=aa;q.xhr=eo;q.TextTrack=vo;q.AudioTrack=h_;q.VideoTrack=d_;["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(i=>{q[i]=function(){return rt.warn(`videojs.${i}() is deprecated; use videojs.dom.${i}() instead`),Y0[i].apply(null,arguments)}});q.computedStyle=an(9,"videojs.computedStyle","videojs.dom.computedStyle",Qr);q.dom=Y0;q.fn=tw;q.num=Fw;q.str=rw;q.url=gw;q.Error=lD;/*! @name videojs-contrib-quality-levels @version 4.1.0 @license Apache-2.0 */class uD{constructor(e){let t=this;return t.id=e.id,t.label=t.id,t.width=e.width,t.height=e.height,t.bitrate=e.bandwidth,t.frameRate=e.frameRate,t.enabled_=e.enabled,Object.defineProperty(t,"enabled",{get(){return t.enabled_()},set(n){t.enabled_(n)}}),t}}class Bl extends q.EventTarget{constructor(){super();let e=this;return e.levels_=[],e.selectedIndex_=-1,Object.defineProperty(e,"selectedIndex",{get(){return e.selectedIndex_}}),Object.defineProperty(e,"length",{get(){return e.levels_.length}}),e[Symbol.iterator]=()=>e.levels_.values(),e}addQualityLevel(e){let t=this.getQualityLevelById(e.id);if(t)return t;const n=this.levels_.length;return t=new uD(e),""+n in this||Object.defineProperty(this,n,{get(){return this.levels_[n]}}),this.levels_.push(t),this.trigger({qualityLevel:t,type:"addqualitylevel"}),t}removeQualityLevel(e){let t=null;for(let n=0,s=this.length;n<s;n++)if(this[n]===e){t=this.levels_.splice(n,1)[0],this.selectedIndex_===n?this.selectedIndex_=-1:this.selectedIndex_>n&&this.selectedIndex_--;break}return t&&this.trigger({qualityLevel:e,type:"removequalitylevel"}),t}getQualityLevelById(e){for(let t=0,n=this.length;t<n;t++){const s=this[t];if(s.id===e)return s}return null}dispose(){this.selectedIndex_=-1,this.levels_.length=0}}Bl.prototype.allowedEvents_={change:"change",addqualitylevel:"addqualitylevel",removequalitylevel:"removequalitylevel"};for(const i in Bl.prototype.allowedEvents_)Bl.prototype["on"+i]=null;var z_="4.1.0";const cD=function(i,e){const t=i.qualityLevels,n=new Bl,s=function(){n.dispose(),i.qualityLevels=t,i.off("dispose",s)};return i.on("dispose",s),i.qualityLevels=()=>n,i.qualityLevels.VERSION=z_,n},G_=function(i){return cD(this,q.obj.merge({},i))};q.registerPlugin("qualityLevels",G_);G_.VERSION=z_;/*! @name @videojs/http-streaming @version 3.12.1 @license Apache-2.0 */const Ti=Ql,Hl=(i,e)=>e&&e.responseURL&&i!==e.responseURL?e.responseURL:i,$i=i=>q.log.debug?q.log.debug.bind(q,"VHS:",`${i} >`):function(){};function ht(...i){const e=q.obj||q;return(e.merge||e.mergeOptions).apply(e,i)}function ni(...i){const e=q.time||q;return(e.createTimeRanges||e.createTimeRanges).apply(e,i)}function hD(i){if(i.length===0)return"Buffered Ranges are empty";let e=`Buffered Ranges: 
`;for(let t=0;t<i.length;t++){const n=i.start(t),s=i.end(t);e+=`${n} --> ${s}. Duration (${s-n})
`}return e}const gn=1/30,_n=gn*3,W_=function(i,e){const t=[];let n;if(i&&i.length)for(n=0;n<i.length;n++)e(i.start(n),i.end(n))&&t.push([i.start(n),i.end(n)]);return ni(t)},Cr=function(i,e){return W_(i,function(t,n){return t-_n<=e&&n+_n>=e})},dl=function(i,e){return W_(i,function(t){return t-gn>=e})},dD=function(i){if(i.length<2)return ni();const e=[];for(let t=1;t<i.length;t++){const n=i.end(t-1),s=i.start(t);e.push([n,s])}return ni(e)},fD=function(i,e){let t=null,n=null,s=0;const r=[],a=[];if(!i||!i.length||!e||!e.length)return ni();let o=i.length;for(;o--;)r.push({time:i.start(o),type:"start"}),r.push({time:i.end(o),type:"end"});for(o=e.length;o--;)r.push({time:e.start(o),type:"start"}),r.push({time:e.end(o),type:"end"});for(r.sort(function(l,u){return l.time-u.time}),o=0;o<r.length;o++)r[o].type==="start"?(s++,s===2&&(t=r[o].time)):r[o].type==="end"&&(s--,s===1&&(n=r[o].time)),t!==null&&n!==null&&(a.push([t,n]),t=null,n=null);return ni(a)},q_=i=>{const e=[];if(!i||!i.length)return"";for(let t=0;t<i.length;t++)e.push(i.start(t)+" => "+i.end(t));return e.join(", ")},pD=function(i,e,t=1){return((i.length?i.end(i.length-1):0)-e)/t},Us=i=>{const e=[];for(let t=0;t<i.length;t++)e.push({start:i.start(t),end:i.end(t)});return e},mD=function(i,e){if(i===e)return!1;if(!i&&e||!e&&i||i.length!==e.length)return!0;for(let t=0;t<i.length;t++)if(i.start(t)!==e.start(t)||i.end(t)!==e.end(t))return!0;return!1},Mc=function(i){if(!(!i||!i.length||!i.end))return i.end(i.length-1)},Td=function(i,e){let t=0;if(!i||!i.length)return t;for(let n=0;n<i.length;n++){const s=i.start(n),r=i.end(n);if(!(e>r)){if(e>s&&e<=r){t+=r-e;continue}t+=r-s}}return t},xd=(i,e)=>{if(!e.preload)return e.duration;let t=0;return(e.parts||[]).forEach(function(n){t+=n.duration}),(e.preloadHints||[]).forEach(function(n){n.type==="PART"&&(t+=i.partTargetDuration)}),t},lh=i=>(i.segments||[]).reduce((e,t,n)=>(t.parts?t.parts.forEach(function(s,r){e.push({duration:s.duration,segmentIndex:n,partIndex:r,part:s,segment:t})}):e.push({duration:t.duration,segmentIndex:n,partIndex:null,segment:t,part:null}),e),[]),$_=i=>{const e=i.segments&&i.segments.length&&i.segments[i.segments.length-1];return e&&e.parts||[]},j_=({preloadSegment:i})=>{if(!i)return;const{parts:e,preloadHints:t}=i;let n=(t||[]).reduce((s,r)=>s+(r.type==="PART"?1:0),0);return n+=e&&e.length?e.length:0,n},X_=(i,e)=>{if(e.endList)return 0;if(i&&i.suggestedPresentationDelay)return i.suggestedPresentationDelay;const t=$_(e).length>0;return t&&e.serverControl&&e.serverControl.partHoldBack?e.serverControl.partHoldBack:t&&e.partTargetDuration?e.partTargetDuration*3:e.serverControl&&e.serverControl.holdBack?e.serverControl.holdBack:e.targetDuration?e.targetDuration*3:0},gD=function(i,e){let t=0,n=e-i.mediaSequence,s=i.segments[n];if(s){if(typeof s.start<"u")return{result:s.start,precise:!0};if(typeof s.end<"u")return{result:s.end-s.duration,precise:!0}}for(;n--;){if(s=i.segments[n],typeof s.end<"u")return{result:t+s.end,precise:!0};if(t+=xd(i,s),typeof s.start<"u")return{result:t+s.start,precise:!0}}return{result:t,precise:!1}},_D=function(i,e){let t=0,n,s=e-i.mediaSequence;for(;s<i.segments.length;s++){if(n=i.segments[s],typeof n.start<"u")return{result:n.start-t,precise:!0};if(t+=xd(i,n),typeof n.end<"u")return{result:n.end-t,precise:!0}}return{result:-1,precise:!1}},K_=function(i,e,t){if(typeof e>"u"&&(e=i.mediaSequence+i.segments.length),e<i.mediaSequence)return 0;const n=gD(i,e);if(n.precise)return n.result;const s=_D(i,e);return s.precise?s.result:n.result+t},Y_=function(i,e,t){if(!i)return 0;if(typeof t!="number"&&(t=0),typeof e>"u"){if(i.totalDuration)return i.totalDuration;if(!i.endList)return N.Infinity}return K_(i,e,t)},Xa=function({defaultDuration:i,durationList:e,startIndex:t,endIndex:n}){let s=0;if(t>n&&([t,n]=[n,t]),t<0){for(let r=t;r<Math.min(0,n);r++)s+=i;t=0}for(let r=t;r<n;r++)s+=e[r].duration;return s},Q_=function(i,e,t,n){if(!i||!i.segments)return null;if(i.endList)return Y_(i);if(e===null)return null;e=e||0;let s=K_(i,i.mediaSequence+i.segments.length,e);return t&&(n=typeof n=="number"?n:X_(null,i),s-=n),Math.max(0,s)},vD=function(i,e,t){const s=e||0;let r=Q_(i,e,!0,t);return r===null?ni():(r<s&&(r=s),ni(s,r))},yD=function({playlist:i,currentTime:e,startingSegmentIndex:t,startingPartIndex:n,startTime:s,exactManifestTimings:r}){let a=e-s;const o=lh(i);let l=0;for(let u=0;u<o.length;u++){const h=o[u];if(t===h.segmentIndex&&!(typeof n=="number"&&typeof h.partIndex=="number"&&n!==h.partIndex)){l=u;break}}if(a<0){if(l>0)for(let u=l-1;u>=0;u--){const h=o[u];if(a+=h.duration,r){if(a<0)continue}else if(a+gn<=0)continue;return{partIndex:h.partIndex,segmentIndex:h.segmentIndex,startTime:s-Xa({defaultDuration:i.targetDuration,durationList:o,startIndex:l,endIndex:u})}}return{partIndex:o[0]&&o[0].partIndex||null,segmentIndex:o[0]&&o[0].segmentIndex||0,startTime:e}}if(l<0){for(let u=l;u<0;u++)if(a-=i.targetDuration,a<0)return{partIndex:o[0]&&o[0].partIndex||null,segmentIndex:o[0]&&o[0].segmentIndex||0,startTime:e};l=0}for(let u=l;u<o.length;u++){const h=o[u];a-=h.duration;const d=h.duration>gn,m=a===0,y=d&&a+gn>=0;if(!((m||y)&&u!==o.length-1)){if(r){if(a>0)continue}else if(a-gn>=0)continue;return{partIndex:h.partIndex,segmentIndex:h.segmentIndex,startTime:s+Xa({defaultDuration:i.targetDuration,durationList:o,startIndex:l,endIndex:u})}}}return{segmentIndex:o[o.length-1].segmentIndex,partIndex:o[o.length-1].partIndex,startTime:e}},Z_=function(i){return i.excludeUntil&&i.excludeUntil>Date.now()},Sd=function(i){return i.excludeUntil&&i.excludeUntil===1/0},yu=function(i){const e=Z_(i);return!i.disabled&&!e},TD=function(i){return i.disabled},xD=function(i){for(let e=0;e<i.segments.length;e++)if(i.segments[e].key)return!0;return!1},J_=function(i,e){return e.attributes&&e.attributes[i]},SD=function(i,e,t,n=0){return J_("BANDWIDTH",t)?(i*t.attributes.BANDWIDTH-n*8)/e:NaN},uh=(i,e)=>{if(i.playlists.length===1)return!0;const t=e.attributes.BANDWIDTH||Number.MAX_VALUE;return i.playlists.filter(n=>yu(n)?(n.attributes.BANDWIDTH||0)<t:!1).length===0},bd=(i,e)=>!i&&!e||!i&&e||i&&!e?!1:!!(i===e||i.id&&e.id&&i.id===e.id||i.resolvedUri&&e.resolvedUri&&i.resolvedUri===e.resolvedUri||i.uri&&e.uri&&i.uri===e.uri),Om=function(i,e){const t=i&&i.mediaGroups&&i.mediaGroups.AUDIO||{};let n=!1;for(const s in t){for(const r in t[s])if(n=e(t[s][r]),n)break;if(n)break}return!!n},So=i=>{if(!i||!i.playlists||!i.playlists.length)return Om(i,t=>t.playlists&&t.playlists.length||t.uri);for(let e=0;e<i.playlists.length;e++){const t=i.playlists[e],n=t.attributes&&t.attributes.CODECS;if(!(n&&n.split(",").every(r=>Fg(r))||Om(i,r=>bd(t,r))))return!1}return!0};var xi={liveEdgeDelay:X_,duration:Y_,seekable:vD,getMediaInfoForTime:yD,isEnabled:yu,isDisabled:TD,isExcluded:Z_,isIncompatible:Sd,playlistEnd:Q_,isAes:xD,hasAttribute:J_,estimateSegmentRequestTime:SD,isLowestEnabledRendition:uh,isAudioOnly:So,playlistMatch:bd,segmentDurationWithParts:xd};const{log:ev}=q,Ur=(i,e)=>`${i}-${e}`,tv=(i,e,t)=>`placeholder-uri-${i}-${e}-${t}`,bD=({onwarn:i,oninfo:e,manifestString:t,customTagParsers:n=[],customTagMappers:s=[],llhls:r})=>{const a=new VA;i&&a.on("warn",i),e&&a.on("info",e),n.forEach(u=>a.addParser(u)),s.forEach(u=>a.addTagMapper(u)),a.push(t),a.end();const o=a.manifest;if(r||(["preloadSegment","skip","serverControl","renditionReports","partInf","partTargetDuration"].forEach(function(u){o.hasOwnProperty(u)&&delete o[u]}),o.segments&&o.segments.forEach(function(u){["parts","preloadHints"].forEach(function(h){u.hasOwnProperty(h)&&delete u[h]})})),!o.targetDuration){let u=10;o.segments&&o.segments.length&&(u=o.segments.reduce((h,d)=>Math.max(h,d.duration),0)),i&&i({message:`manifest has no targetDuration defaulting to ${u}`}),o.targetDuration=u}const l=$_(o);if(l.length&&!o.partTargetDuration){const u=l.reduce((h,d)=>Math.max(h,d.duration),0);i&&(i({message:`manifest has no partTargetDuration defaulting to ${u}`}),ev.error("LL-HLS manifest has parts but lacks required #EXT-X-PART-INF:PART-TARGET value. See https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-09#section-4.4.3.7. Playback is not guaranteed.")),o.partTargetDuration=u}return o},ca=(i,e)=>{i.mediaGroups&&["AUDIO","SUBTITLES"].forEach(t=>{if(i.mediaGroups[t])for(const n in i.mediaGroups[t])for(const s in i.mediaGroups[t][n]){const r=i.mediaGroups[t][n][s];e(r,t,n,s)}})},iv=({playlist:i,uri:e,id:t})=>{i.id=t,i.playlistErrors_=0,e&&(i.uri=e),i.attributes=i.attributes||{}},ED=i=>{let e=i.playlists.length;for(;e--;){const t=i.playlists[e];iv({playlist:t,id:Ur(e,t.uri)}),t.resolvedUri=Ti(i.uri,t.uri),i.playlists[t.id]=t,i.playlists[t.uri]=t,t.attributes.BANDWIDTH||ev.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}},AD=i=>{ca(i,e=>{e.uri&&(e.resolvedUri=Ti(i.uri,e.uri))})},CD=(i,e)=>{const t=Ur(0,e),n={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:N.location.href,resolvedUri:N.location.href,playlists:[{uri:e,id:t,resolvedUri:e,attributes:{}}]};return n.playlists[t]=n.playlists[0],n.playlists[e]=n.playlists[0],n},nv=(i,e,t=tv)=>{i.uri=e;for(let s=0;s<i.playlists.length;s++)if(!i.playlists[s].uri){const r=`placeholder-uri-${s}`;i.playlists[s].uri=r}const n=So(i);ca(i,(s,r,a,o)=>{if(!s.playlists||!s.playlists.length){if(n&&r==="AUDIO"&&!s.uri)for(let l=0;l<i.playlists.length;l++){const u=i.playlists[l];if(u.attributes&&u.attributes.AUDIO&&u.attributes.AUDIO===a)return}s.playlists=[zi({},s)]}s.playlists.forEach(function(l,u){const h=t(r,a,o,l),d=Ur(u,h);l.uri?l.resolvedUri=l.resolvedUri||Ti(i.uri,l.uri):(l.uri=u===0?h:d,l.resolvedUri=l.uri),l.id=l.id||d,l.attributes=l.attributes||{},i.playlists[l.id]=l,i.playlists[l.uri]=l})}),ED(i),AD(i)};class Um{constructor(){this.offset_=null,this.pendingDateRanges_=new Map,this.processedDateRanges_=new Map}setOffset(e=[]){if(this.offset_!==null||!e.length)return;const[t]=e;t.programDateTime!==void 0&&(this.offset_=t.programDateTime/1e3)}setPendingDateRanges(e=[]){if(!e.length)return;const[t]=e,n=t.startDate.getTime();this.trimProcessedDateRanges_(n),this.pendingDateRanges_=e.reduce((s,r)=>(s.set(r.id,r),s),new Map)}processDateRange(e){this.pendingDateRanges_.delete(e.id),this.processedDateRanges_.set(e.id,e)}getDateRangesToProcess(){if(this.offset_===null)return[];const e={},t=[];this.pendingDateRanges_.forEach((n,s)=>{if(!this.processedDateRanges_.has(s)&&(n.startTime=n.startDate.getTime()/1e3-this.offset_,n.processDateRange=()=>this.processDateRange(n),t.push(n),!!n.class))if(e[n.class]){const r=e[n.class].push(n);n.classListIndex=r-1}else e[n.class]=[n],n.classListIndex=0});for(const n of t){const s=e[n.class]||[];n.endDate?n.endTime=n.endDate.getTime()/1e3-this.offset_:n.endOnNext&&s[n.classListIndex+1]?n.endTime=s[n.classListIndex+1].startTime:n.duration?n.endTime=n.startTime+n.duration:n.plannedDuration?n.endTime=n.startTime+n.plannedDuration:n.endTime=n.startTime}return t}trimProcessedDateRanges_(e){new Map(this.processedDateRanges_).forEach((n,s)=>{n.startDate.getTime()<e&&this.processedDateRanges_.delete(s)})}}const{EventTarget:MD}=q,wD=(i,e)=>{if(e.endList||!e.serverControl)return i;const t={};if(e.serverControl.canBlockReload){const{preloadSegment:n}=e;let s=e.mediaSequence+e.segments.length;if(n){const r=n.parts||[],a=j_(e)-1;a>-1&&a!==r.length-1&&(t._HLS_part=a),(a>-1||r.length)&&s--}t._HLS_msn=s}if(e.serverControl&&e.serverControl.canSkipUntil&&(t._HLS_skip=e.serverControl.canSkipDateranges?"v2":"YES"),Object.keys(t).length){const n=new N.URL(i);["_HLS_skip","_HLS_msn","_HLS_part"].forEach(function(s){t.hasOwnProperty(s)&&n.searchParams.set(s,t[s])}),i=n.toString()}return i},DD=(i,e)=>{if(!i)return e;const t=ht(i,e);if(i.preloadHints&&!e.preloadHints&&delete t.preloadHints,i.parts&&!e.parts)delete t.parts;else if(i.parts&&e.parts)for(let n=0;n<e.parts.length;n++)i.parts&&i.parts[n]&&(t.parts[n]=ht(i.parts[n],e.parts[n]));return!i.skipped&&e.skipped&&(t.skipped=!1),i.preload&&!e.preload&&(t.preload=!1),t},RD=(i,e,t)=>{const n=i.slice(),s=e.slice();t=t||0;const r=[];let a;for(let o=0;o<s.length;o++){const l=n[o+t],u=s[o];l?(a=l.map||a,r.push(DD(l,u))):(a&&!u.map&&(u.map=a),r.push(u))}return r},sv=(i,e)=>{!i.resolvedUri&&i.uri&&(i.resolvedUri=Ti(e,i.uri)),i.key&&!i.key.resolvedUri&&(i.key.resolvedUri=Ti(e,i.key.uri)),i.map&&!i.map.resolvedUri&&(i.map.resolvedUri=Ti(e,i.map.uri)),i.map&&i.map.key&&!i.map.key.resolvedUri&&(i.map.key.resolvedUri=Ti(e,i.map.key.uri)),i.parts&&i.parts.length&&i.parts.forEach(t=>{t.resolvedUri||(t.resolvedUri=Ti(e,t.uri))}),i.preloadHints&&i.preloadHints.length&&i.preloadHints.forEach(t=>{t.resolvedUri||(t.resolvedUri=Ti(e,t.uri))})},rv=function(i){const e=i.segments||[],t=i.preloadSegment;if(t&&t.parts&&t.parts.length){if(t.preloadHints){for(let n=0;n<t.preloadHints.length;n++)if(t.preloadHints[n].type==="MAP")return e}t.duration=i.targetDuration,t.preload=!0,e.push(t)}return e},av=(i,e)=>i===e||i.segments&&e.segments&&i.segments.length===e.segments.length&&i.endList===e.endList&&i.mediaSequence===e.mediaSequence&&i.preloadSegment===e.preloadSegment,ch=(i,e,t=av)=>{const n=ht(i,{}),s=n.playlists[e.id];if(!s||t(s,e))return null;e.segments=rv(e);const r=ht(s,e);if(r.preloadSegment&&!e.preloadSegment&&delete r.preloadSegment,s.segments){if(e.skip){e.segments=e.segments||[];for(let a=0;a<e.skip.skippedSegments;a++)e.segments.unshift({skipped:!0})}r.segments=RD(s.segments,e.segments,e.mediaSequence-s.mediaSequence)}r.segments.forEach(a=>{sv(a,r.resolvedUri)});for(let a=0;a<n.playlists.length;a++)n.playlists[a].id===e.id&&(n.playlists[a]=r);return n.playlists[e.id]=r,n.playlists[e.uri]=r,ca(i,(a,o,l,u)=>{if(a.playlists)for(let h=0;h<a.playlists.length;h++)e.id===a.playlists[h].id&&(a.playlists[h]=r)}),n},hh=(i,e)=>{const t=i.segments||[],n=t[t.length-1],s=n&&n.parts&&n.parts[n.parts.length-1],r=s&&s.duration||n&&n.duration;return e&&r?r*1e3:(i.partTargetDuration||i.targetDuration||10)*500};class Mr extends MD{constructor(e,t,n={}){if(super(),!e)throw new Error("A non-empty playlist URL or object is required");this.logger_=$i("PlaylistLoader");const{withCredentials:s=!1}=n;this.src=e,this.vhs_=t,this.withCredentials=s,this.addDateRangesToTextTrack_=n.addDateRangesToTextTrack;const r=t.options_;this.customTagParsers=r&&r.customTagParsers||[],this.customTagMappers=r&&r.customTagMappers||[],this.llhls=r&&r.llhls,this.dateRangesStorage_=new Um,this.state="HAVE_NOTHING",this.handleMediaupdatetimeout_=this.handleMediaupdatetimeout_.bind(this),this.on("mediaupdatetimeout",this.handleMediaupdatetimeout_),this.on("loadedplaylist",this.handleLoadedPlaylist_.bind(this))}handleLoadedPlaylist_(){const e=this.media();if(!e)return;this.dateRangesStorage_.setOffset(e.segments),this.dateRangesStorage_.setPendingDateRanges(e.dateRanges);const t=this.dateRangesStorage_.getDateRangesToProcess();!t.length||!this.addDateRangesToTextTrack_||this.addDateRangesToTextTrack_(t)}handleMediaupdatetimeout_(){if(this.state!=="HAVE_METADATA")return;const e=this.media();let t=Ti(this.main.uri,e.uri);this.llhls&&(t=wD(t,e)),this.state="HAVE_CURRENT_METADATA",this.request=this.vhs_.xhr({uri:t,withCredentials:this.withCredentials,requestType:"hls-playlist"},(n,s)=>{if(this.request){if(n)return this.playlistRequestError(this.request,this.media(),"HAVE_METADATA");this.haveMetadata({playlistString:this.request.responseText,url:this.media().uri,id:this.media().id})}})}playlistRequestError(e,t,n){const{uri:s,id:r}=t;this.request=null,n&&(this.state=n),this.error={playlist:this.main.playlists[r],status:e.status,message:`HLS playlist request error at URL: ${s}.`,responseText:e.responseText,code:e.status>=500?4:2,metadata:{errorType:q.Error.HlsPlaylistRequestError}},this.trigger("error")}parseManifest_({url:e,manifestString:t}){return bD({onwarn:({message:n})=>this.logger_(`m3u8-parser warn for ${e}: ${n}`),oninfo:({message:n})=>this.logger_(`m3u8-parser info for ${e}: ${n}`),manifestString:t,customTagParsers:this.customTagParsers,customTagMappers:this.customTagMappers,llhls:this.llhls})}haveMetadata({playlistString:e,playlistObject:t,url:n,id:s}){this.request=null,this.state="HAVE_METADATA";const r=t||this.parseManifest_({url:n,manifestString:e});r.lastRequest=Date.now(),iv({playlist:r,uri:n,id:s});const a=ch(this.main,r);this.targetDuration=r.partTargetDuration||r.targetDuration,this.pendingMedia_=null,a?(this.main=a,this.media_=this.main.playlists[s]):this.trigger("playlistunchanged"),this.updateMediaUpdateTimeout_(hh(this.media(),!!a)),this.trigger("loadedplaylist")}dispose(){this.trigger("dispose"),this.stopRequest(),N.clearTimeout(this.mediaUpdateTimeout),N.clearTimeout(this.finalRenditionTimeout),this.dateRangesStorage_=new Um,this.off()}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e,t){if(!e)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error("Cannot switch media playlist from "+this.state);if(typeof e=="string"){if(!this.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.main.playlists[e]}if(N.clearTimeout(this.finalRenditionTimeout),t){const a=(e.partTargetDuration||e.targetDuration)/2*1e3||5e3;this.finalRenditionTimeout=N.setTimeout(this.media.bind(this,e,!1),a);return}const n=this.state,s=!this.media_||e.id!==this.media_.id,r=this.main.playlists[e.id];if(r&&r.endList||e.endList&&e.segments.length){this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=e,s&&(this.trigger("mediachanging"),n==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange"));return}if(this.updateMediaUpdateTimeout_(hh(e,!0)),!!s){if(this.state="SWITCHING_MEDIA",this.request){if(e.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.pendingMedia_=e,this.request=this.vhs_.xhr({uri:e.resolvedUri,withCredentials:this.withCredentials,requestType:"hls-playlist"},(a,o)=>{if(this.request){if(e.lastRequest=Date.now(),e.resolvedUri=Hl(e.resolvedUri,o),a)return this.playlistRequestError(this.request,e,n);this.haveMetadata({playlistString:o.responseText,url:e.uri,id:e.id}),n==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange")}})}}pause(){this.mediaUpdateTimeout&&(N.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.stopRequest(),this.state==="HAVE_NOTHING"&&(this.started=!1),this.state==="SWITCHING_MEDIA"?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MAIN_MANIFEST":this.state==="HAVE_CURRENT_METADATA"&&(this.state="HAVE_METADATA")}load(e){this.mediaUpdateTimeout&&(N.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null);const t=this.media();if(e){const n=t?(t.partTargetDuration||t.targetDuration)/2*1e3:5e3;this.mediaUpdateTimeout=N.setTimeout(()=>{this.mediaUpdateTimeout=null,this.load()},n);return}if(!this.started){this.start();return}t&&!t.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist")}updateMediaUpdateTimeout_(e){this.mediaUpdateTimeout&&(N.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),!(!this.media()||this.media().endList)&&(this.mediaUpdateTimeout=N.setTimeout(()=>{this.mediaUpdateTimeout=null,this.trigger("mediaupdatetimeout"),this.updateMediaUpdateTimeout_(e)},e))}start(){if(this.started=!0,typeof this.src=="object"){this.src.uri||(this.src.uri=N.location.href),this.src.resolvedUri=this.src.uri,setTimeout(()=>{this.setupInitialPlaylist(this.src)},0);return}this.request=this.vhs_.xhr({uri:this.src,withCredentials:this.withCredentials,requestType:"hls-playlist"},(e,t)=>{if(!this.request)return;if(this.request=null,e)return this.error={status:t.status,message:`HLS playlist request error at URL: ${this.src}.`,responseText:t.responseText,code:2,metadata:{errorType:q.Error.HlsPlaylistRequestError}},this.state==="HAVE_NOTHING"&&(this.started=!1),this.trigger("error");this.src=Hl(this.src,t);const n=this.parseManifest_({manifestString:t.responseText,url:this.src});this.setupInitialPlaylist(n)})}srcUri(){return typeof this.src=="string"?this.src:this.src.uri}setupInitialPlaylist(e){if(this.state="HAVE_MAIN_MANIFEST",e.playlists){this.main=e,nv(this.main,this.srcUri()),e.playlists.forEach(n=>{n.segments=rv(n),n.segments.forEach(s=>{sv(s,n.resolvedUri)})}),this.trigger("loadedplaylist"),this.request||this.media(this.main.playlists[0]);return}const t=this.srcUri()||N.location.href;this.main=CD(e,t),this.haveMetadata({playlistObject:e,url:t,id:this.main.playlists[0].id}),this.trigger("loadedmetadata")}updateOrDeleteClone(e,t){const n=this.main,s=e.ID;let r=n.playlists.length;for(;r--;){const a=n.playlists[r];if(a.attributes["PATHWAY-ID"]===s){const o=a.resolvedUri,l=a.id;if(t){const u=this.createCloneURI_(a.resolvedUri,e),h=Ur(s,u),d=this.createCloneAttributes_(s,a.attributes),m=this.createClonePlaylist_(a,h,e,d);n.playlists[r]=m,n.playlists[h]=m,n.playlists[u]=m}else n.playlists.splice(r,1);delete n.playlists[l],delete n.playlists[o]}}this.updateOrDeleteCloneMedia(e,t)}updateOrDeleteCloneMedia(e,t){const n=this.main,s=e.ID;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(r=>{if(!(!n.mediaGroups[r]||!n.mediaGroups[r][s])){for(const a in n.mediaGroups[r])if(a===s){for(const o in n.mediaGroups[r][a])n.mediaGroups[r][a][o].playlists.forEach((u,h)=>{const d=n.playlists[u.id],m=d.id,y=d.resolvedUri;delete n.playlists[m],delete n.playlists[y]});delete n.mediaGroups[r][a]}}}),t&&this.createClonedMediaGroups_(e)}addClonePathway(e,t={}){const n=this.main,s=n.playlists.length,r=this.createCloneURI_(t.resolvedUri,e),a=Ur(e.ID,r),o=this.createCloneAttributes_(e.ID,t.attributes),l=this.createClonePlaylist_(t,a,e,o);n.playlists[s]=l,n.playlists[a]=l,n.playlists[r]=l,this.createClonedMediaGroups_(e)}createClonedMediaGroups_(e){const t=e.ID,n=e["BASE-ID"],s=this.main;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(r=>{if(!(!s.mediaGroups[r]||s.mediaGroups[r][t]))for(const a in s.mediaGroups[r]){if(a===n)s.mediaGroups[r][t]={};else continue;for(const o in s.mediaGroups[r][a]){const l=s.mediaGroups[r][a][o];s.mediaGroups[r][t][o]=zi({},l);const u=s.mediaGroups[r][t][o],h=this.createCloneURI_(l.resolvedUri,e);u.resolvedUri=h,u.uri=h,u.playlists=[],l.playlists.forEach((d,m)=>{const y=s.playlists[d.id],v=tv(r,t,o),b=Ur(t,v);if(y&&!s.playlists[b]){const x=this.createClonePlaylist_(y,b,e),_=x.resolvedUri;s.playlists[b]=x,s.playlists[_]=x}u.playlists[m]=this.createClonePlaylist_(d,b,e)})}}})}createClonePlaylist_(e,t,n,s){const r=this.createCloneURI_(e.resolvedUri,n),a={resolvedUri:r,uri:r,id:t};return e.segments&&(a.segments=[]),s&&(a.attributes=s),ht(e,a)}createCloneURI_(e,t){const n=new URL(e);n.hostname=t["URI-REPLACEMENT"].HOST;const s=t["URI-REPLACEMENT"].PARAMS;for(const r of Object.keys(s))n.searchParams.set(r,s[r]);return n.href}createCloneAttributes_(e,t){const n={["PATHWAY-ID"]:e};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(s=>{t[s]&&(n[s]=e)}),n}getKeyIdSet(e){if(e.contentProtection){const t=new Set;for(const n in e.contentProtection){const s=e.contentProtection[n].attributes.keyId;s&&t.add(s.toLowerCase())}return t}}}const dh=function(i,e,t,n){const s=i.responseType==="arraybuffer"?i.response:i.responseText;!e&&s&&(i.responseTime=Date.now(),i.roundTripTime=i.responseTime-i.requestTime,i.bytesReceived=s.byteLength||s.length,i.bandwidth||(i.bandwidth=Math.floor(i.bytesReceived/i.roundTripTime*8*1e3))),t.headers&&(i.responseHeaders=t.headers),e&&e.code==="ETIMEDOUT"&&(i.timedout=!0),!e&&!i.aborted&&t.statusCode!==200&&t.statusCode!==206&&t.statusCode!==0&&(e=new Error("XHR Failed with a response of: "+(i&&(s||i.responseText)))),n(e,i)},PD=(i,e)=>{if(!i||!i.size)return;let t=e;return i.forEach(n=>{t=n(t)}),t},LD=(i,e,t,n)=>{!i||!i.size||i.forEach(s=>{s(e,t,n)})},ov=function(){const i=function e(t,n){t=ht({timeout:45e3},t);const s=e.beforeRequest||q.Vhs.xhr.beforeRequest,r=e._requestCallbackSet||q.Vhs.xhr._requestCallbackSet||new Set,a=e._responseCallbackSet||q.Vhs.xhr._responseCallbackSet;s&&typeof s=="function"&&(q.log.warn("beforeRequest is deprecated, use onRequest instead."),r.add(s));const o=q.Vhs.xhr.original===!0?q.xhr:q.Vhs.xhr,l=PD(r,t);r.delete(s);const u=o(l||t,function(d,m){return LD(a,u,d,m),dh(u,d,m,n)}),h=u.abort;return u.abort=function(){return u.aborted=!0,h.apply(u,arguments)},u.uri=t.uri,u.requestTime=Date.now(),u};return i.original=!0,i},ID=function(i){let e;const t=i.offset;return typeof i.offset=="bigint"||typeof i.length=="bigint"?e=N.BigInt(i.offset)+N.BigInt(i.length)-N.BigInt(1):e=i.offset+i.length-1,"bytes="+t+"-"+e},fh=function(i){const e={};return i.byterange&&(e.Range=ID(i.byterange)),e},OD=function(i,e){return i.start(e)+"-"+i.end(e)},UD=function(i,e){const t=i.toString(16);return"00".substring(0,2-t.length)+t+(e%2?" ":"")},ND=function(i){return i>=32&&i<126?String.fromCharCode(i):"."},lv=function(i){const e={};return Object.keys(i).forEach(t=>{const n=i[t];Hg(n)?e[t]={bytes:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength}:e[t]=n}),e},Vl=function(i){const e=i.byterange||{length:1/0,offset:0};return[e.length,e.offset,i.resolvedUri].join(",")},uv=function(i){return i.resolvedUri},cv=i=>{const e=Array.prototype.slice.call(i),t=16;let n="",s,r;for(let a=0;a<e.length/t;a++)s=e.slice(a*t,a*t+t).map(UD).join(""),r=e.slice(a*t,a*t+t).map(ND).join(""),n+=s+" "+r+`
`;return n},kD=({bytes:i})=>cv(i),FD=i=>{let e="",t;for(t=0;t<i.length;t++)e+=OD(i,t)+" ";return e};var BD=Object.freeze({__proto__:null,createTransferableMessage:lv,initSegmentId:Vl,segmentKeyId:uv,hexDump:cv,tagDump:kD,textRanges:FD});const hv=.25,HD=(i,e)=>{if(!e.dateTimeObject)return null;const t=e.videoTimingInfo.transmuxerPrependedSeconds,s=e.videoTimingInfo.transmuxedPresentationStart+t,r=i-s;return new Date(e.dateTimeObject.getTime()+r*1e3)},VD=i=>i.transmuxedPresentationEnd-i.transmuxedPresentationStart-i.transmuxerPrependedSeconds,zD=(i,e)=>{let t;try{t=new Date(i)}catch{return null}if(!e||!e.segments||e.segments.length===0)return null;let n=e.segments[0];if(t<new Date(n.dateTimeObject))return null;for(let l=0;l<e.segments.length-1;l++){n=e.segments[l];const u=new Date(e.segments[l+1].dateTimeObject);if(t<u)break}const s=e.segments[e.segments.length-1],r=s.dateTimeObject,a=s.videoTimingInfo?VD(s.videoTimingInfo):s.duration+s.duration*hv,o=new Date(r.getTime()+a*1e3);return t>o?null:(t>new Date(r)&&(n=s),{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:xi.duration(e,e.mediaSequence+e.segments.indexOf(n)),type:n.videoTimingInfo?"accurate":"estimate"})},GD=(i,e)=>{if(!e||!e.segments||e.segments.length===0)return null;let t=0,n;for(let r=0;r<e.segments.length&&(n=e.segments[r],t=n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationEnd:t+n.duration,!(i<=t));r++);const s=e.segments[e.segments.length-1];if(s.videoTimingInfo&&s.videoTimingInfo.transmuxedPresentationEnd<i)return null;if(i>t){if(i>t+s.duration*hv)return null;n=s}return{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:t-n.duration,type:n.videoTimingInfo?"accurate":"estimate"}},WD=(i,e)=>{let t,n;try{t=new Date(i),n=new Date(e)}catch{}const s=t.getTime();return(n.getTime()-s)/1e3},qD=i=>{if(!i.segments||i.segments.length===0)return!1;for(let e=0;e<i.segments.length;e++)if(!i.segments[e].dateTimeObject)return!1;return!0},$D=({playlist:i,time:e=void 0,callback:t})=>{if(!t)throw new Error("getProgramTime: callback must be provided");if(!i||e===void 0)return t({message:"getProgramTime: playlist and time must be provided"});const n=GD(e,i);if(!n)return t({message:"valid programTime was not found"});if(n.type==="estimate")return t({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:n.estimatedStart});const s={mediaSeconds:e},r=HD(e,n.segment);return r&&(s.programDateTime=r.toISOString()),t(null,s)},dv=({programTime:i,playlist:e,retryCount:t=2,seekTo:n,pauseAfterSeek:s=!0,tech:r,callback:a})=>{if(!a)throw new Error("seekToProgramTime: callback must be provided");if(typeof i>"u"||!e||!n)return a({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!e.endList&&!r.hasStarted_)return a({message:"player must be playing a live stream to start buffering"});if(!qD(e))return a({message:"programDateTime tags must be provided in the manifest "+e.resolvedUri});const o=zD(i,e);if(!o)return a({message:`${i} was not found in the stream`});const l=o.segment,u=WD(l.dateTimeObject,i);if(o.type==="estimate"){if(t===0)return a({message:`${i} is not buffered yet. Try again`});n(o.estimatedStart+u),r.one("seeked",()=>{dv({programTime:i,playlist:e,retryCount:t-1,seekTo:n,pauseAfterSeek:s,tech:r,callback:a})});return}const h=l.start+u,d=()=>a(null,r.currentTime());r.one("seeked",d),s&&r.pause(),n(h)},wc=(i,e)=>{if(i.readyState===4)return e()},jD=(i,e,t)=>{let n=[],s,r=!1;const a=function(h,d,m,y){return d.abort(),r=!0,t(h,d,m,y)},o=function(h,d){if(r)return;if(h)return a(h,d,"",n);const m=d.responseText.substring(n&&n.byteLength||0,d.responseText.length);if(n=JA(n,Vg(m,!0)),s=s||Fa(n),n.length<10||s&&n.length<s+2)return wc(d,()=>a(h,d,"",n));const y=Gh(n);return y==="ts"&&n.length<188?wc(d,()=>a(h,d,"",n)):!y&&n.length<376?wc(d,()=>a(h,d,"",n)):a(null,d,y,n)},u=e({uri:i,beforeSend(h){h.overrideMimeType("text/plain; charset=x-user-defined"),h.addEventListener("progress",function({total:d,loaded:m}){return dh(h,null,{statusCode:h.status},o)})}},function(h,d){return dh(u,h,d,o)});return u},{EventTarget:XD}=q,Nm=function(i,e){if(!av(i,e)||i.sidx&&e.sidx&&(i.sidx.offset!==e.sidx.offset||i.sidx.length!==e.sidx.length))return!1;if(!i.sidx&&e.sidx||i.sidx&&!e.sidx||i.segments&&!e.segments||!i.segments&&e.segments)return!1;if(!i.segments&&!e.segments)return!0;for(let t=0;t<i.segments.length;t++){const n=i.segments[t],s=e.segments[t];if(n.uri!==s.uri)return!1;if(!n.byterange&&!s.byterange)continue;const r=n.byterange,a=s.byterange;if(r&&!a||!r&&a||r.offset!==a.offset||r.length!==a.length)return!1}return!0},KD=(i,e,t,n)=>{const s=n.attributes.NAME||t;return`placeholder-uri-${i}-${e}-${s}`},YD=({mainXml:i,srcUrl:e,clientOffset:t,sidxMapping:n,previousManifest:s})=>{const r=SM(i,{manifestUri:e,clientOffset:t,sidxMapping:n,previousManifest:s});return nv(r,e,KD),r},QD=(i,e)=>{ca(i,(t,n,s,r)=>{r in e.mediaGroups[n][s]||delete i.mediaGroups[n][s][r]})},ZD=(i,e,t)=>{let n=!0,s=ht(i,{duration:e.duration,minimumUpdatePeriod:e.minimumUpdatePeriod,timelineStarts:e.timelineStarts});for(let r=0;r<e.playlists.length;r++){const a=e.playlists[r];if(a.sidx){const l=tu(a.sidx);t&&t[l]&&t[l].sidx&&Hh(a,t[l].sidx,a.sidx.resolvedUri)}const o=ch(s,a,Nm);o&&(s=o,n=!1)}return ca(e,(r,a,o,l)=>{if(r.playlists&&r.playlists.length){const u=r.playlists[0].id,h=ch(s,r.playlists[0],Nm);h&&(s=h,l in s.mediaGroups[a][o]||(s.mediaGroups[a][o][l]=r),s.mediaGroups[a][o][l].playlists[0]=s.playlists[u],n=!1)}}),QD(s,e),e.minimumUpdatePeriod!==i.minimumUpdatePeriod&&(n=!1),n?null:s},JD=(i,e)=>(Boolean(!i.map&&!e.map)||Boolean(i.map&&e.map&&i.map.byterange.offset===e.map.byterange.offset&&i.map.byterange.length===e.map.byterange.length))&&i.uri===e.uri&&i.byterange.offset===e.byterange.offset&&i.byterange.length===e.byterange.length,km=(i,e)=>{const t={};for(const n in i){const r=i[n].sidx;if(r){const a=tu(r);if(!e[a])break;const o=e[a].sidxInfo;JD(o,r)&&(t[a]=e[a])}}return t},eR=(i,e)=>{let n=km(i.playlists,e);return ca(i,(s,r,a,o)=>{if(s.playlists&&s.playlists.length){const l=s.playlists;n=ht(n,km(l,e))}}),n};class ph extends XD{constructor(e,t,n={},s){super(),this.mainPlaylistLoader_=s||this,s||(this.isMain_=!0);const{withCredentials:r=!1}=n;if(this.vhs_=t,this.withCredentials=r,this.addMetadataToTextTrack=n.addMetadataToTextTrack,!e)throw new Error("A non-empty playlist URL or object is required");this.on("minimumUpdatePeriod",()=>{this.refreshXml_()}),this.on("mediaupdatetimeout",()=>{this.refreshMedia_(this.media().id)}),this.state="HAVE_NOTHING",this.loadedPlaylists_={},this.logger_=$i("DashPlaylistLoader"),this.isMain_?(this.mainPlaylistLoader_.srcUrl=e,this.mainPlaylistLoader_.sidxMapping_={}):this.childPlaylist_=e}requestErrored_(e,t,n){if(!this.request)return!0;if(this.request=null,e)return this.error=typeof e=="object"&&!(e instanceof Error)?e:{status:t.status,message:"DASH request error at URL: "+t.uri,response:t.response,code:2,metadata:e.metadata},n&&(this.state=n),this.trigger("error"),!0}addSidxSegments_(e,t,n){const s=e.sidx&&tu(e.sidx);if(!e.sidx||!s||this.mainPlaylistLoader_.sidxMapping_[s]){this.mediaRequest_=N.setTimeout(()=>n(!1),0);return}const r=Hl(e.sidx.resolvedUri),a=(o,l)=>{if(this.requestErrored_(o,l,t))return;const u=this.mainPlaylistLoader_.sidxMapping_;let h;try{h=MM(ke(l.response).subarray(8))}catch(d){d.metadata={errorType:q.Error.DashManifestSidxParsingError},this.requestErrored_(d,l,t);return}return u[s]={sidxInfo:e.sidx,sidx:h},Hh(e,h,e.sidx.resolvedUri),n(!0)};this.request=jD(r,this.vhs_.xhr,(o,l,u,h)=>{if(o)return a(o,l);if(!u||u!=="mp4"){const y=u||"unknown";return a({status:l.status,message:`Unsupported ${y} container type for sidx segment at URL: ${r}`,response:"",playlist:e,internal:!0,playlistExclusionDuration:1/0,code:2,metadata:{errorType:q.Error.UnsupportedSidxContainer,sidxContainer:y}},l)}const{offset:d,length:m}=e.sidx.byterange;if(h.length>=m+d)return a(o,{response:h.subarray(d,d+m),status:l.status,uri:l.uri});this.request=this.vhs_.xhr({uri:r,responseType:"arraybuffer",headers:fh({byterange:e.sidx.byterange})},a)})}dispose(){this.trigger("dispose"),this.stopRequest(),this.loadedPlaylists_={},N.clearTimeout(this.minimumUpdatePeriodTimeout_),N.clearTimeout(this.mediaRequest_),N.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.mediaRequest_=null,this.minimumUpdatePeriodTimeout_=null,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.off()}hasPendingRequest(){return this.request||this.mediaRequest_}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e){if(!e)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error("Cannot switch media playlist from "+this.state);const t=this.state;if(typeof e=="string"){if(!this.mainPlaylistLoader_.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.mainPlaylistLoader_.main.playlists[e]}const n=!this.media_||e.id!==this.media_.id;if(n&&this.loadedPlaylists_[e.id]&&this.loadedPlaylists_[e.id].endList){this.state="HAVE_METADATA",this.media_=e,n&&(this.trigger("mediachanging"),this.trigger("mediachange"));return}n&&(this.media_&&this.trigger("mediachanging"),this.addSidxSegments_(e,t,s=>{this.haveMetadata({startingState:t,playlist:e})}))}haveMetadata({startingState:e,playlist:t}){this.state="HAVE_METADATA",this.loadedPlaylists_[t.id]=t,this.mediaRequest_=null,this.refreshMedia_(t.id),e==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange")}pause(){this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.stopRequest(),N.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.isMain_&&(N.clearTimeout(this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_),this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_=null),this.state==="HAVE_NOTHING"&&(this.started=!1)}load(e){N.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null;const t=this.media();if(e){const n=t?t.targetDuration/2*1e3:5e3;this.mediaUpdateTimeout=N.setTimeout(()=>this.load(),n);return}if(!this.started){this.start();return}t&&!t.endList?(this.isMain_&&!this.minimumUpdatePeriodTimeout_&&(this.trigger("minimumUpdatePeriod"),this.updateMinimumUpdatePeriodTimeout_()),this.trigger("mediaupdatetimeout")):this.trigger("loadedplaylist")}start(){if(this.started=!0,!this.isMain_){this.mediaRequest_=N.setTimeout(()=>this.haveMain_(),0);return}this.requestMain_((e,t)=>{this.haveMain_(),!this.hasPendingRequest()&&!this.media_&&this.media(this.mainPlaylistLoader_.main.playlists[0])})}requestMain_(e){this.request=this.vhs_.xhr({uri:this.mainPlaylistLoader_.srcUrl,withCredentials:this.withCredentials,requestType:"dash-manifest"},(t,n)=>{if(this.requestErrored_(t,n)){this.state==="HAVE_NOTHING"&&(this.started=!1);return}const s=n.responseText!==this.mainPlaylistLoader_.mainXml_;if(this.mainPlaylistLoader_.mainXml_=n.responseText,n.responseHeaders&&n.responseHeaders.date?this.mainLoaded_=Date.parse(n.responseHeaders.date):this.mainLoaded_=Date.now(),this.mainPlaylistLoader_.srcUrl=Hl(this.mainPlaylistLoader_.srcUrl,n),s){this.handleMain_(),this.syncClientServerClock_(()=>e(n,s));return}return e(n,s)})}syncClientServerClock_(e){const t=bM(this.mainPlaylistLoader_.mainXml_);if(t===null)return this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e();if(t.method==="DIRECT")return this.mainPlaylistLoader_.clientOffset_=t.value-Date.now(),e();this.request=this.vhs_.xhr({uri:Ti(this.mainPlaylistLoader_.srcUrl,t.value),method:t.method,withCredentials:this.withCredentials,requestType:"dash-clock-sync"},(n,s)=>{if(!this.request)return;if(n)return this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e();let r;t.method==="HEAD"?!s.responseHeaders||!s.responseHeaders.date?r=this.mainLoaded_:r=Date.parse(s.responseHeaders.date):r=Date.parse(s.responseText),this.mainPlaylistLoader_.clientOffset_=r-Date.now(),e()})}haveMain_(){this.state="HAVE_MAIN_MANIFEST",this.isMain_?this.trigger("loadedplaylist"):this.media_||this.media(this.childPlaylist_)}handleMain_(){this.mediaRequest_=null;const e=this.mainPlaylistLoader_.main;let t=YD({mainXml:this.mainPlaylistLoader_.mainXml_,srcUrl:this.mainPlaylistLoader_.srcUrl,clientOffset:this.mainPlaylistLoader_.clientOffset_,sidxMapping:this.mainPlaylistLoader_.sidxMapping_,previousManifest:e});e&&(t=ZD(e,t,this.mainPlaylistLoader_.sidxMapping_)),this.mainPlaylistLoader_.main=t||e;const n=this.mainPlaylistLoader_.main.locations&&this.mainPlaylistLoader_.main.locations[0];return n&&n!==this.mainPlaylistLoader_.srcUrl&&(this.mainPlaylistLoader_.srcUrl=n),(!e||t&&t.minimumUpdatePeriod!==e.minimumUpdatePeriod)&&this.updateMinimumUpdatePeriodTimeout_(),this.addEventStreamToMetadataTrack_(t),Boolean(t)}updateMinimumUpdatePeriodTimeout_(){const e=this.mainPlaylistLoader_;e.createMupOnMedia_&&(e.off("loadedmetadata",e.createMupOnMedia_),e.createMupOnMedia_=null),e.minimumUpdatePeriodTimeout_&&(N.clearTimeout(e.minimumUpdatePeriodTimeout_),e.minimumUpdatePeriodTimeout_=null);let t=e.main&&e.main.minimumUpdatePeriod;if(t===0&&(e.media()?t=e.media().targetDuration*1e3:(e.createMupOnMedia_=e.updateMinimumUpdatePeriodTimeout_,e.one("loadedmetadata",e.createMupOnMedia_))),typeof t!="number"||t<=0){t<0&&this.logger_(`found invalid minimumUpdatePeriod of ${t}, not setting a timeout`);return}this.createMUPTimeout_(t)}createMUPTimeout_(e){const t=this.mainPlaylistLoader_;t.minimumUpdatePeriodTimeout_=N.setTimeout(()=>{t.minimumUpdatePeriodTimeout_=null,t.trigger("minimumUpdatePeriod"),t.createMUPTimeout_(e)},e)}refreshXml_(){this.requestMain_((e,t)=>{t&&(this.media_&&(this.media_=this.mainPlaylistLoader_.main.playlists[this.media_.id]),this.mainPlaylistLoader_.sidxMapping_=eR(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.sidxMapping_),this.addSidxSegments_(this.media(),this.state,n=>{this.refreshMedia_(this.media().id)}))})}refreshMedia_(e){if(!e)throw new Error("refreshMedia_ must take a media id");this.media_&&this.isMain_&&this.handleMain_();const t=this.mainPlaylistLoader_.main.playlists,n=!this.media_||this.media_!==t[e];if(n?this.media_=t[e]:this.trigger("playlistunchanged"),!this.mediaUpdateTimeout){const s=()=>{this.media().endList||(this.mediaUpdateTimeout=N.setTimeout(()=>{this.trigger("mediaupdatetimeout"),s()},hh(this.media(),Boolean(n))))};s()}this.trigger("loadedplaylist")}addEventStreamToMetadataTrack_(e){if(e&&this.mainPlaylistLoader_.main.eventStream){const t=this.mainPlaylistLoader_.main.eventStream.map(n=>({cueTime:n.start,frames:[{data:n.messageData}]}));this.addMetadataToTextTrack("EventStream",t,this.mainPlaylistLoader_.main.duration)}}getKeyIdSet(e){if(e.contentProtection){const t=new Set;for(const n in e.contentProtection){const s=e.contentProtection[n].attributes["cenc:default_KID"];s&&t.add(s.replace(/-/g,"").toLowerCase())}return t}}}var jt={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,BACK_BUFFER_LENGTH:30,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:16,BUFFER_LOW_WATER_LINE_RATE:1,BUFFER_HIGH_WATER_LINE:30};const tR=i=>{const e=new Uint8Array(new ArrayBuffer(i.length));for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e.buffer},fv=function(i){return i.on=i.addEventListener,i.off=i.removeEventListener,i},iR=function(i){try{return URL.createObjectURL(new Blob([i],{type:"application/javascript"}))}catch{const t=new BlobBuilder;return t.append(i),URL.createObjectURL(t.getBlob())}},pv=function(i){return function(){const e=iR(i),t=fv(new Worker(e));t.objURL=e;const n=t.terminate;return t.on=t.addEventListener,t.off=t.removeEventListener,t.terminate=function(){return URL.revokeObjectURL(e),n.call(this)},t}},mv=function(i){return`var browserWorkerPolyFill = ${fv.toString()};
browserWorkerPolyFill(self);
`+i},gv=function(i){return i.toString().replace(/^function.+?{/,"").slice(0,-1)},nR=mv(gv(function(){var i=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=function(){this.init=function(){var c={};this.on=function(f,g){c[f]||(c[f]=[]),c[f]=c[f].concat(g)},this.off=function(f,g){var p;return c[f]?(p=c[f].indexOf(g),c[f]=c[f].slice(),c[f].splice(p,1),p>-1):!1},this.trigger=function(f){var g,p,T,S;if(g=c[f],!!g)if(arguments.length===2)for(T=g.length,p=0;p<T;++p)g[p].call(this,arguments[1]);else{for(S=[],p=arguments.length,p=1;p<arguments.length;++p)S.push(arguments[p]);for(T=g.length,p=0;p<T;++p)g[p].apply(this,S)}},this.dispose=function(){c={}}}};e.prototype.pipe=function(c){return this.on("data",function(f){c.push(f)}),this.on("done",function(f){c.flush(f)}),this.on("partialdone",function(f){c.partialFlush(f)}),this.on("endedtimeline",function(f){c.endTimeline(f)}),this.on("reset",function(f){c.reset(f)}),c},e.prototype.push=function(c){this.trigger("data",c)},e.prototype.flush=function(c){this.trigger("done",c)},e.prototype.partialFlush=function(c){this.trigger("partialdone",c)},e.prototype.endTimeline=function(c){this.trigger("endedtimeline",c)},e.prototype.reset=function(c){this.trigger("reset",c)};var t=e,n=Math.pow(2,32),s=function(c){var f=new DataView(c.buffer,c.byteOffset,c.byteLength),g;return f.getBigUint64?(g=f.getBigUint64(0),g<Number.MAX_SAFE_INTEGER?Number(g):g):f.getUint32(0)*n+f.getUint32(4)},r={getUint64:s,MAX_UINT32:n},a=r.MAX_UINT32,o,l,u,h,d,m,y,v,b,x,_,E,A,w,C,I,B,X,M,F,Q,oe,H,$,Z,le,ie,ue,de,fe,Pe,Ae,ee,he,Te,Ce;(function(){var c;if(H={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},!(typeof Uint8Array>"u")){for(c in H)H.hasOwnProperty(c)&&(H[c]=[c.charCodeAt(0),c.charCodeAt(1),c.charCodeAt(2),c.charCodeAt(3)]);$=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),le=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),Z=new Uint8Array([0,0,0,1]),ie=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),ue=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),de={video:ie,audio:ue},Ae=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),Pe=new Uint8Array([0,0,0,0,0,0,0,0]),ee=new Uint8Array([0,0,0,0,0,0,0,0]),he=ee,Te=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Ce=ee,fe=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})(),o=function(c){var f=[],g=0,p,T,S;for(p=1;p<arguments.length;p++)f.push(arguments[p]);for(p=f.length;p--;)g+=f[p].byteLength;for(T=new Uint8Array(g+8),S=new DataView(T.buffer,T.byteOffset,T.byteLength),S.setUint32(0,T.byteLength),T.set(c,4),p=0,g=8;p<f.length;p++)T.set(f[p],g),g+=f[p].byteLength;return T},l=function(){return o(H.dinf,o(H.dref,Ae))},u=function(c){return o(H.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,c.audioobjecttype<<3|c.samplingfrequencyindex>>>1,c.samplingfrequencyindex<<7|c.channelcount<<3,6,1,2]))},h=function(){return o(H.ftyp,$,Z,$,le)},I=function(c){return o(H.hdlr,de[c])},d=function(c){return o(H.mdat,c)},C=function(c){var f=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,c.duration>>>24&255,c.duration>>>16&255,c.duration>>>8&255,c.duration&255,85,196,0,0]);return c.samplerate&&(f[12]=c.samplerate>>>24&255,f[13]=c.samplerate>>>16&255,f[14]=c.samplerate>>>8&255,f[15]=c.samplerate&255),o(H.mdhd,f)},w=function(c){return o(H.mdia,C(c),I(c.type),y(c))},m=function(c){return o(H.mfhd,new Uint8Array([0,0,0,0,(c&4278190080)>>24,(c&16711680)>>16,(c&65280)>>8,c&255]))},y=function(c){return o(H.minf,c.type==="video"?o(H.vmhd,fe):o(H.smhd,Pe),l(),X(c))},v=function(c,f){for(var g=[],p=f.length;p--;)g[p]=F(f[p]);return o.apply(null,[H.moof,m(c)].concat(g))},b=function(c){for(var f=c.length,g=[];f--;)g[f]=E(c[f]);return o.apply(null,[H.moov,_(4294967295)].concat(g).concat(x(c)))},x=function(c){for(var f=c.length,g=[];f--;)g[f]=Q(c[f]);return o.apply(null,[H.mvex].concat(g))},_=function(c){var f=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(c&4278190080)>>24,(c&16711680)>>16,(c&65280)>>8,c&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return o(H.mvhd,f)},B=function(c){var f=c.samples||[],g=new Uint8Array(4+f.length),p,T;for(T=0;T<f.length;T++)p=f[T].flags,g[T+4]=p.dependsOn<<4|p.isDependedOn<<2|p.hasRedundancy;return o(H.sdtp,g)},X=function(c){return o(H.stbl,M(c),o(H.stts,Ce),o(H.stsc,he),o(H.stsz,Te),o(H.stco,ee))},function(){var c,f;M=function(g){return o(H.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),g.type==="video"?c(g):f(g))},c=function(g){var p=g.sps||[],T=g.pps||[],S=[],D=[],P,O;for(P=0;P<p.length;P++)S.push((p[P].byteLength&65280)>>>8),S.push(p[P].byteLength&255),S=S.concat(Array.prototype.slice.call(p[P]));for(P=0;P<T.length;P++)D.push((T[P].byteLength&65280)>>>8),D.push(T[P].byteLength&255),D=D.concat(Array.prototype.slice.call(T[P]));if(O=[H.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(g.width&65280)>>8,g.width&255,(g.height&65280)>>8,g.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o(H.avcC,new Uint8Array([1,g.profileIdc,g.profileCompatibility,g.levelIdc,255].concat([p.length],S,[T.length],D))),o(H.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],g.sarRatio){var k=g.sarRatio[0],z=g.sarRatio[1];O.push(o(H.pasp,new Uint8Array([(k&4278190080)>>24,(k&16711680)>>16,(k&65280)>>8,k&255,(z&4278190080)>>24,(z&16711680)>>16,(z&65280)>>8,z&255])))}return o.apply(null,O)},f=function(g){return o(H.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(g.channelcount&65280)>>8,g.channelcount&255,(g.samplesize&65280)>>8,g.samplesize&255,0,0,0,0,(g.samplerate&65280)>>8,g.samplerate&255,0,0]),u(g))}}(),A=function(c){var f=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(c.id&4278190080)>>24,(c.id&16711680)>>16,(c.id&65280)>>8,c.id&255,0,0,0,0,(c.duration&4278190080)>>24,(c.duration&16711680)>>16,(c.duration&65280)>>8,c.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(c.width&65280)>>8,c.width&255,0,0,(c.height&65280)>>8,c.height&255,0,0]);return o(H.tkhd,f)},F=function(c){var f,g,p,T,S,D,P;return f=o(H.tfhd,new Uint8Array([0,0,0,58,(c.id&4278190080)>>24,(c.id&16711680)>>16,(c.id&65280)>>8,c.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),D=Math.floor(c.baseMediaDecodeTime/a),P=Math.floor(c.baseMediaDecodeTime%a),g=o(H.tfdt,new Uint8Array([1,0,0,0,D>>>24&255,D>>>16&255,D>>>8&255,D&255,P>>>24&255,P>>>16&255,P>>>8&255,P&255])),S=32+20+8+16+8+8,c.type==="audio"?(p=oe(c,S),o(H.traf,f,g,p)):(T=B(c),p=oe(c,T.length+S),o(H.traf,f,g,p,T))},E=function(c){return c.duration=c.duration||4294967295,o(H.trak,A(c),w(c))},Q=function(c){var f=new Uint8Array([0,0,0,0,(c.id&4278190080)>>24,(c.id&16711680)>>16,(c.id&65280)>>8,c.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return c.type!=="video"&&(f[f.length-1]=0),o(H.trex,f)},function(){var c,f,g;g=function(p,T){var S=0,D=0,P=0,O=0;return p.length&&(p[0].duration!==void 0&&(S=1),p[0].size!==void 0&&(D=2),p[0].flags!==void 0&&(P=4),p[0].compositionTimeOffset!==void 0&&(O=8)),[0,0,S|D|P|O,1,(p.length&4278190080)>>>24,(p.length&16711680)>>>16,(p.length&65280)>>>8,p.length&255,(T&4278190080)>>>24,(T&16711680)>>>16,(T&65280)>>>8,T&255]},f=function(p,T){var S,D,P,O,k,z;for(O=p.samples||[],T+=8+12+16*O.length,P=g(O,T),D=new Uint8Array(P.length+O.length*16),D.set(P),S=P.length,z=0;z<O.length;z++)k=O[z],D[S++]=(k.duration&4278190080)>>>24,D[S++]=(k.duration&16711680)>>>16,D[S++]=(k.duration&65280)>>>8,D[S++]=k.duration&255,D[S++]=(k.size&4278190080)>>>24,D[S++]=(k.size&16711680)>>>16,D[S++]=(k.size&65280)>>>8,D[S++]=k.size&255,D[S++]=k.flags.isLeading<<2|k.flags.dependsOn,D[S++]=k.flags.isDependedOn<<6|k.flags.hasRedundancy<<4|k.flags.paddingValue<<1|k.flags.isNonSyncSample,D[S++]=k.flags.degradationPriority&240<<8,D[S++]=k.flags.degradationPriority&15,D[S++]=(k.compositionTimeOffset&4278190080)>>>24,D[S++]=(k.compositionTimeOffset&16711680)>>>16,D[S++]=(k.compositionTimeOffset&65280)>>>8,D[S++]=k.compositionTimeOffset&255;return o(H.trun,D)},c=function(p,T){var S,D,P,O,k,z;for(O=p.samples||[],T+=8+12+8*O.length,P=g(O,T),S=new Uint8Array(P.length+O.length*8),S.set(P),D=P.length,z=0;z<O.length;z++)k=O[z],S[D++]=(k.duration&4278190080)>>>24,S[D++]=(k.duration&16711680)>>>16,S[D++]=(k.duration&65280)>>>8,S[D++]=k.duration&255,S[D++]=(k.size&4278190080)>>>24,S[D++]=(k.size&16711680)>>>16,S[D++]=(k.size&65280)>>>8,S[D++]=k.size&255;return o(H.trun,S)},oe=function(p,T){return p.type==="audio"?c(p,T):f(p,T)}}();var G={ftyp:h,mdat:d,moof:v,moov:b,initSegment:function(c){var f=h(),g=b(c),p;return p=new Uint8Array(f.byteLength+g.byteLength),p.set(f),p.set(g,f.byteLength),p}},Ke=function(c){var f,g,p=[],T=[];for(T.byteLength=0,T.nalCount=0,T.duration=0,p.byteLength=0,f=0;f<c.length;f++)g=c[f],g.nalUnitType==="access_unit_delimiter_rbsp"?(p.length&&(p.duration=g.dts-p.dts,T.byteLength+=p.byteLength,T.nalCount+=p.length,T.duration+=p.duration,T.push(p)),p=[g],p.byteLength=g.data.byteLength,p.pts=g.pts,p.dts=g.dts):(g.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(p.keyFrame=!0),p.duration=g.dts-p.dts,p.byteLength+=g.data.byteLength,p.push(g));return T.length&&(!p.duration||p.duration<=0)&&(p.duration=T[T.length-1].duration),T.byteLength+=p.byteLength,T.nalCount+=p.length,T.duration+=p.duration,T.push(p),T},$e=function(c){var f,g,p=[],T=[];for(p.byteLength=0,p.nalCount=0,p.duration=0,p.pts=c[0].pts,p.dts=c[0].dts,T.byteLength=0,T.nalCount=0,T.duration=0,T.pts=c[0].pts,T.dts=c[0].dts,f=0;f<c.length;f++)g=c[f],g.keyFrame?(p.length&&(T.push(p),T.byteLength+=p.byteLength,T.nalCount+=p.nalCount,T.duration+=p.duration),p=[g],p.nalCount=g.length,p.byteLength=g.byteLength,p.pts=g.pts,p.dts=g.dts,p.duration=g.duration):(p.duration+=g.duration,p.nalCount+=g.length,p.byteLength+=g.byteLength,p.push(g));return T.length&&p.duration<=0&&(p.duration=T[T.length-1].duration),T.byteLength+=p.byteLength,T.nalCount+=p.nalCount,T.duration+=p.duration,T.push(p),T},xe=function(c){var f;return!c[0][0].keyFrame&&c.length>1&&(f=c.shift(),c.byteLength-=f.byteLength,c.nalCount-=f.nalCount,c[0][0].dts=f.dts,c[0][0].pts=f.pts,c[0][0].duration+=f.duration),c},Ge=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}},lt=function(c,f){var g=Ge();return g.dataOffset=f,g.compositionTimeOffset=c.pts-c.dts,g.duration=c.duration,g.size=4*c.length,g.size+=c.byteLength,c.keyFrame&&(g.flags.dependsOn=2,g.flags.isNonSyncSample=0),g},Ne=function(c,f){var g,p,T,S,D,P=f||0,O=[];for(g=0;g<c.length;g++)for(S=c[g],p=0;p<S.length;p++)D=S[p],T=lt(D,P),P+=T.size,O.push(T);return O},it=function(c){var f,g,p,T,S,D,P=0,O=c.byteLength,k=c.nalCount,z=O+4*k,K=new Uint8Array(z),Ee=new DataView(K.buffer);for(f=0;f<c.length;f++)for(T=c[f],g=0;g<T.length;g++)for(S=T[g],p=0;p<S.length;p++)D=S[p],Ee.setUint32(P,D.data.byteLength),P+=4,K.set(D.data,P),P+=D.data.byteLength;return K},Ot=function(c,f){var g,p=f||0,T=[];return g=lt(c,p),T.push(g),T},Ht=function(c){var f,g,p=0,T=c.byteLength,S=c.length,D=T+4*S,P=new Uint8Array(D),O=new DataView(P.buffer);for(f=0;f<c.length;f++)g=c[f],O.setUint32(p,g.data.byteLength),p+=4,P.set(g.data,p),p+=g.data.byteLength;return P},Ut={groupNalsIntoFrames:Ke,groupFramesIntoGops:$e,extendFirstKeyFrame:xe,generateSampleTable:Ne,concatenateNalData:it,generateSampleTableForFrame:Ot,concatenateNalDataForFrame:Ht},gt=[33,16,5,32,164,27],ot=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],Fe=function(c){for(var f=[];c--;)f.push(0);return f},Jt=function(c){return Object.keys(c).reduce(function(f,g){return f[g]=new Uint8Array(c[g].reduce(function(p,T){return p.concat(T)},[])),f},{})},U,R=function(){if(!U){var c={96e3:[gt,[227,64],Fe(154),[56]],88200:[gt,[231],Fe(170),[56]],64e3:[gt,[248,192],Fe(240),[56]],48e3:[gt,[255,192],Fe(268),[55,148,128],Fe(54),[112]],44100:[gt,[255,192],Fe(268),[55,163,128],Fe(84),[112]],32e3:[gt,[255,192],Fe(268),[55,234],Fe(226),[112]],24e3:[gt,[255,192],Fe(268),[55,255,128],Fe(268),[111,112],Fe(126),[224]],16e3:[gt,[255,192],Fe(268),[55,255,128],Fe(268),[111,255],Fe(269),[223,108],Fe(195),[1,192]],12e3:[ot,Fe(268),[3,127,248],Fe(268),[6,255,240],Fe(268),[13,255,224],Fe(268),[27,253,128],Fe(259),[56]],11025:[ot,Fe(268),[3,127,248],Fe(268),[6,255,240],Fe(268),[13,255,224],Fe(268),[27,255,192],Fe(268),[55,175,128],Fe(108),[112]],8e3:[ot,Fe(268),[3,121,16],Fe(47),[7]]};U=Jt(c)}return U},J=9e4,pe,ge,be,ze,Re,ae,Ie;pe=function(c){return c*J},ge=function(c,f){return c*f},be=function(c){return c/J},ze=function(c,f){return c/f},Re=function(c,f){return pe(ze(c,f))},ae=function(c,f){return ge(be(c),f)},Ie=function(c,f,g){return be(g?c:c-f)};var ye={ONE_SECOND_IN_TS:J,secondsToVideoTs:pe,secondsToAudioTs:ge,videoTsToSeconds:be,audioTsToSeconds:ze,audioTsToVideoTs:Re,videoTsToAudioTs:ae,metadataTsToSeconds:Ie},He=R,De=ye,Ue=function(c){var f,g,p=0;for(f=0;f<c.length;f++)g=c[f],p+=g.data.byteLength;return p},st=function(c,f,g,p){var T,S=0,D=0,P=0,O=0,k,z,K;if(f.length&&(T=De.audioTsToVideoTs(c.baseMediaDecodeTime,c.samplerate),S=Math.ceil(De.ONE_SECOND_IN_TS/(c.samplerate/1024)),g&&p&&(D=T-Math.max(g,p),P=Math.floor(D/S),O=P*S),!(P<1||O>De.ONE_SECOND_IN_TS/2))){for(k=He()[c.samplerate],k||(k=f[0].data),z=0;z<P;z++)K=f[0],f.splice(0,0,{data:k,dts:K.dts-S,pts:K.pts-S});return c.baseMediaDecodeTime-=Math.floor(De.videoTsToAudioTs(O,c.samplerate)),O}},ct=function(c,f,g){return f.minSegmentDts>=g?c:(f.minSegmentDts=1/0,c.filter(function(p){return p.dts>=g?(f.minSegmentDts=Math.min(f.minSegmentDts,p.dts),f.minSegmentPts=f.minSegmentDts,!0):!1}))},Et=function(c){var f,g,p=[];for(f=0;f<c.length;f++)g=c[f],p.push({size:g.data.byteLength,duration:1024});return p},V=function(c){var f,g,p=0,T=new Uint8Array(Ue(c));for(f=0;f<c.length;f++)g=c[f],T.set(g.data,p),p+=g.data.byteLength;return T},ne={prefixWithSilence:st,trimAdtsFramesByEarliestDts:ct,generateSampleTable:Et,concatenateFrameData:V},me=ye.ONE_SECOND_IN_TS,we=function(c,f){typeof f.pts=="number"&&(c.timelineStartInfo.pts===void 0&&(c.timelineStartInfo.pts=f.pts),c.minSegmentPts===void 0?c.minSegmentPts=f.pts:c.minSegmentPts=Math.min(c.minSegmentPts,f.pts),c.maxSegmentPts===void 0?c.maxSegmentPts=f.pts:c.maxSegmentPts=Math.max(c.maxSegmentPts,f.pts)),typeof f.dts=="number"&&(c.timelineStartInfo.dts===void 0&&(c.timelineStartInfo.dts=f.dts),c.minSegmentDts===void 0?c.minSegmentDts=f.dts:c.minSegmentDts=Math.min(c.minSegmentDts,f.dts),c.maxSegmentDts===void 0?c.maxSegmentDts=f.dts:c.maxSegmentDts=Math.max(c.maxSegmentDts,f.dts))},Oe=function(c){delete c.minSegmentDts,delete c.maxSegmentDts,delete c.minSegmentPts,delete c.maxSegmentPts},dt=function(c,f){var g,p,T=c.minSegmentDts;return f||(T-=c.timelineStartInfo.dts),g=c.timelineStartInfo.baseMediaDecodeTime,g+=T,g=Math.max(0,g),c.type==="audio"&&(p=c.samplerate/me,g*=p,g=Math.floor(g)),g},ft={clearDtsInfo:Oe,calculateTrackBaseMediaDecodeTime:dt,collectDtsInfo:we},Vt=4,on=128,At=function(c){for(var f=0,g={payloadType:-1,payloadSize:0},p=0,T=0;f<c.byteLength&&c[f]!==on;){for(;c[f]===255;)p+=255,f++;for(p+=c[f++];c[f]===255;)T+=255,f++;if(T+=c[f++],!g.payload&&p===Vt){var S=String.fromCharCode(c[f+3],c[f+4],c[f+5],c[f+6]);if(S==="GA94"){g.payloadType=p,g.payloadSize=T,g.payload=c.subarray(f,f+T);break}else g.payload=void 0}f+=T,p=0,T=0}return g},mi=function(c){return c.payload[0]!==181||(c.payload[1]<<8|c.payload[2])!==49||String.fromCharCode(c.payload[3],c.payload[4],c.payload[5],c.payload[6])!=="GA94"||c.payload[7]!==3?null:c.payload.subarray(8,c.payload.length-1)},ki=function(c,f){var g=[],p,T,S,D;if(!(f[0]&64))return g;for(T=f[0]&31,p=0;p<T;p++)S=p*3,D={type:f[S+2]&3,pts:c},f[S+2]&4&&(D.ccData=f[S+3]<<8|f[S+4],g.push(D));return g},Xs=function(c){for(var f=c.byteLength,g=[],p=1,T,S;p<f-2;)c[p]===0&&c[p+1]===0&&c[p+2]===3?(g.push(p+2),p+=2):p++;if(g.length===0)return c;T=f-g.length,S=new Uint8Array(T);var D=0;for(p=0;p<T;D++,p++)D===g[0]&&(D++,g.shift()),S[p]=c[D];return S},ha={parseSei:At,parseUserData:mi,parseCaptionPackets:ki,discardEmulationPreventionBytes:Xs,USER_DATA_REGISTERED_ITU_T_T35:Vt},da=t,Ks=ha,ei=function(c){c=c||{},ei.prototype.init.call(this),this.parse708captions_=typeof c.parse708captions=="boolean"?c.parse708captions:!0,this.captionPackets_=[],this.ccStreams_=[new Le(0,0),new Le(0,1),new Le(1,0),new Le(1,1)],this.parse708captions_&&(this.cc708Stream_=new ve({captionServices:c.captionServices})),this.reset(),this.ccStreams_.forEach(function(f){f.on("data",this.trigger.bind(this,"data")),f.on("partialdone",this.trigger.bind(this,"partialdone")),f.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};ei.prototype=new da,ei.prototype.push=function(c){var f,g,p;if(c.nalUnitType==="sei_rbsp"&&(f=Ks.parseSei(c.escapedRBSP),!!f.payload&&f.payloadType===Ks.USER_DATA_REGISTERED_ITU_T_T35&&(g=Ks.parseUserData(f),!!g))){if(c.dts<this.latestDts_){this.ignoreNextEqualDts_=!0;return}else if(c.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.numSameDts_--,this.numSameDts_||(this.ignoreNextEqualDts_=!1);return}p=Ks.parseCaptionPackets(c.pts,g),this.captionPackets_=this.captionPackets_.concat(p),this.latestDts_!==c.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=c.dts}},ei.prototype.flushCCStreams=function(c){this.ccStreams_.forEach(function(f){return c==="flush"?f.flush():f.partialFlush()},this)},ei.prototype.flushStream=function(c){if(!this.captionPackets_.length){this.flushCCStreams(c);return}this.captionPackets_.forEach(function(f,g){f.presortIndex=g}),this.captionPackets_.sort(function(f,g){return f.pts===g.pts?f.presortIndex-g.presortIndex:f.pts-g.pts}),this.captionPackets_.forEach(function(f){f.type<2?this.dispatchCea608Packet(f):this.dispatchCea708Packet(f)},this),this.captionPackets_.length=0,this.flushCCStreams(c)},ei.prototype.flush=function(){return this.flushStream("flush")},ei.prototype.partialFlush=function(){return this.flushStream("partialFlush")},ei.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(c){c.reset()})},ei.prototype.dispatchCea608Packet=function(c){this.setsTextOrXDSActive(c)?this.activeCea608Channel_[c.type]=null:this.setsChannel1Active(c)?this.activeCea608Channel_[c.type]=0:this.setsChannel2Active(c)&&(this.activeCea608Channel_[c.type]=1),this.activeCea608Channel_[c.type]!==null&&this.ccStreams_[(c.type<<1)+this.activeCea608Channel_[c.type]].push(c)},ei.prototype.setsChannel1Active=function(c){return(c.ccData&30720)===4096},ei.prototype.setsChannel2Active=function(c){return(c.ccData&30720)===6144},ei.prototype.setsTextOrXDSActive=function(c){return(c.ccData&28928)===256||(c.ccData&30974)===4138||(c.ccData&30974)===6186},ei.prototype.dispatchCea708Packet=function(c){this.parse708captions_&&this.cc708Stream_.push(c)};var L={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},j=function(c){var f=L[c]||c;return c&4096&&c===f?"":String.fromCharCode(f)},te=function(c){return 32<=c&&c<=127||160<=c&&c<=255},W=function(c){this.windowNum=c,this.reset()};W.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},W.prototype.getText=function(){return this.rows.join(`
`)},W.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},W.prototype.newLine=function(c){for(this.rows.length>=this.virtualRowCount&&typeof this.beforeRowOverflow=="function"&&this.beforeRowOverflow(c),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},W.prototype.isEmpty=function(){return this.rows.length===0?!0:this.rows.length===1?this.rows[0]==="":!1},W.prototype.addText=function(c){this.rows[this.rowIdx]+=c},W.prototype.backspace=function(){if(!this.isEmpty()){var c=this.rows[this.rowIdx];this.rows[this.rowIdx]=c.substr(0,c.length-1)}};var se=function(c,f,g){this.serviceNum=c,this.text="",this.currentWindow=new W(-1),this.windows=[],this.stream=g,typeof f=="string"&&this.createTextDecoder(f)};se.prototype.init=function(c,f){this.startPts=c;for(var g=0;g<8;g++)this.windows[g]=new W(g),typeof f=="function"&&(this.windows[g].beforeRowOverflow=f)},se.prototype.setCurrentWindow=function(c){this.currentWindow=this.windows[c]},se.prototype.createTextDecoder=function(c){if(typeof TextDecoder>"u")this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(c)}catch(f){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+c+" encoding. "+f})}};var ve=function(c){c=c||{},ve.prototype.init.call(this);var f=this,g=c.captionServices||{},p={},T;Object.keys(g).forEach(S=>{T=g[S],/^SERVICE/.test(S)&&(p[S]=T.encoding)}),this.serviceEncodings=p,this.current708Packet=null,this.services={},this.push=function(S){S.type===3?(f.new708Packet(),f.add708Bytes(S)):(f.current708Packet===null&&f.new708Packet(),f.add708Bytes(S))}};ve.prototype=new da,ve.prototype.new708Packet=function(){this.current708Packet!==null&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},ve.prototype.add708Bytes=function(c){var f=c.ccData,g=f>>>8,p=f&255;this.current708Packet.ptsVals.push(c.pts),this.current708Packet.data.push(g),this.current708Packet.data.push(p)},ve.prototype.push708Packet=function(){var c=this.current708Packet,f=c.data,g=null,p=null,T=0,S=f[T++];for(c.seq=S>>6,c.sizeCode=S&63;T<f.length;T++)S=f[T++],g=S>>5,p=S&31,g===7&&p>0&&(S=f[T++],g=S),this.pushServiceBlock(g,T,p),p>0&&(T+=p-1)},ve.prototype.pushServiceBlock=function(c,f,g){var p,T=f,S=this.current708Packet.data,D=this.services[c];for(D||(D=this.initService(c,T));T<f+g&&T<S.length;T++)p=S[T],te(p)?T=this.handleText(T,D):p===24?T=this.multiByteCharacter(T,D):p===16?T=this.extendedCommands(T,D):128<=p&&p<=135?T=this.setCurrentWindow(T,D):152<=p&&p<=159?T=this.defineWindow(T,D):p===136?T=this.clearWindows(T,D):p===140?T=this.deleteWindows(T,D):p===137?T=this.displayWindows(T,D):p===138?T=this.hideWindows(T,D):p===139?T=this.toggleWindows(T,D):p===151?T=this.setWindowAttributes(T,D):p===144?T=this.setPenAttributes(T,D):p===145?T=this.setPenColor(T,D):p===146?T=this.setPenLocation(T,D):p===143?D=this.reset(T,D):p===8?D.currentWindow.backspace():p===12?D.currentWindow.clearText():p===13?D.currentWindow.pendingNewLine=!0:p===14?D.currentWindow.clearText():p===141&&T++},ve.prototype.extendedCommands=function(c,f){var g=this.current708Packet.data,p=g[++c];return te(p)&&(c=this.handleText(c,f,{isExtended:!0})),c},ve.prototype.getPts=function(c){return this.current708Packet.ptsVals[Math.floor(c/2)]},ve.prototype.initService=function(c,f){var p="SERVICE"+c,g=this,p,T;return p in this.serviceEncodings&&(T=this.serviceEncodings[p]),this.services[c]=new se(c,T,g),this.services[c].init(this.getPts(f),function(S){g.flushDisplayed(S,g.services[c])}),this.services[c]},ve.prototype.handleText=function(c,f,g){var p=g&&g.isExtended,T=g&&g.isMultiByte,S=this.current708Packet.data,D=p?4096:0,P=S[c],O=S[c+1],k=f.currentWindow,z,K;function Ee(ce){return ce.map(Be=>("0"+(Be&255).toString(16)).slice(-2)).join("")}if(T?(K=[P,O],c++):K=[P],f.textDecoder_&&!p)z=f.textDecoder_.decode(new Uint8Array(K));else if(T){const ce=Ee(K);z=String.fromCharCode(parseInt(ce,16))}else z=j(D|P);return k.pendingNewLine&&!k.isEmpty()&&k.newLine(this.getPts(c)),k.pendingNewLine=!1,k.addText(z),c},ve.prototype.multiByteCharacter=function(c,f){var g=this.current708Packet.data,p=g[c+1],T=g[c+2];return te(p)&&te(T)&&(c=this.handleText(++c,f,{isMultiByte:!0})),c},ve.prototype.setCurrentWindow=function(c,f){var g=this.current708Packet.data,p=g[c],T=p&7;return f.setCurrentWindow(T),c},ve.prototype.defineWindow=function(c,f){var g=this.current708Packet.data,p=g[c],T=p&7;f.setCurrentWindow(T);var S=f.currentWindow;return p=g[++c],S.visible=(p&32)>>5,S.rowLock=(p&16)>>4,S.columnLock=(p&8)>>3,S.priority=p&7,p=g[++c],S.relativePositioning=(p&128)>>7,S.anchorVertical=p&127,p=g[++c],S.anchorHorizontal=p,p=g[++c],S.anchorPoint=(p&240)>>4,S.rowCount=p&15,p=g[++c],S.columnCount=p&63,p=g[++c],S.windowStyle=(p&56)>>3,S.penStyle=p&7,S.virtualRowCount=S.rowCount+1,c},ve.prototype.setWindowAttributes=function(c,f){var g=this.current708Packet.data,p=g[c],T=f.currentWindow.winAttr;return p=g[++c],T.fillOpacity=(p&192)>>6,T.fillRed=(p&48)>>4,T.fillGreen=(p&12)>>2,T.fillBlue=p&3,p=g[++c],T.borderType=(p&192)>>6,T.borderRed=(p&48)>>4,T.borderGreen=(p&12)>>2,T.borderBlue=p&3,p=g[++c],T.borderType+=(p&128)>>5,T.wordWrap=(p&64)>>6,T.printDirection=(p&48)>>4,T.scrollDirection=(p&12)>>2,T.justify=p&3,p=g[++c],T.effectSpeed=(p&240)>>4,T.effectDirection=(p&12)>>2,T.displayEffect=p&3,c},ve.prototype.flushDisplayed=function(c,f){for(var g=[],p=0;p<8;p++)f.windows[p].visible&&!f.windows[p].isEmpty()&&g.push(f.windows[p].getText());f.endPts=c,f.text=g.join(`

`),this.pushCaption(f),f.startPts=c},ve.prototype.pushCaption=function(c){c.text!==""&&(this.trigger("data",{startPts:c.startPts,endPts:c.endPts,text:c.text,stream:"cc708_"+c.serviceNum}),c.text="",c.startPts=c.endPts)},ve.prototype.displayWindows=function(c,f){var g=this.current708Packet.data,p=g[++c],T=this.getPts(c);this.flushDisplayed(T,f);for(var S=0;S<8;S++)p&1<<S&&(f.windows[S].visible=1);return c},ve.prototype.hideWindows=function(c,f){var g=this.current708Packet.data,p=g[++c],T=this.getPts(c);this.flushDisplayed(T,f);for(var S=0;S<8;S++)p&1<<S&&(f.windows[S].visible=0);return c},ve.prototype.toggleWindows=function(c,f){var g=this.current708Packet.data,p=g[++c],T=this.getPts(c);this.flushDisplayed(T,f);for(var S=0;S<8;S++)p&1<<S&&(f.windows[S].visible^=1);return c},ve.prototype.clearWindows=function(c,f){var g=this.current708Packet.data,p=g[++c],T=this.getPts(c);this.flushDisplayed(T,f);for(var S=0;S<8;S++)p&1<<S&&f.windows[S].clearText();return c},ve.prototype.deleteWindows=function(c,f){var g=this.current708Packet.data,p=g[++c],T=this.getPts(c);this.flushDisplayed(T,f);for(var S=0;S<8;S++)p&1<<S&&f.windows[S].reset();return c},ve.prototype.setPenAttributes=function(c,f){var g=this.current708Packet.data,p=g[c],T=f.currentWindow.penAttr;return p=g[++c],T.textTag=(p&240)>>4,T.offset=(p&12)>>2,T.penSize=p&3,p=g[++c],T.italics=(p&128)>>7,T.underline=(p&64)>>6,T.edgeType=(p&56)>>3,T.fontStyle=p&7,c},ve.prototype.setPenColor=function(c,f){var g=this.current708Packet.data,p=g[c],T=f.currentWindow.penColor;return p=g[++c],T.fgOpacity=(p&192)>>6,T.fgRed=(p&48)>>4,T.fgGreen=(p&12)>>2,T.fgBlue=p&3,p=g[++c],T.bgOpacity=(p&192)>>6,T.bgRed=(p&48)>>4,T.bgGreen=(p&12)>>2,T.bgBlue=p&3,p=g[++c],T.edgeRed=(p&48)>>4,T.edgeGreen=(p&12)>>2,T.edgeBlue=p&3,c},ve.prototype.setPenLocation=function(c,f){var g=this.current708Packet.data,p=g[c],T=f.currentWindow.penLoc;return f.currentWindow.pendingNewLine=!0,p=g[++c],T.row=p&15,p=g[++c],T.column=p&63,c},ve.prototype.reset=function(c,f){var g=this.getPts(c);return this.flushDisplayed(g,f),this.initService(f.serviceNum,c)};var Ve={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},We=function(c){return c===null?"":(c=Ve[c]||c,String.fromCharCode(c))},Ye=14,et=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],Xe=function(){for(var c=[],f=Ye+1;f--;)c.push({text:"",indent:0,offset:0});return c},Le=function(c,f){Le.prototype.init.call(this),this.field_=c||0,this.dataChannel_=f||0,this.name_="CC"+((this.field_<<1|this.dataChannel_)+1),this.setConstants(),this.reset(),this.push=function(g){var p,T,S,D,P;if(p=g.ccData&32639,p===this.lastControlCode_){this.lastControlCode_=null;return}if((p&61440)===4096?this.lastControlCode_=p:p!==this.PADDING_&&(this.lastControlCode_=null),S=p>>>8,D=p&255,p!==this.PADDING_)if(p===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(p===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(g.pts),this.flushDisplayed(g.pts),T=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=T,this.startPts_=g.pts;else if(p===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(g.pts);else if(p===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(g.pts);else if(p===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(g.pts);else if(p===this.CARRIAGE_RETURN_)this.clearFormatting(g.pts),this.flushDisplayed(g.pts),this.shiftRowsUp_(),this.startPts_=g.pts;else if(p===this.BACKSPACE_)this.mode_==="popOn"?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1);else if(p===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(g.pts),this.displayed_=Xe();else if(p===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=Xe();else if(p===this.RESUME_DIRECT_CAPTIONING_)this.mode_!=="paintOn"&&(this.flushDisplayed(g.pts),this.displayed_=Xe()),this.mode_="paintOn",this.startPts_=g.pts;else if(this.isSpecialCharacter(S,D))S=(S&3)<<8,P=We(S|D),this[this.mode_](g.pts,P),this.column_++;else if(this.isExtCharacter(S,D))this.mode_==="popOn"?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1),S=(S&3)<<8,P=We(S|D),this[this.mode_](g.pts,P),this.column_++;else if(this.isMidRowCode(S,D))this.clearFormatting(g.pts),this[this.mode_](g.pts," "),this.column_++,(D&14)===14&&this.addFormatting(g.pts,["i"]),(D&1)===1&&this.addFormatting(g.pts,["u"]);else if(this.isOffsetControlCode(S,D)){const k=D&3;this.nonDisplayed_[this.row_].offset=k,this.column_+=k}else if(this.isPAC(S,D)){var O=et.indexOf(p&7968);if(this.mode_==="rollUp"&&(O-this.rollUpRows_+1<0&&(O=this.rollUpRows_-1),this.setRollUp(g.pts,O)),O!==this.row_&&O>=0&&O<=14&&(this.clearFormatting(g.pts),this.row_=O),D&1&&this.formatting_.indexOf("u")===-1&&this.addFormatting(g.pts,["u"]),(p&16)===16){const k=(p&14)>>1;this.column_=k*4,this.nonDisplayed_[this.row_].indent+=k}this.isColorPAC(D)&&(D&14)===14&&this.addFormatting(g.pts,["i"])}else this.isNormalChar(S)&&(D===0&&(D=null),P=We(S),P+=We(D),this[this.mode_](g.pts,P),this.column_+=P.length)}};Le.prototype=new da,Le.prototype.flushDisplayed=function(c){const f=p=>{this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+p+"."})},g=[];this.displayed_.forEach((p,T)=>{if(p&&p.text&&p.text.length){try{p.text=p.text.trim()}catch{f(T)}p.text.length&&g.push({text:p.text,line:T+1,position:10+Math.min(70,p.indent*10)+p.offset*2.5})}else p==null&&f(T)}),g.length&&this.trigger("data",{startPts:this.startPts_,endPts:c,content:g,stream:this.name_})},Le.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=Xe(),this.nonDisplayed_=Xe(),this.lastControlCode_=null,this.column_=0,this.row_=Ye,this.rollUpRows_=2,this.formatting_=[]},Le.prototype.setConstants=function(){this.dataChannel_===0?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):this.dataChannel_===1&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=this.CONTROL_|32,this.END_OF_CAPTION_=this.CONTROL_|47,this.ROLL_UP_2_ROWS_=this.CONTROL_|37,this.ROLL_UP_3_ROWS_=this.CONTROL_|38,this.ROLL_UP_4_ROWS_=this.CONTROL_|39,this.CARRIAGE_RETURN_=this.CONTROL_|45,this.RESUME_DIRECT_CAPTIONING_=this.CONTROL_|41,this.BACKSPACE_=this.CONTROL_|33,this.ERASE_DISPLAYED_MEMORY_=this.CONTROL_|44,this.ERASE_NON_DISPLAYED_MEMORY_=this.CONTROL_|46},Le.prototype.isSpecialCharacter=function(c,f){return c===this.EXT_&&f>=48&&f<=63},Le.prototype.isExtCharacter=function(c,f){return(c===this.EXT_+1||c===this.EXT_+2)&&f>=32&&f<=63},Le.prototype.isMidRowCode=function(c,f){return c===this.EXT_&&f>=32&&f<=47},Le.prototype.isOffsetControlCode=function(c,f){return c===this.OFFSET_&&f>=33&&f<=35},Le.prototype.isPAC=function(c,f){return c>=this.BASE_&&c<this.BASE_+8&&f>=64&&f<=127},Le.prototype.isColorPAC=function(c){return c>=64&&c<=79||c>=96&&c<=127},Le.prototype.isNormalChar=function(c){return c>=32&&c<=127},Le.prototype.setRollUp=function(c,f){if(this.mode_!=="rollUp"&&(this.row_=Ye,this.mode_="rollUp",this.flushDisplayed(c),this.nonDisplayed_=Xe(),this.displayed_=Xe()),f!==void 0&&f!==this.row_)for(var g=0;g<this.rollUpRows_;g++)this.displayed_[f-g]=this.displayed_[this.row_-g],this.displayed_[this.row_-g]={text:"",indent:0,offset:0};f===void 0&&(f=this.row_),this.topRow_=f-this.rollUpRows_+1},Le.prototype.addFormatting=function(c,f){this.formatting_=this.formatting_.concat(f);var g=f.reduce(function(p,T){return p+"<"+T+">"},"");this[this.mode_](c,g)},Le.prototype.clearFormatting=function(c){if(this.formatting_.length){var f=this.formatting_.reverse().reduce(function(g,p){return g+"</"+p+">"},"");this.formatting_=[],this[this.mode_](c,f)}},Le.prototype.popOn=function(c,f){var g=this.nonDisplayed_[this.row_].text;g+=f,this.nonDisplayed_[this.row_].text=g},Le.prototype.rollUp=function(c,f){var g=this.displayed_[this.row_].text;g+=f,this.displayed_[this.row_].text=g},Le.prototype.shiftRowsUp_=function(){var c;for(c=0;c<this.topRow_;c++)this.displayed_[c]={text:"",indent:0,offset:0};for(c=this.row_+1;c<Ye+1;c++)this.displayed_[c]={text:"",indent:0,offset:0};for(c=this.topRow_;c<this.row_;c++)this.displayed_[c]=this.displayed_[c+1];this.displayed_[this.row_]={text:"",indent:0,offset:0}},Le.prototype.paintOn=function(c,f){var g=this.displayed_[this.row_].text;g+=f,this.displayed_[this.row_].text=g};var ut={CaptionStream:ei,Cea608Stream:Le,Cea708Stream:ve},Nt={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},Mi=t,Dn=8589934592,wt=4294967296,nt="shared",gs=function(c,f){var g=1;for(c>f&&(g=-1);Math.abs(f-c)>wt;)c+=g*Dn;return c},Dt=function(c){var f,g;Dt.prototype.init.call(this),this.type_=c||nt,this.push=function(p){if(p.type==="metadata"){this.trigger("data",p);return}this.type_!==nt&&p.type!==this.type_||(g===void 0&&(g=p.dts),p.dts=gs(p.dts,g),p.pts=gs(p.pts,g),f=p.dts,this.trigger("data",p))},this.flush=function(){g=f,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){g=void 0,f=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};Dt.prototype=new Mi;var ln={TimestampRolloverStream:Dt,handleRollover:gs},bo=(c,f,g)=>{if(!c)return-1;for(var p=g;p<c.length;p++)if(c[p]===f)return p;return-1},_s={typedArrayIndexOf:bo},Jn=_s.typedArrayIndexOf,kt={Iso88591:0,Utf16:1,Utf16be:2,Utf8:3},un=function(c,f,g){var p,T="";for(p=f;p<g;p++)T+="%"+("00"+c[p].toString(16)).slice(-2);return T},Rn=function(c,f,g){return decodeURIComponent(un(c,f,g))},zt=function(c,f,g){return unescape(un(c,f,g))},Pn=function(c){return c[0]<<21|c[1]<<14|c[2]<<7|c[3]},vs={APIC:function(c){var f=1,g,p,T="-->";c.data[0]===kt.Utf8&&(g=Jn(c.data,0,f),!(g<0)&&(c.mimeType=zt(c.data,f,g),f=g+1,c.pictureType=c.data[f],f++,p=Jn(c.data,0,f),!(p<0)&&(c.description=Rn(c.data,f,p),f=p+1,c.mimeType===T?c.url=zt(c.data,f,c.data.length):c.pictureData=c.data.subarray(f,c.data.length))))},"T*":function(c){c.data[0]===kt.Utf8&&(c.value=Rn(c.data,1,c.data.length).replace(/\0*$/,""),c.values=c.value.split("\0"))},TXXX:function(c){var f;c.data[0]===kt.Utf8&&(f=Jn(c.data,0,1),f!==-1&&(c.description=Rn(c.data,1,f),c.value=Rn(c.data,f+1,c.data.length).replace(/\0*$/,""),c.data=c.value))},"W*":function(c){c.url=zt(c.data,0,c.data.length).replace(/\0.*$/,"")},WXXX:function(c){var f;c.data[0]===kt.Utf8&&(f=Jn(c.data,0,1),f!==-1&&(c.description=Rn(c.data,1,f),c.url=zt(c.data,f+1,c.data.length).replace(/\0.*$/,"")))},PRIV:function(c){var f;for(f=0;f<c.data.length;f++)if(c.data[f]===0){c.owner=zt(c.data,0,f);break}c.privateData=c.data.subarray(f+1),c.data=c.privateData}},Eo=function(c){var f,g,p=10,T=0,S=[];if(!(c.length<10||c[0]!=="I".charCodeAt(0)||c[1]!=="D".charCodeAt(0)||c[2]!=="3".charCodeAt(0))){T=Pn(c.subarray(6,10)),T+=10;var D=c[5]&64;D&&(p+=4,p+=Pn(c.subarray(10,14)),T-=Pn(c.subarray(16,20)));do{if(f=Pn(c.subarray(p+4,p+8)),f<1)break;g=String.fromCharCode(c[p],c[p+1],c[p+2],c[p+3]);var P={id:g,data:c.subarray(p+10,p+f+10)};P.key=P.id,vs[P.id]?vs[P.id](P):P.id[0]==="T"?vs["T*"](P):P.id[0]==="W"&&vs["W*"](P),S.push(P),p+=10,p+=f}while(p<T);return S}},Cd={parseId3Frames:Eo,parseSyncSafeInteger:Pn,frameParsers:vs},Gv=t,Wv=Nt,es=Cd,Ao;Ao=function(c){var f={descriptor:c&&c.descriptor},g=0,p=[],T=0,S;if(Ao.prototype.init.call(this),this.dispatchType=Wv.METADATA_STREAM_TYPE.toString(16),f.descriptor)for(S=0;S<f.descriptor.length;S++)this.dispatchType+=("00"+f.descriptor[S].toString(16)).slice(-2);this.push=function(D){var P,O,k,z,K,Ee;if(D.type==="timed-metadata"){if(D.dataAlignmentIndicator&&(T=0,p.length=0),p.length===0&&(D.data.length<10||D.data[0]!=="I".charCodeAt(0)||D.data[1]!=="D".charCodeAt(0)||D.data[2]!=="3".charCodeAt(0))){this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});return}if(p.push(D),T+=D.data.byteLength,p.length===1&&(g=es.parseSyncSafeInteger(D.data.subarray(6,10)),g+=10),!(T<g)){for(P={data:new Uint8Array(g),frames:[],pts:p[0].pts,dts:p[0].dts},K=0;K<g;)P.data.set(p[0].data.subarray(0,g-K),K),K+=p[0].data.byteLength,T-=p[0].data.byteLength,p.shift();O=10,P.data[5]&64&&(O+=4,O+=es.parseSyncSafeInteger(P.data.subarray(10,14)),g-=es.parseSyncSafeInteger(P.data.subarray(16,20)));do{if(k=es.parseSyncSafeInteger(P.data.subarray(O+4,O+8)),k<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping remaining metadata parsing."});break}if(Ee=String.fromCharCode(P.data[O],P.data[O+1],P.data[O+2],P.data[O+3]),z={id:Ee,data:P.data.subarray(O+10,O+k+10)},z.key=z.id,es.frameParsers[z.id]?es.frameParsers[z.id](z):z.id[0]==="T"?es.frameParsers["T*"](z):z.id[0]==="W"&&es.frameParsers["W*"](z),z.owner==="com.apple.streaming.transportStreamTimestamp"){var ce=z.data,Be=(ce[3]&1)<<30|ce[4]<<22|ce[5]<<14|ce[6]<<6|ce[7]>>>2;Be*=4,Be+=ce[7]&3,z.timeStamp=Be,P.pts===void 0&&P.dts===void 0&&(P.pts=z.timeStamp,P.dts=z.timeStamp),this.trigger("timestamp",z)}P.frames.push(z),O+=10,O+=k}while(O<g);this.trigger("data",P)}}}},Ao.prototype=new Gv;var qv=Ao,Tu=t,xu=ut,ji=Nt,$v=ln.TimestampRolloverStream,Co,fa,Mo,Ys=188,Su=71;Co=function(){var c=new Uint8Array(Ys),f=0;Co.prototype.init.call(this),this.push=function(g){var p=0,T=Ys,S;for(f?(S=new Uint8Array(g.byteLength+f),S.set(c.subarray(0,f)),S.set(g,f),f=0):S=g;T<S.byteLength;){if(S[p]===Su&&S[T]===Su){this.trigger("data",S.subarray(p,T)),p+=Ys,T+=Ys;continue}p++,T++}p<S.byteLength&&(c.set(S.subarray(p),0),f=S.byteLength-p)},this.flush=function(){f===Ys&&c[0]===Su&&(this.trigger("data",c),f=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){f=0,this.trigger("reset")}},Co.prototype=new Tu,fa=function(){var c,f,g,p;fa.prototype.init.call(this),p=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,c=function(T,S){var D=0;S.payloadUnitStartIndicator&&(D+=T[D]+1),S.type==="pat"?f(T.subarray(D),S):g(T.subarray(D),S)},f=function(T,S){S.section_number=T[7],S.last_section_number=T[8],p.pmtPid=(T[10]&31)<<8|T[11],S.pmtPid=p.pmtPid},g=function(T,S){var D,P,O,k;if(T[5]&1){for(p.programMapTable={video:null,audio:null,"timed-metadata":{}},D=(T[1]&15)<<8|T[2],P=3+D-4,O=(T[10]&15)<<8|T[11],k=12+O;k<P;){var z=T[k],K=(T[k+1]&31)<<8|T[k+2];z===ji.H264_STREAM_TYPE&&p.programMapTable.video===null?p.programMapTable.video=K:z===ji.ADTS_STREAM_TYPE&&p.programMapTable.audio===null?p.programMapTable.audio=K:z===ji.METADATA_STREAM_TYPE&&(p.programMapTable["timed-metadata"][K]=z),k+=((T[k+3]&15)<<8|T[k+4])+5}S.programMapTable=p.programMapTable}},this.push=function(T){var S={},D=4;if(S.payloadUnitStartIndicator=!!(T[1]&64),S.pid=T[1]&31,S.pid<<=8,S.pid|=T[2],(T[3]&48)>>>4>1&&(D+=T[D]+1),S.pid===0)S.type="pat",c(T.subarray(D),S),this.trigger("data",S);else if(S.pid===this.pmtPid)for(S.type="pmt",c(T.subarray(D),S),this.trigger("data",S);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else this.programMapTable===void 0?this.packetsWaitingForPmt.push([T,D,S]):this.processPes_(T,D,S)},this.processPes_=function(T,S,D){D.pid===this.programMapTable.video?D.streamType=ji.H264_STREAM_TYPE:D.pid===this.programMapTable.audio?D.streamType=ji.ADTS_STREAM_TYPE:D.streamType=this.programMapTable["timed-metadata"][D.pid],D.type="pes",D.data=T.subarray(S),this.trigger("data",D)}},fa.prototype=new Tu,fa.STREAM_TYPES={h264:27,adts:15},Mo=function(){var c=this,f=!1,g={data:[],size:0},p={data:[],size:0},T={data:[],size:0},S,D=function(O,k){var z;const K=O[0]<<16|O[1]<<8|O[2];k.data=new Uint8Array,K===1&&(k.packetLength=6+(O[4]<<8|O[5]),k.dataAlignmentIndicator=(O[6]&4)!==0,z=O[7],z&192&&(k.pts=(O[9]&14)<<27|(O[10]&255)<<20|(O[11]&254)<<12|(O[12]&255)<<5|(O[13]&254)>>>3,k.pts*=4,k.pts+=(O[13]&6)>>>1,k.dts=k.pts,z&64&&(k.dts=(O[14]&14)<<27|(O[15]&255)<<20|(O[16]&254)<<12|(O[17]&255)<<5|(O[18]&254)>>>3,k.dts*=4,k.dts+=(O[18]&6)>>>1)),k.data=O.subarray(9+O[8]))},P=function(O,k,z){var K=new Uint8Array(O.size),Ee={type:k},ce=0,Be=0,je=!1,Gt;if(!(!O.data.length||O.size<9)){for(Ee.trackId=O.data[0].pid,ce=0;ce<O.data.length;ce++)Gt=O.data[ce],K.set(Gt.data,Be),Be+=Gt.data.byteLength;D(K,Ee),je=k==="video"||Ee.packetLength<=O.size,(z||je)&&(O.size=0,O.data.length=0),je&&c.trigger("data",Ee)}};Mo.prototype.init.call(this),this.push=function(O){({pat:function(){},pes:function(){var k,z;switch(O.streamType){case ji.H264_STREAM_TYPE:k=g,z="video";break;case ji.ADTS_STREAM_TYPE:k=p,z="audio";break;case ji.METADATA_STREAM_TYPE:k=T,z="timed-metadata";break;default:return}O.payloadUnitStartIndicator&&P(k,z,!0),k.data.push(O),k.size+=O.data.byteLength},pmt:function(){var k={type:"metadata",tracks:[]};S=O.programMapTable,S.video!==null&&k.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+S.video,codec:"avc",type:"video"}),S.audio!==null&&k.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+S.audio,codec:"adts",type:"audio"}),f=!0,c.trigger("data",k)}})[O.type]()},this.reset=function(){g.size=0,g.data.length=0,p.size=0,p.data.length=0,this.trigger("reset")},this.flushStreams_=function(){P(g,"video"),P(p,"audio"),P(T,"timed-metadata")},this.flush=function(){if(!f&&S){var O={type:"metadata",tracks:[]};S.video!==null&&O.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+S.video,codec:"avc",type:"video"}),S.audio!==null&&O.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+S.audio,codec:"adts",type:"audio"}),c.trigger("data",O)}f=!1,this.flushStreams_(),this.trigger("done")}},Mo.prototype=new Tu;var Md={PAT_PID:0,MP2T_PACKET_LENGTH:Ys,TransportPacketStream:Co,TransportParseStream:fa,ElementaryStream:Mo,TimestampRolloverStream:$v,CaptionStream:xu.CaptionStream,Cea608Stream:xu.Cea608Stream,Cea708Stream:xu.Cea708Stream,MetadataStream:qv};for(var bu in ji)ji.hasOwnProperty(bu)&&(Md[bu]=ji[bu]);var jv=Md,Xv=t,Kv=ye.ONE_SECOND_IN_TS,wo,wd=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];wo=function(c){var f,g=0;wo.prototype.init.call(this),this.skipWarn_=function(p,T){this.trigger("log",{level:"warn",message:`adts skiping bytes ${p} to ${T} in frame ${g} outside syncword`})},this.push=function(p){var T=0,S,D,P,O,k;if(c||(g=0),p.type==="audio"){f&&f.length?(P=f,f=new Uint8Array(P.byteLength+p.data.byteLength),f.set(P),f.set(p.data,P.byteLength)):f=p.data;for(var z;T+7<f.length;){if(f[T]!==255||(f[T+1]&246)!==240){typeof z!="number"&&(z=T),T++;continue}if(typeof z=="number"&&(this.skipWarn_(z,T),z=null),D=(~f[T+1]&1)*2,S=(f[T+3]&3)<<11|f[T+4]<<3|(f[T+5]&224)>>5,O=((f[T+6]&3)+1)*1024,k=O*Kv/wd[(f[T+2]&60)>>>2],f.byteLength-T<S)break;this.trigger("data",{pts:p.pts+g*k,dts:p.dts+g*k,sampleCount:O,audioobjecttype:(f[T+2]>>>6&3)+1,channelcount:(f[T+2]&1)<<2|(f[T+3]&192)>>>6,samplerate:wd[(f[T+2]&60)>>>2],samplingfrequencyindex:(f[T+2]&60)>>>2,samplesize:16,data:f.subarray(T+7+D,T+S)}),g++,T+=S}typeof z=="number"&&(this.skipWarn_(z,T),z=null),f=f.subarray(T)}},this.flush=function(){g=0,this.trigger("done")},this.reset=function(){f=void 0,this.trigger("reset")},this.endTimeline=function(){f=void 0,this.trigger("endedtimeline")}},wo.prototype=new Xv;var Yv=wo,Dd;Dd=function(c){var f=c.byteLength,g=0,p=0;this.length=function(){return 8*f},this.bitsAvailable=function(){return 8*f+p},this.loadWord=function(){var T=c.byteLength-f,S=new Uint8Array(4),D=Math.min(4,f);if(D===0)throw new Error("no bytes available");S.set(c.subarray(T,T+D)),g=new DataView(S.buffer).getUint32(0),p=D*8,f-=D},this.skipBits=function(T){var S;p>T?(g<<=T,p-=T):(T-=p,S=Math.floor(T/8),T-=S*8,f-=S,this.loadWord(),g<<=T,p-=T)},this.readBits=function(T){var S=Math.min(p,T),D=g>>>32-S;return p-=S,p>0?g<<=S:f>0&&this.loadWord(),S=T-S,S>0?D<<S|this.readBits(S):D},this.skipLeadingZeros=function(){var T;for(T=0;T<p;++T)if(g&2147483648>>>T)return g<<=T,p-=T,T;return this.loadWord(),T+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var T=this.skipLeadingZeros();return this.readBits(T+1)-1},this.readExpGolomb=function(){var T=this.readUnsignedExpGolomb();return 1&T?1+T>>>1:-1*(T>>>1)},this.readBoolean=function(){return this.readBits(1)===1},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};var Qv=Dd,Rd=t,Zv=Qv,Do,pa,Pd;pa=function(){var c=0,f,g;pa.prototype.init.call(this),this.push=function(p){var T;g?(T=new Uint8Array(g.byteLength+p.data.byteLength),T.set(g),T.set(p.data,g.byteLength),g=T):g=p.data;for(var S=g.byteLength;c<S-3;c++)if(g[c+2]===1){f=c+5;break}for(;f<S;)switch(g[f]){case 0:if(g[f-1]!==0){f+=2;break}else if(g[f-2]!==0){f++;break}c+3!==f-2&&this.trigger("data",g.subarray(c+3,f-2));do f++;while(g[f]!==1&&f<S);c=f-2,f+=3;break;case 1:if(g[f-1]!==0||g[f-2]!==0){f+=3;break}this.trigger("data",g.subarray(c+3,f-2)),c=f-2,f+=3;break;default:f+=3;break}g=g.subarray(c),f-=c,c=0},this.reset=function(){g=null,c=0,this.trigger("reset")},this.flush=function(){g&&g.byteLength>3&&this.trigger("data",g.subarray(c+3)),g=null,c=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}},pa.prototype=new Rd,Pd={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},Do=function(){var c=new pa,f,g,p,T,S,D,P;Do.prototype.init.call(this),f=this,this.push=function(O){O.type==="video"&&(g=O.trackId,p=O.pts,T=O.dts,c.push(O))},c.on("data",function(O){var k={trackId:g,pts:p,dts:T,data:O,nalUnitTypeCode:O[0]&31};switch(k.nalUnitTypeCode){case 5:k.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:k.nalUnitType="sei_rbsp",k.escapedRBSP=S(O.subarray(1));break;case 7:k.nalUnitType="seq_parameter_set_rbsp",k.escapedRBSP=S(O.subarray(1)),k.config=D(k.escapedRBSP);break;case 8:k.nalUnitType="pic_parameter_set_rbsp";break;case 9:k.nalUnitType="access_unit_delimiter_rbsp";break}f.trigger("data",k)}),c.on("done",function(){f.trigger("done")}),c.on("partialdone",function(){f.trigger("partialdone")}),c.on("reset",function(){f.trigger("reset")}),c.on("endedtimeline",function(){f.trigger("endedtimeline")}),this.flush=function(){c.flush()},this.partialFlush=function(){c.partialFlush()},this.reset=function(){c.reset()},this.endTimeline=function(){c.endTimeline()},P=function(O,k){var z=8,K=8,Ee,ce;for(Ee=0;Ee<O;Ee++)K!==0&&(ce=k.readExpGolomb(),K=(z+ce+256)%256),z=K===0?z:K},S=function(O){for(var k=O.byteLength,z=[],K=1,Ee,ce;K<k-2;)O[K]===0&&O[K+1]===0&&O[K+2]===3?(z.push(K+2),K+=2):K++;if(z.length===0)return O;Ee=k-z.length,ce=new Uint8Array(Ee);var Be=0;for(K=0;K<Ee;Be++,K++)Be===z[0]&&(Be++,z.shift()),ce[K]=O[Be];return ce},D=function(O){var k=0,z=0,K=0,Ee=0,ce,Be,je,Gt,Fi,xs,af,of,lf,Ou,uf,Lt=[1,1],cf,Ss;if(ce=new Zv(O),Be=ce.readUnsignedByte(),Gt=ce.readUnsignedByte(),je=ce.readUnsignedByte(),ce.skipUnsignedExpGolomb(),Pd[Be]&&(Fi=ce.readUnsignedExpGolomb(),Fi===3&&ce.skipBits(1),ce.skipUnsignedExpGolomb(),ce.skipUnsignedExpGolomb(),ce.skipBits(1),ce.readBoolean()))for(uf=Fi!==3?8:12,Ss=0;Ss<uf;Ss++)ce.readBoolean()&&(Ss<6?P(16,ce):P(64,ce));if(ce.skipUnsignedExpGolomb(),xs=ce.readUnsignedExpGolomb(),xs===0)ce.readUnsignedExpGolomb();else if(xs===1)for(ce.skipBits(1),ce.skipExpGolomb(),ce.skipExpGolomb(),af=ce.readUnsignedExpGolomb(),Ss=0;Ss<af;Ss++)ce.skipExpGolomb();if(ce.skipUnsignedExpGolomb(),ce.skipBits(1),of=ce.readUnsignedExpGolomb(),lf=ce.readUnsignedExpGolomb(),Ou=ce.readBits(1),Ou===0&&ce.skipBits(1),ce.skipBits(1),ce.readBoolean()&&(k=ce.readUnsignedExpGolomb(),z=ce.readUnsignedExpGolomb(),K=ce.readUnsignedExpGolomb(),Ee=ce.readUnsignedExpGolomb()),ce.readBoolean()&&ce.readBoolean()){switch(cf=ce.readUnsignedByte(),cf){case 1:Lt=[1,1];break;case 2:Lt=[12,11];break;case 3:Lt=[10,11];break;case 4:Lt=[16,11];break;case 5:Lt=[40,33];break;case 6:Lt=[24,11];break;case 7:Lt=[20,11];break;case 8:Lt=[32,11];break;case 9:Lt=[80,33];break;case 10:Lt=[18,11];break;case 11:Lt=[15,11];break;case 12:Lt=[64,33];break;case 13:Lt=[160,99];break;case 14:Lt=[4,3];break;case 15:Lt=[3,2];break;case 16:Lt=[2,1];break;case 255:{Lt=[ce.readUnsignedByte()<<8|ce.readUnsignedByte(),ce.readUnsignedByte()<<8|ce.readUnsignedByte()];break}}Lt&&Lt[0]/Lt[1]}return{profileIdc:Be,levelIdc:je,profileCompatibility:Gt,width:(of+1)*16-k*2-z*2,height:(2-Ou)*(lf+1)*16-K*2-Ee*2,sarRatio:Lt}}},Do.prototype=new Rd;var Jv={H264Stream:Do,NalByteStream:pa},ey=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Ld=function(c,f){var g=c[f+6]<<21|c[f+7]<<14|c[f+8]<<7|c[f+9],p=c[f+5],T=(p&16)>>4;return g=g>=0?g:0,T?g+20:g+10},Id=function(c,f){return c.length-f<10||c[f]!=="I".charCodeAt(0)||c[f+1]!=="D".charCodeAt(0)||c[f+2]!=="3".charCodeAt(0)?f:(f+=Ld(c,f),Id(c,f))},ty=function(c){var f=Id(c,0);return c.length>=f+2&&(c[f]&255)===255&&(c[f+1]&240)===240&&(c[f+1]&22)===16},Od=function(c){return c[0]<<21|c[1]<<14|c[2]<<7|c[3]},iy=function(c,f,g){var p,T="";for(p=f;p<g;p++)T+="%"+("00"+c[p].toString(16)).slice(-2);return T},ny=function(c,f,g){return unescape(iy(c,f,g))},sy=function(c,f){var g=(c[f+5]&224)>>5,p=c[f+4]<<3,T=c[f+3]&3<<11;return T|p|g},ry=function(c,f){return c[f]==="I".charCodeAt(0)&&c[f+1]==="D".charCodeAt(0)&&c[f+2]==="3".charCodeAt(0)?"timed-metadata":c[f]&!0&&(c[f+1]&240)===240?"audio":null},ay=function(c){for(var f=0;f+5<c.length;){if(c[f]!==255||(c[f+1]&246)!==240){f++;continue}return ey[(c[f+2]&60)>>>2]}return null},oy=function(c){var f,g,p,T;f=10,c[5]&64&&(f+=4,f+=Od(c.subarray(10,14)));do{if(g=Od(c.subarray(f+4,f+8)),g<1)return null;if(T=String.fromCharCode(c[f],c[f+1],c[f+2],c[f+3]),T==="PRIV"){p=c.subarray(f+10,f+g+10);for(var S=0;S<p.byteLength;S++)if(p[S]===0){var D=ny(p,0,S);if(D==="com.apple.streaming.transportStreamTimestamp"){var P=p.subarray(S+1),O=(P[3]&1)<<30|P[4]<<22|P[5]<<14|P[6]<<6|P[7]>>>2;return O*=4,O+=P[7]&3,O}break}}f+=10,f+=g}while(f<c.byteLength);return null},Eu={isLikelyAacData:ty,parseId3TagSize:Ld,parseAdtsSize:sy,parseType:ry,parseSampleRate:ay,parseAacTimestamp:oy},ly=t,Ud=Eu,Ro;Ro=function(){var c=new Uint8Array,f=0;Ro.prototype.init.call(this),this.setTimestamp=function(g){f=g},this.push=function(g){var p=0,T=0,S,D,P,O;for(c.length?(O=c.length,c=new Uint8Array(g.byteLength+O),c.set(c.subarray(0,O)),c.set(g,O)):c=g;c.length-T>=3;){if(c[T]==="I".charCodeAt(0)&&c[T+1]==="D".charCodeAt(0)&&c[T+2]==="3".charCodeAt(0)){if(c.length-T<10||(p=Ud.parseId3TagSize(c,T),T+p>c.length))break;D={type:"timed-metadata",data:c.subarray(T,T+p)},this.trigger("data",D),T+=p;continue}else if((c[T]&255)===255&&(c[T+1]&240)===240){if(c.length-T<7||(p=Ud.parseAdtsSize(c,T),T+p>c.length))break;P={type:"audio",data:c.subarray(T,T+p),pts:f,dts:f},this.trigger("data",P),T+=p;continue}T++}S=c.length-T,S>0?c=c.subarray(T):c=new Uint8Array},this.reset=function(){c=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){c=new Uint8Array,this.trigger("endedtimeline")}},Ro.prototype=new ly;var uy=Ro,cy=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],hy=cy,dy=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],fy=dy,Po=t,ma=G,ga=Ut,Lo=ne,Xi=ft,Ln=jv,Io=ye,Nd=Yv,py=Jv.H264Stream,my=uy,gy=Eu.isLikelyAacData,_y=ye.ONE_SECOND_IN_TS,Au=hy,Cu=fy,_a,Qs,Oo,ys,vy=function(c,f){f.stream=c,this.trigger("log",f)},kd=function(c,f){for(var g=Object.keys(f),p=0;p<g.length;p++){var T=g[p];T==="headOfPipeline"||!f[T].on||f[T].on("log",vy.bind(c,T))}},Fd=function(c,f){var g;if(c.length!==f.length)return!1;for(g=0;g<c.length;g++)if(c[g]!==f[g])return!1;return!0},Mu=function(c,f,g,p,T,S){var D=g-f,P=p-f,O=T-g;return{start:{dts:c,pts:c+D},end:{dts:c+P,pts:c+O},prependedContentDuration:S,baseMediaDecodeTime:c}};Qs=function(c,f){var g=[],p,T=0,S=0,D=1/0;f=f||{},p=f.firstSequenceNumber||0,Qs.prototype.init.call(this),this.push=function(P){Xi.collectDtsInfo(c,P),c&&Au.forEach(function(O){c[O]=P[O]}),g.push(P)},this.setEarliestDts=function(P){T=P},this.setVideoBaseMediaDecodeTime=function(P){D=P},this.setAudioAppendStart=function(P){S=P},this.flush=function(){var P,O,k,z,K,Ee,ce;if(g.length===0){this.trigger("done","AudioSegmentStream");return}P=Lo.trimAdtsFramesByEarliestDts(g,c,T),c.baseMediaDecodeTime=Xi.calculateTrackBaseMediaDecodeTime(c,f.keepOriginalTimestamps),ce=Lo.prefixWithSilence(c,P,S,D),c.samples=Lo.generateSampleTable(P),k=ma.mdat(Lo.concatenateFrameData(P)),g=[],O=ma.moof(p,[c]),z=new Uint8Array(O.byteLength+k.byteLength),p++,z.set(O),z.set(k,O.byteLength),Xi.clearDtsInfo(c),K=Math.ceil(_y*1024/c.samplerate),P.length&&(Ee=P.length*K,this.trigger("segmentTimingInfo",Mu(Io.audioTsToVideoTs(c.baseMediaDecodeTime,c.samplerate),P[0].dts,P[0].pts,P[0].dts+Ee,P[0].pts+Ee,ce||0)),this.trigger("timingInfo",{start:P[0].pts,end:P[0].pts+Ee})),this.trigger("data",{track:c,boxes:z}),this.trigger("done","AudioSegmentStream")},this.reset=function(){Xi.clearDtsInfo(c),g=[],this.trigger("reset")}},Qs.prototype=new Po,_a=function(c,f){var g,p=[],T=[],S,D;f=f||{},g=f.firstSequenceNumber||0,_a.prototype.init.call(this),delete c.minPTS,this.gopCache_=[],this.push=function(P){Xi.collectDtsInfo(c,P),P.nalUnitType==="seq_parameter_set_rbsp"&&!S&&(S=P.config,c.sps=[P.data],Cu.forEach(function(O){c[O]=S[O]},this)),P.nalUnitType==="pic_parameter_set_rbsp"&&!D&&(D=P.data,c.pps=[P.data]),p.push(P)},this.flush=function(){for(var P,O,k,z,K,Ee,ce=0,Be,je;p.length&&p[0].nalUnitType!=="access_unit_delimiter_rbsp";)p.shift();if(p.length===0){this.resetStream_(),this.trigger("done","VideoSegmentStream");return}if(P=ga.groupNalsIntoFrames(p),k=ga.groupFramesIntoGops(P),k[0][0].keyFrame||(O=this.getGopForFusion_(p[0],c),O?(ce=O.duration,k.unshift(O),k.byteLength+=O.byteLength,k.nalCount+=O.nalCount,k.pts=O.pts,k.dts=O.dts,k.duration+=O.duration):k=ga.extendFirstKeyFrame(k)),T.length){var Gt;if(f.alignGopsAtEnd?Gt=this.alignGopsAtEnd_(k):Gt=this.alignGopsAtStart_(k),!Gt){this.gopCache_.unshift({gop:k.pop(),pps:c.pps,sps:c.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),p=[],this.resetStream_(),this.trigger("done","VideoSegmentStream");return}Xi.clearDtsInfo(c),k=Gt}Xi.collectDtsInfo(c,k),c.samples=ga.generateSampleTable(k),K=ma.mdat(ga.concatenateNalData(k)),c.baseMediaDecodeTime=Xi.calculateTrackBaseMediaDecodeTime(c,f.keepOriginalTimestamps),this.trigger("processedGopsInfo",k.map(function(Fi){return{pts:Fi.pts,dts:Fi.dts,byteLength:Fi.byteLength}})),Be=k[0],je=k[k.length-1],this.trigger("segmentTimingInfo",Mu(c.baseMediaDecodeTime,Be.dts,Be.pts,je.dts+je.duration,je.pts+je.duration,ce)),this.trigger("timingInfo",{start:k[0].pts,end:k[k.length-1].pts+k[k.length-1].duration}),this.gopCache_.unshift({gop:k.pop(),pps:c.pps,sps:c.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),p=[],this.trigger("baseMediaDecodeTime",c.baseMediaDecodeTime),this.trigger("timelineStartInfo",c.timelineStartInfo),z=ma.moof(g,[c]),Ee=new Uint8Array(z.byteLength+K.byteLength),g++,Ee.set(z),Ee.set(K,z.byteLength),this.trigger("data",{track:c,boxes:Ee}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),p=[],this.gopCache_.length=0,T.length=0,this.trigger("reset")},this.resetStream_=function(){Xi.clearDtsInfo(c),S=void 0,D=void 0},this.getGopForFusion_=function(P){var O=45e3,k=1e4,z=1/0,K,Ee,ce,Be,je;for(je=0;je<this.gopCache_.length;je++)Be=this.gopCache_[je],ce=Be.gop,!(!(c.pps&&Fd(c.pps[0],Be.pps[0]))||!(c.sps&&Fd(c.sps[0],Be.sps[0])))&&(ce.dts<c.timelineStartInfo.dts||(K=P.dts-ce.dts-ce.duration,K>=-k&&K<=O&&(!Ee||z>K)&&(Ee=Be,z=K)));return Ee?Ee.gop:null},this.alignGopsAtStart_=function(P){var O,k,z,K,Ee,ce,Be,je;for(Ee=P.byteLength,ce=P.nalCount,Be=P.duration,O=k=0;O<T.length&&k<P.length&&(z=T[O],K=P[k],z.pts!==K.pts);){if(K.pts>z.pts){O++;continue}k++,Ee-=K.byteLength,ce-=K.nalCount,Be-=K.duration}return k===0?P:k===P.length?null:(je=P.slice(k),je.byteLength=Ee,je.duration=Be,je.nalCount=ce,je.pts=je[0].pts,je.dts=je[0].dts,je)},this.alignGopsAtEnd_=function(P){var O,k,z,K,Ee,ce;for(O=T.length-1,k=P.length-1,Ee=null,ce=!1;O>=0&&k>=0;){if(z=T[O],K=P[k],z.pts===K.pts){ce=!0;break}if(z.pts>K.pts){O--;continue}O===T.length-1&&(Ee=k),k--}if(!ce&&Ee===null)return null;var Be;if(ce?Be=k:Be=Ee,Be===0)return P;var je=P.slice(Be),Gt=je.reduce(function(Fi,xs){return Fi.byteLength+=xs.byteLength,Fi.duration+=xs.duration,Fi.nalCount+=xs.nalCount,Fi},{byteLength:0,duration:0,nalCount:0});return je.byteLength=Gt.byteLength,je.duration=Gt.duration,je.nalCount=Gt.nalCount,je.pts=je[0].pts,je.dts=je[0].dts,je},this.alignGopsWith=function(P){T=P}},_a.prototype=new Po,ys=function(c,f){this.numberOfTracks=0,this.metadataStream=f,c=c||{},typeof c.remux<"u"?this.remuxTracks=!!c.remux:this.remuxTracks=!0,typeof c.keepOriginalTimestamps=="boolean"?this.keepOriginalTimestamps=c.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,ys.prototype.init.call(this),this.push=function(g){if(g.content||g.text)return this.pendingCaptions.push(g);if(g.frames)return this.pendingMetadata.push(g);this.pendingTracks.push(g.track),this.pendingBytes+=g.boxes.byteLength,g.track.type==="video"&&(this.videoTrack=g.track,this.pendingBoxes.push(g.boxes)),g.track.type==="audio"&&(this.audioTrack=g.track,this.pendingBoxes.unshift(g.boxes))}},ys.prototype=new Po,ys.prototype.flush=function(c){var f=0,g={captions:[],captionStreams:{},metadata:[],info:{}},p,T,S,D=0,P;if(this.pendingTracks.length<this.numberOfTracks){if(c!=="VideoSegmentStream"&&c!=="AudioSegmentStream")return;if(this.remuxTracks)return;if(this.pendingTracks.length===0){this.emittedTracks++,this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0);return}}if(this.videoTrack?(D=this.videoTrack.timelineStartInfo.pts,Cu.forEach(function(O){g.info[O]=this.videoTrack[O]},this)):this.audioTrack&&(D=this.audioTrack.timelineStartInfo.pts,Au.forEach(function(O){g.info[O]=this.audioTrack[O]},this)),this.videoTrack||this.audioTrack){for(this.pendingTracks.length===1?g.type=this.pendingTracks[0].type:g.type="combined",this.emittedTracks+=this.pendingTracks.length,S=ma.initSegment(this.pendingTracks),g.initSegment=new Uint8Array(S.byteLength),g.initSegment.set(S),g.data=new Uint8Array(this.pendingBytes),P=0;P<this.pendingBoxes.length;P++)g.data.set(this.pendingBoxes[P],f),f+=this.pendingBoxes[P].byteLength;for(P=0;P<this.pendingCaptions.length;P++)p=this.pendingCaptions[P],p.startTime=Io.metadataTsToSeconds(p.startPts,D,this.keepOriginalTimestamps),p.endTime=Io.metadataTsToSeconds(p.endPts,D,this.keepOriginalTimestamps),g.captionStreams[p.stream]=!0,g.captions.push(p);for(P=0;P<this.pendingMetadata.length;P++)T=this.pendingMetadata[P],T.cueTime=Io.metadataTsToSeconds(T.pts,D,this.keepOriginalTimestamps),g.metadata.push(T);for(g.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",g),P=0;P<g.captions.length;P++)p=g.captions[P],this.trigger("caption",p);for(P=0;P<g.metadata.length;P++)T=g.metadata[P],this.trigger("id3Frame",T)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},ys.prototype.setRemux=function(c){this.remuxTracks=c},Oo=function(c){var f=this,g=!0,p,T;Oo.prototype.init.call(this),c=c||{},this.baseMediaDecodeTime=c.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var S={};this.transmuxPipeline_=S,S.type="aac",S.metadataStream=new Ln.MetadataStream,S.aacStream=new my,S.audioTimestampRolloverStream=new Ln.TimestampRolloverStream("audio"),S.timedMetadataTimestampRolloverStream=new Ln.TimestampRolloverStream("timed-metadata"),S.adtsStream=new Nd,S.coalesceStream=new ys(c,S.metadataStream),S.headOfPipeline=S.aacStream,S.aacStream.pipe(S.audioTimestampRolloverStream).pipe(S.adtsStream),S.aacStream.pipe(S.timedMetadataTimestampRolloverStream).pipe(S.metadataStream).pipe(S.coalesceStream),S.metadataStream.on("timestamp",function(D){S.aacStream.setTimestamp(D.timeStamp)}),S.aacStream.on("data",function(D){D.type!=="timed-metadata"&&D.type!=="audio"||S.audioSegmentStream||(T=T||{timelineStartInfo:{baseMediaDecodeTime:f.baseMediaDecodeTime},codec:"adts",type:"audio"},S.coalesceStream.numberOfTracks++,S.audioSegmentStream=new Qs(T,c),S.audioSegmentStream.on("log",f.getLogTrigger_("audioSegmentStream")),S.audioSegmentStream.on("timingInfo",f.trigger.bind(f,"audioTimingInfo")),S.adtsStream.pipe(S.audioSegmentStream).pipe(S.coalesceStream),f.trigger("trackinfo",{hasAudio:!!T,hasVideo:!!p}))}),S.coalesceStream.on("data",this.trigger.bind(this,"data")),S.coalesceStream.on("done",this.trigger.bind(this,"done")),kd(this,S)},this.setupTsPipeline=function(){var S={};this.transmuxPipeline_=S,S.type="ts",S.metadataStream=new Ln.MetadataStream,S.packetStream=new Ln.TransportPacketStream,S.parseStream=new Ln.TransportParseStream,S.elementaryStream=new Ln.ElementaryStream,S.timestampRolloverStream=new Ln.TimestampRolloverStream,S.adtsStream=new Nd,S.h264Stream=new py,S.captionStream=new Ln.CaptionStream(c),S.coalesceStream=new ys(c,S.metadataStream),S.headOfPipeline=S.packetStream,S.packetStream.pipe(S.parseStream).pipe(S.elementaryStream).pipe(S.timestampRolloverStream),S.timestampRolloverStream.pipe(S.h264Stream),S.timestampRolloverStream.pipe(S.adtsStream),S.timestampRolloverStream.pipe(S.metadataStream).pipe(S.coalesceStream),S.h264Stream.pipe(S.captionStream).pipe(S.coalesceStream),S.elementaryStream.on("data",function(D){var P;if(D.type==="metadata"){for(P=D.tracks.length;P--;)!p&&D.tracks[P].type==="video"?(p=D.tracks[P],p.timelineStartInfo.baseMediaDecodeTime=f.baseMediaDecodeTime):!T&&D.tracks[P].type==="audio"&&(T=D.tracks[P],T.timelineStartInfo.baseMediaDecodeTime=f.baseMediaDecodeTime);p&&!S.videoSegmentStream&&(S.coalesceStream.numberOfTracks++,S.videoSegmentStream=new _a(p,c),S.videoSegmentStream.on("log",f.getLogTrigger_("videoSegmentStream")),S.videoSegmentStream.on("timelineStartInfo",function(O){T&&!c.keepOriginalTimestamps&&(T.timelineStartInfo=O,S.audioSegmentStream.setEarliestDts(O.dts-f.baseMediaDecodeTime))}),S.videoSegmentStream.on("processedGopsInfo",f.trigger.bind(f,"gopInfo")),S.videoSegmentStream.on("segmentTimingInfo",f.trigger.bind(f,"videoSegmentTimingInfo")),S.videoSegmentStream.on("baseMediaDecodeTime",function(O){T&&S.audioSegmentStream.setVideoBaseMediaDecodeTime(O)}),S.videoSegmentStream.on("timingInfo",f.trigger.bind(f,"videoTimingInfo")),S.h264Stream.pipe(S.videoSegmentStream).pipe(S.coalesceStream)),T&&!S.audioSegmentStream&&(S.coalesceStream.numberOfTracks++,S.audioSegmentStream=new Qs(T,c),S.audioSegmentStream.on("log",f.getLogTrigger_("audioSegmentStream")),S.audioSegmentStream.on("timingInfo",f.trigger.bind(f,"audioTimingInfo")),S.audioSegmentStream.on("segmentTimingInfo",f.trigger.bind(f,"audioSegmentTimingInfo")),S.adtsStream.pipe(S.audioSegmentStream).pipe(S.coalesceStream)),f.trigger("trackinfo",{hasAudio:!!T,hasVideo:!!p})}}),S.coalesceStream.on("data",this.trigger.bind(this,"data")),S.coalesceStream.on("id3Frame",function(D){D.dispatchType=S.metadataStream.dispatchType,f.trigger("id3Frame",D)}),S.coalesceStream.on("caption",this.trigger.bind(this,"caption")),S.coalesceStream.on("done",this.trigger.bind(this,"done")),kd(this,S)},this.setBaseMediaDecodeTime=function(S){var D=this.transmuxPipeline_;c.keepOriginalTimestamps||(this.baseMediaDecodeTime=S),T&&(T.timelineStartInfo.dts=void 0,T.timelineStartInfo.pts=void 0,Xi.clearDtsInfo(T),D.audioTimestampRolloverStream&&D.audioTimestampRolloverStream.discontinuity()),p&&(D.videoSegmentStream&&(D.videoSegmentStream.gopCache_=[]),p.timelineStartInfo.dts=void 0,p.timelineStartInfo.pts=void 0,Xi.clearDtsInfo(p),D.captionStream.reset()),D.timestampRolloverStream&&D.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(S){T&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(S)},this.setRemux=function(S){var D=this.transmuxPipeline_;c.remux=S,D&&D.coalesceStream&&D.coalesceStream.setRemux(S)},this.alignGopsWith=function(S){p&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(S)},this.getLogTrigger_=function(S){var D=this;return function(P){P.stream=S,D.trigger("log",P)}},this.push=function(S){if(g){var D=gy(S);D&&this.transmuxPipeline_.type!=="aac"?this.setupAacPipeline():!D&&this.transmuxPipeline_.type!=="ts"&&this.setupTsPipeline(),g=!1}this.transmuxPipeline_.headOfPipeline.push(S)},this.flush=function(){g=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}},Oo.prototype=new Po;var yy={Transmuxer:Oo,VideoSegmentStream:_a,AudioSegmentStream:Qs,AUDIO_PROPERTIES:Au,VIDEO_PROPERTIES:Cu,generateSegmentTimingInfo:Mu},Ty=function(c){return c>>>0},xy=function(c){return("00"+c.toString(16)).slice(-2)},Uo={toUnsigned:Ty,toHexString:xy},Sy=function(c){var f="";return f+=String.fromCharCode(c[0]),f+=String.fromCharCode(c[1]),f+=String.fromCharCode(c[2]),f+=String.fromCharCode(c[3]),f},Bd=Sy,by=Uo.toUnsigned,Ey=Bd,Hd=function(c,f){var g=[],p,T,S,D,P;if(!f.length)return null;for(p=0;p<c.byteLength;)T=by(c[p]<<24|c[p+1]<<16|c[p+2]<<8|c[p+3]),S=Ey(c.subarray(p+4,p+8)),D=T>1?p+T:c.byteLength,S===f[0]&&(f.length===1?g.push(c.subarray(p+8,D)):(P=Hd(c.subarray(p+8,D),f.slice(1)),P.length&&(g=g.concat(P)))),p=D;return g},Vd=Hd,Ay=Uo.toUnsigned,Cy=r.getUint64,My=function(c){var f={version:c[0],flags:new Uint8Array(c.subarray(1,4))};return f.version===1?f.baseMediaDecodeTime=Cy(c.subarray(4)):f.baseMediaDecodeTime=Ay(c[4]<<24|c[5]<<16|c[6]<<8|c[7]),f},zd=My,wy=function(c){return{isLeading:(c[0]&12)>>>2,dependsOn:c[0]&3,isDependedOn:(c[1]&192)>>>6,hasRedundancy:(c[1]&48)>>>4,paddingValue:(c[1]&14)>>>1,isNonSyncSample:c[1]&1,degradationPriority:c[2]<<8|c[3]}},Dy=wy,Gd=Dy,Ry=function(c){var f={version:c[0],flags:new Uint8Array(c.subarray(1,4)),samples:[]},g=new DataView(c.buffer,c.byteOffset,c.byteLength),p=f.flags[2]&1,T=f.flags[2]&4,S=f.flags[1]&1,D=f.flags[1]&2,P=f.flags[1]&4,O=f.flags[1]&8,k=g.getUint32(4),z=8,K;for(p&&(f.dataOffset=g.getInt32(z),z+=4),T&&k&&(K={flags:Gd(c.subarray(z,z+4))},z+=4,S&&(K.duration=g.getUint32(z),z+=4),D&&(K.size=g.getUint32(z),z+=4),O&&(f.version===1?K.compositionTimeOffset=g.getInt32(z):K.compositionTimeOffset=g.getUint32(z),z+=4),f.samples.push(K),k--);k--;)K={},S&&(K.duration=g.getUint32(z),z+=4),D&&(K.size=g.getUint32(z),z+=4),P&&(K.flags=Gd(c.subarray(z,z+4)),z+=4),O&&(f.version===1?K.compositionTimeOffset=g.getInt32(z):K.compositionTimeOffset=g.getUint32(z),z+=4),f.samples.push(K);return f},Wd=Ry,Py=function(c){var f=new DataView(c.buffer,c.byteOffset,c.byteLength),g={version:c[0],flags:new Uint8Array(c.subarray(1,4)),trackId:f.getUint32(4)},p=g.flags[2]&1,T=g.flags[2]&2,S=g.flags[2]&8,D=g.flags[2]&16,P=g.flags[2]&32,O=g.flags[0]&65536,k=g.flags[0]&131072,z;return z=8,p&&(z+=4,g.baseDataOffset=f.getUint32(12),z+=4),T&&(g.sampleDescriptionIndex=f.getUint32(z),z+=4),S&&(g.defaultSampleDuration=f.getUint32(z),z+=4),D&&(g.defaultSampleSize=f.getUint32(z),z+=4),P&&(g.defaultSampleFlags=f.getUint32(z)),O&&(g.durationIsEmpty=!0),!p&&k&&(g.baseDataOffsetIsMoof=!0),g},qd=Py,va;typeof window<"u"?va=window:typeof i<"u"?va=i:typeof self<"u"?va=self:va={};var $d=va,Ly=ha.discardEmulationPreventionBytes,Iy=ut.CaptionStream,ya=Vd,Oy=zd,Uy=Wd,Ny=qd,jd=$d,ky=function(c,f){for(var g=c,p=0;p<f.length;p++){var T=f[p];if(g<T.size)return T;g-=T.size}return null},Fy=function(c,f,g){var p=new DataView(c.buffer,c.byteOffset,c.byteLength),T={logs:[],seiNals:[]},S,D,P,O;for(D=0;D+4<c.length;D+=P)if(P=p.getUint32(D),D+=4,!(P<=0))switch(c[D]&31){case 6:var k=c.subarray(D+1,D+1+P),z=ky(D,f);if(S={nalUnitType:"sei_rbsp",size:P,data:k,escapedRBSP:Ly(k),trackId:g},z)S.pts=z.pts,S.dts=z.dts,O=z;else if(O)S.pts=O.pts,S.dts=O.dts;else{T.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+D+" for trackId "+g+". See mux.js#223."});break}T.seiNals.push(S);break}return T},By=function(c,f,g){var p=f,T=g.defaultSampleDuration||0,S=g.defaultSampleSize||0,D=g.trackId,P=[];return c.forEach(function(O){var k=Uy(O),z=k.samples;z.forEach(function(K){K.duration===void 0&&(K.duration=T),K.size===void 0&&(K.size=S),K.trackId=D,K.dts=p,K.compositionTimeOffset===void 0&&(K.compositionTimeOffset=0),typeof p=="bigint"?(K.pts=p+jd.BigInt(K.compositionTimeOffset),p+=jd.BigInt(K.duration)):(K.pts=p+K.compositionTimeOffset,p+=K.duration)}),P=P.concat(z)}),P},Hy=function(c,f){var g=ya(c,["moof","traf"]),p=ya(c,["mdat"]),T={},S=[];return p.forEach(function(D,P){var O=g[P];S.push({mdat:D,traf:O})}),S.forEach(function(D){var P=D.mdat,O=D.traf,k=ya(O,["tfhd"]),z=Ny(k[0]),K=z.trackId,Ee=ya(O,["tfdt"]),ce=Ee.length>0?Oy(Ee[0]).baseMediaDecodeTime:0,Be=ya(O,["trun"]),je,Gt;f===K&&Be.length>0&&(je=By(Be,ce,z),Gt=Fy(P,je,K),T[K]||(T[K]={seiNals:[],logs:[]}),T[K].seiNals=T[K].seiNals.concat(Gt.seiNals),T[K].logs=T[K].logs.concat(Gt.logs))}),T},Vy=function(c,f,g){var p;if(f===null)return null;p=Hy(c,f);var T=p[f]||{};return{seiNals:T.seiNals,logs:T.logs,timescale:g}},zy=function(){var c=!1,f,g,p,T,S,D;this.isInitialized=function(){return c},this.init=function(P){f=new Iy,c=!0,D=P?P.isPartial:!1,f.on("data",function(O){O.startTime=O.startPts/T,O.endTime=O.endPts/T,S.captions.push(O),S.captionStreams[O.stream]=!0}),f.on("log",function(O){S.logs.push(O)})},this.isNewInit=function(P,O){return P&&P.length===0||O&&typeof O=="object"&&Object.keys(O).length===0?!1:p!==P[0]||T!==O[p]},this.parse=function(P,O,k){var z;if(this.isInitialized()){if(!O||!k)return null;if(this.isNewInit(O,k))p=O[0],T=k[p];else if(p===null||!T)return g.push(P),null}else return null;for(;g.length>0;){var K=g.shift();this.parse(K,O,k)}return z=Vy(P,p,T),z&&z.logs&&(S.logs=S.logs.concat(z.logs)),z===null||!z.seiNals?S.logs.length?{logs:S.logs,captions:[],captionStreams:[]}:null:(this.pushNals(z.seiNals),this.flushStream(),S)},this.pushNals=function(P){if(!this.isInitialized()||!P||P.length===0)return null;P.forEach(function(O){f.push(O)})},this.flushStream=function(){if(!this.isInitialized())return null;D?f.partialFlush():f.flush()},this.clearParsedCaptions=function(){S.captions=[],S.captionStreams={},S.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;f.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){g=[],p=null,T=null,S?this.clearParsedCaptions():S={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},Gy=zy,Wy=function(c){for(var f=0,g=String.fromCharCode(c[f]),p="";g!=="\0";)p+=g,f++,g=String.fromCharCode(c[f]);return p+=g,p},qy={uint8ToCString:Wy},No=qy.uint8ToCString,$y=r.getUint64,jy=function(c){var f=4,g=c[0],p,T,S,D,P,O,k,z;if(g===0){p=No(c.subarray(f)),f+=p.length,T=No(c.subarray(f)),f+=T.length;var K=new DataView(c.buffer);S=K.getUint32(f),f+=4,P=K.getUint32(f),f+=4,O=K.getUint32(f),f+=4,k=K.getUint32(f),f+=4}else if(g===1){var K=new DataView(c.buffer);S=K.getUint32(f),f+=4,D=$y(c.subarray(f)),f+=8,O=K.getUint32(f),f+=4,k=K.getUint32(f),f+=4,p=No(c.subarray(f)),f+=p.length,T=No(c.subarray(f)),f+=T.length}z=new Uint8Array(c.subarray(f,c.byteLength));var Ee={scheme_id_uri:p,value:T,timescale:S||1,presentation_time:D,presentation_time_delta:P,event_duration:O,id:k,message_data:z};return Ky(g,Ee)?Ee:void 0},Xy=function(c,f,g,p){return c||c===0?c/f:p+g/f},Ky=function(c,f){var g=f.scheme_id_uri!=="\0",p=c===0&&Xd(f.presentation_time_delta)&&g,T=c===1&&Xd(f.presentation_time)&&g;return!(c>1)&&p||T},Xd=function(c){return c!==void 0||c!==null},Yy={parseEmsgBox:jy,scaleTime:Xy},ko=Uo.toUnsigned,Ta=Uo.toHexString,Pt=Vd,Zs=Bd,wu=Yy,Qy=qd,Zy=Wd,Jy=zd,eT=r.getUint64,Kd,Yd,Qd,Zd,Jd,Du,ef,Ru=$d,tT=Cd.parseId3Frames;Kd=function(c){var f={},g=Pt(c,["moov","trak"]);return g.reduce(function(p,T){var S,D,P,O,k;return S=Pt(T,["tkhd"])[0],!S||(D=S[0],P=D===0?12:20,O=ko(S[P]<<24|S[P+1]<<16|S[P+2]<<8|S[P+3]),k=Pt(T,["mdia","mdhd"])[0],!k)?null:(D=k[0],P=D===0?12:20,p[O]=ko(k[P]<<24|k[P+1]<<16|k[P+2]<<8|k[P+3]),p)},f)},Yd=function(c,f){var g;g=Pt(f,["moof","traf"]);var p=g.reduce(function(T,S){var D=Pt(S,["tfhd"])[0],P=ko(D[4]<<24|D[5]<<16|D[6]<<8|D[7]),O=c[P]||9e4,k=Pt(S,["tfdt"])[0],z=new DataView(k.buffer,k.byteOffset,k.byteLength),K;k[0]===1?K=eT(k.subarray(4,12)):K=z.getUint32(4);let Ee;return typeof K=="bigint"?Ee=K/Ru.BigInt(O):typeof K=="number"&&!isNaN(K)&&(Ee=K/O),Ee<Number.MAX_SAFE_INTEGER&&(Ee=Number(Ee)),Ee<T&&(T=Ee),T},1/0);return typeof p=="bigint"||isFinite(p)?p:0},Qd=function(c,f){var g=Pt(f,["moof","traf"]),p=0,T=0,S;if(g&&g.length){var D=Pt(g[0],["tfhd"])[0],P=Pt(g[0],["trun"])[0],O=Pt(g[0],["tfdt"])[0];if(D){var k=Qy(D);S=k.trackId}if(O){var z=Jy(O);p=z.baseMediaDecodeTime}if(P){var K=Zy(P);K.samples&&K.samples.length&&(T=K.samples[0].compositionTimeOffset||0)}}var Ee=c[S]||9e4;typeof p=="bigint"&&(T=Ru.BigInt(T),Ee=Ru.BigInt(Ee));var ce=(p+T)/Ee;return typeof ce=="bigint"&&ce<Number.MAX_SAFE_INTEGER&&(ce=Number(ce)),ce},Zd=function(c){var f=Pt(c,["moov","trak"]),g=[];return f.forEach(function(p){var T=Pt(p,["mdia","hdlr"]),S=Pt(p,["tkhd"]);T.forEach(function(D,P){var O=Zs(D.subarray(8,12)),k=S[P],z,K,Ee;O==="vide"&&(z=new DataView(k.buffer,k.byteOffset,k.byteLength),K=z.getUint8(0),Ee=K===0?z.getUint32(12):z.getUint32(20),g.push(Ee))})}),g},Du=function(c){var f=c[0],g=f===0?12:20;return ko(c[g]<<24|c[g+1]<<16|c[g+2]<<8|c[g+3])},Jd=function(c){var f=Pt(c,["moov","trak"]),g=[];return f.forEach(function(p){var T={},S=Pt(p,["tkhd"])[0],D,P;S&&(D=new DataView(S.buffer,S.byteOffset,S.byteLength),P=D.getUint8(0),T.id=P===0?D.getUint32(12):D.getUint32(20));var O=Pt(p,["mdia","hdlr"])[0];if(O){var k=Zs(O.subarray(8,12));k==="vide"?T.type="video":k==="soun"?T.type="audio":T.type=k}var z=Pt(p,["mdia","minf","stbl","stsd"])[0];if(z){var K=z.subarray(8);T.codec=Zs(K.subarray(4,8));var Ee=Pt(K,[T.codec])[0],ce,Be;Ee&&(/^[asm]vc[1-9]$/i.test(T.codec)?(ce=Ee.subarray(78),Be=Zs(ce.subarray(4,8)),Be==="avcC"&&ce.length>11?(T.codec+=".",T.codec+=Ta(ce[9]),T.codec+=Ta(ce[10]),T.codec+=Ta(ce[11])):T.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(T.codec)?(ce=Ee.subarray(28),Be=Zs(ce.subarray(4,8)),Be==="esds"&&ce.length>20&&ce[19]!==0?(T.codec+="."+Ta(ce[19]),T.codec+="."+Ta(ce[20]>>>2&63).replace(/^0/,"")):T.codec="mp4a.40.2"):T.codec=T.codec.toLowerCase())}var je=Pt(p,["mdia","mdhd"])[0];je&&(T.timescale=Du(je)),g.push(T)}),g},ef=function(c,f=0){var g=Pt(c,["emsg"]);return g.map(p=>{var T=wu.parseEmsgBox(new Uint8Array(p)),S=tT(T.message_data);return{cueTime:wu.scaleTime(T.presentation_time,T.timescale,T.presentation_time_delta,f),duration:wu.scaleTime(T.event_duration,T.timescale),frames:S}})};var Pu={findBox:Pt,parseType:Zs,timescale:Kd,startTime:Yd,compositionStartTime:Qd,videoTrackIds:Zd,tracks:Jd,getTimescaleFromMediaHeader:Du,getEmsgID3:ef},Lu=Nt,tf=function(c){var f=c[1]&31;return f<<=8,f|=c[2],f},Fo=function(c){return!!(c[1]&64)},Bo=function(c){var f=0;return(c[3]&48)>>>4>1&&(f+=c[4]+1),f},iT=function(c,f){var g=tf(c);return g===0?"pat":g===f?"pmt":f?"pes":null},nT=function(c){var f=Fo(c),g=4+Bo(c);return f&&(g+=c[g]+1),(c[g+10]&31)<<8|c[g+11]},sT=function(c){var f={},g=Fo(c),p=4+Bo(c);if(g&&(p+=c[p]+1),!!(c[p+5]&1)){var T,S,D;T=(c[p+1]&15)<<8|c[p+2],S=3+T-4,D=(c[p+10]&15)<<8|c[p+11];for(var P=12+D;P<S;){var O=p+P;f[(c[O+1]&31)<<8|c[O+2]]=c[O],P+=((c[O+3]&15)<<8|c[O+4])+5}return f}},rT=function(c,f){var g=tf(c),p=f[g];switch(p){case Lu.H264_STREAM_TYPE:return"video";case Lu.ADTS_STREAM_TYPE:return"audio";case Lu.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},aT=function(c){var f=Fo(c);if(!f)return null;var g=4+Bo(c);if(g>=c.byteLength)return null;var p=null,T;return T=c[g+7],T&192&&(p={},p.pts=(c[g+9]&14)<<27|(c[g+10]&255)<<20|(c[g+11]&254)<<12|(c[g+12]&255)<<5|(c[g+13]&254)>>>3,p.pts*=4,p.pts+=(c[g+13]&6)>>>1,p.dts=p.pts,T&64&&(p.dts=(c[g+14]&14)<<27|(c[g+15]&255)<<20|(c[g+16]&254)<<12|(c[g+17]&255)<<5|(c[g+18]&254)>>>3,p.dts*=4,p.dts+=(c[g+18]&6)>>>1)),p},Iu=function(c){switch(c){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},oT=function(c){for(var f=4+Bo(c),g=c.subarray(f),p=0,T=0,S=!1,D;T<g.byteLength-3;T++)if(g[T+2]===1){p=T+5;break}for(;p<g.byteLength;)switch(g[p]){case 0:if(g[p-1]!==0){p+=2;break}else if(g[p-2]!==0){p++;break}T+3!==p-2&&(D=Iu(g[T+3]&31),D==="slice_layer_without_partitioning_rbsp_idr"&&(S=!0));do p++;while(g[p]!==1&&p<g.length);T=p-2,p+=3;break;case 1:if(g[p-1]!==0||g[p-2]!==0){p+=3;break}D=Iu(g[T+3]&31),D==="slice_layer_without_partitioning_rbsp_idr"&&(S=!0),T=p-2,p+=3;break;default:p+=3;break}return g=g.subarray(T),p-=T,T=0,g&&g.byteLength>3&&(D=Iu(g[T+3]&31),D==="slice_layer_without_partitioning_rbsp_idr"&&(S=!0)),S},lT={parseType:iT,parsePat:nT,parsePmt:sT,parsePayloadUnitStartIndicator:Fo,parsePesType:rT,parsePesTime:aT,videoPacketContainsKeyFrame:oT},nf=Nt,Js=ln.handleRollover,pt={};pt.ts=lT,pt.aac=Eu;var Ts=ye.ONE_SECOND_IN_TS,ai=188,cn=71,uT=function(c,f){for(var g=0,p=ai,T,S;p<c.byteLength;){if(c[g]===cn&&c[p]===cn){switch(T=c.subarray(g,p),S=pt.ts.parseType(T,f.pid),S){case"pat":f.pid=pt.ts.parsePat(T);break;case"pmt":var D=pt.ts.parsePmt(T);f.table=f.table||{},Object.keys(D).forEach(function(P){f.table[P]=D[P]});break}g+=ai,p+=ai;continue}g++,p++}},sf=function(c,f,g){for(var p=0,T=ai,S,D,P,O,k,z=!1;T<=c.byteLength;){if(c[p]===cn&&(c[T]===cn||T===c.byteLength)){switch(S=c.subarray(p,T),D=pt.ts.parseType(S,f.pid),D){case"pes":P=pt.ts.parsePesType(S,f.table),O=pt.ts.parsePayloadUnitStartIndicator(S),P==="audio"&&O&&(k=pt.ts.parsePesTime(S),k&&(k.type="audio",g.audio.push(k),z=!0));break}if(z)break;p+=ai,T+=ai;continue}p++,T++}for(T=c.byteLength,p=T-ai,z=!1;p>=0;){if(c[p]===cn&&(c[T]===cn||T===c.byteLength)){switch(S=c.subarray(p,T),D=pt.ts.parseType(S,f.pid),D){case"pes":P=pt.ts.parsePesType(S,f.table),O=pt.ts.parsePayloadUnitStartIndicator(S),P==="audio"&&O&&(k=pt.ts.parsePesTime(S),k&&(k.type="audio",g.audio.push(k),z=!0));break}if(z)break;p-=ai,T-=ai;continue}p--,T--}},cT=function(c,f,g){for(var p=0,T=ai,S,D,P,O,k,z,K,Ee,ce=!1,Be={data:[],size:0};T<c.byteLength;){if(c[p]===cn&&c[T]===cn){switch(S=c.subarray(p,T),D=pt.ts.parseType(S,f.pid),D){case"pes":if(P=pt.ts.parsePesType(S,f.table),O=pt.ts.parsePayloadUnitStartIndicator(S),P==="video"&&(O&&!ce&&(k=pt.ts.parsePesTime(S),k&&(k.type="video",g.video.push(k),ce=!0)),!g.firstKeyFrame)){if(O&&Be.size!==0){for(z=new Uint8Array(Be.size),K=0;Be.data.length;)Ee=Be.data.shift(),z.set(Ee,K),K+=Ee.byteLength;if(pt.ts.videoPacketContainsKeyFrame(z)){var je=pt.ts.parsePesTime(z);je?(g.firstKeyFrame=je,g.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}Be.size=0}Be.data.push(S),Be.size+=S.byteLength}break}if(ce&&g.firstKeyFrame)break;p+=ai,T+=ai;continue}p++,T++}for(T=c.byteLength,p=T-ai,ce=!1;p>=0;){if(c[p]===cn&&c[T]===cn){switch(S=c.subarray(p,T),D=pt.ts.parseType(S,f.pid),D){case"pes":P=pt.ts.parsePesType(S,f.table),O=pt.ts.parsePayloadUnitStartIndicator(S),P==="video"&&O&&(k=pt.ts.parsePesTime(S),k&&(k.type="video",g.video.push(k),ce=!0));break}if(ce)break;p-=ai,T-=ai;continue}p--,T--}},hT=function(c,f){if(c.audio&&c.audio.length){var g=f;(typeof g>"u"||isNaN(g))&&(g=c.audio[0].dts),c.audio.forEach(function(S){S.dts=Js(S.dts,g),S.pts=Js(S.pts,g),S.dtsTime=S.dts/Ts,S.ptsTime=S.pts/Ts})}if(c.video&&c.video.length){var p=f;if((typeof p>"u"||isNaN(p))&&(p=c.video[0].dts),c.video.forEach(function(S){S.dts=Js(S.dts,p),S.pts=Js(S.pts,p),S.dtsTime=S.dts/Ts,S.ptsTime=S.pts/Ts}),c.firstKeyFrame){var T=c.firstKeyFrame;T.dts=Js(T.dts,p),T.pts=Js(T.pts,p),T.dtsTime=T.dts/Ts,T.ptsTime=T.pts/Ts}}},dT=function(c){for(var f=!1,g=0,p=null,T=null,S=0,D=0,P;c.length-D>=3;){var O=pt.aac.parseType(c,D);switch(O){case"timed-metadata":if(c.length-D<10){f=!0;break}if(S=pt.aac.parseId3TagSize(c,D),S>c.length){f=!0;break}T===null&&(P=c.subarray(D,D+S),T=pt.aac.parseAacTimestamp(P)),D+=S;break;case"audio":if(c.length-D<7){f=!0;break}if(S=pt.aac.parseAdtsSize(c,D),S>c.length){f=!0;break}p===null&&(P=c.subarray(D,D+S),p=pt.aac.parseSampleRate(P)),g++,D+=S;break;default:D++;break}if(f)return null}if(p===null||T===null)return null;var k=Ts/p,z={audio:[{type:"audio",dts:T,pts:T},{type:"audio",dts:T+g*1024*k,pts:T+g*1024*k}]};return z},fT=function(c){var f={pid:null,table:null},g={};uT(c,f);for(var p in f.table)if(f.table.hasOwnProperty(p)){var T=f.table[p];switch(T){case nf.H264_STREAM_TYPE:g.video=[],cT(c,f,g),g.video.length===0&&delete g.video;break;case nf.ADTS_STREAM_TYPE:g.audio=[],sf(c,f,g),g.audio.length===0&&delete g.audio;break}}return g},pT=function(c,f){var g=pt.aac.isLikelyAacData(c),p;return g?p=dT(c):p=fT(c),!p||!p.audio&&!p.video?null:(hT(p,f),p)},mT={inspect:pT,parseAudioPes_:sf};const gT=function(c,f){f.on("data",function(g){const p=g.initSegment;g.initSegment={data:p.buffer,byteOffset:p.byteOffset,byteLength:p.byteLength};const T=g.data;g.data=T.buffer,c.postMessage({action:"data",segment:g,byteOffset:T.byteOffset,byteLength:T.byteLength},[g.data])}),f.on("done",function(g){c.postMessage({action:"done"})}),f.on("gopInfo",function(g){c.postMessage({action:"gopInfo",gopInfo:g})}),f.on("videoSegmentTimingInfo",function(g){const p={start:{decode:ye.videoTsToSeconds(g.start.dts),presentation:ye.videoTsToSeconds(g.start.pts)},end:{decode:ye.videoTsToSeconds(g.end.dts),presentation:ye.videoTsToSeconds(g.end.pts)},baseMediaDecodeTime:ye.videoTsToSeconds(g.baseMediaDecodeTime)};g.prependedContentDuration&&(p.prependedContentDuration=ye.videoTsToSeconds(g.prependedContentDuration)),c.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:p})}),f.on("audioSegmentTimingInfo",function(g){const p={start:{decode:ye.videoTsToSeconds(g.start.dts),presentation:ye.videoTsToSeconds(g.start.pts)},end:{decode:ye.videoTsToSeconds(g.end.dts),presentation:ye.videoTsToSeconds(g.end.pts)},baseMediaDecodeTime:ye.videoTsToSeconds(g.baseMediaDecodeTime)};g.prependedContentDuration&&(p.prependedContentDuration=ye.videoTsToSeconds(g.prependedContentDuration)),c.postMessage({action:"audioSegmentTimingInfo",audioSegmentTimingInfo:p})}),f.on("id3Frame",function(g){c.postMessage({action:"id3Frame",id3Frame:g})}),f.on("caption",function(g){c.postMessage({action:"caption",caption:g})}),f.on("trackinfo",function(g){c.postMessage({action:"trackinfo",trackInfo:g})}),f.on("audioTimingInfo",function(g){c.postMessage({action:"audioTimingInfo",audioTimingInfo:{start:ye.videoTsToSeconds(g.start),end:ye.videoTsToSeconds(g.end)}})}),f.on("videoTimingInfo",function(g){c.postMessage({action:"videoTimingInfo",videoTimingInfo:{start:ye.videoTsToSeconds(g.start),end:ye.videoTsToSeconds(g.end)}})}),f.on("log",function(g){c.postMessage({action:"log",log:g})})};class rf{constructor(f,g){this.options=g||{},this.self=f,this.init()}init(){this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new yy.Transmuxer(this.options),gT(this.self,this.transmuxer)}pushMp4Captions(f){this.captionParser||(this.captionParser=new Gy,this.captionParser.init());const g=new Uint8Array(f.data,f.byteOffset,f.byteLength),p=this.captionParser.parse(g,f.trackIds,f.timescales);this.self.postMessage({action:"mp4Captions",captions:p&&p.captions||[],logs:p&&p.logs||[],data:g.buffer},[g.buffer])}probeMp4StartTime({timescales:f,data:g}){const p=Pu.startTime(f,g);this.self.postMessage({action:"probeMp4StartTime",startTime:p,data:g},[g.buffer])}probeMp4Tracks({data:f}){const g=Pu.tracks(f);this.self.postMessage({action:"probeMp4Tracks",tracks:g,data:f},[f.buffer])}probeEmsgID3({data:f,offset:g}){const p=Pu.getEmsgID3(f,g);this.self.postMessage({action:"probeEmsgID3",id3Frames:p,emsgData:f},[f.buffer])}probeTs({data:f,baseStartTime:g}){const p=typeof g=="number"&&!isNaN(g)?g*ye.ONE_SECOND_IN_TS:void 0,T=mT.inspect(f,p);let S=null;T&&(S={hasVideo:T.video&&T.video.length===2||!1,hasAudio:T.audio&&T.audio.length===2||!1},S.hasVideo&&(S.videoStart=T.video[0].ptsTime),S.hasAudio&&(S.audioStart=T.audio[0].ptsTime)),this.self.postMessage({action:"probeTs",result:S,data:f},[f.buffer])}clearAllMp4Captions(){this.captionParser&&this.captionParser.clearAllCaptions()}clearParsedMp4Captions(){this.captionParser&&this.captionParser.clearParsedCaptions()}push(f){const g=new Uint8Array(f.data,f.byteOffset,f.byteLength);this.transmuxer.push(g)}reset(){this.transmuxer.reset()}setTimestampOffset(f){const g=f.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(ye.secondsToVideoTs(g)))}setAudioAppendStart(f){this.transmuxer.setAudioAppendStart(Math.ceil(ye.secondsToVideoTs(f.appendStart)))}setRemux(f){this.transmuxer.setRemux(f.remux)}flush(f){this.transmuxer.flush(),self.postMessage({action:"done",type:"transmuxed"})}endTimeline(){this.transmuxer.endTimeline(),self.postMessage({action:"endedtimeline",type:"transmuxed"})}alignGopsWith(f){this.transmuxer.alignGopsWith(f.gopsToAlignWith.slice())}}self.onmessage=function(c){if(c.data.action==="init"&&c.data.options){this.messageHandlers=new rf(self,c.data.options);return}this.messageHandlers||(this.messageHandlers=new rf(self)),c.data&&c.data.action&&c.data.action!=="init"&&this.messageHandlers[c.data.action]&&this.messageHandlers[c.data.action](c.data)}}));var sR=pv(nR);const rR=(i,e,t)=>{const{type:n,initSegment:s,captions:r,captionStreams:a,metadata:o,videoFrameDtsTime:l,videoFramePtsTime:u}=i.data.segment;e.buffer.push({captions:r,captionStreams:a,metadata:o});const h=i.data.segment.boxes||{data:i.data.segment.data},d={type:n,data:new Uint8Array(h.data,h.data.byteOffset,h.data.byteLength),initSegment:new Uint8Array(s.data,s.byteOffset,s.byteLength)};typeof l<"u"&&(d.videoFrameDtsTime=l),typeof u<"u"&&(d.videoFramePtsTime=u),t(d)},aR=({transmuxedData:i,callback:e})=>{i.buffer=[],e(i)},oR=(i,e)=>{e.gopInfo=i.data.gopInfo},_v=i=>{const{transmuxer:e,bytes:t,audioAppendStart:n,gopsToAlignWith:s,remux:r,onData:a,onTrackInfo:o,onAudioTimingInfo:l,onVideoTimingInfo:u,onVideoSegmentTimingInfo:h,onAudioSegmentTimingInfo:d,onId3:m,onCaptions:y,onDone:v,onEndedTimeline:b,onTransmuxerLog:x,isEndOfTimeline:_}=i,E={buffer:[]};let A=_;const w=C=>{e.currentTransmux===i&&(C.data.action==="data"&&rR(C,E,a),C.data.action==="trackinfo"&&o(C.data.trackInfo),C.data.action==="gopInfo"&&oR(C,E),C.data.action==="audioTimingInfo"&&l(C.data.audioTimingInfo),C.data.action==="videoTimingInfo"&&u(C.data.videoTimingInfo),C.data.action==="videoSegmentTimingInfo"&&h(C.data.videoSegmentTimingInfo),C.data.action==="audioSegmentTimingInfo"&&d(C.data.audioSegmentTimingInfo),C.data.action==="id3Frame"&&m([C.data.id3Frame],C.data.id3Frame.dispatchType),C.data.action==="caption"&&y(C.data.caption),C.data.action==="endedtimeline"&&(A=!1,b()),C.data.action==="log"&&x(C.data.log),C.data.type==="transmuxed"&&(A||(e.onmessage=null,aR({transmuxedData:E,callback:v}),vv(e))))};if(e.onmessage=w,n&&e.postMessage({action:"setAudioAppendStart",appendStart:n}),Array.isArray(s)&&e.postMessage({action:"alignGopsWith",gopsToAlignWith:s}),typeof r<"u"&&e.postMessage({action:"setRemux",remux:r}),t.byteLength){const C=t instanceof ArrayBuffer?t:t.buffer,I=t instanceof ArrayBuffer?0:t.byteOffset;e.postMessage({action:"push",data:C,byteOffset:I,byteLength:t.byteLength},[C])}_&&e.postMessage({action:"endTimeline"}),e.postMessage({action:"flush"})},vv=i=>{i.currentTransmux=null,i.transmuxQueue.length&&(i.currentTransmux=i.transmuxQueue.shift(),typeof i.currentTransmux=="function"?i.currentTransmux():_v(i.currentTransmux))},Fm=(i,e)=>{i.postMessage({action:e}),vv(i)},yv=(i,e)=>{if(!e.currentTransmux){e.currentTransmux=i,Fm(e,i);return}e.transmuxQueue.push(Fm.bind(null,e,i))},lR=i=>{yv("reset",i)},uR=i=>{yv("endTimeline",i)},Tv=i=>{if(!i.transmuxer.currentTransmux){i.transmuxer.currentTransmux=i,_v(i);return}i.transmuxer.transmuxQueue.push(i)},cR=i=>{const e=new sR;e.currentTransmux=null,e.transmuxQueue=[];const t=e.terminate;return e.terminate=()=>(e.currentTransmux=null,e.transmuxQueue.length=0,t.call(e)),e.postMessage({action:"init",options:i}),e};var Dc={reset:lR,endTimeline:uR,transmux:Tv,createTransmuxer:cR};const Ka=function(i){const e=i.transmuxer,t=i.endAction||i.action,n=i.callback,s=zi({},i,{endAction:null,transmuxer:null,callback:null}),r=a=>{a.data.action===t&&(e.removeEventListener("message",r),a.data.data&&(a.data.data=new Uint8Array(a.data.data,i.byteOffset||0,i.byteLength||a.data.data.byteLength),i.data&&(i.data=a.data.data)),n(a.data))};if(e.addEventListener("message",r),i.data){const a=i.data instanceof ArrayBuffer;s.byteOffset=a?0:i.data.byteOffset,s.byteLength=i.data.byteLength;const o=[a?i.data:i.data.buffer];e.postMessage(s,o)}else e.postMessage(s)},vn={FAILURE:2,TIMEOUT:-101,ABORTED:-102},mh=i=>{i.forEach(e=>{e.abort()})},hR=i=>({bandwidth:i.bandwidth,bytesReceived:i.bytesReceived||0,roundTripTime:i.roundTripTime||0}),dR=i=>{const e=i.target,n={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-e.requestTime||0};return n.bytesReceived=i.loaded,n.bandwidth=Math.floor(n.bytesReceived/n.roundTripTime*8*1e3),n},Ed=(i,e)=>e.timedout?{status:e.status,message:"HLS request timed-out at URL: "+e.uri,code:vn.TIMEOUT,xhr:e}:e.aborted?{status:e.status,message:"HLS request aborted at URL: "+e.uri,code:vn.ABORTED,xhr:e}:i?{status:e.status,message:"HLS request errored at URL: "+e.uri,code:vn.FAILURE,xhr:e}:e.responseType==="arraybuffer"&&e.response.byteLength===0?{status:e.status,message:"Empty HLS response at URL: "+e.uri,code:vn.FAILURE,xhr:e}:null,Bm=(i,e,t)=>(n,s)=>{const r=s.response,a=Ed(n,s);if(a)return t(a,i);if(r.byteLength!==16)return t({status:s.status,message:"Invalid HLS key at URL: "+s.uri,code:vn.FAILURE,xhr:s},i);const o=new DataView(r),l=new Uint32Array([o.getUint32(0),o.getUint32(4),o.getUint32(8),o.getUint32(12)]);for(let u=0;u<e.length;u++)e[u].bytes=l;return t(null,i)},xv=(i,e)=>{const t=Gh(i.map.bytes);if(t!=="mp4"){const n=i.map.resolvedUri||i.map.uri,s=t||"unknown";return e({internal:!0,message:`Found unsupported ${s} container for initialization segment at URL: ${n}`,code:vn.FAILURE,metadata:{errorType:q.Error.UnsupportedMediaInitialization,mediaType:s}})}Ka({action:"probeMp4Tracks",data:i.map.bytes,transmuxer:i.transmuxer,callback:({tracks:n,data:s})=>(i.map.bytes=s,n.forEach(function(r){i.map.tracks=i.map.tracks||{},!i.map.tracks[r.type]&&(i.map.tracks[r.type]=r,typeof r.id=="number"&&r.timescale&&(i.map.timescales=i.map.timescales||{},i.map.timescales[r.id]=r.timescale))}),e(null))})},fR=({segment:i,finishProcessingFn:e})=>(t,n)=>{const s=Ed(t,n);if(s)return e(s,i);const r=new Uint8Array(n.response);if(i.map.key)return i.map.encryptedBytes=r,e(null,i);i.map.bytes=r,xv(i,function(a){if(a)return a.xhr=n,a.status=n.status,e(a,i);e(null,i)})},pR=({segment:i,finishProcessingFn:e,responseType:t})=>(n,s)=>{const r=Ed(n,s);if(r)return e(r,i);const a=t==="arraybuffer"||!s.responseText?s.response:tR(s.responseText.substring(i.lastReachedChar||0));return i.stats=hR(s),i.key?i.encryptedBytes=new Uint8Array(a):i.bytes=new Uint8Array(a),e(null,i)},mR=({segment:i,bytes:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:r,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:h,doneFn:d,onTransmuxerLog:m})=>{const y=i.map&&i.map.tracks||{},v=Boolean(y.audio&&y.video);let b=n.bind(null,i,"audio","start");const x=n.bind(null,i,"audio","end");let _=n.bind(null,i,"video","start");const E=n.bind(null,i,"video","end"),A=()=>Tv({bytes:e,transmuxer:i.transmuxer,audioAppendStart:i.audioAppendStart,gopsToAlignWith:i.gopsToAlignWith,remux:v,onData:w=>{w.type=w.type==="combined"?"video":w.type,h(i,w)},onTrackInfo:w=>{t&&(v&&(w.isMuxed=!0),t(i,w))},onAudioTimingInfo:w=>{b&&typeof w.start<"u"&&(b(w.start),b=null),x&&typeof w.end<"u"&&x(w.end)},onVideoTimingInfo:w=>{_&&typeof w.start<"u"&&(_(w.start),_=null),E&&typeof w.end<"u"&&E(w.end)},onVideoSegmentTimingInfo:w=>{s(w)},onAudioSegmentTimingInfo:w=>{r(w)},onId3:(w,C)=>{a(i,w,C)},onCaptions:w=>{o(i,[w])},isEndOfTimeline:l,onEndedTimeline:()=>{u()},onTransmuxerLog:m,onDone:w=>{d&&(w.type=w.type==="combined"?"video":w.type,d(null,i,w))}});Ka({action:"probeTs",transmuxer:i.transmuxer,data:e,baseStartTime:i.baseStartTime,callback:w=>{i.bytes=e=w.data;const C=w.result;C&&(t(i,{hasAudio:C.hasAudio,hasVideo:C.hasVideo,isMuxed:v}),t=null),A()}})},Sv=({segment:i,bytes:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:r,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:h,doneFn:d,onTransmuxerLog:m})=>{let y=new Uint8Array(e);if(zM(y)){i.isFmp4=!0;const{tracks:v}=i.map,b={isFmp4:!0,hasVideo:!!v.video,hasAudio:!!v.audio};v.audio&&v.audio.codec&&v.audio.codec!=="enca"&&(b.audioCodec=v.audio.codec),v.video&&v.video.codec&&v.video.codec!=="encv"&&(b.videoCodec=v.video.codec),v.video&&v.audio&&(b.isMuxed=!0),t(i,b);const x=(_,E)=>{h(i,{data:y,type:b.hasAudio&&!b.isMuxed?"audio":"video"}),E&&E.length&&a(i,E),_&&_.length&&o(i,_),d(null,i,{})};Ka({action:"probeMp4StartTime",timescales:i.map.timescales,data:y,transmuxer:i.transmuxer,callback:({data:_,startTime:E})=>{e=_.buffer,i.bytes=y=_,b.hasAudio&&!b.isMuxed&&n(i,"audio","start",E),b.hasVideo&&n(i,"video","start",E),Ka({action:"probeEmsgID3",data:y,transmuxer:i.transmuxer,offset:E,callback:({emsgData:A,id3Frames:w})=>{if(e=A.buffer,i.bytes=y=A,!v.video||!A.byteLength||!i.transmuxer){x(void 0,w);return}Ka({action:"pushMp4Captions",endAction:"mp4Captions",transmuxer:i.transmuxer,data:y,timescales:i.map.timescales,trackIds:[v.video.id],callback:C=>{e=C.data.buffer,i.bytes=y=C.data,C.logs.forEach(function(I){m(ht(I,{stream:"mp4CaptionParser"}))}),x(C.captions,w)}})}})}});return}if(!i.transmuxer){d(null,i,{});return}if(typeof i.container>"u"&&(i.container=Gh(y)),i.container!=="ts"&&i.container!=="aac"){t(i,{hasAudio:!1,hasVideo:!1}),d(null,i,{});return}mR({segment:i,bytes:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:r,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:h,doneFn:d,onTransmuxerLog:m})},bv=function({id:i,key:e,encryptedBytes:t,decryptionWorker:n},s){const r=o=>{if(o.data.source===i){n.removeEventListener("message",r);const l=o.data.decrypted;s(new Uint8Array(l.bytes,l.byteOffset,l.byteLength))}};n.addEventListener("message",r);let a;e.bytes.slice?a=e.bytes.slice():a=new Uint32Array(Array.prototype.slice.call(e.bytes)),n.postMessage(lv({source:i,encrypted:t,key:a,iv:e.iv}),[t.buffer,a.buffer])},gR=({decryptionWorker:i,segment:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:r,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:h,doneFn:d,onTransmuxerLog:m})=>{bv({id:e.requestId,key:e.key,encryptedBytes:e.encryptedBytes,decryptionWorker:i},y=>{e.bytes=y,Sv({segment:e,bytes:e.bytes,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:r,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:h,doneFn:d,onTransmuxerLog:m})})},_R=({activeXhrs:i,decryptionWorker:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:r,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:h,doneFn:d,onTransmuxerLog:m})=>{let y=0,v=!1;return(b,x)=>{if(!v){if(b)return v=!0,mh(i),d(b,x);if(y+=1,y===i.length){const _=function(){if(x.encryptedBytes)return gR({decryptionWorker:e,segment:x,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:r,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:h,doneFn:d,onTransmuxerLog:m});Sv({segment:x,bytes:x.bytes,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:r,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:h,doneFn:d,onTransmuxerLog:m})};if(x.endOfAllRequests=Date.now(),x.map&&x.map.encryptedBytes&&!x.map.bytes)return bv({decryptionWorker:e,id:x.requestId+"-init",encryptedBytes:x.map.encryptedBytes,key:x.map.key},E=>{x.map.bytes=E,xv(x,A=>{if(A)return mh(i),d(A,x);_()})});_()}}}},vR=({loadendState:i,abortFn:e})=>t=>{t.target.aborted&&e&&!i.calledAbortFn&&(e(),i.calledAbortFn=!0)},yR=({segment:i,progressFn:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:r,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:h})=>d=>{if(!d.target.aborted)return i.stats=ht(i.stats,dR(d)),!i.stats.firstBytesReceivedAt&&i.stats.bytesReceived&&(i.stats.firstBytesReceivedAt=Date.now()),e(d,i)},TR=({xhr:i,xhrOptions:e,decryptionWorker:t,segment:n,abortFn:s,progressFn:r,trackInfoFn:a,timingInfoFn:o,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:u,id3Fn:h,captionsFn:d,isEndOfTimeline:m,endedTimelineFn:y,dataFn:v,doneFn:b,onTransmuxerLog:x})=>{const _=[],E=_R({activeXhrs:_,decryptionWorker:t,trackInfoFn:a,timingInfoFn:o,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:u,id3Fn:h,captionsFn:d,isEndOfTimeline:m,endedTimelineFn:y,dataFn:v,doneFn:b,onTransmuxerLog:x});if(n.key&&!n.key.bytes){const B=[n.key];n.map&&!n.map.bytes&&n.map.key&&n.map.key.resolvedUri===n.key.resolvedUri&&B.push(n.map.key);const X=ht(e,{uri:n.key.resolvedUri,responseType:"arraybuffer",requestType:"segment-key"}),M=Bm(n,B,E),F=i(X,M);_.push(F)}if(n.map&&!n.map.bytes){if(n.map.key&&(!n.key||n.key.resolvedUri!==n.map.key.resolvedUri)){const Q=ht(e,{uri:n.map.key.resolvedUri,responseType:"arraybuffer",requestType:"segment-key"}),oe=Bm(n,[n.map.key],E),H=i(Q,oe);_.push(H)}const X=ht(e,{uri:n.map.resolvedUri,responseType:"arraybuffer",headers:fh(n.map),requestType:"segment-media-initialization"}),M=fR({segment:n,finishProcessingFn:E}),F=i(X,M);_.push(F)}const A=ht(e,{uri:n.part&&n.part.resolvedUri||n.resolvedUri,responseType:"arraybuffer",headers:fh(n),requestType:"segment"}),w=pR({segment:n,finishProcessingFn:E,responseType:A.responseType}),C=i(A,w);C.addEventListener("progress",yR({segment:n,progressFn:r,trackInfoFn:a,timingInfoFn:o,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:u,id3Fn:h,captionsFn:d,isEndOfTimeline:m,endedTimelineFn:y,dataFn:v})),_.push(C);const I={};return _.forEach(B=>{B.addEventListener("loadend",vR({loadendState:I,abortFn:s}))}),()=>mh(_)},xR=$i("CodecUtils"),SR=function(i){const e=i.attributes||{};if(e.CODECS)return dn(e.CODECS)},Ev=(i,e)=>{const t=e.attributes||{};return i&&i.mediaGroups&&i.mediaGroups.AUDIO&&t.AUDIO&&i.mediaGroups.AUDIO[t.AUDIO]},bR=(i,e)=>{if(!Ev(i,e))return!0;const t=e.attributes||{},n=i.mediaGroups.AUDIO[t.AUDIO];for(const s in n)if(!n[s].uri&&!n[s].playlists)return!0;return!1},zl=function(i){const e={};return i.forEach(({mediaType:t,type:n,details:s})=>{e[t]=e[t]||[],e[t].push(kg(`${n}${s}`))}),Object.keys(e).forEach(function(t){if(e[t].length>1){xR(`multiple ${t} codecs found as attributes: ${e[t].join(", ")}. Setting playlist codecs to null so that we wait for mux.js to probe segments for real codecs.`),e[t]=null;return}e[t]=e[t][0]}),e},Hm=function(i){let e=0;return i.audio&&e++,i.video&&e++,e},Ya=function(i,e){const t=e.attributes||{},n=zl(SR(e)||[]);if(Ev(i,e)&&!n.audio&&!bR(i,e)){const s=zl(GA(i,t.AUDIO)||[]);s.audio&&(n.audio=s.audio)}return n},fl=$i("PlaylistSelector"),Vm=function(i){if(!i||!i.playlist)return;const e=i.playlist;return JSON.stringify({id:e.id,bandwidth:i.bandwidth,width:i.width,height:i.height,codecs:e.attributes&&e.attributes.CODECS||""})},Gl=function(i,e){if(!i)return"";const t=N.getComputedStyle(i);return t?t[e]:""},Nr=function(i,e){const t=i.slice();i.sort(function(n,s){const r=e(n,s);return r===0?t.indexOf(n)-t.indexOf(s):r})},Ad=function(i,e){let t,n;return i.attributes.BANDWIDTH&&(t=i.attributes.BANDWIDTH),t=t||N.Number.MAX_VALUE,e.attributes.BANDWIDTH&&(n=e.attributes.BANDWIDTH),n=n||N.Number.MAX_VALUE,t-n},ER=function(i,e){let t,n;return i.attributes.RESOLUTION&&i.attributes.RESOLUTION.width&&(t=i.attributes.RESOLUTION.width),t=t||N.Number.MAX_VALUE,e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width&&(n=e.attributes.RESOLUTION.width),n=n||N.Number.MAX_VALUE,t===n&&i.attributes.BANDWIDTH&&e.attributes.BANDWIDTH?i.attributes.BANDWIDTH-e.attributes.BANDWIDTH:t-n};let Av=function(i,e,t,n,s,r){if(!i)return;const a={bandwidth:e,width:t,height:n,limitRenditionByPlayerDimensions:s};let o=i.playlists;xi.isAudioOnly(i)&&(o=r.getAudioTrackPlaylists_(),a.audioOnly=!0);let l=o.map(C=>{let I;const B=C.attributes&&C.attributes.RESOLUTION&&C.attributes.RESOLUTION.width,X=C.attributes&&C.attributes.RESOLUTION&&C.attributes.RESOLUTION.height;return I=C.attributes&&C.attributes.BANDWIDTH,I=I||N.Number.MAX_VALUE,{bandwidth:I,width:B,height:X,playlist:C}});Nr(l,(C,I)=>C.bandwidth-I.bandwidth),l=l.filter(C=>!xi.isIncompatible(C.playlist));let u=l.filter(C=>xi.isEnabled(C.playlist));u.length||(u=l.filter(C=>!xi.isDisabled(C.playlist)));const h=u.filter(C=>C.bandwidth*jt.BANDWIDTH_VARIANCE<e);let d=h[h.length-1];const m=h.filter(C=>C.bandwidth===d.bandwidth)[0];if(s===!1){const C=m||u[0]||l[0];if(C&&C.playlist){let I="sortedPlaylistReps";return m&&(I="bandwidthBestRep"),u[0]&&(I="enabledPlaylistReps"),fl(`choosing ${Vm(C)} using ${I} with options`,a),C.playlist}return fl("could not choose a playlist with options",a),null}const y=h.filter(C=>C.width&&C.height);Nr(y,(C,I)=>C.width-I.width);const v=y.filter(C=>C.width===t&&C.height===n);d=v[v.length-1];const b=v.filter(C=>C.bandwidth===d.bandwidth)[0];let x,_,E;b||(x=y.filter(C=>C.width>t||C.height>n),_=x.filter(C=>C.width===x[0].width&&C.height===x[0].height),d=_[_.length-1],E=_.filter(C=>C.bandwidth===d.bandwidth)[0]);let A;if(r.leastPixelDiffSelector){const C=y.map(I=>(I.pixelDiff=Math.abs(I.width-t)+Math.abs(I.height-n),I));Nr(C,(I,B)=>I.pixelDiff===B.pixelDiff?B.bandwidth-I.bandwidth:I.pixelDiff-B.pixelDiff),A=C[0]}const w=A||E||b||m||u[0]||l[0];if(w&&w.playlist){let C="sortedPlaylistReps";return A?C="leastPixelDiffRep":E?C="resolutionPlusOneRep":b?C="resolutionBestRep":m?C="bandwidthBestRep":u[0]&&(C="enabledPlaylistReps"),fl(`choosing ${Vm(w)} using ${C} with options`,a),w.playlist}return fl("could not choose a playlist with options",a),null};const zm=function(){let i=this.useDevicePixelRatio&&N.devicePixelRatio||1;return isNaN(this.customPixelRatio)||(i=this.customPixelRatio),Av(this.playlists.main,this.systemBandwidth,parseInt(Gl(this.tech_.el(),"width"),10)*i,parseInt(Gl(this.tech_.el(),"height"),10)*i,this.limitRenditionByPlayerDimensions,this.playlistController_)},AR=function(i){let e=-1,t=-1;if(i<0||i>1)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){let n=this.useDevicePixelRatio&&N.devicePixelRatio||1;return isNaN(this.customPixelRatio)||(n=this.customPixelRatio),e<0&&(e=this.systemBandwidth,t=this.systemBandwidth),this.systemBandwidth>0&&this.systemBandwidth!==t&&(e=i*this.systemBandwidth+(1-i)*e,t=this.systemBandwidth),Av(this.playlists.main,e,parseInt(Gl(this.tech_.el(),"width"),10)*n,parseInt(Gl(this.tech_.el(),"height"),10)*n,this.limitRenditionByPlayerDimensions,this.playlistController_)}},CR=function(i){const{main:e,currentTime:t,bandwidth:n,duration:s,segmentDuration:r,timeUntilRebuffer:a,currentTimeline:o,syncController:l}=i,u=e.playlists.filter(v=>!xi.isIncompatible(v));let h=u.filter(xi.isEnabled);h.length||(h=u.filter(v=>!xi.isDisabled(v)));const m=h.filter(xi.hasAttribute.bind(null,"BANDWIDTH")).map(v=>{const x=l.getSyncPoint(v,s,o,t)?1:2,E=xi.estimateSegmentRequestTime(r,n,v)*x-a;return{playlist:v,rebufferingImpact:E}}),y=m.filter(v=>v.rebufferingImpact<=0);return Nr(y,(v,b)=>Ad(b.playlist,v.playlist)),y.length?y[0]:(Nr(m,(v,b)=>v.rebufferingImpact-b.rebufferingImpact),m[0]||null)},MR=function(){const i=this.playlists.main.playlists.filter(xi.isEnabled);return Nr(i,(t,n)=>Ad(t,n)),i.filter(t=>!!Ya(this.playlists.main,t).video)[0]||null},wR=i=>{let e=0,t;return i.bytes&&(t=new Uint8Array(i.bytes),i.segments.forEach(n=>{t.set(n,e),e+=n.byteLength})),t};function Cv(i){try{return new URL(i).pathname.split("/").slice(-2).join("/")}catch{return""}}const DR=function(i,e,t){if(!i[t]){e.trigger({type:"usage",name:"vhs-608"});let n=t;/^cc708_/.test(t)&&(n="SERVICE"+t.split("_")[1]);const s=e.textTracks().getTrackById(n);if(s)i[t]=s;else{const r=e.options_.vhs&&e.options_.vhs.captionServices||{};let a=t,o=t,l=!1;const u=r[n];u&&(a=u.label,o=u.language,l=u.default),i[t]=e.addRemoteTextTrack({kind:"captions",id:n,default:l,label:a,language:o},!1).track}}},RR=function({inbandTextTracks:i,captionArray:e,timestampOffset:t}){if(!e)return;const n=N.WebKitDataCue||N.VTTCue;e.forEach(s=>{const r=s.stream;s.content?s.content.forEach(a=>{const o=new n(s.startTime+t,s.endTime+t,a.text);o.line=a.line,o.align="left",o.position=a.position,o.positionAlign="line-left",i[r].addCue(o)}):i[r].addCue(new n(s.startTime+t,s.endTime+t,s.text))})},PR=function(i){Object.defineProperties(i.frame,{id:{get(){return q.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),i.value.key}},value:{get(){return q.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),i.value.data}},privateData:{get(){return q.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),i.value.data}}})},LR=({inbandTextTracks:i,metadataArray:e,timestampOffset:t,videoDuration:n})=>{if(!e)return;const s=N.WebKitDataCue||N.VTTCue,r=i.metadataTrack_;if(!r||(e.forEach(h=>{const d=h.cueTime+t;typeof d!="number"||N.isNaN(d)||d<0||!(d<1/0)||!h.frames||!h.frames.length||h.frames.forEach(m=>{const y=new s(d,d,m.value||m.url||m.data||"");y.frame=m,y.value=m,PR(y),r.addCue(y)})}),!r.cues||!r.cues.length))return;const a=r.cues,o=[];for(let h=0;h<a.length;h++)a[h]&&o.push(a[h]);const l=o.reduce((h,d)=>{const m=h[d.startTime]||[];return m.push(d),h[d.startTime]=m,h},{}),u=Object.keys(l).sort((h,d)=>Number(h)-Number(d));u.forEach((h,d)=>{const m=l[h],y=isFinite(n)?n:h,v=Number(u[d+1])||y;m.forEach(b=>{b.endTime=v})})},IR={id:"ID",class:"CLASS",startDate:"START-DATE",duration:"DURATION",endDate:"END-DATE",endOnNext:"END-ON-NEXT",plannedDuration:"PLANNED-DURATION",scte35Out:"SCTE35-OUT",scte35In:"SCTE35-IN"},OR=new Set(["id","class","startDate","duration","endDate","endOnNext","startTime","endTime","processDateRange"]),UR=({inbandTextTracks:i,dateRanges:e})=>{const t=i.metadataTrack_;if(!t)return;const n=N.WebKitDataCue||N.VTTCue;e.forEach(s=>{for(const r of Object.keys(s)){if(OR.has(r))continue;const a=new n(s.startTime,s.endTime,"");a.id=s.id,a.type="com.apple.quicktime.HLS",a.value={key:IR[r],data:s[r]},(r==="scte35Out"||r==="scte35In")&&(a.value.data=new Uint8Array(a.value.data.match(/[\da-f]{2}/gi)).buffer),t.addCue(a)}s.processDateRange()})},Gm=(i,e,t)=>{i.metadataTrack_||(i.metadataTrack_=t.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,q.browser.IS_ANY_SAFARI||(i.metadataTrack_.inBandMetadataTrackDispatchType=e))},Ha=function(i,e,t){let n,s;if(t&&t.cues)for(n=t.cues.length;n--;)s=t.cues[n],s.startTime>=i&&s.endTime<=e&&t.removeCue(s)},NR=function(i){const e=i.cues;if(!e)return;const t={};for(let n=e.length-1;n>=0;n--){const s=e[n],r=`${s.startTime}-${s.endTime}-${s.text}`;t[r]?i.removeCue(s):t[r]=s}},kR=(i,e,t)=>{if(typeof e>"u"||e===null||!i.length)return[];const n=Math.ceil((e-t+3)*Os.ONE_SECOND_IN_TS);let s;for(s=0;s<i.length&&!(i[s].pts>n);s++);return i.slice(s)},FR=(i,e,t)=>{if(!e.length)return i;if(t)return e.slice();const n=e[0].pts;let s=0;for(s;s<i.length&&!(i[s].pts>=n);s++);return i.slice(0,s).concat(e)},BR=(i,e,t,n)=>{const s=Math.ceil((e-n)*Os.ONE_SECOND_IN_TS),r=Math.ceil((t-n)*Os.ONE_SECOND_IN_TS),a=i.slice();let o=i.length;for(;o--&&!(i[o].pts<=r););if(o===-1)return a;let l=o+1;for(;l--&&!(i[l].pts<=s););return l=Math.max(l,0),a.splice(l,o-l+1),a},HR=function(i,e){if(!i&&!e||!i&&e||i&&!e)return!1;if(i===e)return!0;const t=Object.keys(i).sort(),n=Object.keys(e).sort();if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++){const r=t[s];if(r!==n[s]||i[r]!==e[r])return!1}return!0},Mv=22,VR=function(i,e,t){e=e||[];const n=[];let s=0;for(let r=0;r<e.length;r++){const a=e[r];if(i===a.timeline&&(n.push(r),s+=a.duration,s>t))return r}return n.length===0?0:n[n.length-1]},La=1,zR=500,Wm=i=>typeof i=="number"&&isFinite(i),pl=1/60,GR=(i,e,t)=>i!=="main"||!e||!t?null:!t.hasAudio&&!t.hasVideo?"Neither audio nor video found in segment.":e.hasVideo&&!t.hasVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!e.hasVideo&&t.hasVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null,WR=(i,e,t)=>{let n=e-jt.BACK_BUFFER_LENGTH;i.length&&(n=Math.max(n,i.start(0)));const s=e-t;return Math.min(s,n)},xr=i=>{const{startOfSegment:e,duration:t,segment:n,part:s,playlist:{mediaSequence:r,id:a,segments:o=[]},mediaIndex:l,partIndex:u,timeline:h}=i,d=o.length-1;let m="mediaIndex/partIndex increment";i.getMediaInfoForTime?m=`getMediaInfoForTime (${i.getMediaInfoForTime})`:i.isSyncRequest&&(m="getSyncSegmentCandidate (isSyncRequest)"),i.independent&&(m+=` with independent ${i.independent}`);const y=typeof u=="number",v=i.segment.uri?"segment":"pre-segment",b=y?j_({preloadSegment:n})-1:0;return`${v} [${r+l}/${r+d}]`+(y?` part [${u}/${b}]`:"")+` segment start/end [${n.start} => ${n.end}]`+(y?` part start/end [${s.start} => ${s.end}]`:"")+` startOfSegment [${e}] duration [${t}] timeline [${h}] selected by [${m}] playlist [${a}]`},qm=i=>`${i}TimingInfo`,qR=({segmentTimeline:i,currentTimeline:e,startOfSegment:t,buffered:n,overrideCheck:s})=>!s&&i===e?null:i<e?t:n.length?n.end(n.length-1):t,$m=({timelineChangeController:i,currentTimeline:e,segmentTimeline:t,loaderType:n,audioDisabled:s})=>{if(e===t)return!1;if(n==="audio"){const r=i.lastTimelineChange({type:"main"});return!r||r.to!==t}if(n==="main"&&s){const r=i.pendingTimelineChange({type:"audio"});return!(r&&r.to===t)}return!1},$R=i=>{let e=0;return["video","audio"].forEach(function(t){const n=i[`${t}TimingInfo`];if(!n)return;const{start:s,end:r}=n;let a;typeof s=="bigint"||typeof r=="bigint"?a=N.BigInt(r)-N.BigInt(s):typeof s=="number"&&typeof r=="number"&&(a=r-s),typeof a<"u"&&a>e&&(e=a)}),typeof e=="bigint"&&e<Number.MAX_SAFE_INTEGER&&(e=Number(e)),e},jm=({segmentDuration:i,maxDuration:e})=>i?Math.round(i)>e+gn:!1,jR=(i,e)=>{if(e!=="hls")return null;const t=$R({audioTimingInfo:i.audioTimingInfo,videoTimingInfo:i.videoTimingInfo});if(!t)return null;const n=i.playlist.targetDuration,s=jm({segmentDuration:t,maxDuration:n*2}),r=jm({segmentDuration:t,maxDuration:n}),a=`Segment with index ${i.mediaIndex} from playlist ${i.playlist.id} has a duration of ${t} when the reported duration is ${i.duration} and the target duration is ${n}. For HLS content, a duration in excess of the target duration may result in playback issues. See the HLS specification section on EXT-X-TARGETDURATION for more details: https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.3.1`;return s||r?{severity:s?"warn":"info",message:a}:null};class gh extends q.EventTarget{constructor(e,t={}){if(super(),!e)throw new TypeError("Initialization settings are required");if(typeof e.currentTime!="function")throw new TypeError("No currentTime getter specified");if(!e.mediaSource)throw new TypeError("No MediaSource specified");this.bandwidth=e.bandwidth,this.throughput={rate:0,count:0},this.roundTrip=NaN,this.resetStats_(),this.mediaIndex=null,this.partIndex=null,this.hasPlayed_=e.hasPlayed,this.currentTime_=e.currentTime,this.seekable_=e.seekable,this.seeking_=e.seeking,this.duration_=e.duration,this.mediaSource_=e.mediaSource,this.vhs_=e.vhs,this.loaderType_=e.loaderType,this.currentMediaInfo_=void 0,this.startingMediaInfo_=void 0,this.segmentMetadataTrack_=e.segmentMetadataTrack,this.goalBufferLength_=e.goalBufferLength,this.sourceType_=e.sourceType,this.sourceUpdater_=e.sourceUpdater,this.inbandTextTracks_=e.inbandTextTracks,this.state_="INIT",this.timelineChangeController_=e.timelineChangeController,this.shouldSaveSegmentTimingInfo_=!0,this.parse708captions_=e.parse708captions,this.useDtsForTimestampOffset_=e.useDtsForTimestampOffset,this.captionServices_=e.captionServices,this.exactManifestTimings=e.exactManifestTimings,this.addMetadataToTextTrack=e.addMetadataToTextTrack,this.checkBufferTimeout_=null,this.error_=void 0,this.currentTimeline_=-1,this.shouldForceTimestampOffsetAfterResync_=!1,this.pendingSegment_=null,this.xhrOptions_=null,this.pendingSegments_=[],this.audioDisabled_=!1,this.isPendingTimestampOffset_=!1,this.gopBuffer_=[],this.timeMapping_=0,this.safeAppend_=!1,this.appendInitSegment_={audio:!0,video:!0},this.playlistOfLastInitSegment_={audio:null,video:null},this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_={id3:[],caption:[]},this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=null,this.activeInitSegmentId_=null,this.initSegments_={},this.cacheEncryptionKeys_=e.cacheEncryptionKeys,this.keyCache_={},this.decrypter_=e.decrypter,this.syncController_=e.syncController,this.syncPoint_={segmentIndex:0,time:0},this.transmuxer_=this.createTransmuxer_(),this.triggerSyncInfoUpdate_=()=>this.trigger("syncinfoupdate"),this.syncController_.on("syncinfoupdate",this.triggerSyncInfoUpdate_),this.mediaSource_.addEventListener("sourceopen",()=>{this.isEndOfStream_()||(this.ended_=!1)}),this.fetchAtBuffer_=!1,this.logger_=$i(`SegmentLoader[${this.loaderType_}]`),Object.defineProperty(this,"state",{get(){return this.state_},set(n){n!==this.state_&&(this.logger_(`${this.state_} -> ${n}`),this.state_=n,this.trigger("statechange"))}}),this.sourceUpdater_.on("ready",()=>{this.hasEnoughInfoToAppend_()&&this.processCallQueue_()}),this.loaderType_==="main"&&this.timelineChangeController_.on("pendingtimelinechange",()=>{this.hasEnoughInfoToAppend_()&&this.processCallQueue_()}),this.loaderType_==="audio"&&this.timelineChangeController_.on("timelinechange",()=>{this.hasEnoughInfoToLoad_()&&this.processLoadQueue_(),this.hasEnoughInfoToAppend_()&&this.processCallQueue_()})}get mediaSequenceSync_(){return this.syncController_.getMediaSequenceSync(this.loaderType_)}createTransmuxer_(){return Dc.createTransmuxer({remux:!1,alignGopsAtEnd:this.safeAppend_,keepOriginalTimestamps:!0,parse708captions:this.parse708captions_,captionServices:this.captionServices_})}resetStats_(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0,this.mediaAppends=0}dispose(){this.trigger("dispose"),this.state="DISPOSED",this.pause(),this.abort_(),this.transmuxer_&&this.transmuxer_.terminate(),this.resetStats_(),this.checkBufferTimeout_&&N.clearTimeout(this.checkBufferTimeout_),this.syncController_&&this.triggerSyncInfoUpdate_&&this.syncController_.off("syncinfoupdate",this.triggerSyncInfoUpdate_),this.off()}setAudio(e){this.audioDisabled_=!e,e?this.appendInitSegment_.audio=!0:this.sourceUpdater_.removeAudio(0,this.duration_())}abort(){if(this.state!=="WAITING"){this.pendingSegment_&&(this.pendingSegment_=null);return}this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()}abort_(){this.pendingSegment_&&this.pendingSegment_.abortRequests&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_),this.waitingOnRemove_=!1,N.clearTimeout(this.quotaExceededErrorRetryTimeout_),this.quotaExceededErrorRetryTimeout_=null}checkForAbort_(e){return this.state==="APPENDING"&&!this.pendingSegment_?(this.state="READY",!0):!this.pendingSegment_||this.pendingSegment_.requestId!==e}error(e){return typeof e<"u"&&(this.logger_("error occurred:",e),this.error_=e),this.pendingSegment_=null,this.error_}endOfStream(){this.ended_=!0,this.transmuxer_&&Dc.reset(this.transmuxer_),this.gopBuffer_.length=0,this.pause(),this.trigger("ended")}buffered_(){const e=this.getMediaInfo_();if(!this.sourceUpdater_||!e)return ni();if(this.loaderType_==="main"){const{hasAudio:t,hasVideo:n,isMuxed:s}=e;if(n&&t&&!this.audioDisabled_&&!s)return this.sourceUpdater_.buffered();if(n)return this.sourceUpdater_.videoBuffered()}return this.sourceUpdater_.audioBuffered()}initSegmentForMap(e,t=!1){if(!e)return null;const n=Vl(e);let s=this.initSegments_[n];return t&&!s&&e.bytes&&(this.initSegments_[n]=s={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:e.bytes,tracks:e.tracks,timescales:e.timescales}),s||e}segmentKey(e,t=!1){if(!e)return null;const n=uv(e);let s=this.keyCache_[n];this.cacheEncryptionKeys_&&t&&!s&&e.bytes&&(this.keyCache_[n]=s={resolvedUri:e.resolvedUri,bytes:e.bytes});const r={resolvedUri:(s||e).resolvedUri};return s&&(r.bytes=s.bytes),r}couldBeginLoading_(){return this.playlist_&&!this.paused()}load(){if(this.monitorBuffer_(),!!this.playlist_){if(this.state==="INIT"&&this.couldBeginLoading_())return this.init_();!this.couldBeginLoading_()||this.state!=="READY"&&this.state!=="INIT"||(this.state="READY")}}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}playlist(e,t={}){if(!e)return;const n=this.playlist_,s=this.pendingSegment_;this.playlist_=e,this.xhrOptions_=t,this.state==="INIT"&&(e.syncInfo={mediaSequence:e.mediaSequence,time:0},this.loaderType_==="main"&&this.syncController_.setDateTimeMappingForStart(e));let r=null;if(n&&(n.id?r=n.id:n.uri&&(r=n.uri)),this.logger_(`playlist update [${r} => ${e.id||e.uri}]`),this.mediaSequenceSync_&&(this.mediaSequenceSync_.update(e,this.currentTime_()),this.logger_(`Playlist update:
currentTime: ${this.currentTime_()}
bufferedEnd: ${Mc(this.buffered_())}
`,this.mediaSequenceSync_.diagnostics)),this.trigger("syncinfoupdate"),this.state==="INIT"&&this.couldBeginLoading_())return this.init_();if(!n||n.uri!==e.uri){this.mediaIndex!==null&&(!e.endList&&typeof e.partTargetDuration=="number"?this.resetLoader():this.resyncLoader()),this.currentMediaInfo_=void 0,this.trigger("playlistupdate");return}const a=e.mediaSequence-n.mediaSequence;if(this.logger_(`live window shift [${a}]`),this.mediaIndex!==null)if(this.mediaIndex-=a,this.mediaIndex<0)this.mediaIndex=null,this.partIndex=null;else{const o=this.playlist_.segments[this.mediaIndex];if(this.partIndex&&(!o.parts||!o.parts.length||!o.parts[this.partIndex])){const l=this.mediaIndex;this.logger_(`currently processing part (index ${this.partIndex}) no longer exists.`),this.resetLoader(),this.mediaIndex=l}}s&&(s.mediaIndex-=a,s.mediaIndex<0?(s.mediaIndex=null,s.partIndex=null):(s.mediaIndex>=0&&(s.segment=e.segments[s.mediaIndex]),s.partIndex>=0&&s.segment.parts&&(s.part=s.segment.parts[s.partIndex]))),this.syncController_.saveExpiredSegmentInfo(n,e)}pause(){this.checkBufferTimeout_&&(N.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)}paused(){return this.checkBufferTimeout_===null}resetEverything(e){this.ended_=!1,this.activeInitSegmentId_=null,this.appendInitSegment_={audio:!0,video:!0},this.resetLoader(),this.remove(0,1/0,e),this.transmuxer_&&(this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.transmuxer_.postMessage({action:"reset"}))}resetLoader(){this.fetchAtBuffer_=!1,this.mediaSequenceSync_&&this.mediaSequenceSync_.resetAppendedStatus(),this.resyncLoader()}resyncLoader(){this.transmuxer_&&Dc.reset(this.transmuxer_),this.mediaIndex=null,this.partIndex=null,this.syncPoint_=null,this.isPendingTimestampOffset_=!1;const e=this.currentMediaInfo_&&this.currentMediaInfo_.isFmp4;this.sourceType_==="hls"&&!e&&(this.shouldForceTimestampOffsetAfterResync_=!0),this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}remove(e,t,n=()=>{},s=!1){if(t===1/0&&(t=this.duration_()),t<=e){this.logger_("skipping remove because end ${end} is <= start ${start}");return}if(!this.sourceUpdater_||!this.getMediaInfo_()){this.logger_("skipping remove because no source updater or starting media info");return}let r=1;const a=()=>{r--,r===0&&n()};(s||!this.audioDisabled_)&&(r++,this.sourceUpdater_.removeAudio(e,t,a)),(s||this.loaderType_==="main")&&(this.gopBuffer_=BR(this.gopBuffer_,e,t,this.timeMapping_),r++,this.sourceUpdater_.removeVideo(e,t,a));for(const o in this.inbandTextTracks_)Ha(e,t,this.inbandTextTracks_[o]);Ha(e,t,this.segmentMetadataTrack_),a()}monitorBuffer_(){this.checkBufferTimeout_&&N.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=N.setTimeout(this.monitorBufferTick_.bind(this),1)}monitorBufferTick_(){this.state==="READY"&&this.fillBuffer_(),this.checkBufferTimeout_&&N.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=N.setTimeout(this.monitorBufferTick_.bind(this),zR)}fillBuffer_(){if(this.sourceUpdater_.updating())return;const e=this.chooseNextRequest_();e&&(typeof e.timestampOffset=="number"&&(this.isPendingTimestampOffset_=!1,this.timelineChangeController_.pendingTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline})),this.loadSegment_(e))}isEndOfStream_(e=this.mediaIndex,t=this.playlist_,n=this.partIndex){if(!t||!this.mediaSource_)return!1;const s=typeof e=="number"&&t.segments[e],r=e+1===t.segments.length,a=!s||!s.parts||n+1===s.parts.length;return t.endList&&this.mediaSource_.readyState==="open"&&r&&a}chooseNextRequest_(){const e=this.buffered_(),t=Mc(e)||0,n=Td(e,this.currentTime_()),s=!this.hasPlayed_()&&n>=1,r=n>=this.goalBufferLength_(),a=this.playlist_.segments;if(!a.length||s||r)return null;this.syncPoint_=this.syncPoint_||this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_(),this.loaderType_);const o={partIndex:null,mediaIndex:null,startOfSegment:null,playlist:this.playlist_,isSyncRequest:Boolean(!this.syncPoint_)};if(o.isSyncRequest)o.mediaIndex=VR(this.currentTimeline_,a,t),this.logger_(`choose next request. Can not find sync point. Fallback to media Index: ${o.mediaIndex}`);else if(this.mediaIndex!==null){const m=a[this.mediaIndex],y=typeof this.partIndex=="number"?this.partIndex:-1;o.startOfSegment=m.end?m.end:t,m.parts&&m.parts[y+1]?(o.mediaIndex=this.mediaIndex,o.partIndex=y+1):o.mediaIndex=this.mediaIndex+1}else{let m,y,v;const b=this.fetchAtBuffer_?t:this.currentTime_();if(this.mediaSequenceSync_&&this.logger_(`chooseNextRequest_ request after Quality Switch:
For TargetTime: ${b}.
CurrentTime: ${this.currentTime_()}
BufferedEnd: ${t}
Fetch At Buffer: ${this.fetchAtBuffer_}
`,this.mediaSequenceSync_.diagnostics),this.mediaSequenceSync_&&this.mediaSequenceSync_.isReliable){const x=this.getSyncInfoFromMediaSequenceSync_(b);if(!x)return this.logger_("chooseNextRequest_ - no sync info found using media sequence sync"),null;this.logger_(`chooseNextRequest_ mediaSequence syncInfo (${x.start} --> ${x.end})`),m=x.segmentIndex,y=x.partIndex,v=x.start}else{this.logger_("chooseNextRequest_ - fallback to a regular segment selection algorithm, based on a syncPoint.");const x=xi.getMediaInfoForTime({exactManifestTimings:this.exactManifestTimings,playlist:this.playlist_,currentTime:b,startingPartIndex:this.syncPoint_.partIndex,startingSegmentIndex:this.syncPoint_.segmentIndex,startTime:this.syncPoint_.time});m=x.segmentIndex,y=x.partIndex,v=x.startTime}o.getMediaInfoForTime=this.fetchAtBuffer_?`bufferedEnd ${b}`:`currentTime ${b}`,o.mediaIndex=m,o.startOfSegment=v,o.partIndex=y,this.logger_(`choose next request. Playlist switched and we have a sync point. Media Index: ${o.mediaIndex} `)}const l=a[o.mediaIndex];let u=l&&typeof o.partIndex=="number"&&l.parts&&l.parts[o.partIndex];if(!l||typeof o.partIndex=="number"&&!u)return null;typeof o.partIndex!="number"&&l.parts&&(o.partIndex=0,u=l.parts[0]);const h=this.vhs_.playlists&&this.vhs_.playlists.main&&this.vhs_.playlists.main.independentSegments||this.playlist_.independentSegments;if(!n&&u&&!h&&!u.independent)if(o.partIndex===0){const m=a[o.mediaIndex-1],y=m.parts&&m.parts.length&&m.parts[m.parts.length-1];y&&y.independent&&(o.mediaIndex-=1,o.partIndex=m.parts.length-1,o.independent="previous segment")}else l.parts[o.partIndex-1].independent&&(o.partIndex-=1,o.independent="previous part");const d=this.mediaSource_&&this.mediaSource_.readyState==="ended";return o.mediaIndex>=a.length-1&&d&&!this.seeking_()?null:(this.shouldForceTimestampOffsetAfterResync_&&(this.shouldForceTimestampOffsetAfterResync_=!1,o.forceTimestampOffset=!0,this.logger_("choose next request. Force timestamp offset after loader resync")),this.generateSegmentInfo_(o))}getSyncInfoFromMediaSequenceSync_(e){if(!this.mediaSequenceSync_)return null;const t=Math.max(e,this.mediaSequenceSync_.start);e!==t&&this.logger_(`getSyncInfoFromMediaSequenceSync_. Pulled target time from ${e} to ${t}`);const n=this.mediaSequenceSync_.getSyncInfoForTime(t);if(!n)return null;if(!n.isAppended)return n;const s=this.mediaSequenceSync_.getSyncInfoForTime(n.end);return s?(s.isAppended&&this.logger_("getSyncInfoFromMediaSequenceSync_: We encounter unexpected scenario where next media sequence sync info is also appended!"),s):null}generateSegmentInfo_(e){const{independent:t,playlist:n,mediaIndex:s,startOfSegment:r,isSyncRequest:a,partIndex:o,forceTimestampOffset:l,getMediaInfoForTime:u}=e,h=n.segments[s],d=typeof o=="number"&&h.parts[o],m={requestId:"segment-loader-"+Math.random(),uri:d&&d.resolvedUri||h.resolvedUri,mediaIndex:s,partIndex:d?o:null,isSyncRequest:a,startOfSegment:r,playlist:n,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:h.timeline,duration:d&&d.duration||h.duration,segment:h,part:d,byteLength:0,transmuxer:this.transmuxer_,getMediaInfoForTime:u,independent:t},y=typeof l<"u"?l:this.isPendingTimestampOffset_;m.timestampOffset=this.timestampOffsetForSegment_({segmentTimeline:h.timeline,currentTimeline:this.currentTimeline_,startOfSegment:r,buffered:this.buffered_(),overrideCheck:y});const v=Mc(this.sourceUpdater_.audioBuffered());return typeof v=="number"&&(m.audioAppendStart=v-this.sourceUpdater_.audioTimestampOffset()),this.sourceUpdater_.videoBuffered().length&&(m.gopsToAlignWith=kR(this.gopBuffer_,this.currentTime_()-this.sourceUpdater_.videoTimestampOffset(),this.timeMapping_)),m}timestampOffsetForSegment_(e){return qR(e)}earlyAbortWhenNeeded_(e){if(this.vhs_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH||Date.now()-(e.firstBytesReceivedAt||Date.now())<1e3)return;const t=this.currentTime_(),n=e.bandwidth,s=this.pendingSegment_.duration,r=xi.estimateSegmentRequestTime(s,n,this.playlist_,e.bytesReceived),a=pD(this.buffered_(),t,this.vhs_.tech_.playbackRate())-1;if(r<=a)return;const o=CR({main:this.vhs_.playlists.main,currentTime:t,bandwidth:n,duration:this.duration_(),segmentDuration:s,timeUntilRebuffer:a,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(!o)return;const u=r-a-o.rebufferingImpact;let h=.5;a<=gn&&(h=1),!(!o.playlist||o.playlist.uri===this.playlist_.uri||u<h)&&(this.bandwidth=o.playlist.attributes.BANDWIDTH*jt.BANDWIDTH_VARIANCE+1,this.trigger("earlyabort"))}handleAbort_(e){this.logger_(`Aborting ${xr(e)}`),this.mediaRequestsAborted+=1}handleProgress_(e,t){this.earlyAbortWhenNeeded_(t.stats),!this.checkForAbort_(t.requestId)&&this.trigger("progress")}handleTrackInfo_(e,t){this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId)&&(this.checkForIllegalMediaSwitch(t)||(t=t||{},HR(this.currentMediaInfo_,t)||(this.appendInitSegment_={audio:!0,video:!0},this.startingMediaInfo_=t,this.currentMediaInfo_=t,this.logger_("trackinfo update",t),this.trigger("trackinfo")),!this.checkForAbort_(e.requestId)&&(this.pendingSegment_.trackInfo=t,this.hasEnoughInfoToAppend_()&&this.processCallQueue_())))}handleTimingInfo_(e,t,n,s){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;const r=this.pendingSegment_,a=qm(t);r[a]=r[a]||{},r[a][n]=s,this.logger_(`timinginfo: ${t} - ${n} - ${s}`),this.hasEnoughInfoToAppend_()&&this.processCallQueue_()}handleCaptions_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(t.length===0){this.logger_("SegmentLoader received no captions from a caption event");return}if(!this.pendingSegment_.hasAppendedData_){this.metadataQueue_.caption.push(this.handleCaptions_.bind(this,e,t));return}const s=this.sourceUpdater_.videoTimestampOffset()===null?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),r={};t.forEach(a=>{r[a.stream]=r[a.stream]||{startTime:1/0,captions:[],endTime:0};const o=r[a.stream];o.startTime=Math.min(o.startTime,a.startTime+s),o.endTime=Math.max(o.endTime,a.endTime+s),o.captions.push(a)}),Object.keys(r).forEach(a=>{const{startTime:o,endTime:l,captions:u}=r[a],h=this.inbandTextTracks_;this.logger_(`adding cues from ${o} -> ${l} for ${a}`),DR(h,this.vhs_.tech_,a),Ha(o,l,h[a]),RR({captionArray:u,inbandTextTracks:h,timestampOffset:s})}),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}handleId3_(e,t,n){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(!this.pendingSegment_.hasAppendedData_){this.metadataQueue_.id3.push(this.handleId3_.bind(this,e,t,n));return}this.addMetadataToTextTrack(n,t,this.duration_())}processMetadataQueue_(){this.metadataQueue_.id3.forEach(e=>e()),this.metadataQueue_.caption.forEach(e=>e()),this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]}processCallQueue_(){const e=this.callQueue_;this.callQueue_=[],e.forEach(t=>t())}processLoadQueue_(){const e=this.loadQueue_;this.loadQueue_=[],e.forEach(t=>t())}hasEnoughInfoToLoad_(){if(this.loaderType_!=="audio")return!0;const e=this.pendingSegment_;return e?this.getCurrentMediaInfo_()?!$m({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}):!0:!1}getCurrentMediaInfo_(e=this.pendingSegment_){return e&&e.trackInfo||this.currentMediaInfo_}getMediaInfo_(e=this.pendingSegment_){return this.getCurrentMediaInfo_(e)||this.startingMediaInfo_}getPendingSegmentPlaylist(){return this.pendingSegment_?this.pendingSegment_.playlist:null}hasEnoughInfoToAppend_(){if(!this.sourceUpdater_.ready()||this.waitingOnRemove_||this.quotaExceededErrorRetryTimeout_)return!1;const e=this.pendingSegment_,t=this.getCurrentMediaInfo_();if(!e||!t)return!1;const{hasAudio:n,hasVideo:s,isMuxed:r}=t;return!(s&&!e.videoTimingInfo||n&&!this.audioDisabled_&&!r&&!e.audioTimingInfo||$m({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))}handleData_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(this.callQueue_.length||!this.hasEnoughInfoToAppend_()){this.callQueue_.push(this.handleData_.bind(this,e,t));return}const n=this.pendingSegment_;if(this.setTimeMapping_(n.timeline),this.updateMediaSecondsLoaded_(n.part||n.segment),this.mediaSource_.readyState!=="closed"){if(e.map&&(e.map=this.initSegmentForMap(e.map,!0),n.segment.map=e.map),e.key&&this.segmentKey(e.key,!0),n.isFmp4=e.isFmp4,n.timingInfo=n.timingInfo||{},n.isFmp4)this.trigger("fmp4"),n.timingInfo.start=n[qm(t.type)].start;else{const s=this.getCurrentMediaInfo_(),r=this.loaderType_==="main"&&s&&s.hasVideo;let a;r&&(a=n.videoTimingInfo.start),n.timingInfo.start=this.trueSegmentStart_({currentStart:n.timingInfo.start,playlist:n.playlist,mediaIndex:n.mediaIndex,currentVideoTimestampOffset:this.sourceUpdater_.videoTimestampOffset(),useVideoTimingInfo:r,firstVideoFrameTimeForData:a,videoTimingInfo:n.videoTimingInfo,audioTimingInfo:n.audioTimingInfo})}if(this.updateAppendInitSegmentStatus(n,t.type),this.updateSourceBufferTimestampOffset_(n),n.isSyncRequest){this.updateTimingInfoEnd_(n),this.syncController_.saveSegmentTimingInfo({segmentInfo:n,shouldSaveTimelineMapping:this.loaderType_==="main"});const s=this.chooseNextRequest_();if(s.mediaIndex!==n.mediaIndex||s.partIndex!==n.partIndex){this.logger_("sync segment was incorrect, not appending");return}this.logger_("sync segment was correct, appending")}n.hasAppendedData_=!0,this.processMetadataQueue_(),this.appendData_(n,t)}}updateAppendInitSegmentStatus(e,t){this.loaderType_==="main"&&typeof e.timestampOffset=="number"&&!e.changedTimestampOffset&&(this.appendInitSegment_={audio:!0,video:!0}),this.playlistOfLastInitSegment_[t]!==e.playlist&&(this.appendInitSegment_[t]=!0)}getInitSegmentAndUpdateState_({type:e,initSegment:t,map:n,playlist:s}){if(n){const r=Vl(n);if(this.activeInitSegmentId_===r)return null;t=this.initSegmentForMap(n,!0).bytes,this.activeInitSegmentId_=r}return t&&this.appendInitSegment_[e]?(this.playlistOfLastInitSegment_[e]=s,this.appendInitSegment_[e]=!1,this.activeInitSegmentId_=null,t):null}handleQuotaExceededError_({segmentInfo:e,type:t,bytes:n},s){const r=this.sourceUpdater_.audioBuffered(),a=this.sourceUpdater_.videoBuffered();r.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the audio buffer: "+Us(r).join(", ")),a.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the video buffer: "+Us(a).join(", "));const o=r.length?r.start(0):0,l=r.length?r.end(r.length-1):0,u=a.length?a.start(0):0,h=a.length?a.end(a.length-1):0;if(l-o<=La&&h-u<=La){this.logger_(`On QUOTA_EXCEEDED_ERR, single segment too large to append to buffer, triggering an error. Appended byte length: ${n.byteLength}, audio buffer: ${Us(r).join(", ")}, video buffer: ${Us(a).join(", ")}, `),this.error({message:"Quota exceeded error with append of a single segment of content",excludeUntil:1/0,metadata:{errorType:q.Error.SegmentExceedsSourceBufferQuota}}),this.trigger("error");return}this.waitingOnRemove_=!0,this.callQueue_.push(this.appendToSourceBuffer_.bind(this,{segmentInfo:e,type:t,bytes:n}));const m=this.currentTime_()-La;this.logger_(`On QUOTA_EXCEEDED_ERR, removing audio/video from 0 to ${m}`),this.remove(0,m,()=>{this.logger_(`On QUOTA_EXCEEDED_ERR, retrying append in ${La}s`),this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=N.setTimeout(()=>{this.logger_("On QUOTA_EXCEEDED_ERR, re-processing call queue"),this.quotaExceededErrorRetryTimeout_=null,this.processCallQueue_()},La*1e3)},!0)}handleAppendError_({segmentInfo:e,type:t,bytes:n},s){if(s){if(s.code===Mv){this.handleQuotaExceededError_({segmentInfo:e,type:t,bytes:n});return}this.logger_("Received non QUOTA_EXCEEDED_ERR on append",s),this.error({message:`${t} append of ${n.length}b failed for segment #${e.mediaIndex} in playlist ${e.playlist.id}`,metadata:{errorType:q.Error.SegmentAppendError}}),this.trigger("appenderror")}}appendToSourceBuffer_({segmentInfo:e,type:t,initSegment:n,data:s,bytes:r}){if(!r){const a=[s];let o=s.byteLength;n&&(a.unshift(n),o+=n.byteLength),r=wR({bytes:o,segments:a})}this.sourceUpdater_.appendBuffer({segmentInfo:e,type:t,bytes:r},this.handleAppendError_.bind(this,{segmentInfo:e,type:t,bytes:r}))}handleSegmentTimingInfo_(e,t,n){if(!this.pendingSegment_||t!==this.pendingSegment_.requestId)return;const s=this.pendingSegment_.segment,r=`${e}TimingInfo`;s[r]||(s[r]={}),s[r].transmuxerPrependedSeconds=n.prependedContentDuration||0,s[r].transmuxedPresentationStart=n.start.presentation,s[r].transmuxedDecodeStart=n.start.decode,s[r].transmuxedPresentationEnd=n.end.presentation,s[r].transmuxedDecodeEnd=n.end.decode,s[r].baseMediaDecodeTime=n.baseMediaDecodeTime}appendData_(e,t){const{type:n,data:s}=t;if(!s||!s.byteLength||n==="audio"&&this.audioDisabled_)return;const r=this.getInitSegmentAndUpdateState_({type:n,initSegment:t.initSegment,playlist:e.playlist,map:e.isFmp4?e.segment.map:null});this.appendToSourceBuffer_({segmentInfo:e,type:n,initSegment:r,data:s})}loadSegment_(e){if(this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),typeof e.timestampOffset=="number"&&this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),!this.hasEnoughInfoToLoad_()){this.loadQueue_.push(()=>{const t=zi({},e,{forceTimestampOffset:!0});zi(e,this.generateSegmentInfo_(t)),this.isPendingTimestampOffset_=!1,this.updateTransmuxerAndRequestSegment_(e)});return}this.updateTransmuxerAndRequestSegment_(e)}updateTransmuxerAndRequestSegment_(e){this.shouldUpdateTransmuxerTimestampOffset_(e.timestampOffset)&&(this.gopBuffer_.length=0,e.gopsToAlignWith=[],this.timeMapping_=0,this.transmuxer_.postMessage({action:"reset"}),this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e.timestampOffset}));const t=this.createSimplifiedSegmentObj_(e),n=this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex),s=this.mediaIndex!==null,r=e.timeline!==this.currentTimeline_&&e.timeline>0,a=n||s&&r;this.logger_(`Requesting
${Cv(e.uri)}
${xr(e)}`),t.map&&!t.map.bytes&&(this.logger_("going to request init segment."),this.appendInitSegment_={video:!0,audio:!0}),e.abortRequests=TR({xhr:this.vhs_.xhr,xhrOptions:this.xhrOptions_,decryptionWorker:this.decrypter_,segment:t,abortFn:this.handleAbort_.bind(this,e),progressFn:this.handleProgress_.bind(this),trackInfoFn:this.handleTrackInfo_.bind(this),timingInfoFn:this.handleTimingInfo_.bind(this),videoSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"video",e.requestId),audioSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"audio",e.requestId),captionsFn:this.handleCaptions_.bind(this),isEndOfTimeline:a,endedTimelineFn:()=>{this.logger_("received endedtimeline callback")},id3Fn:this.handleId3_.bind(this),dataFn:this.handleData_.bind(this),doneFn:this.segmentRequestFinished_.bind(this),onTransmuxerLog:({message:o,level:l,stream:u})=>{this.logger_(`${xr(e)} logged from transmuxer stream ${u} as a ${l}: ${o}`)}})}trimBackBuffer_(e){const t=WR(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);t>0&&this.remove(0,t)}createSimplifiedSegmentObj_(e){const t=e.segment,n=e.part,s={resolvedUri:n?n.resolvedUri:t.resolvedUri,byterange:n?n.byterange:t.byterange,requestId:e.requestId,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,part:e.part},r=e.playlist.segments[e.mediaIndex-1];if(r&&r.timeline===t.timeline&&(r.videoTimingInfo?s.baseStartTime=r.videoTimingInfo.transmuxedDecodeEnd:r.audioTimingInfo&&(s.baseStartTime=r.audioTimingInfo.transmuxedDecodeEnd)),t.key){const a=t.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);s.key=this.segmentKey(t.key),s.key.iv=a}return t.map&&(s.map=this.initSegmentForMap(t.map)),s}saveTransferStats_(e){this.mediaRequests+=1,e&&(this.mediaBytesTransferred+=e.bytesReceived,this.mediaTransferDuration+=e.roundTripTime)}saveBandwidthRelatedStats_(e,t){if(this.pendingSegment_.byteLength=t.bytesReceived,e<pl){this.logger_(`Ignoring segment's bandwidth because its duration of ${e} is less than the min to record ${pl}`);return}this.bandwidth=t.bandwidth,this.roundTrip=t.roundTripTime}handleTimeout_(){this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate"),this.trigger("timeout")}segmentRequestFinished_(e,t,n){if(this.callQueue_.length){this.callQueue_.push(this.segmentRequestFinished_.bind(this,e,t,n));return}if(this.saveTransferStats_(t.stats),!this.pendingSegment_||t.requestId!==this.pendingSegment_.requestId)return;if(e){if(this.pendingSegment_=null,this.state="READY",e.code===vn.ABORTED)return;if(this.pause(),e.code===vn.TIMEOUT){this.handleTimeout_();return}this.mediaRequestsErrored+=1,this.error(e),this.trigger("error");return}const s=this.pendingSegment_;this.saveBandwidthRelatedStats_(s.duration,t.stats),s.endOfAllRequests=t.endOfAllRequests,n.gopInfo&&(this.gopBuffer_=FR(this.gopBuffer_,n.gopInfo,this.safeAppend_)),this.state="APPENDING",this.trigger("appending"),this.waitForAppendsToComplete_(s)}setTimeMapping_(e){const t=this.syncController_.mappingForTimeline(e);t!==null&&(this.timeMapping_=t)}updateMediaSecondsLoaded_(e){typeof e.start=="number"&&typeof e.end=="number"?this.mediaSecondsLoaded+=e.end-e.start:this.mediaSecondsLoaded+=e.duration}shouldUpdateTransmuxerTimestampOffset_(e){return e===null?!1:this.loaderType_==="main"&&e!==this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&e!==this.sourceUpdater_.audioTimestampOffset()}trueSegmentStart_({currentStart:e,playlist:t,mediaIndex:n,firstVideoFrameTimeForData:s,currentVideoTimestampOffset:r,useVideoTimingInfo:a,videoTimingInfo:o,audioTimingInfo:l}){if(typeof e<"u")return e;if(!a)return l.start;const u=t.segments[n-1];return n===0||!u||typeof u.start>"u"||u.end!==s+r?s:o.start}waitForAppendsToComplete_(e){const t=this.getCurrentMediaInfo_(e);if(!t){this.error({message:"No starting media returned, likely due to an unsupported media format.",playlistExclusionDuration:1/0,metadata:{errorType:q.Error.SegmentUnsupportedMediaFormat}}),this.trigger("error");return}const{hasAudio:n,hasVideo:s,isMuxed:r}=t,a=this.loaderType_==="main"&&s,o=!this.audioDisabled_&&n&&!r;if(e.waitingOnAppends=0,!e.hasAppendedData_){!e.timingInfo&&typeof e.timestampOffset=="number"&&(this.isPendingTimestampOffset_=!0),e.timingInfo={start:0},e.waitingOnAppends++,this.isPendingTimestampOffset_||(this.updateSourceBufferTimestampOffset_(e),this.processMetadataQueue_()),this.checkAppendsDone_(e);return}a&&e.waitingOnAppends++,o&&e.waitingOnAppends++,a&&this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this,e)),o&&this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this,e))}checkAppendsDone_(e){this.checkForAbort_(e.requestId)||(e.waitingOnAppends--,e.waitingOnAppends===0&&this.handleAppendsDone_())}checkForIllegalMediaSwitch(e){const t=GR(this.loaderType_,this.getCurrentMediaInfo_(),e);return t?(this.error({message:t,playlistExclusionDuration:1/0,metadata:{errorType:q.Error.SegmentSwitchError}}),this.trigger("error"),!0):!1}updateSourceBufferTimestampOffset_(e){if(e.timestampOffset===null||typeof e.timingInfo.start!="number"||e.changedTimestampOffset||this.loaderType_!=="main")return;let t=!1;e.timestampOffset-=this.getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e.segment.videoTimingInfo,audioTimingInfo:e.segment.audioTimingInfo,timingInfo:e.timingInfo}),e.changedTimestampOffset=!0,e.timestampOffset!==this.sourceUpdater_.videoTimestampOffset()&&(this.sourceUpdater_.videoTimestampOffset(e.timestampOffset),t=!0),e.timestampOffset!==this.sourceUpdater_.audioTimestampOffset()&&(this.sourceUpdater_.audioTimestampOffset(e.timestampOffset),t=!0),t&&this.trigger("timestampoffset")}getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e,audioTimingInfo:t,timingInfo:n}){return this.useDtsForTimestampOffset_?e&&typeof e.transmuxedDecodeStart=="number"?e.transmuxedDecodeStart:t&&typeof t.transmuxedDecodeStart=="number"?t.transmuxedDecodeStart:n.start:n.start}updateTimingInfoEnd_(e){e.timingInfo=e.timingInfo||{};const t=this.getMediaInfo_(),s=this.loaderType_==="main"&&t&&t.hasVideo&&e.videoTimingInfo?e.videoTimingInfo:e.audioTimingInfo;s&&(e.timingInfo.end=typeof s.end=="number"?s.end:s.start+e.duration)}handleAppendsDone_(){if(this.pendingSegment_&&this.trigger("appendsdone"),!this.pendingSegment_){this.state="READY",this.paused()||this.monitorBuffer_();return}const e=this.pendingSegment_;e.part&&e.part.syncInfo?e.part.syncInfo.markAppended():e.segment.syncInfo&&e.segment.syncInfo.markAppended(),this.updateTimingInfoEnd_(e),this.shouldSaveSegmentTimingInfo_&&this.syncController_.saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:this.loaderType_==="main"});const t=jR(e,this.sourceType_);if(t&&(t.severity==="warn"?q.log.warn(t.message):this.logger_(t.message)),this.recordThroughput_(e),this.pendingSegment_=null,this.state="READY",e.isSyncRequest&&(this.trigger("syncinfoupdate"),!e.hasAppendedData_)){this.logger_(`Throwing away un-appended sync request ${xr(e)}`);return}this.logger_(`Appended ${xr(e)}`),this.addSegmentMetadataCue_(e),this.fetchAtBuffer_=!0,this.currentTimeline_!==e.timeline&&(this.timelineChangeController_.lastTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline}),this.loaderType_==="main"&&!this.audioDisabled_&&this.timelineChangeController_.lastTimelineChange({type:"audio",from:this.currentTimeline_,to:e.timeline})),this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate");const n=e.segment,s=e.part,r=n.end&&this.currentTime_()-n.end>e.playlist.targetDuration*3,a=s&&s.end&&this.currentTime_()-s.end>e.playlist.partTargetDuration*3;if(r||a){this.logger_(`bad ${r?"segment":"part"} ${xr(e)}`),this.resetEverything();return}this.mediaIndex!==null&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.mediaIndex=e.mediaIndex,this.partIndex=e.partIndex,this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex)&&this.endOfStream(),this.trigger("appended"),e.hasAppendedData_&&this.mediaAppends++,this.paused()||this.monitorBuffer_()}recordThroughput_(e){if(e.duration<pl){this.logger_(`Ignoring segment's throughput because its duration of ${e.duration} is less than the min to record ${pl}`);return}const t=this.throughput.rate,n=Date.now()-e.endOfAllRequests+1,s=Math.floor(e.byteLength/n*8*1e3);this.throughput.rate+=(s-t)/++this.throughput.count}addSegmentMetadataCue_(e){if(!this.segmentMetadataTrack_)return;const t=e.segment,n=t.start,s=t.end;if(!Wm(n)||!Wm(s))return;Ha(n,s,this.segmentMetadataTrack_);const r=N.WebKitDataCue||N.VTTCue,a={custom:t.custom,dateTimeObject:t.dateTimeObject,dateTimeString:t.dateTimeString,programDateTime:t.programDateTime,bandwidth:e.playlist.attributes.BANDWIDTH,resolution:e.playlist.attributes.RESOLUTION,codecs:e.playlist.attributes.CODECS,byteLength:e.byteLength,uri:e.uri,timeline:e.timeline,playlist:e.playlist.id,start:n,end:s},o=JSON.stringify(a),l=new r(n,s,o);l.value=a,this.segmentMetadataTrack_.addCue(l)}}function Gn(){}const wv=function(i){return typeof i!="string"?i:i.replace(/./,e=>e.toUpperCase())},XR=["video","audio"],_h=(i,e)=>{const t=e[`${i}Buffer`];return t&&t.updating||e.queuePending[i]},KR=(i,e)=>{for(let t=0;t<e.length;t++){const n=e[t];if(n.type==="mediaSource")return null;if(n.type===i)return t}return null},kr=(i,e)=>{if(e.queue.length===0)return;let t=0,n=e.queue[t];if(n.type==="mediaSource"){!e.updating()&&e.mediaSource.readyState!=="closed"&&(e.queue.shift(),n.action(e),n.doneFn&&n.doneFn(),kr("audio",e),kr("video",e));return}if(i!=="mediaSource"&&!(!e.ready()||e.mediaSource.readyState==="closed"||_h(i,e))){if(n.type!==i){if(t=KR(i,e.queue),t===null)return;n=e.queue[t]}if(e.queue.splice(t,1),e.queuePending[i]=n,n.action(i,e),!n.doneFn){e.queuePending[i]=null,kr(i,e);return}}},Dv=(i,e)=>{const t=e[`${i}Buffer`],n=wv(i);t&&(t.removeEventListener("updateend",e[`on${n}UpdateEnd_`]),t.removeEventListener("error",e[`on${n}Error_`]),e.codecs[i]=null,e[`${i}Buffer`]=null)},pn=(i,e)=>i&&e&&Array.prototype.indexOf.call(i.sourceBuffers,e)!==-1,Pi={appendBuffer:(i,e,t)=>(n,s)=>{const r=s[`${n}Buffer`];if(pn(s.mediaSource,r)){s.logger_(`Appending segment ${e.mediaIndex}'s ${i.length} bytes to ${n}Buffer`);try{r.appendBuffer(i)}catch(a){s.logger_(`Error with code ${a.code} `+(a.code===Mv?"(QUOTA_EXCEEDED_ERR) ":"")+`when appending segment ${e.mediaIndex} to ${n}Buffer`),s.queuePending[n]=null,t(a)}}},remove:(i,e)=>(t,n)=>{const s=n[`${t}Buffer`];if(pn(n.mediaSource,s)){n.logger_(`Removing ${i} to ${e} from ${t}Buffer`);try{s.remove(i,e)}catch{n.logger_(`Remove ${i} to ${e} from ${t}Buffer failed`)}}},timestampOffset:i=>(e,t)=>{const n=t[`${e}Buffer`];pn(t.mediaSource,n)&&(t.logger_(`Setting ${e}timestampOffset to ${i}`),n.timestampOffset=i)},callback:i=>(e,t)=>{i()},endOfStream:i=>e=>{if(e.mediaSource.readyState==="open"){e.logger_(`Calling mediaSource endOfStream(${i||""})`);try{e.mediaSource.endOfStream(i)}catch(t){q.log.warn("Failed to call media source endOfStream",t)}}},duration:i=>e=>{e.logger_(`Setting mediaSource duration to ${i}`);try{e.mediaSource.duration=i}catch(t){q.log.warn("Failed to set media source duration",t)}},abort:()=>(i,e)=>{if(e.mediaSource.readyState!=="open")return;const t=e[`${i}Buffer`];if(pn(e.mediaSource,t)){e.logger_(`calling abort on ${i}Buffer`);try{t.abort()}catch(n){q.log.warn(`Failed to abort on ${i}Buffer`,n)}}},addSourceBuffer:(i,e)=>t=>{const n=wv(i),s=to(e);t.logger_(`Adding ${i}Buffer with codec ${e} to mediaSource`);const r=t.mediaSource.addSourceBuffer(s);r.addEventListener("updateend",t[`on${n}UpdateEnd_`]),r.addEventListener("error",t[`on${n}Error_`]),t.codecs[i]=e,t[`${i}Buffer`]=r},removeSourceBuffer:i=>e=>{const t=e[`${i}Buffer`];if(Dv(i,e),!!pn(e.mediaSource,t)){e.logger_(`Removing ${i}Buffer with codec ${e.codecs[i]} from mediaSource`);try{e.mediaSource.removeSourceBuffer(t)}catch(n){q.log.warn(`Failed to removeSourceBuffer ${i}Buffer`,n)}}},changeType:i=>(e,t)=>{const n=t[`${e}Buffer`],s=to(i);if(!pn(t.mediaSource,n))return;const r=i.substring(0,i.indexOf(".")),a=t.codecs[e];if(a.substring(0,a.indexOf("."))!==r){t.logger_(`changing ${e}Buffer codec from ${t.codecs[e]} to ${i}`);try{n.changeType(s),t.codecs[e]=i}catch(l){q.log.warn(`Failed to changeType on ${e}Buffer`,l)}}}},Li=({type:i,sourceUpdater:e,action:t,doneFn:n,name:s})=>{e.queue.push({type:i,action:t,doneFn:n,name:s}),kr(i,e)},Xm=(i,e)=>t=>{const n=e[`${i}Buffered`](),s=hD(n);if(e.logger_(`received "updateend" event for ${i} Source Buffer: `,s),e.queuePending[i]){const r=e.queuePending[i].doneFn;e.queuePending[i]=null,r&&r(e[`${i}Error_`])}kr(i,e)};class Rv extends q.EventTarget{constructor(e){super(),this.mediaSource=e,this.sourceopenListener_=()=>kr("mediaSource",this),this.mediaSource.addEventListener("sourceopen",this.sourceopenListener_),this.logger_=$i("SourceUpdater"),this.audioTimestampOffset_=0,this.videoTimestampOffset_=0,this.queue=[],this.queuePending={audio:null,video:null},this.delayedAudioAppendQueue_=[],this.videoAppendQueued_=!1,this.codecs={},this.onVideoUpdateEnd_=Xm("video",this),this.onAudioUpdateEnd_=Xm("audio",this),this.onVideoError_=t=>{this.videoError_=t},this.onAudioError_=t=>{this.audioError_=t},this.createdSourceBuffers_=!1,this.initializedEme_=!1,this.triggeredReady_=!1}initializedEme(){this.initializedEme_=!0,this.triggerReady()}hasCreatedSourceBuffers(){return this.createdSourceBuffers_}hasInitializedAnyEme(){return this.initializedEme_}ready(){return this.hasCreatedSourceBuffers()&&this.hasInitializedAnyEme()}createSourceBuffers(e){this.hasCreatedSourceBuffers()||(this.addOrChangeSourceBuffers(e),this.createdSourceBuffers_=!0,this.trigger("createdsourcebuffers"),this.triggerReady())}triggerReady(){this.ready()&&!this.triggeredReady_&&(this.triggeredReady_=!0,this.trigger("ready"))}addSourceBuffer(e,t){Li({type:"mediaSource",sourceUpdater:this,action:Pi.addSourceBuffer(e,t),name:"addSourceBuffer"})}abort(e){Li({type:e,sourceUpdater:this,action:Pi.abort(e),name:"abort"})}removeSourceBuffer(e){if(!this.canRemoveSourceBuffer()){q.log.error("removeSourceBuffer is not supported!");return}Li({type:"mediaSource",sourceUpdater:this,action:Pi.removeSourceBuffer(e),name:"removeSourceBuffer"})}canRemoveSourceBuffer(){return!q.browser.IS_FIREFOX&&N.MediaSource&&N.MediaSource.prototype&&typeof N.MediaSource.prototype.removeSourceBuffer=="function"}static canChangeType(){return N.SourceBuffer&&N.SourceBuffer.prototype&&typeof N.SourceBuffer.prototype.changeType=="function"}canChangeType(){return this.constructor.canChangeType()}changeType(e,t){if(!this.canChangeType()){q.log.error("changeType is not supported!");return}Li({type:e,sourceUpdater:this,action:Pi.changeType(t),name:"changeType"})}addOrChangeSourceBuffers(e){if(!e||typeof e!="object"||Object.keys(e).length===0)throw new Error("Cannot addOrChangeSourceBuffers to undefined codecs");Object.keys(e).forEach(t=>{const n=e[t];if(!this.hasCreatedSourceBuffers())return this.addSourceBuffer(t,n);this.canChangeType()&&this.changeType(t,n)})}appendBuffer(e,t){const{segmentInfo:n,type:s,bytes:r}=e;if(this.processedAppend_=!0,s==="audio"&&this.videoBuffer&&!this.videoAppendQueued_){this.delayedAudioAppendQueue_.push([e,t]),this.logger_(`delayed audio append of ${r.length} until video append`);return}const a=t;if(Li({type:s,sourceUpdater:this,action:Pi.appendBuffer(r,n||{mediaIndex:-1},a),doneFn:t,name:"appendBuffer"}),s==="video"){if(this.videoAppendQueued_=!0,!this.delayedAudioAppendQueue_.length)return;const o=this.delayedAudioAppendQueue_.slice();this.logger_(`queuing delayed audio ${o.length} appendBuffers`),this.delayedAudioAppendQueue_.length=0,o.forEach(l=>{this.appendBuffer.apply(this,l)})}}audioBuffered(){return pn(this.mediaSource,this.audioBuffer)&&this.audioBuffer.buffered?this.audioBuffer.buffered:ni()}videoBuffered(){return pn(this.mediaSource,this.videoBuffer)&&this.videoBuffer.buffered?this.videoBuffer.buffered:ni()}buffered(){const e=pn(this.mediaSource,this.videoBuffer)?this.videoBuffer:null,t=pn(this.mediaSource,this.audioBuffer)?this.audioBuffer:null;return t&&!e?this.audioBuffered():e&&!t?this.videoBuffered():fD(this.audioBuffered(),this.videoBuffered())}setDuration(e,t=Gn){Li({type:"mediaSource",sourceUpdater:this,action:Pi.duration(e),name:"duration",doneFn:t})}endOfStream(e=null,t=Gn){typeof e!="string"&&(e=void 0),Li({type:"mediaSource",sourceUpdater:this,action:Pi.endOfStream(e),name:"endOfStream",doneFn:t})}removeAudio(e,t,n=Gn){if(!this.audioBuffered().length||this.audioBuffered().end(0)===0){n();return}Li({type:"audio",sourceUpdater:this,action:Pi.remove(e,t),doneFn:n,name:"remove"})}removeVideo(e,t,n=Gn){if(!this.videoBuffered().length||this.videoBuffered().end(0)===0){n();return}Li({type:"video",sourceUpdater:this,action:Pi.remove(e,t),doneFn:n,name:"remove"})}updating(){return!!(_h("audio",this)||_h("video",this))}audioTimestampOffset(e){return typeof e<"u"&&this.audioBuffer&&this.audioTimestampOffset_!==e&&(Li({type:"audio",sourceUpdater:this,action:Pi.timestampOffset(e),name:"timestampOffset"}),this.audioTimestampOffset_=e),this.audioTimestampOffset_}videoTimestampOffset(e){return typeof e<"u"&&this.videoBuffer&&this.videoTimestampOffset!==e&&(Li({type:"video",sourceUpdater:this,action:Pi.timestampOffset(e),name:"timestampOffset"}),this.videoTimestampOffset_=e),this.videoTimestampOffset_}audioQueueCallback(e){this.audioBuffer&&Li({type:"audio",sourceUpdater:this,action:Pi.callback(e),name:"callback"})}videoQueueCallback(e){this.videoBuffer&&Li({type:"video",sourceUpdater:this,action:Pi.callback(e),name:"callback"})}dispose(){this.trigger("dispose"),XR.forEach(e=>{this.abort(e),this.canRemoveSourceBuffer()?this.removeSourceBuffer(e):this[`${e}QueueCallback`](()=>Dv(e,this))}),this.videoAppendQueued_=!1,this.delayedAudioAppendQueue_.length=0,this.sourceopenListener_&&this.mediaSource.removeEventListener("sourceopen",this.sourceopenListener_),this.off()}}const Km=i=>decodeURIComponent(escape(String.fromCharCode.apply(null,i))),YR=i=>{const e=new Uint8Array(i);return Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("")},Ym=new Uint8Array(`

`.split("").map(i=>i.charCodeAt(0)));class QR extends Error{constructor(){super("Trying to parse received VTT cues, but there is no WebVTT. Make sure vtt.js is loaded.")}}class ZR extends gh{constructor(e,t={}){super(e,t),this.mediaSource_=null,this.subtitlesTrack_=null,this.featuresNativeTextTracks_=e.featuresNativeTextTracks,this.loadVttJs=e.loadVttJs,this.shouldSaveSegmentTimingInfo_=!1}createTransmuxer_(){return null}buffered_(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues||!this.subtitlesTrack_.cues.length)return ni();const e=this.subtitlesTrack_.cues,t=e[0].startTime,n=e[e.length-1].startTime;return ni([[t,n]])}initSegmentForMap(e,t=!1){if(!e)return null;const n=Vl(e);let s=this.initSegments_[n];if(t&&!s&&e.bytes){const r=Ym.byteLength+e.bytes.byteLength,a=new Uint8Array(r);a.set(e.bytes),a.set(Ym,e.bytes.byteLength),this.initSegments_[n]=s={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:a}}return s||e}couldBeginLoading_(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}track(e){return typeof e>"u"?this.subtitlesTrack_:(this.subtitlesTrack_=e,this.state==="INIT"&&this.couldBeginLoading_()&&this.init_(),this.subtitlesTrack_)}remove(e,t){Ha(e,t,this.subtitlesTrack_)}fillBuffer_(){const e=this.chooseNextRequest_();if(e){if(this.syncController_.timestampOffsetForTimeline(e.timeline)===null){const t=()=>{this.state="READY",this.paused()||this.monitorBuffer_()};this.syncController_.one("timestampoffset",t),this.state="WAITING_ON_TIMELINE";return}this.loadSegment_(e)}}timestampOffsetForSegment_(){return null}chooseNextRequest_(){return this.skipEmptySegments_(super.chooseNextRequest_())}skipEmptySegments_(e){for(;e&&e.segment.empty;){if(e.mediaIndex+1>=e.playlist.segments.length){e=null;break}e=this.generateSegmentInfo_({playlist:e.playlist,mediaIndex:e.mediaIndex+1,startOfSegment:e.startOfSegment+e.duration,isSyncRequest:e.isSyncRequest})}return e}stopForError(e){this.error(e),this.state="READY",this.pause(),this.trigger("error")}segmentRequestFinished_(e,t,n){if(!this.subtitlesTrack_){this.state="READY";return}if(this.saveTransferStats_(t.stats),!this.pendingSegment_){this.state="READY",this.mediaRequestsAborted+=1;return}if(e){e.code===vn.TIMEOUT&&this.handleTimeout_(),e.code===vn.ABORTED?this.mediaRequestsAborted+=1:this.mediaRequestsErrored+=1,this.stopForError(e);return}const s=this.pendingSegment_;this.saveBandwidthRelatedStats_(s.duration,t.stats),t.key&&this.segmentKey(t.key,!0),this.state="APPENDING",this.trigger("appending");const r=s.segment;if(r.map&&(r.map.bytes=t.map.bytes),s.bytes=t.bytes,typeof N.WebVTT!="function"&&typeof this.loadVttJs=="function"){this.state="WAITING_ON_VTTJS",this.loadVttJs().then(()=>this.segmentRequestFinished_(e,t,n),()=>this.stopForError({message:"Error loading vtt.js",metadata:{errorType:q.Error.VttLoadError}}));return}r.requested=!0;try{this.parseVTTCues_(s)}catch(a){this.stopForError({message:a.message,metadata:{errorType:q.Error.VttCueParsingError}});return}if(this.updateTimeMapping_(s,this.syncController_.timelines[s.timeline],this.playlist_),s.cues.length?s.timingInfo={start:s.cues[0].startTime,end:s.cues[s.cues.length-1].endTime}:s.timingInfo={start:s.startOfSegment,end:s.startOfSegment+s.duration},s.isSyncRequest){this.trigger("syncinfoupdate"),this.pendingSegment_=null,this.state="READY";return}s.byteLength=s.bytes.byteLength,this.mediaSecondsLoaded+=r.duration,s.cues.forEach(a=>{this.subtitlesTrack_.addCue(this.featuresNativeTextTracks_?new N.VTTCue(a.startTime,a.endTime,a.text):a)}),NR(this.subtitlesTrack_),this.handleAppendsDone_()}handleData_(){}updateTimingInfoEnd_(){}parseVTTCues_(e){let t,n=!1;if(typeof N.WebVTT!="function")throw new QR;typeof N.TextDecoder=="function"?t=new N.TextDecoder("utf8"):(t=N.WebVTT.StringDecoder(),n=!0);const s=new N.WebVTT.Parser(N,N.vttjs,t);if(e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},s.oncue=e.cues.push.bind(e.cues),s.ontimestampmap=a=>{e.timestampmap=a},s.onparsingerror=a=>{q.log.warn("Error encountered when parsing cues: "+a.message)},e.segment.map){let a=e.segment.map.bytes;n&&(a=Km(a)),s.parse(a)}let r=e.bytes;n&&(r=Km(r)),s.parse(r),s.flush()}updateTimeMapping_(e,t,n){const s=e.segment;if(!t)return;if(!e.cues.length){s.empty=!0;return}const{MPEGTS:r,LOCAL:a}=e.timestampmap,l=r/Os.ONE_SECOND_IN_TS-a+t.mapping;if(e.cues.forEach(u=>{const h=u.endTime-u.startTime,d=r===0?u.startTime+l:this.handleRollover_(u.startTime+l,t.time);u.startTime=Math.max(d,0),u.endTime=Math.max(d+h,0)}),!n.syncInfo){const u=e.cues[0].startTime,h=e.cues[e.cues.length-1].startTime;n.syncInfo={mediaSequence:n.mediaSequence+e.mediaIndex,time:Math.min(u,h-s.duration)}}}handleRollover_(e,t){if(t===null)return e;let n=e*Os.ONE_SECOND_IN_TS;const s=t*Os.ONE_SECOND_IN_TS;let r;for(s<n?r=-8589934592:r=8589934592;Math.abs(n-s)>4294967296;)n+=r;return n/Os.ONE_SECOND_IN_TS}}const JR=function(i,e){const t=i.cues;for(let n=0;n<t.length;n++){const s=t[n];if(e>=s.adStartTime&&e<=s.adEndTime)return s}return null},eP=function(i,e,t=0){if(!i.segments)return;let n=t,s;for(let r=0;r<i.segments.length;r++){const a=i.segments[r];if(s||(s=JR(e,n+a.duration/2)),s){if("cueIn"in a){s.endTime=n,s.adEndTime=n,n+=a.duration,s=null;continue}if(n<s.endTime){n+=a.duration;continue}s.endTime+=a.duration}else if("cueOut"in a&&(s=new N.VTTCue(n,n+a.duration,a.cueOut),s.adStartTime=n,s.adEndTime=n+parseFloat(a.cueOut),e.addCue(s)),"cueOutCont"in a){const[o,l]=a.cueOutCont.split("/").map(parseFloat);s=new N.VTTCue(n,n+a.duration,""),s.adStartTime=n-o,s.adEndTime=s.adStartTime+l,e.addCue(s)}n+=a.duration}};class Qm{constructor({start:e,end:t,segmentIndex:n,partIndex:s=null,appended:r=!1}){this.start_=e,this.end_=t,this.segmentIndex_=n,this.partIndex_=s,this.appended_=r}isInRange(e){return e>=this.start&&e<this.end}markAppended(){this.appended_=!0}resetAppendedStatus(){this.appended_=!1}get isAppended(){return this.appended_}get start(){return this.start_}get end(){return this.end_}get segmentIndex(){return this.segmentIndex_}get partIndex(){return this.partIndex_}}class tP{constructor(e,t=[]){this.segmentSyncInfo_=e,this.partsSyncInfo_=t}get segmentSyncInfo(){return this.segmentSyncInfo_}get partsSyncInfo(){return this.partsSyncInfo_}get hasPartsSyncInfo(){return this.partsSyncInfo_.length>0}resetAppendStatus(){this.segmentSyncInfo_.resetAppendedStatus(),this.partsSyncInfo_.forEach(e=>e.resetAppendedStatus())}}class Rc{constructor(){this.storage_=new Map,this.diagnostics_="",this.isReliable_=!1,this.start_=-1/0,this.end_=1/0}get start(){return this.start_}get end(){return this.end_}get diagnostics(){return this.diagnostics_}get isReliable(){return this.isReliable_}resetAppendedStatus(){this.storage_.forEach(e=>e.resetAppendStatus())}update(e,t){const{mediaSequence:n,segments:s}=e;if(this.isReliable_=this.isReliablePlaylist_(n,s),!!this.isReliable_)return this.updateStorage_(s,n,this.calculateBaseTime_(n,t))}getSyncInfoForTime(e){for(const{segmentSyncInfo:t,partsSyncInfo:n}of this.storage_.values())if(n.length){for(const s of n)if(s.isInRange(e))return s}else if(t.isInRange(e))return t;return null}updateStorage_(e,t,n){const s=new Map;let r=`
`,a=n,o=t;this.start_=a,e.forEach((l,u)=>{const h=this.storage_.get(o),d=a,m=d+l.duration,y=Boolean(h&&h.segmentSyncInfo&&h.segmentSyncInfo.isAppended),v=new Qm({start:d,end:m,appended:y,segmentIndex:u});l.syncInfo=v;let b=a;const x=(l.parts||[]).map((_,E)=>{const A=b,w=b+_.duration,C=Boolean(h&&h.partsSyncInfo&&h.partsSyncInfo[E]&&h.partsSyncInfo[E].isAppended),I=new Qm({start:A,end:w,appended:C,segmentIndex:u,partIndex:E});return b=w,r+=`Media Sequence: ${o}.${E} | Range: ${A} --> ${w} | Appended: ${C}
`,_.syncInfo=I,I});s.set(o,new tP(v,x)),r+=`${Cv(l.resolvedUri)} | Media Sequence: ${o} | Range: ${d} --> ${m} | Appended: ${y}
`,o++,a=m}),this.end_=a,this.storage_=s,this.diagnostics_=r}calculateBaseTime_(e,t){return this.storage_.size?this.storage_.has(e)?this.storage_.get(e).segmentSyncInfo.start:t:0}isReliablePlaylist_(e,t){return e!=null&&Array.isArray(t)&&t.length}}const iP=86400,Pc=[{name:"VOD",run:(i,e,t,n,s)=>t!==1/0?{time:0,segmentIndex:0,partIndex:null}:null},{name:"MediaSequence",run:(i,e,t,n,s,r)=>{const a=i.getMediaSequenceSync(r);if(!a||!a.isReliable)return null;const o=a.getSyncInfoForTime(s);return o?{time:o.start,partIndex:o.partIndex,segmentIndex:o.segmentIndex}:null}},{name:"ProgramDateTime",run:(i,e,t,n,s)=>{if(!Object.keys(i.timelineToDatetimeMappings).length)return null;let r=null,a=null;const o=lh(e);s=s||0;for(let l=0;l<o.length;l++){const u=e.endList||s===0?l:o.length-(l+1),h=o[u],d=h.segment,m=i.timelineToDatetimeMappings[d.timeline];if(!m||!d.dateTimeObject)continue;let v=d.dateTimeObject.getTime()/1e3+m;if(d.parts&&typeof h.partIndex=="number")for(let x=0;x<h.partIndex;x++)v+=d.parts[x].duration;const b=Math.abs(s-v);if(a!==null&&(b===0||a<b))break;a=b,r={time:v,segmentIndex:h.segmentIndex,partIndex:h.partIndex}}return r}},{name:"Segment",run:(i,e,t,n,s)=>{let r=null,a=null;s=s||0;const o=lh(e);for(let l=0;l<o.length;l++){const u=e.endList||s===0?l:o.length-(l+1),h=o[u],d=h.segment,m=h.part&&h.part.start||d&&d.start;if(d.timeline===n&&typeof m<"u"){const y=Math.abs(s-m);if(a!==null&&a<y)break;(!r||a===null||a>=y)&&(a=y,r={time:m,segmentIndex:h.segmentIndex,partIndex:h.partIndex})}}return r}},{name:"Discontinuity",run:(i,e,t,n,s)=>{let r=null;if(s=s||0,e.discontinuityStarts&&e.discontinuityStarts.length){let a=null;for(let o=0;o<e.discontinuityStarts.length;o++){const l=e.discontinuityStarts[o],u=e.discontinuitySequence+o+1,h=i.discontinuities[u];if(h){const d=Math.abs(s-h.time);if(a!==null&&a<d)break;(!r||a===null||a>=d)&&(a=d,r={time:h.time,segmentIndex:l,partIndex:null})}}}return r}},{name:"Playlist",run:(i,e,t,n,s)=>e.syncInfo?{time:e.syncInfo.time,segmentIndex:e.syncInfo.mediaSequence-e.mediaSequence,partIndex:null}:null}];class nP extends q.EventTarget{constructor(e={}){super(),this.timelines=[],this.discontinuities=[],this.timelineToDatetimeMappings={},this.mediaSequenceStorage_={main:new Rc,audio:new Rc,vtt:new Rc},this.logger_=$i("SyncController")}getMediaSequenceSync(e){return this.mediaSequenceStorage_[e]||null}getSyncPoint(e,t,n,s,r){if(t!==1/0)return Pc.find(({name:l})=>l==="VOD").run(this,e,t);const a=this.runStrategies_(e,t,n,s,r);if(!a.length)return null;for(const o of a){const{syncPoint:l,strategy:u}=o,{segmentIndex:h,time:d}=l;if(h<0)continue;const m=e.segments[h],y=d,v=y+m.duration;if(this.logger_(`Strategy: ${u}. Current time: ${s}. selected segment: ${h}. Time: [${y} -> ${v}]}`),s>=y&&s<v)return this.logger_("Found sync point with exact match: ",l),l}return this.selectSyncPoint_(a,{key:"time",value:s})}getExpiredTime(e,t){if(!e||!e.segments)return null;const n=this.runStrategies_(e,t,e.discontinuitySequence,0);if(!n.length)return null;const s=this.selectSyncPoint_(n,{key:"segmentIndex",value:0});return s.segmentIndex>0&&(s.time*=-1),Math.abs(s.time+Xa({defaultDuration:e.targetDuration,durationList:e.segments,startIndex:s.segmentIndex,endIndex:0}))}runStrategies_(e,t,n,s,r){const a=[];for(let o=0;o<Pc.length;o++){const l=Pc[o],u=l.run(this,e,t,n,s,r);u&&(u.strategy=l.name,a.push({strategy:l.name,syncPoint:u}))}return a}selectSyncPoint_(e,t){let n=e[0].syncPoint,s=Math.abs(e[0].syncPoint[t.key]-t.value),r=e[0].strategy;for(let a=1;a<e.length;a++){const o=Math.abs(e[a].syncPoint[t.key]-t.value);o<s&&(s=o,n=e[a].syncPoint,r=e[a].strategy)}return this.logger_(`syncPoint for [${t.key}: ${t.value}] chosen with strategy [${r}]: [time:${n.time}, segmentIndex:${n.segmentIndex}`+(typeof n.partIndex=="number"?`,partIndex:${n.partIndex}`:"")+"]"),n}saveExpiredSegmentInfo(e,t){const n=t.mediaSequence-e.mediaSequence;if(n>iP){q.log.warn(`Not saving expired segment info. Media sequence gap ${n} is too large.`);return}for(let s=n-1;s>=0;s--){const r=e.segments[s];if(r&&typeof r.start<"u"){t.syncInfo={mediaSequence:e.mediaSequence+s,time:r.start},this.logger_(`playlist refresh sync: [time:${t.syncInfo.time}, mediaSequence: ${t.syncInfo.mediaSequence}]`),this.trigger("syncinfoupdate");break}}}setDateTimeMappingForStart(e){if(this.timelineToDatetimeMappings={},e.segments&&e.segments.length&&e.segments[0].dateTimeObject){const t=e.segments[0],n=t.dateTimeObject.getTime()/1e3;this.timelineToDatetimeMappings[t.timeline]=-n}}saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:t}){const n=this.calculateSegmentTimeMapping_(e,e.timingInfo,t),s=e.segment;n&&(this.saveDiscontinuitySyncInfo_(e),e.playlist.syncInfo||(e.playlist.syncInfo={mediaSequence:e.playlist.mediaSequence+e.mediaIndex,time:s.start}));const r=s.dateTimeObject;s.discontinuity&&t&&r&&(this.timelineToDatetimeMappings[s.timeline]=-(r.getTime()/1e3))}timestampOffsetForTimeline(e){return typeof this.timelines[e]>"u"?null:this.timelines[e].time}mappingForTimeline(e){return typeof this.timelines[e]>"u"?null:this.timelines[e].mapping}calculateSegmentTimeMapping_(e,t,n){const s=e.segment,r=e.part;let a=this.timelines[e.timeline],o,l;if(typeof e.timestampOffset=="number")a={time:e.startOfSegment,mapping:e.startOfSegment-t.start},n&&(this.timelines[e.timeline]=a,this.trigger("timestampoffset"),this.logger_(`time mapping for timeline ${e.timeline}: [time: ${a.time}] [mapping: ${a.mapping}]`)),o=e.startOfSegment,l=t.end+a.mapping;else if(a)o=t.start+a.mapping,l=t.end+a.mapping;else return!1;return r&&(r.start=o,r.end=l),(!s.start||o<s.start)&&(s.start=o),s.end=l,!0}saveDiscontinuitySyncInfo_(e){const t=e.playlist,n=e.segment;if(n.discontinuity)this.discontinuities[n.timeline]={time:n.start,accuracy:0};else if(t.discontinuityStarts&&t.discontinuityStarts.length)for(let s=0;s<t.discontinuityStarts.length;s++){const r=t.discontinuityStarts[s],a=t.discontinuitySequence+s+1,o=r-e.mediaIndex,l=Math.abs(o);if(!this.discontinuities[a]||this.discontinuities[a].accuracy>l){let u;o<0?u=n.start-Xa({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex,endIndex:r}):u=n.end+Xa({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex+1,endIndex:r}),this.discontinuities[a]={time:u,accuracy:l}}}}dispose(){this.trigger("dispose"),this.off()}}class sP extends q.EventTarget{constructor(){super(),this.pendingTimelineChanges_={},this.lastTimelineChanges_={}}clearPendingTimelineChange(e){this.pendingTimelineChanges_[e]=null,this.trigger("pendingtimelinechange")}pendingTimelineChange({type:e,from:t,to:n}){return typeof t=="number"&&typeof n=="number"&&(this.pendingTimelineChanges_[e]={type:e,from:t,to:n},this.trigger("pendingtimelinechange")),this.pendingTimelineChanges_[e]}lastTimelineChange({type:e,from:t,to:n}){return typeof t=="number"&&typeof n=="number"&&(this.lastTimelineChanges_[e]={type:e,from:t,to:n},delete this.pendingTimelineChanges_[e],this.trigger("timelinechange")),this.lastTimelineChanges_[e]}dispose(){this.trigger("dispose"),this.pendingTimelineChanges_={},this.lastTimelineChanges_={},this.off()}}const rP=mv(gv(function(){var i=function(){function b(){this.listeners={}}var x=b.prototype;return x.on=function(E,A){this.listeners[E]||(this.listeners[E]=[]),this.listeners[E].push(A)},x.off=function(E,A){if(!this.listeners[E])return!1;var w=this.listeners[E].indexOf(A);return this.listeners[E]=this.listeners[E].slice(0),this.listeners[E].splice(w,1),w>-1},x.trigger=function(E){var A=this.listeners[E];if(A)if(arguments.length===2)for(var w=A.length,C=0;C<w;++C)A[C].call(this,arguments[1]);else for(var I=Array.prototype.slice.call(arguments,1),B=A.length,X=0;X<B;++X)A[X].apply(this,I)},x.dispose=function(){this.listeners={}},x.pipe=function(E){this.on("data",function(A){E.push(A)})},b}();/*! @name pkcs7 @version 1.0.4 @license Apache-2.0 */function e(b){return b.subarray(0,b.byteLength-b[b.byteLength-1])}/*! @name aes-decrypter @version 4.0.1 @license Apache-2.0 */const t=function(){const b=[[[],[],[],[],[]],[[],[],[],[],[]]],x=b[0],_=b[1],E=x[4],A=_[4];let w,C,I;const B=[],X=[];let M,F,Q,oe,H,$;for(w=0;w<256;w++)X[(B[w]=w<<1^(w>>7)*283)^w]=w;for(C=I=0;!E[C];C^=M||1,I=X[I]||1)for(oe=I^I<<1^I<<2^I<<3^I<<4,oe=oe>>8^oe&255^99,E[C]=oe,A[oe]=C,Q=B[F=B[M=B[C]]],$=Q*16843009^F*65537^M*257^C*16843008,H=B[oe]*257^oe*16843008,w=0;w<4;w++)x[w][C]=H=H<<24^H>>>8,_[w][oe]=$=$<<24^$>>>8;for(w=0;w<5;w++)x[w]=x[w].slice(0),_[w]=_[w].slice(0);return b};let n=null;class s{constructor(x){n||(n=t()),this._tables=[[n[0][0].slice(),n[0][1].slice(),n[0][2].slice(),n[0][3].slice(),n[0][4].slice()],[n[1][0].slice(),n[1][1].slice(),n[1][2].slice(),n[1][3].slice(),n[1][4].slice()]];let _,E,A;const w=this._tables[0][4],C=this._tables[1],I=x.length;let B=1;if(I!==4&&I!==6&&I!==8)throw new Error("Invalid aes key size");const X=x.slice(0),M=[];for(this._key=[X,M],_=I;_<4*I+28;_++)A=X[_-1],(_%I===0||I===8&&_%I===4)&&(A=w[A>>>24]<<24^w[A>>16&255]<<16^w[A>>8&255]<<8^w[A&255],_%I===0&&(A=A<<8^A>>>24^B<<24,B=B<<1^(B>>7)*283)),X[_]=X[_-I]^A;for(E=0;_;E++,_--)A=X[E&3?_:_-4],_<=4||E<4?M[E]=A:M[E]=C[0][w[A>>>24]]^C[1][w[A>>16&255]]^C[2][w[A>>8&255]]^C[3][w[A&255]]}decrypt(x,_,E,A,w,C){const I=this._key[1];let B=x^I[0],X=A^I[1],M=E^I[2],F=_^I[3],Q,oe,H;const $=I.length/4-2;let Z,le=4;const ie=this._tables[1],ue=ie[0],de=ie[1],fe=ie[2],Pe=ie[3],Ae=ie[4];for(Z=0;Z<$;Z++)Q=ue[B>>>24]^de[X>>16&255]^fe[M>>8&255]^Pe[F&255]^I[le],oe=ue[X>>>24]^de[M>>16&255]^fe[F>>8&255]^Pe[B&255]^I[le+1],H=ue[M>>>24]^de[F>>16&255]^fe[B>>8&255]^Pe[X&255]^I[le+2],F=ue[F>>>24]^de[B>>16&255]^fe[X>>8&255]^Pe[M&255]^I[le+3],le+=4,B=Q,X=oe,M=H;for(Z=0;Z<4;Z++)w[(3&-Z)+C]=Ae[B>>>24]<<24^Ae[X>>16&255]<<16^Ae[M>>8&255]<<8^Ae[F&255]^I[le++],Q=B,B=X,X=M,M=F,F=Q}}class r extends i{constructor(){super(i),this.jobs=[],this.delay=1,this.timeout_=null}processJob_(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null}push(x){this.jobs.push(x),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))}}const a=function(b){return b<<24|(b&65280)<<8|(b&16711680)>>8|b>>>24},o=function(b,x,_){const E=new Int32Array(b.buffer,b.byteOffset,b.byteLength>>2),A=new s(Array.prototype.slice.call(x)),w=new Uint8Array(b.byteLength),C=new Int32Array(w.buffer);let I,B,X,M,F,Q,oe,H,$;for(I=_[0],B=_[1],X=_[2],M=_[3],$=0;$<E.length;$+=4)F=a(E[$]),Q=a(E[$+1]),oe=a(E[$+2]),H=a(E[$+3]),A.decrypt(F,Q,oe,H,C,$),C[$]=a(C[$]^I),C[$+1]=a(C[$+1]^B),C[$+2]=a(C[$+2]^X),C[$+3]=a(C[$+3]^M),I=F,B=Q,X=oe,M=H;return w};class l{constructor(x,_,E,A){const w=l.STEP,C=new Int32Array(x.buffer),I=new Uint8Array(x.byteLength);let B=0;for(this.asyncStream_=new r,this.asyncStream_.push(this.decryptChunk_(C.subarray(B,B+w),_,E,I)),B=w;B<C.length;B+=w)E=new Uint32Array([a(C[B-4]),a(C[B-3]),a(C[B-2]),a(C[B-1])]),this.asyncStream_.push(this.decryptChunk_(C.subarray(B,B+w),_,E,I));this.asyncStream_.push(function(){A(null,e(I))})}static get STEP(){return 32e3}decryptChunk_(x,_,E,A){return function(){const w=o(x,_,E);A.set(w,x.byteOffset)}}}var u=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},h;typeof window<"u"?h=window:typeof u<"u"?h=u:typeof self<"u"?h=self:h={};var d=h,m=function(x){return ArrayBuffer.isView==="function"?ArrayBuffer.isView(x):x&&x.buffer instanceof ArrayBuffer},y=d.BigInt||Number;y("0x1"),y("0x100"),y("0x10000"),y("0x1000000"),y("0x100000000"),y("0x10000000000"),y("0x1000000000000"),y("0x100000000000000"),y("0x10000000000000000"),function(){var b=new Uint16Array([65484]),x=new Uint8Array(b.buffer,b.byteOffset,b.byteLength);return x[0]===255?"big":x[0]===204?"little":"unknown"}();const v=function(b){const x={};return Object.keys(b).forEach(_=>{const E=b[_];m(E)?x[_]={bytes:E.buffer,byteOffset:E.byteOffset,byteLength:E.byteLength}:x[_]=E}),x};self.onmessage=function(b){const x=b.data,_=new Uint8Array(x.encrypted.bytes,x.encrypted.byteOffset,x.encrypted.byteLength),E=new Uint32Array(x.key.bytes,x.key.byteOffset,x.key.byteLength/4),A=new Uint32Array(x.iv.bytes,x.iv.byteOffset,x.iv.byteLength/4);new l(_,E,A,function(w,C){self.postMessage(v({source:x.source,decrypted:C}),[C.buffer])})}}));var aP=pv(rP);const oP=i=>{let e=i.default?"main":"alternative";return i.characteristics&&i.characteristics.indexOf("public.accessibility.describes-video")>=0&&(e="main-desc"),e},Pv=(i,e)=>{i.abort(),i.pause(),e&&e.activePlaylistLoader&&(e.activePlaylistLoader.pause(),e.activePlaylistLoader=null)},vh=(i,e)=>{e.activePlaylistLoader=i,i.load()},lP=(i,e)=>()=>{const{segmentLoaders:{[i]:t,main:n},mediaTypes:{[i]:s}}=e,r=s.activeTrack(),a=s.getActiveGroup(),o=s.activePlaylistLoader,l=s.lastGroup_;if(!(a&&l&&a.id===l.id)&&(s.lastGroup_=a,s.lastTrack_=r,Pv(t,s),!(!a||a.isMainPlaylist))){if(!a.playlistLoader){o&&n.resetEverything();return}t.resyncLoader(),vh(a.playlistLoader,s)}},uP=(i,e)=>()=>{const{segmentLoaders:{[i]:t},mediaTypes:{[i]:n}}=e;n.lastGroup_=null,t.abort(),t.pause()},cP=(i,e)=>()=>{const{mainPlaylistLoader:t,segmentLoaders:{[i]:n,main:s},mediaTypes:{[i]:r}}=e,a=r.activeTrack(),o=r.getActiveGroup(),l=r.activePlaylistLoader,u=r.lastTrack_;if(!(u&&a&&u.id===a.id)&&(r.lastGroup_=o,r.lastTrack_=a,Pv(n,r),!!o)){if(o.isMainPlaylist){if(!a||!u||a.id===u.id)return;const h=e.vhs.playlistController_,d=h.selectPlaylist();if(h.media()===d)return;r.logger_(`track change. Switching main audio from ${u.id} to ${a.id}`),t.pause(),s.resetEverything(),h.fastQualityChange_(d);return}if(i==="AUDIO"){if(!o.playlistLoader){s.setAudio(!0),s.resetEverything();return}n.setAudio(!0),s.setAudio(!1)}if(l===o.playlistLoader){vh(o.playlistLoader,r);return}n.track&&n.track(a),n.resetEverything(),vh(o.playlistLoader,r)}},Wl={AUDIO:(i,e)=>()=>{const{mediaTypes:{[i]:t},excludePlaylist:n}=e,s=t.activeTrack(),r=t.activeGroup(),a=(r.filter(l=>l.default)[0]||r[0]).id,o=t.tracks[a];if(s===o){n({error:{message:"Problem encountered loading the default audio track."}});return}q.log.warn("Problem encountered loading the alternate audio track.Switching back to default.");for(const l in t.tracks)t.tracks[l].enabled=t.tracks[l]===o;t.onTrackChanged()},SUBTITLES:(i,e)=>()=>{const{mediaTypes:{[i]:t}}=e;q.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track.");const n=t.activeTrack();n&&(n.mode="disabled"),t.onTrackChanged()}},Zm={AUDIO:(i,e,t)=>{if(!e)return;const{tech:n,requestOptions:s,segmentLoaders:{[i]:r}}=t;e.on("loadedmetadata",()=>{const a=e.media();r.playlist(a,s),(!n.paused()||a.endList&&n.preload()!=="none")&&r.load()}),e.on("loadedplaylist",()=>{r.playlist(e.media(),s),n.paused()||r.load()}),e.on("error",Wl[i](i,t))},SUBTITLES:(i,e,t)=>{const{tech:n,requestOptions:s,segmentLoaders:{[i]:r},mediaTypes:{[i]:a}}=t;e.on("loadedmetadata",()=>{const o=e.media();r.playlist(o,s),r.track(a.activeTrack()),(!n.paused()||o.endList&&n.preload()!=="none")&&r.load()}),e.on("loadedplaylist",()=>{r.playlist(e.media(),s),n.paused()||r.load()}),e.on("error",Wl[i](i,t))}},hP={AUDIO:(i,e)=>{const{vhs:t,sourceType:n,segmentLoaders:{[i]:s},requestOptions:r,main:{mediaGroups:a},mediaTypes:{[i]:{groups:o,tracks:l,logger_:u}},mainPlaylistLoader:h}=e,d=So(h.main);(!a[i]||Object.keys(a[i]).length===0)&&(a[i]={main:{default:{default:!0}}},d&&(a[i].main.default.playlists=h.main.playlists));for(const m in a[i]){o[m]||(o[m]=[]);for(const y in a[i][m]){let v=a[i][m][y],b;if(d?(u(`AUDIO group '${m}' label '${y}' is a main playlist`),v.isMainPlaylist=!0,b=null):n==="vhs-json"&&v.playlists?b=new Mr(v.playlists[0],t,r):v.resolvedUri?b=new Mr(v.resolvedUri,t,r):v.playlists&&n==="dash"?b=new ph(v.playlists[0],t,r,h):b=null,v=ht({id:y,playlistLoader:b},v),Zm[i](i,v.playlistLoader,e),o[m].push(v),typeof l[y]>"u"){const x=new q.AudioTrack({id:y,kind:oP(v),enabled:!1,language:v.language,default:v.default,label:y});l[y]=x}}}s.on("error",Wl[i](i,e))},SUBTITLES:(i,e)=>{const{tech:t,vhs:n,sourceType:s,segmentLoaders:{[i]:r},requestOptions:a,main:{mediaGroups:o},mediaTypes:{[i]:{groups:l,tracks:u}},mainPlaylistLoader:h}=e;for(const d in o[i]){l[d]||(l[d]=[]);for(const m in o[i][d]){if(!n.options_.useForcedSubtitles&&o[i][d][m].forced)continue;let y=o[i][d][m],v;if(s==="hls")v=new Mr(y.resolvedUri,n,a);else if(s==="dash"){if(!y.playlists.filter(x=>x.excludeUntil!==1/0).length)return;v=new ph(y.playlists[0],n,a,h)}else s==="vhs-json"&&(v=new Mr(y.playlists?y.playlists[0]:y.resolvedUri,n,a));if(y=ht({id:m,playlistLoader:v},y),Zm[i](i,y.playlistLoader,e),l[d].push(y),typeof u[m]>"u"){const b=t.addRemoteTextTrack({id:m,kind:"subtitles",default:y.default&&y.autoselect,language:y.language,label:m},!1).track;u[m]=b}}}r.on("error",Wl[i](i,e))},"CLOSED-CAPTIONS":(i,e)=>{const{tech:t,main:{mediaGroups:n},mediaTypes:{[i]:{groups:s,tracks:r}}}=e;for(const a in n[i]){s[a]||(s[a]=[]);for(const o in n[i][a]){const l=n[i][a][o];if(!/^(?:CC|SERVICE)/.test(l.instreamId))continue;const u=t.options_.vhs&&t.options_.vhs.captionServices||{};let h={label:o,language:l.language,instreamId:l.instreamId,default:l.default&&l.autoselect};if(u[h.instreamId]&&(h=ht(h,u[h.instreamId])),h.default===void 0&&delete h.default,s[a].push(ht({id:o},l)),typeof r[o]>"u"){const d=t.addRemoteTextTrack({id:h.instreamId,kind:"captions",default:h.default,language:h.language,label:h.label},!1).track;r[o]=d}}}}},Lv=(i,e)=>{for(let t=0;t<i.length;t++)if(bd(e,i[t])||i[t].playlists&&Lv(i[t].playlists,e))return!0;return!1},dP=(i,e)=>t=>{const{mainPlaylistLoader:n,mediaTypes:{[i]:{groups:s}}}=e,r=n.media();if(!r)return null;let a=null;r.attributes[i]&&(a=s[r.attributes[i]]);const o=Object.keys(s);if(!a)if(i==="AUDIO"&&o.length>1&&So(e.main))for(let l=0;l<o.length;l++){const u=s[o[l]];if(Lv(u,r)){a=u;break}}else s.main?a=s.main:o.length===1&&(a=s[o[0]]);return typeof t>"u"?a:t===null||!a?null:a.filter(l=>l.id===t.id)[0]||null},fP={AUDIO:(i,e)=>()=>{const{mediaTypes:{[i]:{tracks:t}}}=e;for(const n in t)if(t[n].enabled)return t[n];return null},SUBTITLES:(i,e)=>()=>{const{mediaTypes:{[i]:{tracks:t}}}=e;for(const n in t)if(t[n].mode==="showing"||t[n].mode==="hidden")return t[n];return null}},pP=(i,{mediaTypes:e})=>()=>{const t=e[i].activeTrack();return t?e[i].activeGroup(t):null},mP=i=>{["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(u=>{hP[u](u,i)});const{mediaTypes:e,mainPlaylistLoader:t,tech:n,vhs:s,segmentLoaders:{["AUDIO"]:r,main:a}}=i;["AUDIO","SUBTITLES"].forEach(u=>{e[u].activeGroup=dP(u,i),e[u].activeTrack=fP[u](u,i),e[u].onGroupChanged=lP(u,i),e[u].onGroupChanging=uP(u,i),e[u].onTrackChanged=cP(u,i),e[u].getActiveGroup=pP(u,i)});const o=e.AUDIO.activeGroup();if(o){const u=(o.filter(d=>d.default)[0]||o[0]).id;e.AUDIO.tracks[u].enabled=!0,e.AUDIO.onGroupChanged(),e.AUDIO.onTrackChanged(),e.AUDIO.getActiveGroup().playlistLoader?(a.setAudio(!1),r.setAudio(!0)):a.setAudio(!0)}t.on("mediachange",()=>{["AUDIO","SUBTITLES"].forEach(u=>e[u].onGroupChanged())}),t.on("mediachanging",()=>{["AUDIO","SUBTITLES"].forEach(u=>e[u].onGroupChanging())});const l=()=>{e.AUDIO.onTrackChanged(),n.trigger({type:"usage",name:"vhs-audio-change"})};n.audioTracks().addEventListener("change",l),n.remoteTextTracks().addEventListener("change",e.SUBTITLES.onTrackChanged),s.on("dispose",()=>{n.audioTracks().removeEventListener("change",l),n.remoteTextTracks().removeEventListener("change",e.SUBTITLES.onTrackChanged)}),n.clearTracks("audio");for(const u in e.AUDIO.tracks)n.audioTracks().addTrack(e.AUDIO.tracks[u])},gP=()=>{const i={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{i[e]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:Gn,activeTrack:Gn,getActiveGroup:Gn,onGroupChanged:Gn,onTrackChanged:Gn,lastTrack_:null,logger_:$i(`MediaGroups[${e}]`)}}),i};class Jm{constructor(){this.priority_=[],this.pathwayClones_=new Map}set version(e){e===1&&(this.version_=e)}set ttl(e){this.ttl_=e||300}set reloadUri(e){e&&(this.reloadUri_=Ti(this.reloadUri_,e))}set priority(e){e&&e.length&&(this.priority_=e)}set pathwayClones(e){e&&e.length&&(this.pathwayClones_=new Map(e.map(t=>[t.ID,t])))}get version(){return this.version_}get ttl(){return this.ttl_}get reloadUri(){return this.reloadUri_}get priority(){return this.priority_}get pathwayClones(){return this.pathwayClones_}}class _P extends q.EventTarget{constructor(e,t){super(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=!1,this.availablePathways_=new Set,this.steeringManifest=new Jm,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.currentPathwayClones=new Map,this.nextPathwayClones=new Map,this.excludedSteeringManifestURLs=new Set,this.logger_=$i("Content Steering"),this.xhr_=e,this.getBandwidth_=t}assignTagProperties(e,t){this.manifestType_=t.serverUri?"HLS":"DASH";const n=t.serverUri||t.serverURL;if(!n){this.logger_(`steering manifest URL is ${n}, cannot request steering manifest.`),this.trigger("error");return}if(n.startsWith("data:")){this.decodeDataUriManifest_(n.substring(n.indexOf(",")+1));return}this.steeringManifest.reloadUri=Ti(e,n),this.defaultPathway=t.pathwayId||t.defaultServiceLocation,this.queryBeforeStart=t.queryBeforeStart,this.proxyServerUrl_=t.proxyServerURL,this.defaultPathway&&!this.queryBeforeStart&&this.trigger("content-steering")}requestSteeringManifest(e){const t=this.steeringManifest.reloadUri;if(!t)return;const n=e?t:this.getRequestURI(t);if(!n){this.logger_("No valid content steering manifest URIs. Stopping content steering."),this.trigger("error"),this.dispose();return}this.request_=this.xhr_({uri:n,requestType:"content-steering-manifest"},(s,r)=>{if(s){if(r.status===410){this.logger_(`manifest request 410 ${s}.`),this.logger_(`There will be no more content steering requests to ${n} this session.`),this.excludedSteeringManifestURLs.add(n);return}if(r.status===429){const o=r.responseHeaders["retry-after"];this.logger_(`manifest request 429 ${s}.`),this.logger_(`content steering will retry in ${o} seconds.`),this.startTTLTimeout_(parseInt(o,10));return}this.logger_(`manifest failed to load ${s}.`),this.startTTLTimeout_();return}const a=JSON.parse(this.request_.responseText);this.assignSteeringProperties_(a),this.startTTLTimeout_()})}setProxyServerUrl_(e){const t=new N.URL(e),n=new N.URL(this.proxyServerUrl_);return n.searchParams.set("url",encodeURI(t.toString())),this.setSteeringParams_(n.toString())}decodeDataUriManifest_(e){const t=JSON.parse(N.atob(e));this.assignSteeringProperties_(t)}setSteeringParams_(e){const t=new N.URL(e),n=this.getPathway(),s=this.getBandwidth_();if(n){const r=`_${this.manifestType_}_pathway`;t.searchParams.set(r,n)}if(s){const r=`_${this.manifestType_}_throughput`;t.searchParams.set(r,s)}return t.toString()}assignSteeringProperties_(e){if(this.steeringManifest.version=e.VERSION,!this.steeringManifest.version){this.logger_(`manifest version is ${e.VERSION}, which is not supported.`),this.trigger("error");return}this.steeringManifest.ttl=e.TTL,this.steeringManifest.reloadUri=e["RELOAD-URI"],this.steeringManifest.priority=e["PATHWAY-PRIORITY"]||e["SERVICE-LOCATION-PRIORITY"],this.steeringManifest.pathwayClones=e["PATHWAY-CLONES"],this.nextPathwayClones=this.steeringManifest.pathwayClones,this.availablePathways_.size||(this.logger_("There are no available pathways for content steering. Ending content steering."),this.trigger("error"),this.dispose());const n=(s=>{for(const r of s)if(this.availablePathways_.has(r))return r;return[...this.availablePathways_][0]})(this.steeringManifest.priority);this.currentPathway!==n&&(this.currentPathway=n,this.trigger("content-steering"))}getPathway(){return this.currentPathway||this.defaultPathway}getRequestURI(e){if(!e)return null;const t=s=>this.excludedSteeringManifestURLs.has(s);if(this.proxyServerUrl_){const s=this.setProxyServerUrl_(e);if(!t(s))return s}const n=this.setSteeringParams_(e);return t(n)?null:n}startTTLTimeout_(e=this.steeringManifest.ttl){const t=e*1e3;this.ttlTimeout_=N.setTimeout(()=>{this.requestSteeringManifest()},t)}clearTTLTimeout_(){N.clearTimeout(this.ttlTimeout_),this.ttlTimeout_=null}abort(){this.request_&&this.request_.abort(),this.request_=null}dispose(){this.off("content-steering"),this.off("error"),this.abort(),this.clearTTLTimeout_(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=null,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.excludedSteeringManifestURLs=new Set,this.availablePathways_=new Set,this.steeringManifest=new Jm}addAvailablePathway(e){e&&this.availablePathways_.add(e)}clearAvailablePathways(){this.availablePathways_.clear()}excludePathway(e){return this.availablePathways_.delete(e)}didDASHTagChange(e,t){return!t&&this.steeringManifest.reloadUri||t&&(Ti(e,t.serverURL)!==this.steeringManifest.reloadUri||t.defaultServiceLocation!==this.defaultPathway||t.queryBeforeStart!==this.queryBeforeStart||t.proxyServerURL!==this.proxyServerUrl_)}getAvailablePathways(){return this.availablePathways_}}const vP=10;let Bn;const yP=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred","mediaAppends"],TP=function(i){return this.audioSegmentLoader_[i]+this.mainSegmentLoader_[i]},xP=function({currentPlaylist:i,buffered:e,currentTime:t,nextPlaylist:n,bufferLowWaterLine:s,bufferHighWaterLine:r,duration:a,bufferBasedABR:o,log:l}){if(!n)return q.log.warn("We received no playlist to switch to. Please check your stream."),!1;const u=`allowing switch ${i&&i.id||"null"} -> ${n.id}`;if(!i)return l(`${u} as current playlist is not set`),!0;if(n.id===i.id)return!1;const h=Boolean(Cr(e,t).length);if(!i.endList)return!h&&typeof i.partTargetDuration=="number"?(l(`not ${u} as current playlist is live llhls, but currentTime isn't in buffered.`),!1):(l(`${u} as current playlist is live`),!0);const d=Td(e,t),m=o?jt.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:jt.MAX_BUFFER_LOW_WATER_LINE;if(a<m)return l(`${u} as duration < max low water line (${a} < ${m})`),!0;const y=n.attributes.BANDWIDTH,v=i.attributes.BANDWIDTH;if(y<v&&(!o||d<r)){let b=`${u} as next bandwidth < current bandwidth (${y} < ${v})`;return o&&(b+=` and forwardBuffer < bufferHighWaterLine (${d} < ${r})`),l(b),!0}if((!o||y>v)&&d>=s){let b=`${u} as forwardBuffer >= bufferLowWaterLine (${d} >= ${s})`;return o&&(b+=` and next bandwidth > current bandwidth (${y} > ${v})`),l(b),!0}return l(`not ${u} as no switching criteria met`),!1};class SP extends q.EventTarget{constructor(e){super();const{src:t,withCredentials:n,tech:s,bandwidth:r,externVhs:a,useCueTags:o,playlistExclusionDuration:l,enableLowInitialPlaylist:u,sourceType:h,cacheEncryptionKeys:d,bufferBasedABR:m,leastPixelDiffSelector:y,captionServices:v}=e;if(!t)throw new Error("A non-empty playlist URL or JSON manifest string is required");let{maxPlaylistRetries:b}=e;(b===null||typeof b>"u")&&(b=1/0),Bn=a,this.bufferBasedABR=Boolean(m),this.leastPixelDiffSelector=Boolean(y),this.withCredentials=n,this.tech_=s,this.vhs_=s.vhs,this.sourceType_=h,this.useCueTags_=o,this.playlistExclusionDuration=l,this.maxPlaylistRetries=b,this.enableLowInitialPlaylist=u,this.useCueTags_&&(this.cueTagsTrack_=this.tech_.addTextTrack("metadata","ad-cues"),this.cueTagsTrack_.inBandMetadataTrackDispatchType=""),this.requestOptions_={withCredentials:n,maxPlaylistRetries:b,timeout:null},this.on("error",this.pauseLoading),this.mediaTypes_=gP(),this.mediaSource=new N.MediaSource,this.handleDurationChange_=this.handleDurationChange_.bind(this),this.handleSourceOpen_=this.handleSourceOpen_.bind(this),this.handleSourceEnded_=this.handleSourceEnded_.bind(this),this.mediaSource.addEventListener("durationchange",this.handleDurationChange_),this.mediaSource.addEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.addEventListener("sourceended",this.handleSourceEnded_),this.seekable_=ni(),this.hasPlayed_=!1,this.syncController_=new nP(e),this.segmentMetadataTrack_=s.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,this.decrypter_=new aP,this.sourceUpdater_=new Rv(this.mediaSource),this.inbandTextTracks_={},this.timelineChangeController_=new sP,this.keyStatusMap_=new Map;const x={vhs:this.vhs_,parse708captions:e.parse708captions,useDtsForTimestampOffset:e.useDtsForTimestampOffset,captionServices:v,mediaSource:this.mediaSource,currentTime:this.tech_.currentTime.bind(this.tech_),seekable:()=>this.seekable(),seeking:()=>this.tech_.seeking(),duration:()=>this.duration(),hasPlayed:()=>this.hasPlayed_,goalBufferLength:()=>this.goalBufferLength(),bandwidth:r,syncController:this.syncController_,decrypter:this.decrypter_,sourceType:this.sourceType_,inbandTextTracks:this.inbandTextTracks_,cacheEncryptionKeys:d,sourceUpdater:this.sourceUpdater_,timelineChangeController:this.timelineChangeController_,exactManifestTimings:e.exactManifestTimings,addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)};this.mainPlaylistLoader_=this.sourceType_==="dash"?new ph(t,this.vhs_,ht(this.requestOptions_,{addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)})):new Mr(t,this.vhs_,ht(this.requestOptions_,{addDateRangesToTextTrack:this.addDateRangesToTextTrack_.bind(this)})),this.setupMainPlaylistLoaderListeners_(),this.mainSegmentLoader_=new gh(ht(x,{segmentMetadataTrack:this.segmentMetadataTrack_,loaderType:"main"}),e),this.audioSegmentLoader_=new gh(ht(x,{loaderType:"audio"}),e),this.subtitleSegmentLoader_=new ZR(ht(x,{loaderType:"vtt",featuresNativeTextTracks:this.tech_.featuresNativeTextTracks,loadVttJs:()=>new Promise((A,w)=>{function C(){s.off("vttjserror",I),A()}function I(){s.off("vttjsloaded",C),w()}s.one("vttjsloaded",C),s.one("vttjserror",I),s.addWebVttScript_()})}),e);const _=()=>this.mainSegmentLoader_.bandwidth;this.contentSteeringController_=new _P(this.vhs_.xhr,_),this.setupSegmentLoaderListeners_(),this.bufferBasedABR&&(this.mainPlaylistLoader_.one("loadedplaylist",()=>this.startABRTimer_()),this.tech_.on("pause",()=>this.stopABRTimer_()),this.tech_.on("play",()=>this.startABRTimer_())),yP.forEach(A=>{this[A+"_"]=TP.bind(this,A)}),this.logger_=$i("pc"),this.triggeredFmp4Usage=!1,this.tech_.preload()==="none"?(this.loadOnPlay_=()=>{this.loadOnPlay_=null,this.mainPlaylistLoader_.load()},this.tech_.one("play",this.loadOnPlay_)):this.mainPlaylistLoader_.load(),this.timeToLoadedData__=-1,this.mainAppendsToLoadedData__=-1,this.audioAppendsToLoadedData__=-1;const E=this.tech_.preload()==="none"?"play":"loadstart";this.tech_.one(E,()=>{const A=Date.now();this.tech_.one("loadeddata",()=>{this.timeToLoadedData__=Date.now()-A,this.mainAppendsToLoadedData__=this.mainSegmentLoader_.mediaAppends,this.audioAppendsToLoadedData__=this.audioSegmentLoader_.mediaAppends})})}mainAppendsToLoadedData_(){return this.mainAppendsToLoadedData__}audioAppendsToLoadedData_(){return this.audioAppendsToLoadedData__}appendsToLoadedData_(){const e=this.mainAppendsToLoadedData_(),t=this.audioAppendsToLoadedData_();return e===-1||t===-1?-1:e+t}timeToLoadedData_(){return this.timeToLoadedData__}checkABR_(e="abr"){const t=this.selectPlaylist();t&&this.shouldSwitchToMedia_(t)&&this.switchMedia_(t,e)}switchMedia_(e,t,n){const s=this.media(),r=s&&(s.id||s.uri),a=e&&(e.id||e.uri);r&&r!==a&&(this.logger_(`switch media ${r} -> ${a} from ${t}`),this.tech_.trigger({type:"usage",name:`vhs-rendition-change-${t}`})),this.mainPlaylistLoader_.media(e,n)}switchMediaForDASHContentSteering_(){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{const t=this.mediaTypes_[e],n=t?t.activeGroup():null,s=this.contentSteeringController_.getPathway();if(n&&s){const a=(n.length?n[0].playlists:n.playlists).filter(o=>o.attributes.serviceLocation===s);a.length&&this.mediaTypes_[e].activePlaylistLoader.media(a[0])}})}startABRTimer_(){this.stopABRTimer_(),this.abrTimer_=N.setInterval(()=>this.checkABR_(),250)}stopABRTimer_(){this.tech_.scrubbing&&this.tech_.scrubbing()||(N.clearInterval(this.abrTimer_),this.abrTimer_=null)}getAudioTrackPlaylists_(){const e=this.main(),t=e&&e.playlists||[];if(!e||!e.mediaGroups||!e.mediaGroups.AUDIO)return t;const n=e.mediaGroups.AUDIO,s=Object.keys(n);let r;if(Object.keys(this.mediaTypes_.AUDIO.groups).length)r=this.mediaTypes_.AUDIO.activeTrack();else{const o=n.main||s.length&&n[s[0]];for(const l in o)if(o[l].default){r={label:l};break}}if(!r)return t;const a=[];for(const o in n)if(n[o][r.label]){const l=n[o][r.label];if(l.playlists&&l.playlists.length)a.push.apply(a,l.playlists);else if(l.uri)a.push(l);else if(e.playlists.length)for(let u=0;u<e.playlists.length;u++){const h=e.playlists[u];h.attributes&&h.attributes.AUDIO&&h.attributes.AUDIO===o&&a.push(h)}}return a.length?a:t}setupMainPlaylistLoaderListeners_(){this.mainPlaylistLoader_.on("loadedmetadata",()=>{const e=this.mainPlaylistLoader_.media(),t=e.targetDuration*1.5*1e3;uh(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=t,e.endList&&this.tech_.preload()!=="none"&&(this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.mainSegmentLoader_.load()),mP({sourceType:this.sourceType_,segmentLoaders:{AUDIO:this.audioSegmentLoader_,SUBTITLES:this.subtitleSegmentLoader_,main:this.mainSegmentLoader_},tech:this.tech_,requestOptions:this.requestOptions_,mainPlaylistLoader:this.mainPlaylistLoader_,vhs:this.vhs_,main:this.main(),mediaTypes:this.mediaTypes_,excludePlaylist:this.excludePlaylist.bind(this)}),this.triggerPresenceUsage_(this.main(),e),this.setupFirstPlay(),!this.mediaTypes_.AUDIO.activePlaylistLoader||this.mediaTypes_.AUDIO.activePlaylistLoader.media()?this.trigger("selectedinitialmedia"):this.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",()=>{this.trigger("selectedinitialmedia")})}),this.mainPlaylistLoader_.on("loadedplaylist",()=>{this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_);let e=this.mainPlaylistLoader_.media();if(!e){this.attachContentSteeringListeners_(),this.initContentSteeringController_(),this.excludeUnsupportedVariants_();let t;if(this.enableLowInitialPlaylist&&(t=this.selectInitialPlaylist()),t||(t=this.selectPlaylist()),!t||!this.shouldSwitchToMedia_(t)||(this.initialMedia_=t,this.switchMedia_(this.initialMedia_,"initial"),!(this.sourceType_==="vhs-json"&&this.initialMedia_.segments)))return;e=this.initialMedia_}this.handleUpdatedMediaPlaylist(e)}),this.mainPlaylistLoader_.on("error",()=>{const e=this.mainPlaylistLoader_.error;this.excludePlaylist({playlistToExclude:e.playlist,error:e})}),this.mainPlaylistLoader_.on("mediachanging",()=>{this.mainSegmentLoader_.abort(),this.mainSegmentLoader_.pause()}),this.mainPlaylistLoader_.on("mediachange",()=>{const e=this.mainPlaylistLoader_.media(),t=e.targetDuration*1.5*1e3;uh(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=t,this.sourceType_==="dash"&&this.mainPlaylistLoader_.load(),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_?this.runFastQualitySwitch_():this.mainSegmentLoader_.load(),this.tech_.trigger({type:"mediachange",bubbles:!0})}),this.mainPlaylistLoader_.on("playlistunchanged",()=>{const e=this.mainPlaylistLoader_.media();if(e.lastExcludeReason_==="playlist-unchanged")return;this.stuckAtPlaylistEnd_(e)&&(this.excludePlaylist({error:{message:"Playlist no longer updating.",reason:"playlist-unchanged"}}),this.tech_.trigger("playliststuck"))}),this.mainPlaylistLoader_.on("renditiondisabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-disabled"})}),this.mainPlaylistLoader_.on("renditionenabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-enabled"})})}handleUpdatedMediaPlaylist(e){this.useCueTags_&&this.updateAdCues_(e),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_&&this.runFastQualitySwitch_(),this.updateDuration(!e.endList),this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioSegmentLoader_&&this.audioSegmentLoader_.load())}triggerPresenceUsage_(e,t){const n=e.mediaGroups||{};let s=!0;const r=Object.keys(n.AUDIO);for(const a in n.AUDIO)for(const o in n.AUDIO[a])n.AUDIO[a][o].uri||(s=!1);s&&this.tech_.trigger({type:"usage",name:"vhs-demuxed"}),Object.keys(n.SUBTITLES).length&&this.tech_.trigger({type:"usage",name:"vhs-webvtt"}),Bn.Playlist.isAes(t)&&this.tech_.trigger({type:"usage",name:"vhs-aes"}),r.length&&Object.keys(n.AUDIO[r[0]]).length>1&&this.tech_.trigger({type:"usage",name:"vhs-alternate-audio"}),this.useCueTags_&&this.tech_.trigger({type:"usage",name:"vhs-playlist-cue-tags"})}shouldSwitchToMedia_(e){const t=this.mainPlaylistLoader_.media()||this.mainPlaylistLoader_.pendingMedia_,n=this.tech_.currentTime(),s=this.bufferLowWaterLine(),r=this.bufferHighWaterLine(),a=this.tech_.buffered();return xP({buffered:a,currentTime:n,currentPlaylist:t,nextPlaylist:e,bufferLowWaterLine:s,bufferHighWaterLine:r,duration:this.duration(),bufferBasedABR:this.bufferBasedABR,log:this.logger_})}setupSegmentLoaderListeners_(){this.mainSegmentLoader_.on("bandwidthupdate",()=>{this.checkABR_("bandwidthupdate"),this.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("timeout",()=>{this.bufferBasedABR&&this.mainSegmentLoader_.load()}),this.bufferBasedABR||this.mainSegmentLoader_.on("progress",()=>{this.trigger("progress")}),this.mainSegmentLoader_.on("error",()=>{const t=this.mainSegmentLoader_.error();this.excludePlaylist({playlistToExclude:t.playlist,error:t})}),this.mainSegmentLoader_.on("appenderror",()=>{this.error=this.mainSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",()=>{this.tech_.trigger({type:"usage",name:"vhs-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.audioSegmentLoader_.on("appenderror",()=>{this.error=this.audioSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("ended",()=>{this.logger_("main segment loader ended"),this.onEndOfStream()}),this.mainSegmentLoader_.on("earlyabort",t=>{this.bufferBasedABR||(this.delegateLoaders_("all",["abort"]),this.excludePlaylist({error:{message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},playlistExclusionDuration:vP}))});const e=()=>{if(!this.sourceUpdater_.hasCreatedSourceBuffers())return this.tryToCreateSourceBuffers_();const t=this.getCodecsOrExclude_();t&&this.sourceUpdater_.addOrChangeSourceBuffers(t)};this.mainSegmentLoader_.on("trackinfo",e),this.audioSegmentLoader_.on("trackinfo",e),this.mainSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("ended",()=>{this.logger_("audioSegmentLoader ended"),this.onEndOfStream()})}mediaSecondsLoaded_(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}load(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()}fastQualityChange_(e=this.selectPlaylist()){if(e&&e===this.mainPlaylistLoader_.media()){this.logger_("skipping fastQualityChange because new media is same as old");return}this.switchMedia_(e,"fast-quality"),this.waitingForFastQualityPlaylistReceived_=!0}runFastQualitySwitch_(){this.waitingForFastQualityPlaylistReceived_=!1,this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(()=>{this.tech_.setCurrentTime(this.tech_.currentTime())})}play(){if(this.setupFirstPlay())return;this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_&&this.load();const e=this.tech_.seekable();if(this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0))return this.tech_.setCurrentTime(e.end(e.length-1))}setupFirstPlay(){const e=this.mainPlaylistLoader_.media();if(!e||this.tech_.paused()||this.hasPlayed_)return!1;if(!e.endList||e.start){const t=this.seekable();if(!t.length)return!1;const n=t.end(0);let s=n;if(e.start){const r=e.start.timeOffset;r<0?s=Math.max(n+r,t.start(0)):s=Math.min(n,r)}this.trigger("firstplay"),this.tech_.setCurrentTime(s)}return this.hasPlayed_=!0,this.load(),!0}handleSourceOpen_(){if(this.tryToCreateSourceBuffers_(),this.tech_.autoplay()){const e=this.tech_.play();typeof e<"u"&&typeof e.then=="function"&&e.then(null,t=>{})}this.trigger("sourceopen")}handleSourceEnded_(){if(!this.inbandTextTracks_.metadataTrack_)return;const e=this.inbandTextTracks_.metadataTrack_.cues;if(!e||!e.length)return;const t=this.duration();e[e.length-1].endTime=isNaN(t)||Math.abs(t)===1/0?Number.MAX_VALUE:t}handleDurationChange_(){this.tech_.trigger("durationchange")}onEndOfStream(){let e=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader){const t=this.mainSegmentLoader_.getCurrentMediaInfo_();!t||t.hasVideo?e=e&&this.audioSegmentLoader_.ended_:e=this.audioSegmentLoader_.ended_}e&&(this.stopABRTimer_(),this.sourceUpdater_.endOfStream())}stuckAtPlaylistEnd_(e){if(!this.seekable().length)return!1;const n=this.syncController_.getExpiredTime(e,this.duration());if(n===null)return!1;const s=Bn.Playlist.playlistEnd(e,n),r=this.tech_.currentTime(),a=this.tech_.buffered();if(!a.length)return s-r<=_n;const o=a.end(a.length-1);return o-r<=_n&&s-o<=_n}excludePlaylist({playlistToExclude:e=this.mainPlaylistLoader_.media(),error:t={},playlistExclusionDuration:n}){if(e=e||this.mainPlaylistLoader_.media(),n=n||t.playlistExclusionDuration||this.playlistExclusionDuration,!e){this.error=t,this.mediaSource.readyState!=="open"?this.trigger("error"):this.sourceUpdater_.endOfStream("network");return}e.playlistErrors_++;const s=this.mainPlaylistLoader_.main.playlists,r=s.filter(yu),a=r.length===1&&r[0]===e;if(s.length===1&&n!==1/0)return q.log.warn(`Problem encountered with playlist ${e.id}. Trying again since it is the only playlist.`),this.tech_.trigger("retryplaylist"),this.mainPlaylistLoader_.load(a);if(a){if(this.main().contentSteering){const v=this.pathwayAttribute_(e),b=this.contentSteeringController_.steeringManifest.ttl*1e3;this.contentSteeringController_.excludePathway(v),this.excludeThenChangePathway_(),setTimeout(()=>{this.contentSteeringController_.addAvailablePathway(v)},b);return}let y=!1;s.forEach(v=>{if(v===e)return;const b=v.excludeUntil;typeof b<"u"&&b!==1/0&&(y=!0,delete v.excludeUntil)}),y&&(q.log.warn("Removing other playlists from the exclusion list because the last rendition is about to be excluded."),this.tech_.trigger("retryplaylist"))}let o;e.playlistErrors_>this.maxPlaylistRetries?o=1/0:o=Date.now()+n*1e3,e.excludeUntil=o,t.reason&&(e.lastExcludeReason_=t.reason),this.tech_.trigger("excludeplaylist"),this.tech_.trigger({type:"usage",name:"vhs-rendition-excluded"});const l=this.selectPlaylist();if(!l){this.error="Playback cannot continue. No available working or supported playlists.",this.trigger("error");return}const u=t.internal?this.logger_:q.log.warn,h=t.message?" "+t.message:"";u(`${t.internal?"Internal problem":"Problem"} encountered with playlist ${e.id}.${h} Switching to playlist ${l.id}.`),l.attributes.AUDIO!==e.attributes.AUDIO&&this.delegateLoaders_("audio",["abort","pause"]),l.attributes.SUBTITLES!==e.attributes.SUBTITLES&&this.delegateLoaders_("subtitle",["abort","pause"]),this.delegateLoaders_("main",["abort","pause"]);const d=l.targetDuration/2*1e3||5*1e3,m=typeof l.lastRequest=="number"&&Date.now()-l.lastRequest<=d;return this.switchMedia_(l,"exclude",a||m)}pauseLoading(){this.delegateLoaders_("all",["abort","pause"]),this.stopABRTimer_()}delegateLoaders_(e,t){const n=[],s=e==="all";(s||e==="main")&&n.push(this.mainPlaylistLoader_);const r=[];(s||e==="audio")&&r.push("AUDIO"),(s||e==="subtitle")&&(r.push("CLOSED-CAPTIONS"),r.push("SUBTITLES")),r.forEach(a=>{const o=this.mediaTypes_[a]&&this.mediaTypes_[a].activePlaylistLoader;o&&n.push(o)}),["main","audio","subtitle"].forEach(a=>{const o=this[`${a}SegmentLoader_`];o&&(e===a||e==="all")&&n.push(o)}),n.forEach(a=>t.forEach(o=>{typeof a[o]=="function"&&a[o]()}))}setCurrentTime(e){const t=Cr(this.tech_.buffered(),e);if(!(this.mainPlaylistLoader_&&this.mainPlaylistLoader_.media())||!this.mainPlaylistLoader_.media().segments)return 0;if(t&&t.length)return e;this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}duration(){if(!this.mainPlaylistLoader_)return 0;const e=this.mainPlaylistLoader_.media();return e?e.endList?this.mediaSource?this.mediaSource.duration:Bn.Playlist.duration(e):1/0:0}seekable(){return this.seekable_}onSyncInfoUpdate_(){let e;if(!this.mainPlaylistLoader_)return;let t=this.mainPlaylistLoader_.media();if(!t)return;let n=this.syncController_.getExpiredTime(t,this.duration());if(n===null)return;const s=this.mainPlaylistLoader_.main,r=Bn.Playlist.seekable(t,n,Bn.Playlist.liveEdgeDelay(s,t));if(r.length===0||this.mediaTypes_.AUDIO.activePlaylistLoader&&(t=this.mediaTypes_.AUDIO.activePlaylistLoader.media(),n=this.syncController_.getExpiredTime(t,this.duration()),n===null||(e=Bn.Playlist.seekable(t,n,Bn.Playlist.liveEdgeDelay(s,t)),e.length===0)))return;let a,o;this.seekable_&&this.seekable_.length&&(a=this.seekable_.end(0),o=this.seekable_.start(0)),e?e.start(0)>r.end(0)||r.start(0)>e.end(0)?this.seekable_=r:this.seekable_=ni([[e.start(0)>r.start(0)?e.start(0):r.start(0),e.end(0)<r.end(0)?e.end(0):r.end(0)]]):this.seekable_=r,!(this.seekable_&&this.seekable_.length&&this.seekable_.end(0)===a&&this.seekable_.start(0)===o)&&(this.logger_(`seekable updated [${q_(this.seekable_)}]`),this.tech_.trigger("seekablechanged"))}updateDuration(e){if(this.updateDuration_&&(this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.updateDuration_=null),this.mediaSource.readyState!=="open"){this.updateDuration_=this.updateDuration.bind(this,e),this.mediaSource.addEventListener("sourceopen",this.updateDuration_);return}if(e){const s=this.seekable();if(!s.length)return;(isNaN(this.mediaSource.duration)||this.mediaSource.duration<s.end(s.length-1))&&this.sourceUpdater_.setDuration(s.end(s.length-1));return}const t=this.tech_.buffered();let n=Bn.Playlist.duration(this.mainPlaylistLoader_.media());t.length>0&&(n=Math.max(n,t.end(t.length-1))),this.mediaSource.duration!==n&&this.sourceUpdater_.setDuration(n)}dispose(){this.trigger("dispose"),this.decrypter_.terminate(),this.mainPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),this.contentSteeringController_.dispose(),this.keyStatusMap_.clear(),this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_),["AUDIO","SUBTITLES"].forEach(e=>{const t=this.mediaTypes_[e].groups;for(const n in t)t[n].forEach(s=>{s.playlistLoader&&s.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose(),this.timelineChangeController_.dispose(),this.stopABRTimer_(),this.updateDuration_&&this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.mediaSource.removeEventListener("durationchange",this.handleDurationChange_),this.mediaSource.removeEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.removeEventListener("sourceended",this.handleSourceEnded_),this.off()}main(){return this.mainPlaylistLoader_.main}media(){return this.mainPlaylistLoader_.media()||this.initialMedia_}areMediaTypesKnown_(){const e=!!this.mediaTypes_.AUDIO.activePlaylistLoader,t=!!this.mainSegmentLoader_.getCurrentMediaInfo_(),n=e?!!this.audioSegmentLoader_.getCurrentMediaInfo_():!0;return!(!t||!n)}getCodecsOrExclude_(){const e={main:this.mainSegmentLoader_.getCurrentMediaInfo_()||{},audio:this.audioSegmentLoader_.getCurrentMediaInfo_()||{}},t=this.mainSegmentLoader_.getPendingSegmentPlaylist()||this.media();e.video=e.main;const n=Ya(this.main(),t),s={},r=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(e.main.hasVideo&&(s.video=n.video||e.main.videoCodec||qA),e.main.isMuxed&&(s.video+=`,${n.audio||e.main.audioCodec||kp}`),(e.main.hasAudio&&!e.main.isMuxed||e.audio.hasAudio||r)&&(s.audio=n.audio||e.main.audioCodec||e.audio.audioCodec||kp,e.audio.isFmp4=e.main.hasAudio&&!e.main.isMuxed?e.main.isFmp4:e.audio.isFmp4),!s.audio&&!s.video){this.excludePlaylist({playlistToExclude:t,error:{message:"Could not determine codecs for playlist."},playlistExclusionDuration:1/0});return}const a=(u,h)=>u?gl(h):fc(h),o={};let l;if(["video","audio"].forEach(function(u){if(s.hasOwnProperty(u)&&!a(e[u].isFmp4,s[u])){const h=e[u].isFmp4?"browser":"muxer";o[h]=o[h]||[],o[h].push(s[u]),u==="audio"&&(l=h)}}),r&&l&&t.attributes.AUDIO){const u=t.attributes.AUDIO;this.main().playlists.forEach(h=>{(h.attributes&&h.attributes.AUDIO)===u&&h!==t&&(h.excludeUntil=1/0)}),this.logger_(`excluding audio group ${u} as ${l} does not support codec(s): "${s.audio}"`)}if(Object.keys(o).length){const u=Object.keys(o).reduce((h,d)=>(h&&(h+=", "),h+=`${d} does not support codec(s): "${o[d].join(",")}"`,h),"")+".";this.excludePlaylist({playlistToExclude:t,error:{internal:!0,message:u},playlistExclusionDuration:1/0});return}if(this.sourceUpdater_.hasCreatedSourceBuffers()&&!this.sourceUpdater_.canChangeType()){const u=[];if(["video","audio"].forEach(h=>{const d=(dn(this.sourceUpdater_.codecs[h]||"")[0]||{}).type,m=(dn(s[h]||"")[0]||{}).type;d&&m&&d.toLowerCase()!==m.toLowerCase()&&u.push(`"${this.sourceUpdater_.codecs[h]}" -> "${s[h]}"`)}),u.length){this.excludePlaylist({playlistToExclude:t,error:{message:`Codec switching not supported: ${u.join(", ")}.`,internal:!0},playlistExclusionDuration:1/0});return}}return s}tryToCreateSourceBuffers_(){if(this.mediaSource.readyState!=="open"||this.sourceUpdater_.hasCreatedSourceBuffers()||!this.areMediaTypesKnown_())return;const e=this.getCodecsOrExclude_();if(!e)return;this.sourceUpdater_.createSourceBuffers(e);const t=[e.video,e.audio].filter(Boolean).join(",");this.excludeIncompatibleVariants_(t)}excludeUnsupportedVariants_(){const e=this.main().playlists,t=[];Object.keys(e).forEach(n=>{const s=e[n];if(t.indexOf(s.id)!==-1)return;t.push(s.id);const r=Ya(this.main,s),a=[];r.audio&&!fc(r.audio)&&!gl(r.audio)&&a.push(`audio codec ${r.audio}`),r.video&&!fc(r.video)&&!gl(r.video)&&a.push(`video codec ${r.video}`),r.text&&r.text==="stpp.ttml.im1t"&&a.push(`text codec ${r.text}`),a.length&&(s.excludeUntil=1/0,this.logger_(`excluding ${s.id} for unsupported: ${a.join(", ")}`))})}excludeIncompatibleVariants_(e){const t=[],n=this.main().playlists,s=zl(dn(e)),r=Hm(s),a=s.video&&dn(s.video)[0]||null,o=s.audio&&dn(s.audio)[0]||null;Object.keys(n).forEach(l=>{const u=n[l];if(t.indexOf(u.id)!==-1||u.excludeUntil===1/0)return;t.push(u.id);const h=[],d=Ya(this.mainPlaylistLoader_.main,u),m=Hm(d);if(!(!d.audio&&!d.video)){if(m!==r&&h.push(`codec count "${m}" !== "${r}"`),!this.sourceUpdater_.canChangeType()){const y=d.video&&dn(d.video)[0]||null,v=d.audio&&dn(d.audio)[0]||null;y&&a&&y.type.toLowerCase()!==a.type.toLowerCase()&&h.push(`video codec "${y.type}" !== "${a.type}"`),v&&o&&v.type.toLowerCase()!==o.type.toLowerCase()&&h.push(`audio codec "${v.type}" !== "${o.type}"`)}h.length&&(u.excludeUntil=1/0,this.logger_(`excluding ${u.id}: ${h.join(" && ")}`))}})}updateAdCues_(e){let t=0;const n=this.seekable();n.length&&(t=n.start(0)),eP(e,this.cueTagsTrack_,t)}goalBufferLength(){const e=this.tech_.currentTime(),t=jt.GOAL_BUFFER_LENGTH,n=jt.GOAL_BUFFER_LENGTH_RATE,s=Math.max(t,jt.MAX_GOAL_BUFFER_LENGTH);return Math.min(t+e*n,s)}bufferLowWaterLine(){const e=this.tech_.currentTime(),t=jt.BUFFER_LOW_WATER_LINE,n=jt.BUFFER_LOW_WATER_LINE_RATE,s=Math.max(t,jt.MAX_BUFFER_LOW_WATER_LINE),r=Math.max(t,jt.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE);return Math.min(t+e*n,this.bufferBasedABR?r:s)}bufferHighWaterLine(){return jt.BUFFER_HIGH_WATER_LINE}addDateRangesToTextTrack_(e){Gm(this.inbandTextTracks_,"com.apple.streaming",this.tech_),UR({inbandTextTracks:this.inbandTextTracks_,dateRanges:e})}addMetadataToTextTrack(e,t,n){const s=this.sourceUpdater_.videoBuffer?this.sourceUpdater_.videoTimestampOffset():this.sourceUpdater_.audioTimestampOffset();Gm(this.inbandTextTracks_,e,this.tech_),LR({inbandTextTracks:this.inbandTextTracks_,metadataArray:t,timestampOffset:s,videoDuration:n})}pathwayAttribute_(e){return e.attributes["PATHWAY-ID"]||e.attributes.serviceLocation}initContentSteeringController_(){const e=this.main();if(e.contentSteering){for(const t of e.playlists)this.contentSteeringController_.addAvailablePathway(this.pathwayAttribute_(t));if(this.contentSteeringController_.assignTagProperties(e.uri,e.contentSteering),this.contentSteeringController_.queryBeforeStart){this.contentSteeringController_.requestSteeringManifest(!0);return}this.tech_.one("canplay",()=>{this.contentSteeringController_.requestSteeringManifest()})}}resetContentSteeringController_(){this.contentSteeringController_.clearAvailablePathways(),this.contentSteeringController_.dispose(),this.initContentSteeringController_()}attachContentSteeringListeners_(){this.contentSteeringController_.on("content-steering",this.excludeThenChangePathway_.bind(this)),this.sourceType_==="dash"&&this.mainPlaylistLoader_.on("loadedplaylist",()=>{const e=this.main();(this.contentSteeringController_.didDASHTagChange(e.uri,e.contentSteering)||(()=>{const s=this.contentSteeringController_.getAvailablePathways(),r=[];for(const a of e.playlists){const o=a.attributes.serviceLocation;if(o&&(r.push(o),!s.has(o)))return!0}return!!(!r.length&&s.size)})())&&this.resetContentSteeringController_()})}excludeThenChangePathway_(){const e=this.contentSteeringController_.getPathway();if(!e)return;this.handlePathwayClones_();const n=this.main().playlists,s=new Set;let r=!1;Object.keys(n).forEach(a=>{const o=n[a],l=this.pathwayAttribute_(o),u=l&&e!==l;o.excludeUntil===1/0&&o.lastExcludeReason_==="content-steering"&&!u&&(delete o.excludeUntil,delete o.lastExcludeReason_,r=!0);const d=!o.excludeUntil&&o.excludeUntil!==1/0;!s.has(o.id)&&u&&d&&(s.add(o.id),o.excludeUntil=1/0,o.lastExcludeReason_="content-steering",this.logger_(`excluding ${o.id} for ${o.lastExcludeReason_}`))}),this.contentSteeringController_.manifestType_==="DASH"&&Object.keys(this.mediaTypes_).forEach(a=>{const o=this.mediaTypes_[a];if(o.activePlaylistLoader){const l=o.activePlaylistLoader.media_;l&&l.attributes.serviceLocation!==e&&(r=!0)}}),r&&this.changeSegmentPathway_()}handlePathwayClones_(){const t=this.main().playlists,n=this.contentSteeringController_.currentPathwayClones,s=this.contentSteeringController_.nextPathwayClones;if(n&&n.size||s&&s.size){for(const[a,o]of n.entries())s.get(a)||(this.mainPlaylistLoader_.updateOrDeleteClone(o),this.contentSteeringController_.excludePathway(a));for(const[a,o]of s.entries()){const l=n.get(a);if(!l){t.filter(h=>h.attributes["PATHWAY-ID"]===o["BASE-ID"]).forEach(h=>{this.mainPlaylistLoader_.addClonePathway(o,h)}),this.contentSteeringController_.addAvailablePathway(a);continue}this.equalPathwayClones_(l,o)||(this.mainPlaylistLoader_.updateOrDeleteClone(o,!0),this.contentSteeringController_.addAvailablePathway(a))}this.contentSteeringController_.currentPathwayClones=new Map(JSON.parse(JSON.stringify([...s])))}}equalPathwayClones_(e,t){if(e["BASE-ID"]!==t["BASE-ID"]||e.ID!==t.ID||e["URI-REPLACEMENT"].HOST!==t["URI-REPLACEMENT"].HOST)return!1;const n=e["URI-REPLACEMENT"].PARAMS,s=t["URI-REPLACEMENT"].PARAMS;for(const r in n)if(n[r]!==s[r])return!1;for(const r in s)if(n[r]!==s[r])return!1;return!0}changeSegmentPathway_(){const e=this.selectPlaylist();this.pauseLoading(),this.contentSteeringController_.manifestType_==="DASH"&&this.switchMediaForDASHContentSteering_(),this.switchMedia_(e,"content-steering")}excludeNonUsablePlaylistsByKeyId_(){if(!this.mainPlaylistLoader_||!this.mainPlaylistLoader_.main)return;let e=0;const t="non-usable";this.mainPlaylistLoader_.main.playlists.forEach(n=>{const s=this.mainPlaylistLoader_.getKeyIdSet(n);!s||!s.size||s.forEach(r=>{const a="usable",o=this.keyStatusMap_.has(r)&&this.keyStatusMap_.get(r)===a,l=n.lastExcludeReason_===t&&n.excludeUntil===1/0;o?o&&l&&(delete n.excludeUntil,delete n.lastExcludeReason_,this.logger_(`enabling playlist ${n.id} because key ID ${r} is ${a}`)):(n.excludeUntil!==1/0&&n.lastExcludeReason_!==t&&(n.excludeUntil=1/0,n.lastExcludeReason_=t,this.logger_(`excluding playlist ${n.id} because the key ID ${r} doesn't exist in the keyStatusMap or is not ${a}`)),e++)})}),e>=this.mainPlaylistLoader_.main.playlists.length&&this.mainPlaylistLoader_.main.playlists.forEach(n=>{const s=n&&n.attributes&&n.attributes.RESOLUTION&&n.attributes.RESOLUTION.height<720,r=n.excludeUntil===1/0&&n.lastExcludeReason_===t;s&&r&&(delete n.excludeUntil,q.log.warn(`enabling non-HD playlist ${n.id} because all playlists were excluded due to ${t} key IDs`))})}addKeyStatus_(e,t){const r=(typeof e=="string"?e:YR(e)).slice(0,32).toLowerCase();this.logger_(`KeyStatus '${t}' with key ID ${r} added to the keyStatusMap`),this.keyStatusMap_.set(r,t)}updatePlaylistByKeyStatus(e,t){this.addKeyStatus_(e,t),this.waitingForFastQualityPlaylistReceived_||this.excludeNonUsableThenChangePlaylist_(),this.mainPlaylistLoader_.off("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this)),this.mainPlaylistLoader_.on("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this))}excludeNonUsableThenChangePlaylist_(){this.excludeNonUsablePlaylistsByKeyId_(),this.fastQualityChange_()}}const bP=(i,e,t)=>n=>{const s=i.main.playlists[e],r=Sd(s),a=yu(s);return typeof n>"u"?a:(n?delete s.disabled:s.disabled=!0,n!==a&&!r&&(t(s),n?i.trigger("renditionenabled"):i.trigger("renditiondisabled")),n)};class EP{constructor(e,t,n){const{playlistController_:s}=e,r=s.fastQualityChange_.bind(s);if(t.attributes){const a=t.attributes.RESOLUTION;this.width=a&&a.width,this.height=a&&a.height,this.bandwidth=t.attributes.BANDWIDTH,this.frameRate=t.attributes["FRAME-RATE"]}this.codecs=Ya(s.main(),t),this.playlist=t,this.id=n,this.enabled=bP(e.playlists,t.id,r)}}const AP=function(i){i.representations=()=>{const e=i.playlistController_.main(),t=So(e)?i.playlistController_.getAudioTrackPlaylists_():e.playlists;return t?t.filter(n=>!Sd(n)).map((n,s)=>new EP(i,n,n.id)):[]}},eg=["seeking","seeked","pause","playing","error"];class CP{constructor(e){this.playlistController_=e.playlistController,this.tech_=e.tech,this.seekable=e.seekable,this.allowSeeksWithinUnsafeLiveWindow=e.allowSeeksWithinUnsafeLiveWindow,this.liveRangeSafeTimeDelta=e.liveRangeSafeTimeDelta,this.media=e.media,this.consecutiveUpdates=0,this.lastRecordedTime=null,this.checkCurrentTimeTimeout_=null,this.logger_=$i("PlaybackWatcher"),this.logger_("initialize");const t=()=>this.monitorCurrentTime_(),n=()=>this.monitorCurrentTime_(),s=()=>this.techWaiting_(),r=()=>this.resetTimeUpdate_(),a=this.playlistController_,o=["main","subtitle","audio"],l={};o.forEach(h=>{l[h]={reset:()=>this.resetSegmentDownloads_(h),updateend:()=>this.checkSegmentDownloads_(h)},a[`${h}SegmentLoader_`].on("appendsdone",l[h].updateend),a[`${h}SegmentLoader_`].on("playlistupdate",l[h].reset),this.tech_.on(["seeked","seeking"],l[h].reset)});const u=h=>{["main","audio"].forEach(d=>{a[`${d}SegmentLoader_`][h]("appended",this.seekingAppendCheck_)})};this.seekingAppendCheck_=()=>{this.fixesBadSeeks_()&&(this.consecutiveUpdates=0,this.lastRecordedTime=this.tech_.currentTime(),u("off"))},this.clearSeekingAppendCheck_=()=>u("off"),this.watchForBadSeeking_=()=>{this.clearSeekingAppendCheck_(),u("on")},this.tech_.on("seeked",this.clearSeekingAppendCheck_),this.tech_.on("seeking",this.watchForBadSeeking_),this.tech_.on("waiting",s),this.tech_.on(eg,r),this.tech_.on("canplay",n),this.tech_.one("play",t),this.dispose=()=>{this.clearSeekingAppendCheck_(),this.logger_("dispose"),this.tech_.off("waiting",s),this.tech_.off(eg,r),this.tech_.off("canplay",n),this.tech_.off("play",t),this.tech_.off("seeking",this.watchForBadSeeking_),this.tech_.off("seeked",this.clearSeekingAppendCheck_),o.forEach(h=>{a[`${h}SegmentLoader_`].off("appendsdone",l[h].updateend),a[`${h}SegmentLoader_`].off("playlistupdate",l[h].reset),this.tech_.off(["seeked","seeking"],l[h].reset)}),this.checkCurrentTimeTimeout_&&N.clearTimeout(this.checkCurrentTimeTimeout_),this.resetTimeUpdate_()}}monitorCurrentTime_(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&N.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=N.setTimeout(this.monitorCurrentTime_.bind(this),250)}resetSegmentDownloads_(e){const t=this.playlistController_[`${e}SegmentLoader_`];this[`${e}StalledDownloads_`]>0&&this.logger_(`resetting possible stalled download count for ${e} loader`),this[`${e}StalledDownloads_`]=0,this[`${e}Buffered_`]=t.buffered_()}checkSegmentDownloads_(e){const t=this.playlistController_,n=t[`${e}SegmentLoader_`],s=n.buffered_(),r=mD(this[`${e}Buffered_`],s);if(this[`${e}Buffered_`]=s,r){this.resetSegmentDownloads_(e);return}this[`${e}StalledDownloads_`]++,this.logger_(`found #${this[`${e}StalledDownloads_`]} ${e} appends that did not increase buffer (possible stalled download)`,{playlistId:n.playlist_&&n.playlist_.id,buffered:Us(s)}),!(this[`${e}StalledDownloads_`]<10)&&(this.logger_(`${e} loader stalled download exclusion`),this.resetSegmentDownloads_(e),this.tech_.trigger({type:"usage",name:`vhs-${e}-download-exclusion`}),e!=="subtitle"&&t.excludePlaylist({error:{message:`Excessive ${e} segment downloading detected.`},playlistExclusionDuration:1/0}))}checkCurrentTime_(){if(this.tech_.paused()||this.tech_.seeking())return;const e=this.tech_.currentTime(),t=this.tech_.buffered();if(this.lastRecordedTime===e&&(!t.length||e+_n>=t.end(t.length-1)))return this.techWaiting_();this.consecutiveUpdates>=5&&e===this.lastRecordedTime?(this.consecutiveUpdates++,this.waiting_()):e===this.lastRecordedTime?this.consecutiveUpdates++:(this.consecutiveUpdates=0,this.lastRecordedTime=e)}resetTimeUpdate_(){this.consecutiveUpdates=0}fixesBadSeeks_(){if(!this.tech_.seeking())return!1;const t=this.seekable(),n=this.tech_.currentTime(),s=this.afterSeekableWindow_(t,n,this.media(),this.allowSeeksWithinUnsafeLiveWindow);let r;if(s&&(r=t.end(t.length-1)),this.beforeSeekableWindow_(t,n)){const v=t.start(0);r=v+(v===t.end(0)?0:_n)}if(typeof r<"u")return this.logger_(`Trying to seek outside of seekable at time ${n} with seekable range ${q_(t)}. Seeking to ${r}.`),this.tech_.setCurrentTime(r),!0;const a=this.playlistController_.sourceUpdater_,o=this.tech_.buffered(),l=a.audioBuffer?a.audioBuffered():null,u=a.videoBuffer?a.videoBuffered():null,h=this.media(),d=h.partTargetDuration?h.partTargetDuration:(h.targetDuration-gn)*2,m=[l,u];for(let v=0;v<m.length;v++){if(!m[v])continue;if(Td(m[v],n)<d)return!1}const y=dl(o,n);return y.length===0?!1:(r=y.start(0)+_n,this.logger_(`Buffered region starts (${y.start(0)})  just beyond seek point (${n}). Seeking to ${r}.`),this.tech_.setCurrentTime(r),!0)}waiting_(){if(this.techWaiting_())return;const e=this.tech_.currentTime(),t=this.tech_.buffered(),n=Cr(t,e);if(n.length&&e+3<=n.end(0)){this.resetTimeUpdate_(),this.tech_.setCurrentTime(e),this.logger_(`Stopped at ${e} while inside a buffered region [${n.start(0)} -> ${n.end(0)}]. Attempting to resume playback by seeking to the current time.`),this.tech_.trigger({type:"usage",name:"vhs-unknown-waiting"});return}}techWaiting_(){const e=this.seekable(),t=this.tech_.currentTime();if(this.tech_.seeking())return!0;if(this.beforeSeekableWindow_(e,t)){const o=e.end(e.length-1);return this.logger_(`Fell out of live window at time ${t}. Seeking to live point (seekable end) ${o}`),this.resetTimeUpdate_(),this.tech_.setCurrentTime(o),this.tech_.trigger({type:"usage",name:"vhs-live-resync"}),!0}const n=this.tech_.vhs.playlistController_.sourceUpdater_,s=this.tech_.buffered();if(this.videoUnderflow_({audioBuffered:n.audioBuffered(),videoBuffered:n.videoBuffered(),currentTime:t}))return this.resetTimeUpdate_(),this.tech_.setCurrentTime(t),this.tech_.trigger({type:"usage",name:"vhs-video-underflow"}),!0;const a=dl(s,t);return a.length>0?(this.logger_(`Stopped at ${t} and seeking to ${a.start(0)}`),this.resetTimeUpdate_(),this.skipTheGap_(t),!0):!1}afterSeekableWindow_(e,t,n,s=!1){if(!e.length)return!1;let r=e.end(e.length-1)+_n;const a=!n.endList,o=typeof n.partTargetDuration=="number";return a&&(o||s)&&(r=e.end(e.length-1)+n.targetDuration*3),t>r}beforeSeekableWindow_(e,t){return!!(e.length&&e.start(0)>0&&t<e.start(0)-this.liveRangeSafeTimeDelta)}videoUnderflow_({videoBuffered:e,audioBuffered:t,currentTime:n}){if(!e)return;let s;if(e.length&&t.length){const r=Cr(e,n-3),a=Cr(e,n),o=Cr(t,n);o.length&&!a.length&&r.length&&(s={start:r.end(0),end:o.end(0)})}else dl(e,n).length||(s=this.gapFromVideoUnderflow_(e,n));return s?(this.logger_(`Encountered a gap in video from ${s.start} to ${s.end}. Seeking to current time ${n}`),!0):!1}skipTheGap_(e){const t=this.tech_.buffered(),n=this.tech_.currentTime(),s=dl(t,n);this.resetTimeUpdate_(),!(s.length===0||n!==e)&&(this.logger_("skipTheGap_:","currentTime:",n,"scheduled currentTime:",e,"nextRange start:",s.start(0)),this.tech_.setCurrentTime(s.start(0)+gn),this.tech_.trigger({type:"usage",name:"vhs-gap-skip"}))}gapFromVideoUnderflow_(e,t){const n=dD(e);for(let s=0;s<n.length;s++){const r=n.start(s),a=n.end(s);if(t-r<4&&t-r>2)return{start:r,end:a}}return null}}const MP={errorInterval:30,getSource(i){const t=this.tech({IWillNotUseThisInPlugins:!0}).currentSource_||this.currentSource();return i(t)}},Iv=function(i,e){let t=0,n=0;const s=ht(MP,e);i.ready(()=>{i.trigger({type:"usage",name:"vhs-error-reload-initialized"})});const r=function(){n&&i.currentTime(n)},a=function(h){h!=null&&(n=i.duration()!==1/0&&i.currentTime()||0,i.one("loadedmetadata",r),i.src(h),i.trigger({type:"usage",name:"vhs-error-reload"}),i.play())},o=function(){if(Date.now()-t<s.errorInterval*1e3){i.trigger({type:"usage",name:"vhs-error-reload-canceled"});return}if(!s.getSource||typeof s.getSource!="function"){q.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!");return}return t=Date.now(),s.getSource.call(i,a)},l=function(){i.off("loadedmetadata",r),i.off("error",o),i.off("dispose",l)},u=function(h){l(),Iv(i,h)};i.on("error",o),i.on("dispose",l),i.reloadSourceOnError=u},wP=function(i){Iv(this,i)};var Ov="3.12.1",DP="7.0.3",RP="1.3.0",PP="7.1.0",LP="4.0.1";const Ct={PlaylistLoader:Mr,Playlist:xi,utils:BD,STANDARD_PLAYLIST_SELECTOR:zm,INITIAL_PLAYLIST_SELECTOR:MR,lastBandwidthSelector:zm,movingAverageBandwidthSelector:AR,comparePlaylistBandwidth:Ad,comparePlaylistResolution:ER,xhr:ov()};Object.keys(jt).forEach(i=>{Object.defineProperty(Ct,i,{get(){return q.log.warn(`using Vhs.${i} is UNSAFE be sure you know what you are doing`),jt[i]},set(e){if(q.log.warn(`using Vhs.${i} is UNSAFE be sure you know what you are doing`),typeof e!="number"||e<0){q.log.warn(`value of Vhs.${i} must be greater than or equal to 0`);return}jt[i]=e}})});const Uv="videojs-vhs",Nv=function(i,e){const t=e.media();let n=-1;for(let s=0;s<i.length;s++)if(i[s].id===t.id){n=s;break}i.selectedIndex_=n,i.trigger({selectedIndex:n,type:"change"})},IP=function(i,e){e.representations().forEach(t=>{i.addQualityLevel(t)}),Nv(i,e.playlists)};Ct.canPlaySource=function(){return q.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};const OP=(i,e,t)=>{if(!i)return i;let n={};e&&e.attributes&&e.attributes.CODECS&&(n=zl(dn(e.attributes.CODECS))),t&&t.attributes&&t.attributes.CODECS&&(n.audio=t.attributes.CODECS);const s=to(n.video),r=to(n.audio),a={};for(const o in i)a[o]={},r&&(a[o].audioContentType=r),s&&(a[o].videoContentType=s),e.contentProtection&&e.contentProtection[o]&&e.contentProtection[o].pssh&&(a[o].pssh=e.contentProtection[o].pssh),typeof i[o]=="string"&&(a[o].url=i[o]);return ht(i,a)},UP=(i,e)=>i.reduce((t,n)=>{if(!n.contentProtection)return t;const s=e.reduce((r,a)=>{const o=n.contentProtection[a];return o&&o.pssh&&(r[a]={pssh:o.pssh}),r},{});return Object.keys(s).length&&t.push(s),t},[]),NP=({player:i,sourceKeySystems:e,audioMedia:t,mainPlaylists:n})=>{if(!i.eme.initializeMediaKeys)return Promise.resolve();const s=t?n.concat([t]):n,r=UP(s,Object.keys(e)),a=[],o=[];return r.forEach(l=>{o.push(new Promise((u,h)=>{i.tech_.one("keysessioncreated",u)})),a.push(new Promise((u,h)=>{i.eme.initializeMediaKeys({keySystems:l},d=>{if(d){h(d);return}u()})}))}),Promise.race([Promise.all(a),Promise.race(o)])},kP=({player:i,sourceKeySystems:e,media:t,audioMedia:n})=>{const s=OP(e,t,n);return s?(i.currentSource().keySystems=s,s&&!i.eme?(q.log.warn("DRM encrypted source cannot be decrypted without a DRM plugin"),!1):!0):!1},kv=()=>{if(!N.localStorage)return null;const i=N.localStorage.getItem(Uv);if(!i)return null;try{return JSON.parse(i)}catch{return null}},FP=i=>{if(!N.localStorage)return!1;let e=kv();e=e?ht(e,i):i;try{N.localStorage.setItem(Uv,JSON.stringify(e))}catch{return!1}return e},BP=i=>i.toLowerCase().indexOf("data:application/vnd.videojs.vhs+json,")===0?JSON.parse(i.substring(i.indexOf(",")+1)):i,Fv=(i,e)=>{i._requestCallbackSet||(i._requestCallbackSet=new Set),i._requestCallbackSet.add(e)},Bv=(i,e)=>{i._responseCallbackSet||(i._responseCallbackSet=new Set),i._responseCallbackSet.add(e)},Hv=(i,e)=>{i._requestCallbackSet&&(i._requestCallbackSet.delete(e),i._requestCallbackSet.size||delete i._requestCallbackSet)},Vv=(i,e)=>{i._responseCallbackSet&&(i._responseCallbackSet.delete(e),i._responseCallbackSet.size||delete i._responseCallbackSet)};Ct.supportsNativeHls=function(){if(!_e||!_e.createElement)return!1;const i=_e.createElement("video");return q.getTech("Html5").isSupported()?["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some(function(t){return/maybe|probably/i.test(i.canPlayType(t))}):!1}();Ct.supportsNativeDash=function(){return!_e||!_e.createElement||!q.getTech("Html5").isSupported()?!1:/maybe|probably/i.test(_e.createElement("video").canPlayType("application/dash+xml"))}();Ct.supportsTypeNatively=i=>i==="hls"?Ct.supportsNativeHls:i==="dash"?Ct.supportsNativeDash:!1;Ct.isSupported=function(){return q.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};Ct.xhr.onRequest=function(i){Fv(Ct.xhr,i)};Ct.xhr.onResponse=function(i){Bv(Ct.xhr,i)};Ct.xhr.offRequest=function(i){Hv(Ct.xhr,i)};Ct.xhr.offResponse=function(i){Vv(Ct.xhr,i)};const HP=q.getComponent("Component");class zv extends HP{constructor(e,t,n){if(super(t,n.vhs),typeof n.initialBandwidth=="number"&&(this.options_.bandwidth=n.initialBandwidth),this.logger_=$i("VhsHandler"),t.options_&&t.options_.playerId){const s=q.getPlayer(t.options_.playerId);this.player_=s}if(this.tech_=t,this.source_=e,this.stats={},this.ignoreNextSeekingEvent_=!1,this.setOptions_(),this.options_.overrideNative&&t.overrideNativeAudioTracks&&t.overrideNativeVideoTracks)t.overrideNativeAudioTracks(!0),t.overrideNativeVideoTracks(!0);else if(this.options_.overrideNative&&(t.featuresNativeVideoTracks||t.featuresNativeAudioTracks))throw new Error("Overriding native VHS requires emulated tracks. See https://git.io/vMpjB");this.on(_e,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],s=>{const r=_e.fullscreenElement||_e.webkitFullscreenElement||_e.mozFullScreenElement||_e.msFullscreenElement;r&&r.contains(this.tech_.el())?this.playlistController_.fastQualityChange_():this.playlistController_.checkABR_()}),this.on(this.tech_,"seeking",function(){if(this.ignoreNextSeekingEvent_){this.ignoreNextSeekingEvent_=!1;return}this.setCurrentTime(this.tech_.currentTime())}),this.on(this.tech_,"error",function(){this.tech_.error()&&this.playlistController_&&this.playlistController_.pauseLoading()}),this.on(this.tech_,"play",this.play)}setOptions_(e={}){if(this.options_=ht(this.options_,e),this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions!==!1,this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1,this.options_.useBandwidthFromLocalStorage=typeof this.source_.useBandwidthFromLocalStorage<"u"?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.useForcedSubtitles=this.options_.useForcedSubtitles||!1,this.options_.useNetworkInformationApi=this.options_.useNetworkInformationApi||!1,this.options_.useDtsForTimestampOffset=this.options_.useDtsForTimestampOffset||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,this.options_.llhls=this.options_.llhls!==!1,this.options_.bufferBasedABR=this.options_.bufferBasedABR||!1,typeof this.options_.playlistExclusionDuration!="number"&&(this.options_.playlistExclusionDuration=60),typeof this.options_.bandwidth!="number"&&this.options_.useBandwidthFromLocalStorage){const n=kv();n&&n.bandwidth&&(this.options_.bandwidth=n.bandwidth,this.tech_.trigger({type:"usage",name:"vhs-bandwidth-from-local-storage"})),n&&n.throughput&&(this.options_.throughput=n.throughput,this.tech_.trigger({type:"usage",name:"vhs-throughput-from-local-storage"}))}typeof this.options_.bandwidth!="number"&&(this.options_.bandwidth=jt.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===jt.INITIAL_BANDWIDTH,["withCredentials","useDevicePixelRatio","customPixelRatio","limitRenditionByPlayerDimensions","bandwidth","customTagParsers","customTagMappers","cacheEncryptionKeys","playlistSelector","initialPlaylistSelector","bufferBasedABR","liveRangeSafeTimeDelta","llhls","useForcedSubtitles","useNetworkInformationApi","useDtsForTimestampOffset","exactManifestTimings","leastPixelDiffSelector"].forEach(n=>{typeof this.source_[n]<"u"&&(this.options_[n]=this.source_[n])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions,this.useDevicePixelRatio=this.options_.useDevicePixelRatio;const t=this.options_.customPixelRatio;typeof t=="number"&&t>=0&&(this.customPixelRatio=t)}setOptions(e={}){this.setOptions_(e)}src(e,t){if(!e)return;this.setOptions_(),this.options_.src=BP(this.source_.src),this.options_.tech=this.tech_,this.options_.externVhs=Ct,this.options_.sourceType=Bg(t),this.options_.seekTo=r=>{this.tech_.setCurrentTime(r)},this.playlistController_=new SP(this.options_);const n=ht({liveRangeSafeTimeDelta:_n},this.options_,{seekable:()=>this.seekable(),media:()=>this.playlistController_.media(),playlistController:this.playlistController_});this.playbackWatcher_=new CP(n),this.playlistController_.on("error",()=>{const r=q.players[this.tech_.options_.playerId];let a=this.playlistController_.error;typeof a=="object"&&!a.code?a.code=3:typeof a=="string"&&(a={message:a,code:3}),r.error(a)});const s=this.options_.bufferBasedABR?Ct.movingAverageBandwidthSelector(.55):Ct.STANDARD_PLAYLIST_SELECTOR;this.playlistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):s.bind(this),this.playlistController_.selectInitialPlaylist=Ct.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.playlistController_.mainPlaylistLoader_,this.mediaSource=this.playlistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get(){return this.playlistController_.selectPlaylist},set(r){this.playlistController_.selectPlaylist=r.bind(this)}},throughput:{get(){return this.playlistController_.mainSegmentLoader_.throughput.rate},set(r){this.playlistController_.mainSegmentLoader_.throughput.rate=r,this.playlistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get(){let r=this.playlistController_.mainSegmentLoader_.bandwidth;const a=N.navigator.connection||N.navigator.mozConnection||N.navigator.webkitConnection,o=1e7;if(this.options_.useNetworkInformationApi&&a){const l=a.downlink*1e3*1e3;l>=o&&r>=o?r=Math.max(r,l):r=l}return r},set(r){this.playlistController_.mainSegmentLoader_.bandwidth=r,this.playlistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get(){const r=1/(this.bandwidth||1);let a;return this.throughput>0?a=1/this.throughput:a=0,Math.floor(1/(r+a))},set(){q.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:()=>this.bandwidth||0,enumerable:!0},mediaRequests:{get:()=>this.playlistController_.mediaRequests_()||0,enumerable:!0},mediaRequestsAborted:{get:()=>this.playlistController_.mediaRequestsAborted_()||0,enumerable:!0},mediaRequestsTimedout:{get:()=>this.playlistController_.mediaRequestsTimedout_()||0,enumerable:!0},mediaRequestsErrored:{get:()=>this.playlistController_.mediaRequestsErrored_()||0,enumerable:!0},mediaTransferDuration:{get:()=>this.playlistController_.mediaTransferDuration_()||0,enumerable:!0},mediaBytesTransferred:{get:()=>this.playlistController_.mediaBytesTransferred_()||0,enumerable:!0},mediaSecondsLoaded:{get:()=>this.playlistController_.mediaSecondsLoaded_()||0,enumerable:!0},mediaAppends:{get:()=>this.playlistController_.mediaAppends_()||0,enumerable:!0},mainAppendsToLoadedData:{get:()=>this.playlistController_.mainAppendsToLoadedData_()||0,enumerable:!0},audioAppendsToLoadedData:{get:()=>this.playlistController_.audioAppendsToLoadedData_()||0,enumerable:!0},appendsToLoadedData:{get:()=>this.playlistController_.appendsToLoadedData_()||0,enumerable:!0},timeToLoadedData:{get:()=>this.playlistController_.timeToLoadedData_()||0,enumerable:!0},buffered:{get:()=>Us(this.tech_.buffered()),enumerable:!0},currentTime:{get:()=>this.tech_.currentTime(),enumerable:!0},currentSource:{get:()=>this.tech_.currentSource_,enumerable:!0},currentTech:{get:()=>this.tech_.name_,enumerable:!0},duration:{get:()=>this.tech_.duration(),enumerable:!0},main:{get:()=>this.playlists.main,enumerable:!0},playerDimensions:{get:()=>this.tech_.currentDimensions(),enumerable:!0},seekable:{get:()=>Us(this.tech_.seekable()),enumerable:!0},timestamp:{get:()=>Date.now(),enumerable:!0},videoPlaybackQuality:{get:()=>this.tech_.getVideoPlaybackQuality(),enumerable:!0}}),this.tech_.one("canplay",this.playlistController_.setupFirstPlay.bind(this.playlistController_)),this.tech_.on("bandwidthupdate",()=>{this.options_.useBandwidthFromLocalStorage&&FP({bandwidth:this.bandwidth,throughput:Math.round(this.throughput)})}),this.playlistController_.on("selectedinitialmedia",()=>{AP(this)}),this.playlistController_.sourceUpdater_.on("createdsourcebuffers",()=>{this.setupEme_()}),this.on(this.playlistController_,"progress",function(){this.tech_.trigger("progress")}),this.on(this.playlistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=!0}),this.setupQualityLevels_(),this.tech_.el()&&(this.mediaSourceUrl_=N.URL.createObjectURL(this.playlistController_.mediaSource),this.tech_.src(this.mediaSourceUrl_))}createKeySessions_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader;this.logger_("waiting for EME key session creation"),NP({player:this.player_,sourceKeySystems:this.source_.keySystems,audioMedia:e&&e.media(),mainPlaylists:this.playlists.main.playlists}).then(()=>{this.logger_("created EME key session"),this.playlistController_.sourceUpdater_.initializedEme()}).catch(t=>{this.logger_("error while creating EME key session",t),this.player_.error({message:"Failed to initialize media keys for EME",code:3,metadata:{errorType:q.Error.EMEKeySessionCreationError}})})}handleWaitingForKey_(){this.logger_("waitingforkey fired, attempting to create any new key sessions"),this.createKeySessions_()}setupEme_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader,t=kP({player:this.player_,sourceKeySystems:this.source_.keySystems,media:this.playlists.media(),audioMedia:e&&e.media()});if(this.player_.tech_.on("keystatuschange",n=>{this.playlistController_.updatePlaylistByKeyStatus(n.keyId,n.status)}),this.handleWaitingForKey_=this.handleWaitingForKey_.bind(this),this.player_.tech_.on("waitingforkey",this.handleWaitingForKey_),!t){this.playlistController_.sourceUpdater_.initializedEme();return}this.createKeySessions_()}setupQualityLevels_(){const e=q.players[this.tech_.options_.playerId];!e||!e.qualityLevels||this.qualityLevels_||(this.qualityLevels_=e.qualityLevels(),this.playlistController_.on("selectedinitialmedia",()=>{IP(this.qualityLevels_,this)}),this.playlists.on("mediachange",()=>{Nv(this.qualityLevels_,this.playlists)}))}static version(){return{"@videojs/http-streaming":Ov,"mux.js":DP,"mpd-parser":RP,"m3u8-parser":PP,"aes-decrypter":LP}}version(){return this.constructor.version()}canChangeType(){return Rv.canChangeType()}play(){this.playlistController_.play()}setCurrentTime(e){this.playlistController_.setCurrentTime(e)}duration(){return this.playlistController_.duration()}seekable(){return this.playlistController_.seekable()}dispose(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.playlistController_&&this.playlistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.tech_&&this.tech_.vhs&&delete this.tech_.vhs,this.mediaSourceUrl_&&N.URL.revokeObjectURL&&(N.URL.revokeObjectURL(this.mediaSourceUrl_),this.mediaSourceUrl_=null),this.tech_&&this.tech_.off("waitingforkey",this.handleWaitingForKey_),super.dispose()}convertToProgramTime(e,t){return $D({playlist:this.playlistController_.media(),time:e,callback:t})}seekToProgramTime(e,t,n=!0,s=2){return dv({programTime:e,playlist:this.playlistController_.media(),retryCount:s,pauseAfterSeek:n,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:t})}setupXhrHooks_(){this.xhr.onRequest=e=>{Fv(this.xhr,e)},this.xhr.onResponse=e=>{Bv(this.xhr,e)},this.xhr.offRequest=e=>{Hv(this.xhr,e)},this.xhr.offResponse=e=>{Vv(this.xhr,e)},this.player_.trigger("xhr-hooks-ready")}}const ql={name:"videojs-http-streaming",VERSION:Ov,canHandleSource(i,e={}){const t=ht(q.options,e);return ql.canPlayType(i.type,t)},handleSource(i,e,t={}){const n=ht(q.options,t);return e.vhs=new zv(i,e,n),e.vhs.xhr=ov(),e.vhs.setupXhrHooks_(),e.vhs.src(i.src,i.type),e.vhs},canPlayType(i,e){const t=Bg(i);if(!t)return"";const n=ql.getOverrideNative(e);return!Ct.supportsTypeNatively(t)||n?"maybe":""},getOverrideNative(i={}){const{vhs:e={}}=i,t=!(q.browser.IS_ANY_SAFARI||q.browser.IS_IOS),{overrideNative:n=t}=e;return n}},VP=()=>gl("avc1.4d400d,mp4a.40.2");VP()&&q.getTech("Html5").registerSourceHandler(ql,0);q.VhsHandler=zv;q.VhsSourceHandler=ql;q.Vhs=Ct;q.use||q.registerComponent("Vhs",Ct);q.options.vhs=q.options.vhs||{};(!q.getPlugin||!q.getPlugin("reloadSourceOnError"))&&q.registerPlugin("reloadSourceOnError",wP);const zP=["id"],GP=tg({__name:"LmVideo",props:{id:null,url:null,options:{default:()=>({controls:!0,autoplay:!1,muted:!1,preload:"auto"})},is360:{type:Boolean,default:!1}},setup(i){const e=i,t=new Vi(75,window.innerWidth/window.innerHeight,.25,10),n=new N1,s=new Rg,r=_T({isUserInteracting:!1,lon:0,lat:0,phi:0,theta:0,onPointerDownPointerX:0,onPointerDownPointerY:0,onPointerDownLon:0,onPointerDownLat:0,distance:.5}),a=hf(),o=hf(),l=()=>{r.lat=Math.max(-85,Math.min(85,r.lat)),r.phi=qf.degToRad(90-r.lat),r.theta=qf.degToRad(r.lon),t.position.x=r.distance*Math.sin(r.phi)*Math.cos(r.theta),t.position.y=r.distance*Math.cos(r.phi),t.position.z=r.distance*Math.sin(r.phi)*Math.sin(r.theta),t.lookAt(0,0,0),s.render(n,t)},u=v=>{r.isUserInteracting=!0,r.onPointerDownPointerX=v.clientX,r.onPointerDownPointerY=v.clientY,r.onPointerDownLon=r.lon,r.onPointerDownLat=r.lat},h=v=>{r.isUserInteracting===!0&&(r.lon=(r.onPointerDownPointerX-v.clientX)*.1+r.onPointerDownLon,r.lat=(r.onPointerDownPointerY-v.clientY)*.1+r.onPointerDownLat)},d=()=>{r.isUserInteracting=!1},m=()=>{const v=document.getElementById(e.id);t.aspect=window.innerWidth/window.innerHeight,t.updateProjectionMatrix(),s.setSize(v.clientWidth,v.clientHeight)},y=()=>{const v=document.getElementById(e.id),b=document.getElementById(`${e.id}_html5_api`);if(!b)return;b.style.display="none",b.currentTime=0;const x=new Ah(5,60,40);x.scale(-1,1,1);const _=new k1(b);_.colorSpace=Ze;const E=new Sh({map:_}),A=new Wn(x,E);n.add(A),s.setPixelRatio(window.devicePixelRatio),s.setSize(v.clientWidth,v.clientHeight),s.setAnimationLoop(l),s.domElement.class="vjs-tech",v.appendChild(s.domElement),a.value.addEventListener("pointerdown",u),a.value.addEventListener("pointermove",h),a.value.addEventListener("pointerup",d),window.addEventListener("resize",m)};return vT(()=>{o.value=q(e.id,{...e.options,html5:{hls:{withCredentials:!0}},sources:[{src:e.url,type:e.url.endsWith(".mu3u8")?"application/x-mpegURL":""}]}),e.is360&&y()}),(v,b)=>(ig(),ng("div",{class:"lm-video",ref_key:"lmVideoRef",ref:a},[yT("video",{id:e.id,class:"lm-video-dom video-js vjs-default-skin"},null,8,zP)],512))}});const WP=TT(GP,[["__scopeId","data-v-4b42eb54"]]),qP={class:"comp-box"},jP=tg({__name:"index",setup(i){return(e,t)=>(ig(),ng("div",qP,[xT(WP,{id:"zzh",url:"/PanoramaPlayer/video/362.mp4",is360:""})]))}});export{jP as default};
